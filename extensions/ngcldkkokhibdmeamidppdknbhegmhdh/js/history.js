require.config({baseUrl:"./js",paths:{promise:"./lib/promise.min"}});
require("promise ./module/i18nDom ./module/dom ./module/utils ./lib/moment-with-locales.min ./module/highlight ./module/counter".split(" "),function(q,r,b,t,k,l,u){(new q(function(b){k.locale(chrome.i18n.getUILanguage());r();chrome.storage.local.get({history:[],clickHistory:[]},b)})).then(function(c){document.body.classList.remove("loading");var m=function(){return b.el("div",{class:["history_empty"],append:[b.el("span",{text:chrome.i18n.getMessage("historyEmpty")})]})},p=function(a,d){var g=a.slice(0),
e={};d.forEach(function(b){var d=b.query.trim();e[d]||(e[d]=[]);e[d].push(b)});var f=b.el("div",{class:["history"]});g.length?b.el(f,{append:g.map(function(a,c){var h=a.query,n=e[h]||[],g=l.getMap(h);return b.el("div",{class:["history__item"],append:[b.el("div",{class:["item","item-query"],data:{index:c},append:[b.el("a",{class:["item__remove"],data:{action:"remove-query"},href:"#remove",title:chrome.i18n.getMessage("remove")}),b.el("a",{class:["item__link"],href:"index.html#"+t.hashParam({query:h,
profileId:a.profileId}),text:h?h:JSON.stringify(h)})]}),b.el("div",{class:["click_history","item__click_history"],append:n.map(function(d,a){return b.el("div",{class:["item","item-click_history"],data:{index:a},append:[b.el("a",{class:["item__remove"],data:{action:"remove-click_history"},href:"#remove",title:chrome.i18n.getMessage("remove")}),b.el("span",{class:["item__date"],text:k(1E3*d.time).format("lll")}),b.el("a",{class:["item__link"],target:"_blank",href:d.url,append:[l.insert(d.title,g)]})]})}),
on:["click",function(a){var c=b.closest("a",a.target);if(c&&"remove-click_history"===c.dataset.action){a.preventDefault();var e=c.parentNode;a=d.indexOf(n[e.dataset.index]);-1!==a&&(d.splice(a,1),chrome.storage.local.set({clickHistory:d},function(){e.parentNode.removeChild(e)}))}}]})]})}),on:["click",function(c){var f=b.closest("a",c.target);if(f&&"remove-query"===f.dataset.action){c.preventDefault();var h=f.parentNode;c=g[h.dataset.index];f=a.indexOf(c);-1!==f&&a.splice(f,1);(e[c.query]||[]).forEach(function(a){a=
d.indexOf(a);-1!==a&&d.splice(a,1)});chrome.storage.local.set({history:a,clickHistory:d},function(){var a=h.parentNode,c=a.parentNode;c.removeChild(a);0===c.childNodes.length&&c.appendChild(m())})}}]}):f.appendChild(m());var c=document.querySelector(".history");c.parentNode.replaceChild(f,c)};p(c.history,c.clickHistory);chrome.storage.onChanged.addListener(function(a){var b=c.history,g=a.history,e=c.clickHistory;a=a.clickHistory;var f=!1;g&&JSON.stringify(g.newValue)!==JSON.stringify(b)&&(b.splice(0),
b.push.apply(b,g.newValue),f=!0);a&&JSON.stringify(a.newValue)!==JSON.stringify(e)&&(e.splice(0),e.push.apply(e,a.newValue),f=!0);f&&p(c.history,c.clickHistory)});u()})});
