define(function(){var f=function(){},g=function(a){return function(){a&&(a.apply(null,arguments),a=null)}};return function(a){var h=0,d={};this.onMessage=function(e){a.onMessage(function(b){if(b.responseId)return d[b.responseId](b.message);var c=b.callbackId?g(function(c){a.sendMessage({responseId:b.callbackId,message:c})}):f;!0!==e(b.message,c)&&c()})};this.sendMessage=function(e,b){var c={message:e};b&&(c.callbackId=++h,d[c.callbackId]=function(a){delete d[c.callbackId];b(a)});a.sendMessage(c)}}});
