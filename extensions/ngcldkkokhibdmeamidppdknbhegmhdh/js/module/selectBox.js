define(["./dom"],function(e){return function(d,f){f=f||{};var a=this;a.isOpen=!1;a.control=null;a.selected=null;a.menu=null;var g=function(){return[].slice.call(d.childNodes).filter(function(a){return"OPTION"===a.tagName})},h=function(b){a.control.contains(b.target)||a.menu.contains(b.target)||(document.removeEventListener("click",h,!0),a.hide())};a.open=function(){if(!a.isOpen){a.isOpen=!0;a.control.classList.add("simple_select-open");a.menu.style.display="";var b=a.control.getBoundingClientRect();
a.menu.style.top=b.top+window.pageYOffset+a.control.clientHeight+1+"px";a.menu.style.left=b.left+"px";a.menu.style.width=a.control.clientWidth+"px";a.overItem(a.control.dataset.selectedIndex);a.menu.parentNode||a.control.parentNode.insertBefore(a.menu,a.control.nextElementSibling);document.addEventListener("click",h,!0)}};a.hide=function(){a.isOpen&&(a.isOpen=!1,a.control.classList.remove("simple_select-open"),a.menu.style.display="none")};a.overItem=function(b){var c=a.menu.querySelector(".simple_select__menu__item-selected");
c&&c.classList.remove("simple_select__menu__item-selected");(b=a.menu.childNodes[b])&&b.classList.add("simple_select__menu__item-selected")};a.overNextItem=function(){var b=a.menu.querySelector(".simple_select__menu__item-selected"),c=null;b&&(b.classList.remove("simple_select__menu__item-selected"),c=b.nextElementSibling);c||(c=a.menu.firstChild);c.classList.add("simple_select__menu__item-selected")};a.overPreviewItem=function(){var b=a.menu.querySelector(".simple_select__menu__item-selected"),c=
null;b&&(b.classList.remove("simple_select__menu__item-selected"),c=b.previousElementSibling);c||(c=a.menu.lastChild);c.classList.add("simple_select__menu__item-selected")};a.syncSelectedIndex=function(){var b=d.selectedIndex;a.control.dataset.selectedIndex=b;var c=g()[b];c&&(a.selected.textContent=c.textContent,a.selected.dataset.index=b)};a.select=function(b){b||0==b||(b=(b=a.menu.querySelector(".simple_select__menu__item-selected"))?b.dataset.index:d.selectedIndex);if(a.control.dataset.selectedIndex!=
b){a.control.dataset.selectedIndex=b;var c=g()[b];c&&(a.selected.textContent=c.textContent,a.selected.dataset.index=b);d.selectedIndex!=b&&(d.selectedIndex=b,d.dispatchEvent(new CustomEvent("change",{detail:"simpleSelect"})))}a.hide()};a.update=function(){var b=document.createDocumentFragment();g().forEach(function(c,d){b.appendChild(e.el("a",{class:"simple_select__menu__item",href:"#option",data:{value:c.value,index:d},text:c.textContent,on:["click",function(b){b.preventDefault();a.select(this.dataset.index)}]}))});
a.menu?(a.menu.textContent="",a.menu.appendChild(b)):a.menu=e.el("div",{class:"simple_select__menu",style:{display:"none",position:"absolute"},on:["click",function(a){a.stopPropagation()}],append:b})};a.control=e.el("a",{href:"#selectBox",class:["simple_select"],append:[a.selected=e.el("span",{class:["simple_select__value"]}),f.editBtn?a.editBtn=e.el("span",{class:["simple_select__btn"],append:[f.editBtn]}):"",a.arrowBtn=e.el("a",{href:"#open",class:["simple_select__btn"],append:[e.el("i",{class:["simple_select__btn__icon",
"simple_select__btn__icon-arrow"]})]})],on:[["click",function(b){b.preventDefault();a.isOpen?a.select():a.open()}],["keydown",function(b){40===b.keyCode?(b.preventDefault(),a.isOpen?a.overNextItem():a.open()):38===b.keyCode?(b.preventDefault(),a.isOpen?a.overPreviewItem():a.open()):27===b.keyCode&&(b.preventDefault(),a.isOpen&&(b.preventDefault(),a.hide()))}]]});d.style.display="none";d.parentNode.insertBefore(a.control,d);d.addEventListener("change",function(b){"simpleSelect"!==b.detail&&a.select(d.selectedIndex)});
a.update();a.select()}});
