define("promise ./utils ./dom ./dialog ./table ./highlight ./rate ../lib/filesize.min".split(" "),function(A,B,a,ba,ca,S,T,da){var Q="favorites kpFavorites kpInCinema kpPopular kpSerials imdbInCinema imdbPopular imdbSerials ggGamesTop ggGamesNew".split(" "),V=function(a,n){var q=/^ru-?/.test(chrome.i18n.getUILanguage())?["imdbInCinema","imdbPopular","imdbSerials"]:["kpFavorites","kpInCinema","kpPopular","kpSerials"];Q.forEach(function(u){if(!a[u]){var p=U[u];p={id:u,enable:-1===q.indexOf(u),show:!0,
width:p.defaultWidth,lines:p.defaultLines};n.push(a[u]=p)}})},U={favorites:{defaultLines:1,defaultWidth:100,maxWidth:120,noAutoUpdate:1},kpFavorites:{rootUrl:"http://www.kinopoisk.ru",defaultLines:1,defaultWidth:100,maxWidth:120,url:"https://www.kinopoisk.ru/mykp/movies/list/type/%category%/page/%page%/sort/default/vector/desc/vt/all/format/full/perpage/25/",baseUrl:"http://www.kinopoisk.ru/film/",imgUrl:"https://st.kp.yandex.net/images/film/",noAutoUpdate:1},kpInCinema:{rootUrl:"http://www.kinopoisk.ru",
defaultLines:1,defaultWidth:100,maxWidth:120,url:["http://www.kinopoisk.ru/afisha/new/page/0/","http://www.kinopoisk.ru/afisha/new/page/1/","http://www.kinopoisk.ru/afisha/new/page/2/"],keepAlive:[2,4,6],baseUrl:"http://www.kinopoisk.ru/film/",imgUrl:"https://st.kp.yandex.net/images/film/"},kpPopular:{rootUrl:"http://www.kinopoisk.ru",defaultLines:2,defaultWidth:100,maxWidth:120,url:"http://www.kinopoisk.ru/popular/day/now/perpage/200/",keepAlive:[0,3],baseUrl:"http://www.kinopoisk.ru/film/",imgUrl:"https://st.kp.yandex.net/images/film/"},
kpSerials:{rootUrl:"http://www.kinopoisk.ru",defaultLines:1,defaultWidth:100,maxWidth:120,url:"http://www.kinopoisk.ru/top/lists/45/",keepAlive:[0],baseUrl:"http://www.kinopoisk.ru/film/",imgUrl:"https://st.kp.yandex.net/images/film/"},imdbInCinema:{rootUrl:"http://www.imdb.com",defaultLines:1,defaultWidth:100,maxWidth:120,url:"http://www.imdb.com/movies-in-theaters/",keepAlive:[2,4,6],baseUrl:"http://www.imdb.com/title/",imgUrl:"http://ia.media-imdb.com/images/"},imdbPopular:{rootUrl:"http://www.imdb.com",
defaultLines:2,defaultWidth:100,maxWidth:120,url:"http://www.imdb.com/search/title?count=100&title_type=feature",keepAlive:[0,2],baseUrl:"http://www.imdb.com/title/",imgUrl:"http://ia.media-imdb.com/images/"},imdbSerials:{rootUrl:"http://www.imdb.com",defaultLines:1,defaultWidth:100,maxWidth:120,url:"http://www.imdb.com/search/title?count=100&title_type=tv_series",keepAlive:[0],baseUrl:"http://www.imdb.com/title/",imgUrl:"http://ia.media-imdb.com/images/"},ggGamesTop:{rootUrl:"http://gameguru.ru",
defaultLines:1,defaultWidth:100,maxWidth:120,url:["http://gameguru.ru/pc/games/rated/list.html","http://gameguru.ru/pc/games/rated/page2/list.html","http://gameguru.ru/pc/games/rated/page3/list.html","http://gameguru.ru/pc/games/rated/page4/list.html","http://gameguru.ru/pc/games/rated/page5/list.html"],keepAlive:[0],baseUrl:"http://gameguru.ru/pc/games/",imgUrl:"http://gameguru.ru/f/games/"},ggGamesNew:{rootUrl:"http://gameguru.ru",defaultLines:1,defaultWidth:100,maxWidth:120,url:["http://gameguru.ru/pc/games/released/list.html",
"http://gameguru.ru/pc/games/released/page2/list.html","http://gameguru.ru/pc/games/released/page3/list.html","http://gameguru.ru/pc/games/released/page4/list.html","http://gameguru.ru/pc/games/released/page5/list.html"],keepAlive:[2,4],baseUrl:"http://gameguru.ru/pc/games/",imgUrl:"http://gameguru.ru/f/games/"}},Y=function(){var a=/javascript/ig,n=/\/\//,A=/src=(['"]?)/ig,u=/srcset=(['"]?)/ig,p=/on(\w+)=/ig,B=/data:image\/gif,base64#blockurl#/g,v=/about:blank#blockurl#/g,G=/tms-block-javascript/g,
k=function(f){return f.replace(a,"tms-block-javascript").replace(n,"//about:blank#blockurl#").replace(A,"src=$1data:image/gif,base64#blockurl#").replace(u,"data-block-attr-srcset=$1").replace(p,"data-block-event-$1=")},m=function(f){var a=document.createDocumentFragment(),g=document.createElement("html");for(g.innerHTML=f;f=g.firstChild;)a.appendChild(f);return a},t=function(f){for(var a in f)if(f[a]=f[a]&&f[a].replace(B,"").replace(v,"").replace(G,"javascript").replace(/[\s\xA0]/g," ").trim(),"string"!==
typeof f[a]||!f[a])if("title_en"===a)f[a]=void 0;else return!1;return!0},C=function(a){var f=a.match(/images\/(.+)_V1/);return f&&f[1]+"_V1_SX120_.jpg"||a},x=function(a){return(a=/\s+\([^)]*([1-2]\d{3})[^)]*\)$/.exec(a))&&parseInt(a[1])},w=function(a){return a.replace(/\s+\([^)]*([1-2]\d{3})[^)]*\)$/,"").trim()},F=function(a){return a.replace(/\s+\d+\s+.{3}\.$/,"").trim()},I=function(a){var f=[];a=m(k(a)).querySelectorAll(".cnt-box-td .enc-tab1 .enc-box-list > .enc-item");[].slice.call(a).forEach(function(a){var c=
a.querySelector(".im img");c=(c=c&&c.getAttribute("src"))&&c.replace("/f/games/","");var g=a.querySelector(".e-title a");g=g&&g.textContent.trim();a=(a=a.querySelector(".e-title a"))&&a.getAttribute("href");c={img:c,title:g,url:a};t(c)?f.push(c):console.debug("Explorer gg_games_new have problem!")});return f};return{kpFavorites:function(a){a=m(k(a));if(a.querySelector(".login > .js-external-login-action"))return{requireAuth:1};a=a.querySelectorAll("#itemList > li.item");var f=[];[].slice.call(a).forEach(function(a){var c=
a.querySelector("div.info > a.name"),d=c&&c.getAttribute("href");c=c&&c.textContent.trim();a=(a=(a=a.querySelector("div.info > span"))&&a.textContent.trim())&&F(a);/^\([^)]+\)$/.test(a)&&(a="");var g="",K=/-(\d+)\/$/.exec(d);K&&(g=K[1]+".jpg");d={img:g,title:c,title_en:a,url:d};d.title_en&&(c=x(d.title_en))&&(d.title_en=w(d.title_en),d.title_en+=" "+c,d.title+=" "+c);t(d)?f.push(d):console.debug("Explorer kp_favorites have problem!")});return f},kpInCinema:function(a){a=m(k(a));for(var f=a.querySelectorAll("div.filmsListNew > div.item div.threeD"),
g=0,c;c=f[g];g++){var d=c.parentNode;d&&d.removeChild(c)}a=a.querySelectorAll("div.filmsListNew > div.item");var J=[];[].slice.call(a).forEach(function(a){var c=a.querySelector("div > a > img");c=c&&c.getAttribute("src");var g;if(g=c)g=c.replace(/sm_film/,"film");c=g;g=(g=a.querySelector("div > div.name > a"))&&g.textContent.trim();var d=a.querySelector("div > div.name > span");d=(d=d&&d.textContent.trim())&&F(d);/^\([^)]+\)$/.test(d)&&(d="");a=(a=a.querySelector("div > div.name > a"))&&a.getAttribute("href");
c={img:c,title:g,title_en:d,url:a};c.title_en&&(a=x(c.title_en))&&(c.title_en=w(c.title_en),c.title_en+=" "+a,c.title+=" "+a);t(c)?J.push(c):console.debug("Explorer kp_in_cinema have problem!")});return J},kpPopular:function(a){a=m(k(a)).querySelectorAll("div.stat > div.el");var f=[];[].slice.call(a).forEach(function(a){var c=a.querySelectorAll("a")[1],d=c&&c.getAttribute("href"),g="",k=/-(\d+)\/$/.exec(d);k&&(g=k[1]+".jpg");c=c&&c.textContent.trim();a=(a=a.querySelector("i"))&&a.textContent.trim();
d={img:g,title:c,title_en:a,url:d};if(g=x(d.title))d.title=w(d.title),d.title+=" "+g,d.title_en&&(d.title_en+=" "+g);t(d)?f.push(d):console.debug("Explorer kp_popular have problem!")});return f},kpSerials:function(a){a=m(k(a)).querySelectorAll("#itemList > tbody > tr");var f=[];[].slice.call(a).forEach(function(a){var c=a.querySelector("td~td > div > a"),d=c&&c.getAttribute("href");c=(c=c&&c.textContent.trim())&&c.replace(/\s+\([^)]+\)$/,"").trim();var g="",k=/-(\d+)\/$/.exec(d);k&&(g=k[1]+".jpg");
a=(a=(a=(a=a.querySelector("td~td > div > a~span"))&&a.textContent.trim())&&F(a))&&a.replace(/\s+\([^)]+\)$/,"").trim();d={img:g,title:c,title_en:a,url:d};t(d)?f.push(d):console.debug("Explorer kp_serials have problem!")});return f},imdbInCinema:function(a){a=m(k(a)).querySelectorAll("table.nm-title-overview-widget-layout");var f=[];[].slice.call(a).forEach(function(a){var c=a.querySelector("div.image img");c=(c=c&&c.getAttribute("src"))&&C(c);var d=a.querySelector('*[itemprop="name"] a');d=d&&d.textContent.trim();
var g=x(d);g&&(d=w(d),d+=" "+g);a=(a=(a=a.querySelector('*[itemprop="name"] a'))&&a.getAttribute("href"))&&a.replace(/\?ref.*$/,"");c={img:c,title:d,url:a};t(c)?f.push(c):console.debug("Explorer imdb_in_cinema have problem!")});return f},imdbPopular:function(a){a=m(k(a)).querySelectorAll(".lister-list > .lister-item");var f=[];[].slice.call(a).forEach(function(a){var c=a.querySelector(".lister-item-image img");c=(c=c&&c.getAttribute("loadlate"))&&C(c);var d=a.querySelector(".lister-item-header > a");
d=d&&d.textContent.trim();a=(a=a.querySelector(".lister-item-header > a"))&&a.getAttribute("href");c={img:c,title:d,url:a};t(c)?f.push(c):console.debug("Explorer imdb_popular have problem!")});return f},imdbSerials:function(a){a=m(k(a)).querySelectorAll(".lister-list > .lister-item");var f=[];[].slice.call(a).forEach(function(a){var c=a.querySelector(".lister-item-image img");c=(c=c&&c.getAttribute("loadlate"))&&C(c);var d=a.querySelector(".lister-item-header > a");d=d&&d.textContent.trim();a=(a=
a.querySelector(".lister-item-header > a"))&&a.getAttribute("href");c={img:c,title:d,url:a};t(c)?f.push(c):console.debug("Explorer imdb_serials have problem!")});return f},ggGamesTop:I,ggGamesNew:I}}(),P=function(q,n,P){var u={},p=q.eSections,W={};p.forEach(function(a){W[a.id]=a});V(W,p);var v=null,G=[],k={},m=function(a){a.bodyNode.style.minHeight="";a.minHeight=0;y(a,a.currentPage,1)},t=function(){for(var a,l=0,e;e=G[l];l++)a=e.section,a.enable&&a.show&&e.displayItemCount!==X(a)&&m(e)},C=B.throttle(t,
100),x=function(){var b={};q.quickSearch.forEach(function(a){b[a.id]=a});var l="",e=null,c=null,D=null,d=!1,f=null,g=function(b,e,l){var c=S.getMap(b);D.textContent="";D.appendChild(a.el("ul",{append:l.map(function(b,e){e="";b.size&&(e+=", "+da(b.size));return a.el("li",{class:"torrent__title",append:a.el("a",{class:["title"],target:"_blank",href:b.url,append:[S.insert(b.title,c),e]})})})}));d||(d=!0,f.classList.add("quick_search__visible"))},k=function(a,c,h,D){var d=b[h];d||(d=b[h]={id:h,label:"",
results:[]},q.quickSearch.unshift(d),q.quickSearch.splice(50));var E=T.getScheme(h);D.forEach(function(b){if(!ca.prototype.normalizeTorrent(q,c.id,b)&&!/\u0422\u0440\u0435\u0439\u043b\u0435\u0440|\u0422\u0438\u0437\u0435\u0440|Teaser|Trailer/i.test(b.title)){var e=T.getRate(b,E);b.rate=e;b.quality=e.sum;b.rate.rate.audioFormat&&(b.quality-=b.rate.rate.audioFormat);80<=e.rate.title&&50<=e.rate.wordSpaces&&50<=e.rate.caseSens&&a.push({label:e.quality,quality:b.quality,title:b.title,url:b.url,size:b.size})}});
a.sort(function(a,b){a=a.quality;b=b.quality;return a===b?0:a>b?-1:1}).splice(5);a.length&&(d.results=a,d.label=a[0].label||"+",chrome.storage.local.set({quickSearch:q.quickSearch}),l===h&&(e.textContent=d.label,e.appendChild(f),g(h,e,a)))};return{getLabel:function(a){return(b[a]||{}).label||"?"},onLabelClick:function(a,b){l=b=L(this.cache.content[b]);e=a;var c=[];P.trigger("quickSearch",[b,function(a,b,e){k(c,a,b,e)}])},onLabelOver:function(h,E){var z;if(e!==h){l=E=L(this.cache.content[E]);e=h;f||
(f=a.el("div",{class:"quick_search",title:"",append:[a.el("div",{class:"popup",append:[c=a.el("div",{class:"popup__angle_shadow",append:[a.el("div",{class:"popup__angle"})]}),D=a.el("div",{class:"popup__body"})]})]}));d&&(d=!1,f.classList.remove("quick_search__visible"));h.appendChild(f);var k=f,ea=c,r=0,m=0;for(z=h;null!==z.offsetParent;)r+=z.offsetLeft,m+=z.offsetTop,z=z.offsetParent;var N=h.getBoundingClientRect();z=Math.round(N.top+window.pageYOffset);N=Math.round(N.left+window.pageXOffset);var p=
h.offsetHeight,n=document.body.clientWidth,R=r+h.offsetWidth/2;r=R-150;R+150>n&&(r=n-300);0>r&&(r=0);n=100*(R-r)/300;ea.style.left=n+"%";k.style.left=r-N+"px";k.style.top=m-z+p-5+"px";k=(b[E]||{}).results||[];k.length&&g(E,h,k)}}}}(),w=function(){chrome.storage.local.set({eSections:p})},F=function(){var a=this;a.node.classList.add("section-loading");ha(a).then(function(){a.node.classList.remove("section-loading");var b={};b[a.cacheKey]=a.cache;chrome.storage.local.set(b);y(a)})},I=function(b){var c=
b.section,e=b.source,h=B.throttle(function(){m(b);w()},250),d;return a.el("div",{class:["section__setup"],append:[d=a.el("input",{type:"range",class:["setup__size_range"],min:20,max:e.maxWidth,value:c.width,on:["input",function(){c.width=parseInt(this.value);Z(b);h()}]}),a.el("a",{class:["setup__size_default"],href:"#size_default",title:chrome.i18n.getMessage("default"),on:["click",function(a){a.preventDefault();d.value=e.defaultWidth;d.dispatchEvent(new CustomEvent("input"))}]}),a.el("select",{class:["setup__lines"],
append:function(){for(var b=[],e=1;7>e;e++)b.push(a.el("option",{text:e,value:e}));return b}(),on:["change",function(){c.lines=parseInt(this.value);m(b);w()}],selectedIndex:c.lines-1})]})},f=function(){v&&v!==this&&(v.setupNode.parentNode.removeChild(v.setupNode),v.setupNode=null);this.setupNode?(v=null,this.setupNode.parentNode.removeChild(this.setupNode),this.setupNode=null):(v=this,this.setupNode=I(this),this.actionsNode.appendChild(this.setupNode))},H=function(){var a=k.favorites,c={};c[a.cacheKey]=
a.cache;chrome.storage.local.set(c);q.favoriteSync&&chrome.storage.sync.set(c)},g=function(a){a=this.cache.content[a];var b=this.source;a={img:M(a.img,b.imgUrl),url:M(a.url,b.rootUrl),title:L(a)};b=k.favorites;b.cache.content||(b.cache.content=[]);b.cache.content.push(a);m(b);H()},c=function(a){this.cache.content.splice(a,1);m(this);H()},d=function(b){var c=this,e=this.cache.content[b],h=new ba;a.el(h.body,{class:["dialog-poster_edit"],append:[a.el("span",{class:"dialog__label",text:chrome.i18n.getMessage("title")}),
h.addInput(a.el("input",{class:["input__input"],name:"title",type:"text",value:e.title})),a.el("span",{class:"dialog__label",text:chrome.i18n.getMessage("imageUrl")}),h.addInput(a.el("input",{class:["input__input"],name:"img",type:"text",value:e.img})),a.el("span",{class:"dialog__label",text:chrome.i18n.getMessage("descUrl")}),h.addInput(a.el("input",{class:["input__input"],name:"url",type:"text",value:e.url})),a.el("div",{class:["dialog__button_box"],append:[a.el("a",{class:["button","button-save"],
href:"#save",text:chrome.i18n.getMessage("save"),on:["click",function(a){a.preventDefault();a=h.getValues();for(var b in a)e[b]=a[b];m(c);H();h.destroy()}]}),a.el("a",{class:["button","button-cancel"],href:"#cancel",text:chrome.i18n.getMessage("cancel"),on:["click",function(a){a.preventDefault();h.destroy()}]})]})]});h.show()},J=function(){this.section.show?(this.section.show=!1,this.node.classList.add("section-collapsed")):(this.section.show=!0,this.node.classList.remove("section-collapsed"),aa(this));
w()},K=function(a){if(a){var b=new Date,e=b.getDay(),c=b.getHours(),d=b.getMinutes(),f=b.getSeconds(),g=0;a.forEach(function(a){e>=a&&(g=a)});e-=g;e*=86400;c*=3600;d*=60;return parseInt(b.getTime()/1E3)-e-c-d-f}},X=function(a){return(Math.ceil((document.body.clientWidth-175)/(a.width+20))-1)*a.lines},L=function(a){return a.title_en&&q.originalPosterName?a.title_en:a.title},M=function(a,c){c&&!/^https?:\/\//.test(a)&&(a=c+a);return a},Q=function(a){if(this.currentPage!==a){this.currentPage=a;this.currentPageEl&&
this.currentPageEl.classList.remove("item-active");var b=this.pagesNode.querySelector('li[data-page="'+a+'"]');b&&b.classList.add("item-active");this.currentPageEl=b;b=this.bodyNode.clientHeight;this.minHeight<b&&(this.bodyNode.style.minHeight=b+"px",this.minHeight=b);this.cache.content&&y(this,a)}},ia=function(b,c,e){var h=c.length/b.displayItemCount;c=Math.floor(h);0===h%1&&c--;Infinity===c&&(c=0);h=document.createDocumentFragment();for(var d=0;d<=c;d++){var l=e===d,f=a.el("li",{class:["pages__item"],
data:{page:d},text:d+1});l&&(f.classList.add("item-active"),b.currentPageEl=f,b.currentPage=d);h.appendChild(f)}b.pagesNode.textContent="";b.pagesNode.appendChild(h);0===c?b.pagesNode.classList.add("pages-hide"):b.pagesNode.classList.remove("pages-hide");b.hasPages=!0},y=function(b,c,e){var d=b.source,f=b.id;c=c||0;var l=b.cache.content||[],g=b.displayItemCount=X(b.section),k=g*c;g=l.slice(k,k+g);var r=document.createDocumentFragment();g.forEach(function(c,e){e+=k;var h=L(c),l="index.html#"+B.hashParam({query:h}),
D=M(c.img,d.imgUrl);c=M(c.url,d.rootUrl);var g=document.createDocumentFragment();"favorites"===f?a.el(g,{append:[a.el("div",{class:"action__rmFavorite",title:chrome.i18n.getMessage("removeFromFavorite")}),a.el("div",{class:"action__move",title:chrome.i18n.getMessage("move")}),a.el("div",{class:"action__edit",title:chrome.i18n.getMessage("edit")})]}):g.appendChild(a.el("div",{class:"action__favorite",title:chrome.i18n.getMessage("addInFavorite")}));g.appendChild(a.el("div",{class:"action__quick_search",
title:chrome.i18n.getMessage("quickSearch"),text:x.getLabel(h),on:[["mouseenter",function(){b.quickSearchOver(this,e)}]]}));r.appendChild(a.el("li",{class:["section__poster","poster"],data:{index:e},append:[a.el("div",{class:"poster__image",append:[g,a.el("a",{class:"image__more_link",href:c,target:"_blank",title:chrome.i18n.getMessage("readMore")}),a.el("a",{class:"image__search_link",href:l,title:h,append:a.el("img",{class:["image__image"],src:D,on:["error",function(){this.src="img/no_poster.png"}]})})]}),
a.el("div",{class:"poster__title",append:a.el("span",{append:a.el("a",{class:"poster__search_link",href:l,text:h,title:h}),on:["mouseenter",function fa(c){this.removeEventListener("mouseenter",fa);c=b.section.width;var e=null,d=this.offsetWidth;if(!(d<=c)){d=Math.ceil(d/10);if(10<d)if(100>d){var h=Math.round(d/10);d=h>d/10?100*h:10*(10*h+5)}else d*=10;else d*=10;h=Math.round(parseInt(d)/parseInt(c)*3.5);var f="moveble_"+c+"_"+d;u["style."+f]||(u["style."+f]=e=a.el("style",{class:f,text:"@keyframes a_"+
f+("{0%{margin-left:2px;}50%{margin-left:-"+(d-c)+"px;}90%{margin-left:6px;}100%{margin-left:2px;}}")+"div."+f+":hover > span {overflow: visible;animation:a_"+f+" "+h+"s;}"}));this.parentNode.classList.add(f);e&&document.body.appendChild(e)}}]})})]}))});if(r.childNodes.length)"favorites"===f&&b.node.classList.contains("section-empty")&&b.node.classList.remove("section-empty");else{if(0<c)return y(b,--c,e);"favorites"===f&&b.node.classList.add("section-empty")}b.hasPages&&!e||ia(b,l,c);b.bodyNode.textContent=
"";b.bodyNode.appendChild(r)},ja=function(a){a.requestList.splice(0).forEach(function(a){a.abort()});var b=a.source.url;Array.isArray(b)||(b=[b]);var c=[];b.forEach(function(b){c.push((new A(function(c,e){var d=B.request({url:b},function(a,b){a?e(a):c(b.body)});a.requestList.push({abort:function(){d.abort();e(Error("ABORTED"))}})})).then(function(b){b=Y[a.id](b);if(!b)throw Error("ERROR");return b}))});var d=a.cache;return A.all(c).then(function(a){a=[].concat.apply([],a);if(!a.length)throw Error("Content is empty!");
d.content=a;return{success:!0}}).catch(function(b){console.error("Error",b);d.keepAlive=null;d.errorTimeout=parseInt(Date.now()/1E3+7200);a.node.classList.add("section-error");return{success:!1,error:b}})},ha=function(a){var b=a.cache;a.requestList.splice(0).forEach(function(a){a.abort()});var c=20,d=[],f=[],g=a.source.url.replace("%category%",q.kpFolderId),k=function(b){return(new A(function(c,e){var d=B.request({url:g.replace("%page%",b)},function(a,b){a?e(a):c(b.body)});a.requestList.push({abort:function(){d.abort();
e(Error("ABORTED"))}})})).then(function(e){e=Y[a.id](e);if(!e)throw Error("ERROR");if(e.requireAuth)throw Error("AUTH");for(var h=0,g=0,l;l=e[g];g++)-1===d.indexOf(l.url)&&(d.push(l.url),f.push(l),h++);if(h&&c--)return k(++b)})};a.node.classList.remove("section-login");a.node.classList.remove("section-error");return k(1).then(function(){b.content=f;return{success:!0}}).catch(function(b){"AUTH"===b.message?a.node.classList.add("section-login"):a.node.classList.add("section-error");return{success:!1,
error:b}})},aa=function(a,c){var b=function(b){chrome.storage.local.get(a.cacheKey,function(e){var d=null;b&&(d=b[a.cacheKey]);d||(d=e[a.cacheKey]||{});a.node.classList.remove("section-error");a.cache=d;e=a.source;var h=K(e.keepAlive);e.noAutoUpdate?y(a):d.errorTimeout&&d.errorTimeout>parseInt(Date.now()/1E3)?a.node.classList.add("section-error"):d.keepAlive!==h&&navigator.onLine?(a.node.classList.add("section-loading"),y(a),d.keepAlive=h,ja(a).then(function(){a.node.classList.remove("section-loading");
var b={};b[a.cacheKey]=d;chrome.storage.local.set(b);y(a,a.currentPage,1)})):y(a);c&&c()})};"favorites"===a.id&&q.favoriteSync?chrome.storage.sync.get(a.cacheKey,function(a){b(a)}):b()},Z=function(b){var c=b.styleNode,e=b.section;var d=b.section.width;var f=b.source.maxWidth;d=60<=d?(10+(d-60)/(f-60)*.035*100).toFixed(6):void 0;f="ul.explore li[data-id="+JSON.stringify(b.id)+"] > ul.section__body > li";e=f+"{width: "+e.width+"px;}";d=f+" > div.poster__title{"+(d?"font-size:"+d+"px;":"display:none;")+
"}";c||(c=b.styleNode=a.el("style",{class:["section-style","section-style--"+b.id]}),document.body.appendChild(c));c.textContent=e+d},ka=function(b,l){var e={};e.id=b.id;e.source=U[b.id];e.section=b;e.cacheKey="cache_"+b.id;e.setup=f;e.collapse=J;e.requestList=[];e.setupNode=null;e.cache={};e.currentPage=null;e.currentPageEl=null;e.minHeight=0;e.displayItemCount=null;e.hasPages=!1;e.setPage=Q;e.quickSearch=x.onLabelClick;e.quickSearchOver=x.onLabelOver;"favorites"===b.id?(e.rmFavorite=c,e.edit=d):
e.favorite=g;"kpFavorites"===b.id&&(e.update=F);e.node=a.el("li",{class:["section","section-"+b.id],data:{id:b.id},append:[a.el("div",{class:["section__head"],append:[e.moveNode=a.el("div",{class:["section__move"]}),a.el("div",{class:["section__title"],text:chrome.i18n.getMessage(b.id)}),e.actionsNode=a.el("div",{class:["section__actions"],append:["kpFavorites"!==b.id?"":a.el("a",{class:"action__open",target:"_blank",title:chrome.i18n.getMessage("goToTheWebsite"),href:e.source.url.replace("%page%",
1).replace("%category%",q.kpFolderId)}),e.update?e.updateBtnNode=a.el("div",{class:"action__update",title:chrome.i18n.getMessage("update"),on:["click",function(a){a.preventDefault();e.update()}]}):"",e.setupBtnNode=a.el("div",{class:"action__setup",title:chrome.i18n.getMessage("setupView"),on:["click",function(a){a.preventDefault();e.setup()}]})]}),e.collapsesNode=a.el("div",{class:["section__collapses"],on:["click",function(a){a.preventDefault();e.collapse()}]})],on:["click",function(b){var c=a.closestNode(this,
b.target);(b.target===this||c&&c.classList.contains("section__title"))&&e.collapse()}]}),e.pagesNode=a.el("ul",{class:["section__pages"],on:["mouseover",function(b){(b=a.closestNode(this,b.target))&&e.setPage(parseInt(b.dataset.page))}]}),e.bodyNode=a.el("ul",{class:["section__body"]})]});b.show?aa(e,l):(e.node.classList.add("section-collapsed"),l());Z(e);return e},O=function(){n.classList.add("explore-hidden");var b=[];p.forEach(function(a){b.push(new A(function(b){b=ka(a,b);G.push(b);k[b.id]=b;
a.enable&&n.appendChild(b.node)}))});A.all(b).then(function(){n.classList.remove("explore-hidden");setTimeout(function(){t()},0);b=null});n.addEventListener("click",function(b){var c=b.target,d=a.closest(".section",c);if(d=k[d.dataset.id]){var f=a.closest(".poster",c);if(f){f=f&&parseInt(f.dataset.index);if(c.classList.contains("action__favorite"))return b.preventDefault(),d.favorite(f);if(c.classList.contains("action__rmFavorite"))return b.preventDefault(),d.rmFavorite(f);if(c.classList.contains("action__edit"))return b.preventDefault(),
d.edit(f);if(c.classList.contains("action__quick_search"))return b.preventDefault(),d.quickSearch(c,f)}}});(function(){var a=k.favorites;chrome.storage.onChanged.addListener(function(b){var c;if(b=b[a.cacheKey])if(b=b.newValue,JSON.stringify(a.cache)!==JSON.stringify(b)){for(c in a.cache)delete a.cache[c];for(c in b)a.cache[c]=b[c];a.section.enable&&a.section.show&&m(a)}})})();setTimeout(function(){require(["jquery"],function(){require(["jqueryUi"],function(){var a=$(n);a.sortable({axis:"y",handle:".section__move",
scroll:!1,start:function(){window.scrollTo(0,0);n.classList.add("explore-sort");a.sortable("refreshPositions")},stop:function(){n.classList.remove("explore-sort");var a=p.splice(0);[].slice.call(n.childNodes).forEach(function(a){p.push(k[a.dataset.id].section)});a.forEach(function(a){-1===p.indexOf(a)&&p.push(a)});w()}});$(k.favorites.bodyNode).sortable({handle:".action__move",items:".poster",opacity:.8,stop:function(a,b){var c=b.item[0];a=parseInt(c.dataset.index);b=null;var d=c.previousElementSibling;
d&&(b=parseInt(d.dataset.index));var e=null;(c=c.nextElementSibling)&&(e=parseInt(c.dataset.index));var f=k.favorites,g=f.cache.content,h=g.splice(a,1)[0];c||d?c?(a<e&&e--,g.splice(e,0,h)):g.splice(b,0,h):g.push(h);m(f);H()}})})})},50)};this.show=function(){n.classList.remove("explore-hide");O?(O&&O(),O=null):C();window.addEventListener("resize",C)};this.hide=function(){window.removeEventListener("resize",C);n.classList.add("explore-hide")}};P.prototype.insertDefaultSections=V;return P});
