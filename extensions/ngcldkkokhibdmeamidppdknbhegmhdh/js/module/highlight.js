define(["./utils"],function(h){return{getMap:function(b){b=b.split(/\s+/);for(var a,c=[],f=0,d=b.length;f<d;f++)(a=h.sanitizeTextRe(b[f]))&&c.push(a);c.sort(function(a,b){return a.length>b.length?-1:1});return c.length&&new RegExp(c.join("|"),"ig")},getHlMap:function(b,a,c){var f;b.replace(a,function(a,e){(f=a.length)&&h.isBoundary(b[e-1],b[e+f])&&(c.push(["b",e]),c.push(["b",e+f,!0]))})},getBracketsMap:function(b,a){var c;b.replace(/\([^)]*\)|\[[^\]]*]|<[^>]*>|{[^}]*}/g,function(b,d){if(c=b.length)a.push(["span",
d]),a.push(["span",d+c,!0])})},insert:function(b,a){var c=[];a&&this.getHlMap(b,a,c);this.getBracketsMap(b,c);c.sort(function(a,b){return a[1]===b[1]?0:a[1]<b[1]?-1:1});var f,d=0;a=f=document.createDocumentFragment();for(var e,h,g,k=0,l=c.length;k<l;k++)e=c[k],h=e[0],g=e[1],e=e[2],g!==d&&a.appendChild(document.createTextNode(b.substr(d,g-d))),d=g,e?a=a.parentNode||f:a.appendChild(a=document.createElement(h));g=b.length;g!==d&&a.appendChild(document.createTextNode(b.substr(d,g-d)));return a}}});
