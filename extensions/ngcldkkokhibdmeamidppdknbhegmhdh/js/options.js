require.config({baseUrl:"./js",paths:{promise:"./lib/promise.min",moment:"./lib/moment-with-locales.min"}});
require("promise ./module/i18nDom ./module/utils ./module/dom ./module/explore ./lib/jszip.min ./module/counter".split(" "),function(g,m,n,f,p,h,q){(new g(function(e){m();chrome.storage.local.get({hidePeerRow:!0,hideSeedRow:!1,categoryWordFilter:!0,contextMenu:!0,disablePopup:!1,invertIcon:!1,eSections:[],favoriteSync:!0,originalPosterName:!1,kpFolderId:"1",syncProfiles:!0,doNotSendStatistics:!1},e)})).then(function(e){document.body.classList.remove("loading");(function(){var b=function(){chrome.runtime.sendMessage({action:"reload"})},
c={contextMenu:b,disablePopup:b,invertIcon:b};[].slice.call(document.querySelectorAll("[data-option]")).forEach(function(a){var d=a.dataset.option;"checkbox"===a.type?(a.checked=!!e[d],a.addEventListener("click",function(){var b={};b[d]=e[d]=!!a.checked;chrome.storage.local.set(b,function(){var k=c[d];k&&k()})})):"text"===a.type&&(a.value=e[d],a.addEventListener("keyup",n.throttle(function(){var b={};b[d]=e[d]=a.value;chrome.storage.local.set(b)},250)))})})();(function(){var b=document.querySelector(".mainPage__sections"),
c=e.eSections,a={};c.forEach(function(b){a[b.id]=b});p.prototype.insertDefaultSections(a,c);c.forEach(function(a){"favorites"!==a.id&&b.appendChild(f.el("div",{class:"option",append:[f.el("label",{append:[f.el("input",{type:"checkbox",checked:a.enable,on:["click",function(){a.enable=this.checked;chrome.storage.local.set({eSections:c})}]}),f.el("span",{text:chrome.i18n.getMessage(a.id)})]})]}))})})();(function(){var b=document.querySelector(".backup__export-zip"),c=document.querySelector(".backup__import-zip"),
a=function(a){var b=URL.createObjectURL(a);a=document.createElement("a");a.href=b;a.download="tmsBackup.zip";a.click();setTimeout(function(){URL.revokeObjectURL(b)})},d=function(){return(new g(function(a){chrome.storage.local.get(null,a)})).then(function(a){var b=new h,c;for(c in a)/^cache/.test(c)&&"cache__favorites"!==c||b.file(c+".json",JSON.stringify(a[c]));return b.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}})}).then(function(b){a(b)}).catch(function(a){console.error("Compress error",
a);alert("Write file error! "+a.message)})},e=function(a){return h.loadAsync(a).then(function(a){var b={},c=[];a.forEach(function(l,e){var d=/(.+)\.json/i.exec(e.name);d&&(d=d[1],e=a.file(l).async("string").then(function(a){try{b[d]=JSON.parse(a)}catch(r){console.error("Read file error!",l,r)}}),c.push(e))});return g.all(c).then(function(){return new g(function(a){chrome.storage.local.set(b,a)})})}).catch(function(a){console.error("Read file error",a);alert("Read file error! "+a.message)})};b.addEventListener("click",
function(a){a.preventDefault();var b=this,c=b.textContent;b.textContent="...";d().then(function(){b.textContent=c})});c.addEventListener("click",function(a){a.preventDefault();var b=this,c=b.textContent;f.el("input",{style:{display:"none"},type:"file",on:["change",function(a){a=a.target.files[0];b.textContent="...";e(a).then(function(){b.textContent=c})}]}).click()})})();(function(){var b=null;document.querySelector(".options");var c=null;document.querySelector(".sections").addEventListener("click",
function(a){if(a=f.closest("a",a.target))b&&b.classList.remove("page-visible"),c.classList.remove("item-active"),c=a,a.classList.add("item-active"),a=document.querySelector(".page.page-"+a.dataset.page),a.classList.add("page-visible"),b=a});(c=document.querySelector('.sections a[href="'+location.hash+'"]'))||(c=document.querySelector('.sections a[href="#basic"]'));c.dispatchEvent(new MouseEvent("click",{cancelable:!0,bubbles:!0}))})();q()})});
