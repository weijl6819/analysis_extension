var Adguard=Adguard||{};!function(t,e,o,r,n){"use strict";Adguard.Blocker=function(t,e){var o=this.getBaseUrl();this.defaultConf={startOnLoad:!0,filters:[2],whitelist:["search.scanguard.com","search.totalav.com","search.pcprotect.com","www.google.*","google.*","search.yahoo.com","bing.com/search","www.bing.com/search"],rules:["example.org##h1"],localFiltersFolder:"/assets/js/background_scripts/adguard",filtersMetadataUrl:o+"/filters.json",filterRulesUrl:o+"/filters/{filter_id}.txt"},this.storageKey="adguardBlocker",this.api=t,this.setConfig(e)},Adguard.Blocker.prototype.getBaseUrl=function(){return"https://ext.scanguard.com/adblock"},Adguard.Blocker.prototype.addToWhitelist=function(t){t=this.removeProtocolFromUrl(t),this.conf.whitelist.push(t);var e=this.findAltUrl(t);e&&this.conf.whitelist.push(e),this.setLocalStorage(this.storageKey,this.conf),this.api.configure(this.conf,function(){})},Adguard.Blocker.prototype.removeFromWhitelist=function(t){var e=!1;t=this.removeProtocolFromUrl(t);var o=this.conf.whitelist.indexOf(t);-1!==o&&(this.conf.whitelist.splice(o,1),e=!0);var r=this.findAltUrl(t);r&&-1!==(o=this.conf.whitelist.indexOf(r))&&(this.conf.whitelist.splice(o,1),e=!0),e&&(this.setLocalStorage(this.storageKey,this.conf),this.api.configure(this.conf,function(){}))},Adguard.Blocker.prototype.setConfig=function(e){var o=this;void 0!==e&&(this.defaultConf=t.extend(this.defaultConf,e)),this.getLocalStorage(o.storageKey,function(e){"object"!=typeof e||t.isEmptyObject(e)?(o.setLocalStorage(o.storageKey,o.defaultConf),o.conf=o.defaultConf):o.conf=e.adguardBlocker;var r=o.conf.whitelist.indexOf("lala.com");-1!==r&&(o.conf.whitelist.splice(r,1),o.setLocalStorage(o.storageKey,o.conf)),o.init()})},Adguard.Blocker.prototype.init=function(){this.running=!1,this.onMessageListeners(),this.onStorageChangeListener(),this.onActivatedTabListener(),this.conf.startOnLoad&&this.start()},Adguard.Blocker.prototype.start=function(){var t=this;return this.running?this.running:(this.running=!0,t.conf.startOnLoad=t.running,t.setLocalStorage(t.storageKey,t.conf),this.api.start(t.conf,function(){t.onBlockedListener()}),this.running)},Adguard.Blocker.prototype.stop=function(){var t=this;return this.running?(this.running=!1,t.conf.startOnLoad=t.running,t.setLocalStorage(t.storageKey,t.conf),this.api.stop(function(){t.api.onRequestBlocked.removeListener(t.onBlocked)}),this.running):this.running},Adguard.Blocker.prototype.onBlockedListener=function(){var t=this;this.onBlocked=function(e){t.queryCurrentTab(function(o){t.sendAdBlockMessageToTab(o,e)})},this.api.onRequestBlocked.addListener(this.onBlocked)},Adguard.Blocker.prototype.onActivatedTabListener=function(){var t=this;e.tabs.onActivated.addListener(function(e){t.activeTabId=e.tabId})},Adguard.Blocker.prototype.queryCurrentTab=function(t){var o=this;e.tabs.query({active:!0,currentWindow:!0},function(r){r.length>0?t(r[0].id):o.activeTabId&&e.tabs.get(o.activeTabId,function(e){e&&t(e.id)})})},Adguard.Blocker.prototype.sendAdBlockMessageToTab=function(t,o){e.tabs.sendMessage(t,{action:"adBlocked",ad:o},function(t){t&&void 0!==t.type&&t.type})},Adguard.Blocker.prototype.notifyTabs=function(t){var o=this;"boolean"!=typeof t&&(t=!1),e.tabs.query({},function(r){for(var n={action:"toggleAdBlockElement"},a=0;a<r.length;++a)t&&r[a].active||o.isTabToIgnore(r[a].url)||e.tabs.sendMessage(r[a].id,n)})},Adguard.Blocker.prototype.isTabToIgnore=function(t){if(!t)return!1;for(var e=["^about:","^https://developer.mozilla.org","^https://addons.mozilla.org"],o=0;o<e.length;o++)if(t.match(new RegExp(e[o])))return!0;return!1},Adguard.Blocker.prototype.onMessageListeners=function(){var t=this;e.runtime.onMessage.addListener(function(e){"assistant-create-rule"===e.type&&(void 0,t.conf.rules.push(e.ruleText),t.api.configure(t.conf,function(){}))}),e.runtime.onMessage.addListener(function(e,o,r){if("string"==typeof e.action){var n={};switch(e.action){case"start-adblock":t.running=t.start(),n.running=t.running;break;case"stop-adblock":t.running=t.stop(),n.running=t.running;break;case"get-config-adblock":n.conf=t.conf,n.running=t.running;break;case"notifyTabs":t.notifyTabs(!0);break;case"add-to-whitelist-adblock":t.running?(n.success=!0,t.addToWhitelist(e.url)):(n.success=!1,n.message="Ad Block Pro must be running.");break;case"remove-from-whitelist-adblock":t.running?(n.success=!0,t.removeFromWhitelist(e.url)):(n.success=!1,n.message="Ad Block Pro must be running.")}}return r(n),!0})},Adguard.Blocker.prototype.setLocalStorage=function(t,o,r){var n={};n[t]=o,e.storage.local.set(n,function(){"function"==typeof r&&r(n)})},Adguard.Blocker.prototype.getLocalStorage=function(t,o){e.storage.local.get(t,function(t){"function"==typeof o&&o(t)})},Adguard.Blocker.prototype.clearLocalStorage=function(){e.storage.local.clear(function(){var t=e.runtime.lastError;t&&void 0})},Adguard.Blocker.prototype.onStorageChangeListener=function(){e.storage.onChanged.addListener(function(t,e){for(var o in t);})},Adguard.Blocker.prototype.prependProtocolToUrl=function(t,e){return/^https?:\/\//i.test(t)||(t=e+t),t},Adguard.Blocker.prototype.removeProtocolFromUrl=function(t){return t.replace(/(^\w+:|^)\/\//,"")},Adguard.Blocker.prototype.urlHasWWW=function(t){try{t=this.prependProtocolToUrl(t,"http://");return"www."===this.parseURL(t).hostname.substring(0,4)}catch(t){void 0}return!1},Adguard.Blocker.prototype.findAltUrl=function(t){var e=null;if(this.urlHasWWW(t))e=this.stripWWWFromUrl(t);else try{var o="www."+t;o=this.prependProtocolToUrl(o,"http://");var r=this.parseURL(o),n="/"!==r.pathname?r.pathname:"";e=r.hostname+n,e=decodeURIComponent(e)}catch(t){void 0}return e},Adguard.Blocker.prototype.parseURL=function(t){var e=[],o=["host","hostname","pathname"];t=this.replaceAll(t,"*","wildcard-all-pattern");var r,n=new URL(t);for(var a in o)r=o[a],e[r]=this.replaceAll(n[r],"wildcard-all-pattern","*");return e},Adguard.Blocker.prototype.replaceAll=function(t,e,o){return t.split(e).join(o)},Adguard.Blocker.prototype.stripWWWFromUrl=function(t){return t.replace(/^(www\.)/,"")}}(jQuery,utils().getExtensionApi(),window,document),$(document).ready(function(){adblock=new Adguard.Blocker(adguardApi,{startOnLoad:!1})});