var navigationIntercepter=function(){var e={api:utils().getExtensionApi(),endpoint:{url:"https://ext.scanguard.com/e1/gsb/url",method:"POST",cache:[]},settings:{urlFilters:["http://*/*","https://*/*"],method:"blocking",blockPageUrl:browser.extension.getURL("/assets/html/warning-page.html")},init:function(){e.loadDontBlockWhitelist();var r=e.api;r.webRequest.onBeforeRequest.addListener(function(r){return e.onBeforeRequest(r)},{urls:e.settings.urlFilters},[e.settings.method]),r.webNavigation.onBeforeNavigate.addListener(function(r){return e.onBeforeNavigate(r)},{urls:e.settings.urlFilters},[e.settings.method]),r.webNavigation.onErrorOccurred.addListener(function(r){return e.onBeforeNavigateErrorOccurred(r)})},onBeforeRequest:function(r){if(void 0!==r&&0==r.frameId&&"main_frame"==r.type&&e.excludeUrls(r.url)){var t,o=e.regexUrl(r.url),n=e.endpoint.cache,i=e.cleanUrl(o);if(o[0]){if(r.cleanUrl=o[0],n.hasOwnProperty(i)){var l=!!n[i]&&n[i];if(l)return e.ifThreatBlockResponse(l,r,!1)}else if(t=e.ajax(o[0])){void 0!==t[i]&&0==i.indexOf("www.")?n[i]=t[i]:n[i]=t[i.replace("www.","")];var a=!!t[i]&&t[i];if(a)return e.ifThreatBlockResponse(a,r,!1)}}else{void 0;var c=encodeURIComponent(r.url),s="https://search.scanguard.com/web?fcoid=417&fcop=topnav&fpid=27&q="+c;browser.tabs.query({currentWindow:!0,active:!0},function(e){browser.tabs.update(e[0].id,{url:s})})}}},onBeforeNavigate:function(r){if(void 0!==r&&0==r.frameId&&e.excludeUrls(r.url)){var t,o=e.regexUrl(r.url),n=e.endpoint.cache,i=e.cleanUrl(o);if(o[0])if(r.cleanUrl=o[0],n.hasOwnProperty(i)){var l=!!n[i]&&n[i];if(l)return e.ifThreatBlockResponse(l,r,!0)}else if(t=e.ajax(o[0])){void 0!==t[i]&&0==i.indexOf("www.")?n[i]=t[i]:n[i]=t[i.replace("www.","")];var a=!!t[i]&&t[i];if(a)return e.ifThreatBlockResponse(a,r,!0)}}},onBeforeNavigateErrorOccurred:function(r){if(void 0!==r&&0==r.frameId&&e.excludeUrls(r.url)){var t,o=e.regexUrl(r.url),n=e.endpoint.cache,i=e.cleanUrl(o);if(o[0])if(r.cleanUrl=o[0],n.hasOwnProperty(i)){var l=!!n[i]&&n[i];if(l)return e.ifThreatBlockResponse(l,r,!0)}else if(t=e.ajax(o[0])){void 0!==t[i]&&0==i.indexOf("www.")?n[i]=t[i]:n[i]=t[i.replace("www.","")];var a=!!t[i]&&t[i];if(a)return e.ifThreatBlockResponse(a,r,!0)}}},ajax:function(r){var t=$.ajax({url:e.endpoint.url,method:e.endpoint.method,data:JSON.stringify({urls:[r]}),dataType:"json",async:!1});return"object"==typeof t.responseJSON&&t.responseJSON.data},regexUrl:function(e){var r=new RegExp("^(http://|https://).*?(/|$)"),t=e.match(r);return void 0!==t&&void 0!==t[0]&&t},excludeUrls:function(r){var t=[e.endpoint.url,"about:blank"];return-1==$.inArray(r,t)},cleanUrl:function(e){if(void 0!==e[1])var r=e[0].replace(e[1],"");return r?r.replace("/",""):null},loadDontBlockWhitelist:function(){e.api.storage.local.get("dont-block-whitelist",function(r){if(r&&void 0!==r["dont-block-whitelist"])return void 0,e.urlWhitelist=JSON.parse(r["dont-block-whitelist"]),r["dont-block-whitelist"]})},ifThreatBlockResponse:function(r,t,o){function n(n){browser.storage.local.set({"dont-block-temp":null},function(i){if(t.cleanUrl=t.cleanUrl.replace("https://www.","").replace("http://www.","").replace("https://","").replace("http://","").replace("/",""),void 0,void 0,void 0,-1==$.inArray(t.cleanUrl,n)){void 0;var l="?url="+encodeURIComponent(t.url)+"&threat="+r.threatType;void 0;var a=e.settings.blockPageUrl+l;if(void 0!==o)return o?(browser.tabs.query({currentWindow:!0,active:!0},function(e){browser.tabs.update(e[0].id,{url:a})}),{redirectUrl:a}):{redirectUrl:'javascript: window.open("'+a+'","_self");'}}})}void 0,""!=r.threatType&&browser.storage.local.get("dont-block-temp",function(e){void 0===e["dont-block-temp"]||null==e["dont-block-temp"]?browser.storage.local.get("dont-block-whitelist",function(e){e=void 0===e["dont-block-whitelist"]?[]:JSON.parse(e["dont-block-whitelist"]),n(e)}):(e=[e["dont-block-temp"]],n(e))})}};return e.init(),e}();