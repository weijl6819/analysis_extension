var ctxtId=0;var rUrl=new RegExp("[\r\n\t]");chrome.extension.onConnect.addListener(function(a,b){a.onMessage.addListener(function(g,c){var d=localStorage.fav_al_w+"";var h=d.split(",");var f=h[0]||"";var e=h[2]||"";if(g.ktp&&g.ktp=="op"){window.open(chrome.extension.getURL("options.html"),"_blank");return}if(f=="none"){chrome.browserAction.setIcon({path:"icon16_off.png"})}else{chrome.browserAction.setIcon({path:"icon16.png"});f=h[1]||""}if(ctxtId==0&&e=="show"){ctxtId=chrome.contextMenus.create({type:"normal",title:"Weblio辞書で検索",contexts:["selection"],onclick:rdtxt})}else{if(ctxtId>0&&e=="noShow"){chrome.contextMenus.remove(ctxtId);ctxtId=0}}c.postMessage({r_act:f,r_al:d})})});chrome.tabs.onSelectionChanged.addListener(function(a){chrome.tabs.get(a,function(b){if(b.status==="complete"&&/^(https?|file):/.test(b.url)){chrome.tabs.sendRequest(a,{tb:""},function(c){})}})});function rdtxt(d,b){var a={};var c=fetchQry(d.selectionText)||"";if(c.length>0){a.url="http://www.weblio.jp/content/"+encodeURL(c).replace(/%2f/g,"/");chrome.tabs.create(a)}}function fetchQry(a){a=a.replace(rUrl,"");a=a.replace(/^\s+/g,"");if(a.length==0||a.length>100){return""}return a}function encodeURL(e){var f="";var a="";var d="";for(var b=0;b<e.length;b++){f=e.charAt(b);a=e.charCodeAt(b);if(a==42||a==45||a==46||a==95||((a>=48)&&(a<=57))||((a>=65)&&(a<=90))||((a>=97)&&(a<=122))){d+=f}else{if(a==32){d+="+"}else{if((a>=0)&&(a<=127)){f="0"+a.toString(16);d+="%"+f.substr(f.length-2)}else{if(a>2097151){d+="%"+(240+((a&1835008)>>18)).toString(16);d+="%"+(128+((a&258048)>>12)).toString(16);d+="%"+(128+((a&4032)>>6)).toString(16);d+="%"+(128+(a&63)).toString(16)}else{if(a>2047){d+="%"+(224+((a&61440)>>12)).toString(16);d+="%"+(128+((a&4032)>>6)).toString(16);d+="%"+(128+(a&63)).toString(16)}else{d+="%"+(192+((a&1984)>>6)).toString(16);d+="%"+(128+(a&63)).toString(16)}}}}}}return d};