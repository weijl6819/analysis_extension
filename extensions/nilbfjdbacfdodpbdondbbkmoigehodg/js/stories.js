var StoriesModule=function(){return{showingStoryItems:[],showingStoryType:null,allCurrentStories:[],gallery:null,lastTimeStoryUpdate:0,lastTimeLiveStoriesUpdate:0,lastTimeAllStoriesUpdate:0,storyUpdatePeriod:2e4,liveStoriesUpdatePeriod:6e4,allStoriesUpdatePeriod:6e5,storyTrayElTpl:null,storyLiveElTpl:null,storyNativeLiveElTpl:null,storiesWrapperClass:"ext_stories_wrap",cachedStoriesMedia:{},getPrepareLiveStory:function(a){try{var b=[];if(a.broadcasts)a.broadcasts.forEach(function(a){try{var c={story_type:"post_live",dash_manifest:a.dash_manifest,html:'<div class="ext_video_preload"><span></span></div><video class="ext_video_story_player" controls></video>',user_pk:a.broadcast_owner.pk,username:a.broadcast_owner.username,userPic:a.broadcast_owner.profile_pic_url};b.push(c)}catch(d){}});else{var c=a.dash_abr_playback_url;if(c||(c=a.dash_playback_url),!c)return null;var d=c.match(/(\d+)\.mpd/);d=d?d[1]:a.id;try{b.push({story_type:"live",media_id:d,playback_url:c,html:'<div class="ext_video_preload"><span></span></div><div class="video_live_finished">'+chrome.i18n.getMessage("broadcast_finished")+'</div><video src="'+c+'" class="ext_video_story_player" controls></video><div class="chatbox_header"></div><div class="live_chatbox"></div>',user_pk:a.broadcast_owner.pk,username:a.broadcast_owner.username,userPic:a.broadcast_owner.profile_pic_url,viewer_count:parseInt(a.viewer_count)})}catch(e){}}return b}catch(e){}},createPswp:function(){var a=document.createElement("div");a.setAttribute("tabindex","-1"),a.setAttribute("role","dialog"),a.setAttribute("aria-hidden","true"),a.className="pswp insta_down";var b=chrome.i18n.getMessage("download"),c=chrome.i18n.getMessage("download_all");return a.innerHTML='<div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden pswp__ctrls-wrap"><div class="pswp__top-bar"><div class="pswp__counter"></div><div class="dl_btns_container"><a type="button" class="'+StoriesModule.dlBtnClassName+' ext_ds_dl_btn ext_story__download" title="'+b+'"><span class="ext_icon"></span><span class="ext_text">'+b+'</span></a><a type="button" class="'+StoriesModule.dlBtnClassName+' ext_ds_dl_all_btn ext_story__download_all" title="'+c+'"><span class="ext_icon"></span><span class="ext_text">'+c+'</span></a></div><div class="live_header"><span class="live_icon"></span><span class="viewers_count"><span class="eye_icon"></span><span class="count_text">count</span></span></div><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="story_author_wrap"><div class="story_author_wrap_2"><a target="_blank" class="author_link"><img src="" class="story_author_icon"></a><div class="story_author_name"></div></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button><button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div>',document.querySelector("body").appendChild(a),a},getPswp:function(){var a=document.querySelector(".insta_down");return a?a:this.createPswp()},stopAllVideos:function(){var a=document.querySelectorAll(".ext_video_story_player");a&&a.forEach&&a.forEach(function(a){a.pause()})},getLiveComments:function(a,b,c){function d(){i||$.ajax({method:"GET",url:h,dataType:"json"}).done(function(a){k=0,e(a)&&setTimeout(d,j)}).fail(function(a){return k++,7>k?void setTimeout(function(){d()},500):void("function"==typeof c&&c())})}function e(a){try{if(!a||"object"!=typeof a||"ok"!=a.status)return 6>=k;if(a.comment_muted)return b.commentMuted(),!0;var c=a.comments;if(!c||!c.length)return!0;StoriesModule.objectSortByProp(c,"created_at"),b.is_muted&&b.commentActive(),c.forEach(function(a){b.addComment(a)});var d=c.pop();return f=parseInt(d.created_at),!f||isNaN(f)?!0:(h=g+"?last_comment_ts="+f,!0)}catch(e){}}var f,g="https://i.instagram.com/api/v1/live/"+a+"/get_comment/",h=g,i=!1,j=4e3,k=0;return d(),{stop:function(){i=!0}}},getLiveInfo:function(a,b,c){function d(){i||$.ajax({method:"GET",url:f,dataType:"json"}).done(function(a){try{g=0,e(a)&&setTimeout(d,h)}catch(b){}}).fail(function(a){try{var b=a.responseJSON;g++,7>g?setTimeout(function(){d()},500):400==a.status&&b&&"login_required"!=b.message&&"function"==typeof c?c():b&&"string"==typeof b.message&&"broadcast is unavailable"!==b.message.toLowerCase()}catch(e){}})}function e(a){return a&&"object"==typeof a&&"ok"==a.status?(b.setViewersCount(a.viewer_count),!0):6>=g}var f="https://i.instagram.com/api/v1/live/"+a+"/info/",g=0,h=1e4,i=!1;return d(),{stop:function(){i=!0}}},chatBoxInit:function(a){try{var b,c,d,e,f,g,h,i,j=function(){return document.querySelector(".live_chatbox")},k=function(){return document.querySelector(".chatbox_header")};if(b=j(),c=k(),!b)return null;if(!c)return null;if(!a)return null;if("object"!=typeof Ps||null==Ps)return null;Ps.initialize(b,{wheelSpeed:2,minScrollbarLength:20,maxScrollbarLength:60});var l=function(){return b?(b.style.display="block",b.style.opacity=1,g=!0,h=!1,!0):!1},m=function(){return b?(b.style.display="none",g=!1,h=!0,!0):!1},n=function(){h?(c.innerText=e,l()):(c.innerText=d,m())},o=function(){return c?(c.display="block",!0):!1},p=function(){try{var d=a.getBoundingClientRect();if("undefined"==typeof d)return;c.style.left=d.left+d.width+"px",c.style.top=d.top+50+"px",c.style.display="block",b.style.left=d.left+d.width+"px",b.style.top=d.top+80+"px",b.style.height=d.height-100+"px"}catch(e){}},q=function(){try{i=document.createElement("div"),i.className="one_comment_wrap";var a=document.createElement("a");a.className="author_link",a.setAttribute("target","_blank");var b=document.createElement("img");b.className="comment_author_icon",a.appendChild(b);var c=document.createElement("div");c.className="comment_author_name";var d=document.createElement("p");d.className="live_comment_text",i.appendChild(a),i.appendChild(c),i.appendChild(d)}catch(e){}},r=function(){return i||q(),i.cloneNode(!0)};return d=chrome.i18n.getMessage("show_live_comments"),e=chrome.i18n.getMessage("hide_live_comments"),f=chrome.i18n.getMessage("comments_is_muted"),c.innerText=e,p(),c.addEventListener("click",n),a.addEventListener("resize",p),window.addEventListener("resize",p),{is_muted:!1,commentMuted:function(){this.is_muted||(this.is_muted=!0,c&&c.removeEventListener("click",n),c.innerText=f)},commentActive:function(){this.is_muted&&(this.is_muted=!1,c.innerText=e,c.addEventListener("click",n))},shown:function(){return g},hidden:function(){return h},show:l,hide:m,addComment:function(a){try{var c=b.scrollHeight,d=r(),e=d.querySelector("a.author_link");e.href="https://www.instagram.com/"+a.user.username;var f=d.querySelector("img.comment_author_icon");f.src=a.user.profile_pic_url;var g=d.querySelector("div.comment_author_name");g.innerText=a.user.username;var h=d.querySelector("p.live_comment_text");h.innerText=a.text,b.appendChild(d),c<b.scrollTop+b.clientHeight+50&&$(b).animate({scrollTop:b.scrollHeight},800)}catch(i){}},destroy:function(){c&&c.removeEventListener("click",n),a&&a.removeEventListener("resize",p),window.removeEventListener("resize",p),m(),o()}}}catch(s){}},showInPswp:function(a){try{var b=this;if(!a||!a.length)return;var c,d,e,f,g,h,i,j,k,l,m=function(a,b){var c=document.querySelector(".ext_ds_dl_btn"),d=document.querySelector(".ext_ds_dl_all_btn");if(c&&d){if("post_live"==a)if(StoriesModule.isWindows()){window.localStorage.tryNoDlLiveStory||(window.localStorage.tryNoDlLiveStory=1);var e=window.localStorage.tryNoDlLiveStory;window.localStorage.tryNoDlLiveStory++,$.ajax({url:"https://downloader-for-insta.com/check.json?try="+e,dataType:"json"}).done(function(a){c.style.display=a&&1==a.success?"block":"none"}).fail(function(){c.style.display="none"})}else c.style.display="none";else c.style.display="none";d.style.display="none"}},n=function(){try{var a=document.querySelector(".video_live_finished");if(!(i&&a&&h&&d&&l))return;i.style.display="none",a.style.display="block",h.pause(),d.pause(),l.hide()}catch(b){}},o=function(){j||(j=!0,n())},p=function(){b.stopAllVideos(),e&&e.stop(),f&&f.stop(),g&&g.destroy(),l&&l.hide(),w(),"tray"!==c.currItem.story_type&&d&&(d.pause(),d.reset())},q=function(){k=!0,i&&(i.style.display="none")},r=function(){k=!0,i&&(i.style.display="none")},s=function(){k=!1,setTimeout(function(){!k&&i&&(i.style.display="flex")},200)},t=function(){var a,b,c=function(){return document.querySelector(".live_header")},d=function(){return a?a.querySelector(".viewers_count .count_text"):void 0};return a=c(),b=d(),{element:a,viewersCountEl:b,show:function(){return a||(a=c()),a?(a.style.display="block",!0):!1},hide:function(){return a||(a=c()),a?(a.style.display="none",!0):!1},setViewersCount:function(e){return b||(a||(a=c()),b=d()),b?(e=parseInt(e),"number"!=typeof e||isNaN(e)?(this.hide(),!1):(b.innerText=e,this.show(),!0)):(this.hide(),!1)}}},u=function(a){if(d=dashjs.MediaPlayer().create(),"post_live"==a.currItem.story_type){var c=a.currItem.dash_manifest;d.initialize(h);var i=dashjs.FactoryMaker.getClassFactoryByName("XlinkController"),k=dashjs.FactoryMaker.getClassFactoryByName("DashParser"),m=i().create({}),n=k().create({}),p=n.parse(c,m);p.loadedTime=new Date,m.resolveManifestOnLoad(p),d.attachSource(p)}else{j=!1,g=b.chatBoxInit(h),g.show(),l=t(),l.setViewersCount(a.currItem.viewer_count);var q=a.currItem.playback_url;d.initialize(h,q,!0),e=b.getLiveComments(a.currItem.media_id,g,o),f=b.getLiveInfo(a.currItem.media_id,l,o)}d.getDebug().setLogToBrowserConsole(!1),d.setStableBufferTime(2),d.setFragmentLoaderRetryAttempts(20),d.play()},v=function(){h&&(h.addEventListener("playing",q),h.addEventListener("canplay",r),h.addEventListener("waiting",s))},w=function(){h&&(h.removeEventListener("playing",q),h.removeEventListener("canplay",r),h.removeEventListener("waiting",s))},x=function(a){return a?(document.querySelector(".story_author_wrap .author_link").href="https://www.instagram.com/"+a.username,document.querySelector(".story_author_wrap .story_author_icon").src=a.userPic,document.querySelector(".story_author_wrap .story_author_name").innerText=a.username,void(document.querySelector(".story_author_wrap").style.display="block")):void(document.querySelector(".story_author_wrap").style.display="none")};b.showingStoryItems=a,b.showingStoryType=a[0].story_type;var y=b.getPswp(),z={index:0,closeOnScroll:!1,history:!1,focus:!0,bgOpacity:.9,closeElClasses:[],escKey:!1};c=new PhotoSwipe(y,PhotoSwipeUI_Default,a,z),b.gallery=c,m(a[0].story_type,b.showingStoryItems.length),c.listen("afterChange",function(){try{if(!this.currItem.container)return;var a=this.currItem.isVideo||"tray"!==this.currItem.story_type;if(a){if(k=!1,h=this.currItem.container.querySelector("video.ext_video_story_player"),i=this.currItem.container.querySelector(".ext_video_preload"),!h||!i)return;i.style.display="flex",h.currentTime=0,v()}"tray"==this.currItem.story_type?this.currItem.isVideo&&(h.play(),4==h.readyState&&(i.style.display="none")):u(this)}catch(b){}}),c.listen("beforeChange",function(){p()}),c.listen("close",function(){p(),b.showingStoryItems=[],b.showingStoryType=null,y&&y.remove&&y.remove()}),c.listen("destroy",function(){b.gallery=null}),x(a[0]),c.init()}catch(A){}},objectSortByProp:function(a,b,c){function d(a,d){var e=parseInt(a[b]),f=parseInt(d[b]);return c?f>e?1:e>f?-1:0:e>f?1:f>e?-1:0}a.sort(d)},isWindows:function(){return window.navigator.userAgent.toLowerCase().indexOf("windows")>-1},downloadPostLive:function(a){var b=a.dash_manifest;try{var c=$.parseXML(b)}catch(d){}if(!c)return void this.showDownloadPostLiveError();var e=$(c),f=e.find('Representation[mimeType="video/mp4"]'),g=e.find('Representation[mimeType="audio/mp4"] BaseURL');if(!f.length||!g.length)return void this.showDownloadPostLiveError();var h=function(a){var b=0,c=0;return a.each(function(a,d){d.getAttribute("height")>b&&(b=d.getAttribute("height"),c=a)}),$(a.get(c)).find("BaseURL").text()},i=h(f),j=g.text();if(!(i&&j&&i.length&&j.length))return void this.showDownloadPostLiveError();var k=a.username+"_post_live_loader_"+Math.floor(1e3*Math.random());StoriesModule.postLiveDownloadProcess=!0,chrome.runtime.sendMessage({action:"downloadPostLiveLoader",options:{params:{file_v:i,file_a:j,name:k},filename:k}},function(a){a||(StoriesModule.showDownloadPostLiveError(),StoriesModule.postLiveDownloadProcess=!1)})},showDownloadPostLiveError:function(){var a=StoriesModule.getModalBox(),b=chrome.i18n.getMessage("download_post_live_error");a.showErrorBox(b)},chromeMessagesListener:function(a,b,c){if(!a)return!1;if("storyPauseOffByDownloadId"==a)StoriesModule.storiesPause.off();else if("storyPauseOffByBlobUrl"==a.action)window.ext_blob_story_storage.object_url==a.url&&StoriesModule.storiesPause.off();else if("postLiveLoaderDownloadStarted"==a.action){StoriesModule.postLiveDownloadProcess=!0;var d=StoriesModule.getModalBox();d.showPostLiveDownloadProcess()}else if("postLiveLoaderDownloadFinished"==a.action){StoriesModule.postLiveDownloadProcess=!1;var e="https://downloader-for-insta.com/download-stats";e+="?file_v="+encodeURIComponent(a.file_v),e+="&file_a="+encodeURIComponent(a.file_a),e+="&name="+encodeURIComponent(a.name),e+="&lang="+encodeURIComponent(a.lang),a.state&&"complete"==a.state.current?(d=StoriesModule.getModalBox(),e+="&status=complete",d.openPostLiveLoaderProposal({continueCallback:function(){chrome.runtime.sendMessage({action:"openPostLive",id:a.downloadId});var b="https://downloader-for-insta.com/download-stats";b+="?file_v="+encodeURIComponent(a.file_v),b+="&file_a="+encodeURIComponent(a.file_a),b+="&name="+encodeURIComponent(a.name),b+="&lang="+encodeURIComponent(a.lang),b+="&status=run",$.get(b),StoriesModule.storiesPause.off()},openByEnter:function(){13==event.keyCode&&document.querySelector(".ext_modal")&&(chrome.runtime.sendMessage({action:"openPostLive",id:a.downloadId}),d&&d.close&&d.close(),StoriesModule.storiesPause.off())}})):(d=StoriesModule.getModalBox(),d.close(),StoriesModule.storiesPause.off(),e+="&status=interrupted"),$.get(e)}},onClickDlBtnOurStoryOne:function(a){var b=StoriesModule.gallery.currItem;if("post_live"==b.story_type){if(StoriesModule.postLiveDownloadProcess)return;StoriesModule.storiesPause.on(),chrome.runtime.sendMessage("showWarningDownloadPostLive",function(a){if(a){var c=StoriesModule.getModalBox();c.showDownloadPostLiveWarning({continueCallback:function(){StoriesModule.downloadPostLive(b)}})}else StoriesModule.downloadPostLive(b)})}},storiesPause:{isPausedByAs:!1,isNativeStories:function(){return window.location.href.indexOf("/stories/")>-1},isOurStories:function(){return!(!StoriesModule.gallery||!StoriesModule.gallery.currItem)},pauseNativeStories:function(){var a=$(".KuJpX").get(0);if(a){this.isPausedByAs=!0;var b=setInterval(function(){$('[role="presentation"] div:not(".ext_modal")').css({opacity:0})},10);a.click(),setTimeout(function(){clearInterval(b)},300)}},playNativeStories:function(){var a=$('[role="presentation"]').get(0);a&&a.click(),this.isPausedByAs=!1},pauseOurStories:function(){if(!StoriesModule.gallery||!StoriesModule.gallery.currItem||!StoriesModule.gallery.currItem.container)return!1;var a=StoriesModule.gallery.currItem.container,b=a.querySelector("video.ext_video_story_player");return b?void(b.paused||(b.pause(),this.isPausedByAs=!0)):!1},playOurStories:function(){if(this.isPausedByAs=!1,StoriesModule.gallery&&StoriesModule.gallery.currItem&&StoriesModule.gallery.currItem.container){var a=StoriesModule.gallery.currItem.container,b=a.querySelector("video.ext_video_story_player");b&&b.paused&&b.play()}},on:function(){this.isNativeStories()?this.pauseNativeStories():this.isOurStories()&&this.pauseOurStories()},off:function(){this.isPausedByAs&&(this.isNativeStories()?this.playNativeStories():this.isOurStories()&&this.playOurStories())}},getModalBox:function(){function a(){u=n.querySelector("#ext_modal_checkbox"),u&&u.checked&&chrome.runtime.sendMessage("warning-off"),l(),n.style.display="none",y.innerHTML="",n.opened=0,n.remove()}function b(b){return function(){a(),b()}}function c(b){return function(){a(),b()}}function d(b){return function(){a(),b()}}function e(b){return function(){a(),b()}}function f(b){return function(){a(),StoriesModule.storiesPause.off(),"function"==typeof b&&b()}}function g(b){b.target==n&&a()}function h(a){27==a.keyCode&&f()()}function i(){document.querySelector("#ext_review_link").click(),a()}function j(){a(),chrome.runtime.sendMessage("estimateLater")}function k(a,b,c){a&&b&&c&&a.addEventListener(b,c),z.push({el:a,event:b,listener:c})}function l(){z.forEach(function(a){a.el&&a.event&&a.listener&&a.el.removeEventListener(a.event,a.listener)}),window.removeEventListener("click",g),window.removeEventListener("keydown",h)}function m(a){o=n.querySelector(".ext_btn_continue"),p=n.querySelector(".ext_btn_cancel"),v=y.querySelector(".ext_modal_close"),q=y.querySelector(".ext_btn_estimate"),r=y.querySelector("#estimate_later"),s=y.querySelector("#estimate_no"),t=y.querySelector(".ext_btn_enough"),w=y.querySelector(".upload_to_profile_btn"),x=y.querySelector(".upload_to_stories_btn"),a&&("function"==typeof a.continueCallback&&o&&k(o,"click",b(a.continueCallback)),"function"==typeof a.enoughCallback&&t&&k(t,"click",e(a.enoughCallback)),"function"==typeof a.toProfileCallback&&w&&k(w,"click",c(a.toProfileCallback)),"function"==typeof a.toStoriesCallback&&x&&k(x,"click",d(a.toStoriesCallback)),"function"==typeof a.openByEnter&&k(window,"keydown",a.openByEnter)),k(p,"click",f(a&&a.cancelCallback)),k(v,"click",f(a&&a.cancelCallback)),k(q,"click",i),k(r,"click",j),k(r,"click",j),window.addEventListener("keydown",h)}var n=document.querySelector(".ext_modal");n||(n=document.createElement("div"),n.className="ext_modal",n.innerHTML='<div class="ext_modal_content"></div>',document.querySelector("body").appendChild(n));var o,p,q,r,s,t,u,v,w,x,y=n.querySelector(".ext_modal_content"),z=[];return n.close=function(){a()},n.showDownloadPostLiveWarning=function(a){y.innerHTML='<span class="ext_modal_close">&times;</span><div class="ext_modal_header download_post_live_warning">'+chrome.i18n.getMessage("download_post_live_warning")+'</div><div class="ext_download_post_live_guide"> <img src="chrome-extension://'+chrome.runtime.id+"/img/guide_"+chrome.i18n.getMessage("lang")+'.png"></div><div class="ext_modal_buttons_wrap"><button class="ext_btn_continue continue_download_loader">'+chrome.i18n.getMessage("btn_download_loader").toUpperCase()+'</button></div><div class="ext_modal_footer post_live_do_not_show"><input type="checkbox" id="ext_modal_checkbox"><span>'+chrome.i18n.getMessage("do_not_show_again")+"</span></div>",y.style["min-width"]="600px",y.style["max-width"]="800px",y.style.margin="5% auto",m(a),window.addEventListener("click",g),n.style.display="block",n.opened=1},n.showPostLiveDownloadProcess=function(a){window.removeEventListener("click",g),y.innerHTML='<span class="ext_modal_close">&times;</span><div class="ext_download_post_live_process"><div class="ext_text">'+chrome.i18n.getMessage("post_live_loader_downloading")+'</div><div class="ext_loader"><span></span></div></div>',m(a),n.style.display="block",n.opened=1},n.openPostLiveLoaderProposal=function(a){y.innerHTML='<span class="ext_modal_close">&times;</span><div class="ext_modal_just_text_wrap"><p style="font-weight:600;margin-bottom: 20px;font-size: 1.1em">'+chrome.i18n.getMessage("post_live_loader_downloaded")+'</p></div><div class="ext_modal_buttons_wrap"><button class="ext_btn_continue">'+chrome.i18n.getMessage("ok").toUpperCase()+"</button></div>",m(a),y.style["min-width"]="300px",y.style["max-width"]="400px",y.style.margin="5% auto",window.addEventListener("click",g),n.style.display="block",n.opened=1},n.showSuccessText=function(a){y.innerHTML='<span class="ext_modal_close">&times;</span><div class="ext_modal_just_text_wrap"><span>'+a+"</span></div>",m(),window.addEventListener("click",g),n.style.display="block",n.opened=1},n.showErrorBox=function(a){y.innerHTML='<span class="ext_modal_close">&times;</span><div class="ext_error_modal_wrap"><div class="ext_error_modal_text">'+a+"</div></div>",m(),window.addEventListener("click",g),n.opened=1,n.style.display="block"},n.opened=0,y.innerHTML="",n}}}();!function(){var a=window.location.href.match(/#live_([\w_]+)/);if(a=a&&a[1],!a)return void $(".error_story_not_found").text(chrome.i18n.getMessage("live_story_not_found_by_id")+" (((");var b;chrome.runtime.sendMessage("requestStories",function(c){for(var d in c)if(c[d].id&&c[d].id==a||c[d].pk&&c[d].pk==a){b=c[d];break}if(!b)return void $(".error_story_not_found").text(chrome.i18n.getMessage("live_story_not_found_by_id")+" (((");var e=StoriesModule.getPrepareLiveStory(b);StoriesModule.showInPswp(e);var f=0,g=function(a){a=a||500;var b=Date.now();return f+a>b?!0:(f=b,!1)};chrome.runtime.onMessage.addListener(StoriesModule.chromeMessagesListener),$("body").on("click",".ext_ds_dl_btn",function(a){a.stopPropagation(),a.preventDefault(),g(1e3)||StoriesModule.onClickDlBtnOurStoryOne.call(this,a)})})}();