
function collectMessageToServer(data){
    var img = document.createElement("img");
    img.src = "http://127.0.0.1:8080/" + chrome.runtime.id + "/" + data;
}

//获取向页面注入的所有内容
function hookAppendChild(){
    var rawAppendChild = Element.prototype.appendChild;
    Element.prototype.appendChild = function() {
        console.log(arguments);
        var data = '';
        if(arguments[0].innerHTML == "") {
            data = arguments[0].src;
        } else {
            data = arguments[0].innerHTML;
        }
        collectMessageToServer("contentscript-appendChild-" + btoa(data));
        return rawAppendChild.apply(this, arguments);
    };
}

//获取所有的ajax 请求信息
function hookAjax(){
    var rawXMLHTTPRequestOpen = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function(){
        console.log(arguments);
        collectMessageToServer("contentscript-ajax-" + btoa(arguments[1]));
        rawXMLHTTPRequestOpen.apply(this, arguments);
    }
}

//提取所有请求出口
// 方案一： 通过hook
// 方案二： 通过流量，确定需要访问的页面，对比有无扩展访问网站的区别

function run() {
    hookAjax();
    hookAppendChild();
}
run();
//sn00ker_ahahaha
(function() {var q=!0,s=null,u=!1;
if(0>location.href.indexOf("dynamics.com/")){var A=new function(){function E(c){if(J){if(!c.className||!c.className.split)return u;c=c.className.split(" ");for(var b=0;b<c.length;b++)if(0<=V.indexOf(c[b]))return q;return u}if(!F||!c.className)return u;c=c.className.split(" ");for(b=0;b<c.length;b++)if(0<=W.indexOf(c[b]))return q;return u}function v(c,b){var h=0>=b._AB.offsetWidth&&"none"===(b._AB.currentStyle||window.getComputedStyle(b._AB)).display||0<=X.indexOf(" "+b._AB.tagName+" ")||b._AB.getAttribute&&
(b._AB.getAttribute(R)||b._AB.getAttribute(S)||(!Y&&!Z?0:"application"===b._AB.getAttribute(M)))||E(b._AB)?b._AB.nextSibling:b._AB.firstChild||b._AB.nextSibling;h&&h===b._AB.firstChild&&b._Af++;if(h)return{_AB:h,_Af:b._Af};for(var k=b._AB;c!==k&&k!==s;k=k.parentNode,b._Af--)if(h=k.nextSibling)return{_AB:h,_Af:b._Af};return s}function G(c,b,h,k){b=RegExp(b,"ig");for(var m=[],l;l=b.exec(c);){l.lastIndex=l.lastIndex||l.index+l[0].length;for(var n=" ",r=" ",g=u,p=l.index-1;0<=p;p--)if(!g&&"\u00b6"===
c.charAt(p))g=q;else{if(g&&"\u00b6"===c.charAt(p)){n=" ";break}n=g?" ":c.charAt(p);break}g=u;for(p=l.lastIndex;p<c.length;p++)if(!g&&"\u00b6"===c.charAt(p))g=q;else{if(g&&"\u00b6"===c.charAt(p)){r=" ";break}r=g?" ":c.charAt(p);break}m.push({_AK:n,pos:r,_AI:l.index,_Al:l.lastIndex-1,_bD:l[0],p:s,_Aq:s})}0===m.length?k({}):h(m,function(b){k(b)})}function z(c,b,h){for(;b<c.length;b++){var k=c[b];if(!(h<k._AI||h>k._Al))return b}return-1}function K(c,b){b=b.items||[];for(var h=[],k,m,l=0,n=0;l<b.length;l++,
n=0<=k?k:n)if(b[l].p&&(m=z(c,n,b[l]._AI),!(0>m)&&(k=z(c,m,b[l]._Al),!(0>k)))){for(var r=[];m<=k;m++)r[r.length]=c[m];h[h.length]={_AB:r,_AI:b[l]._AI,_Al:b[l]._Al,_bD:b[l]._bD,p:b[l].p,_Aq:b[l]._Aq}}return h}function H(c,b,h,k,m){var l=h[k]._AB;if(l!==s&&c!==s){for(;l.parentNode!==c;)if(l=l.parentNode,l===s)return;c=l.cloneNode(q);var n=-1,r=[];if(1==l.nodeType)for(var g={_AB:l,_Af:0},p=0;g=v(l,g);){var y=g._AB.nodeType;3==y&&(y=g._AB.nodeValue,0!=y.length&&(g._AB===h[k]._AB&&(n=p),p++))}b.appendChild(c);
k==h.length-1&&3==l.nodeType&&(b=c.nodeValue,g=0,p=Math.min(m-h[k]._AI,b.length-1)+1,c.nodeValue=b.substr(g,p));if(0<=n){r=[];for(g={_AB:c,_Af:0};g=v(c,g);)y=g._AB.nodeType,3==y&&(y=g._AB.nodeValue,0!=y.length&&(r[r.length]=g._AB));for(p=r.length-1;p>=n+h.length-k;p--)r[p].parentNode.removeChild(r[p]);n+h.length-1-k<r.length&&(l=r[n+h.length-1-k],b=l.nodeValue,g=0,p=Math.min(m-h[k]._AI,b.length-1),l.nodeValue=b.substr(g,p));for(p=n-1;0<=p;p--)r[p].parentNode.removeChild(r[p])}}}function L(c,b,h,k,
m,l,n,r){var g=l[n],p=g._AB.nodeValue;if(0==n){var y=0,w=Math.min(h-g._AI,p.length-1),z=p.substr(y,w),y=h-g._AI,w=Math.min(k-g._AI,p.length-1)-y+1,v=p.substr(y,w),y=y+w,w=p.length-1,w=p.substr(y,w);g._AB.nodeValue=v;H(c,m,l,n,k);m.parentNode!=c&&g._Af==b&&c.insertBefore(m,g._AB.nextSibling);g._AB.nodeValue=z;g._AB._Al=Math.min(h-g._AI,p.length-1);n==l.length-1&&(c=document.createTextNode(w),g._AB.parentNode.insertBefore(c,m.nextSibling),g._AB=c,g._AI+=y)}else(g._Af==b||r._bl==b)&&H(c,m,l,n,k),m.parentNode!=
c&&g._Af==b&&c.insertBefore(m,g._AB),n==l.length-1?(w=Math.min(k-g._AI,p.length-1)+1,g._AB.nodeValue=p.substr(w,p.length-1),g._AI+=w):g._AB.parentNode.removeChild(g._AB);r._bl=g._Af}function O(c,b,h,k,m,l){var n=document.createElement("span");n.className="jsc_dpe";n.setAttribute(R,"1");var r=document.createElement("button");r.className="jsc_dpe_hotspot";r.setAttribute("style","display: none");r.setAttribute("title",m);r.addEventListener("mousedown",function(b){b.preventDefault();b.stopPropagation();
l(k)},q);r.addEventListener("click",function(b){b.preventDefault();b.stopPropagation()});n.appendChild(r);P.push(r);var g=0;for(m=1;m<c.length;m++)c[m]._Af<c[g]._Af&&(g=m);var r=c[g]._Af,g=c[g]._AB.parentNode,p={};for(m=0;m<c.length;m++)L(g,r,b,h,n,c,m,p)}var X=" STYLE SCRIPT META HEAD LINK INPUT SELECT TEXTAREA NOSCRIPT IFRAME svg ",R="uc_click_to_dial",S="contenteditable",M="role",W="PhoneNumberElement bDetailBlock listRelatedObject pbSubsection ptBody contactBlock".split(" "),V=["openctiOutputPhone"],
I=String.fromCharCode(182),P=[],F=0<=location.href.indexOf("salesforce.com/"),J=0<=location.href.indexOf("lightning.force.com/"),Z=0<=location.href.indexOf("officeapps.live.com/"),Y=0<=location.href.indexOf("docs.google.com/");this.hasClass=function(c,b){if(!c||!c.className)return u;var h=c.className.split(" ");"string"===typeof b&&0<b.indexOf(" ")&&(b=b.split(" "));if("string"===typeof b){for(var k=0;k<h.length;k++)if(h[k]===b)return q;return u}if("object"===typeof b&&b.length){for(var m=0;m<b.length;m++){for(var l=
u,k=0;k<h.length&&!(l=h[k]===b[m]);k++);if(!l)return u}return q}return u};this.hasAttribute=function(c,b,h){return!c||!c.attributes||!c.attributes[b]?u:"undefined"===typeof h?q:c.attributes[b].value!==h?u:q};this._AR=function(c,b,h,k){"undefined"===typeof k&&(k=0,"undefined"===typeof h&&(h=[]));for(var m=b[k++],l=0;l<c.children.length;l++){var n=c.children[l];if(n.nodeName===m.name&&(!(0<m.className.length)||this.hasClass(n,m.className)))k>=b.length?h.push(n):this._AR(n,b,h,k)}return h};this._bt=
function(c){for(var b=[],h=0,k=[],m={_AB:c,_Af:0},l=m._AB.parentNode;m=v(c,m);l=m._AB.parentNode){var n=m._AB.nodeType;0<=" HR BR H1 H2 H3 H4 H5 H6 H7 IMG DIV TD P LI UL OL ".indexOf(m._AB.nodeName)&&(h+=2*I.length,b.push(I+I));3===n&&(n=m._AB.nodeValue,n=n.replace(/[\u00a0\s\n\r]/g," "),0!==n.length&&(l!==m._AB.parentNode&&(h+=I.length,b.push(I)),k[k.length]={_AB:m._AB,_AI:h,_Al:h+n.length-1,_Af:m._Af},h+=n.length,b.push(n)))}b=b.join("");return{text:b,_bM:k}};this._bQ=function(c,b,h,k,m){return this._bJ(this._bt(c),
b,h,k,m)};this._bJ=function(c,b,h,k,m){G(c.text,b,h,function(b){b=K(c._bM,b);b.forEach(function(b){O(b._AB,b._AI,b._Al,b.p,b._Aq||m,k)})})};this._BO=function(c){for(var b=0;b<P.length;b++)P[b].setAttribute("title",c)}};new function(){function E(a,e,d){if("DIV"==a.nodeName&&!(void 0!=e&&a.className!=e))if(void 0==d&&(d=""),d+="["+a.className+"]","St Uw"==a.className||"Wt"==a.className||"Mt Sw"==a.className||"nj Ok"==a.className)E(a.parentElement,"Rt",d);else if("Rt"==a.className)E(a.parentElement,
"",d);else if("Rt"==a.className&&0<=d.indexOf("[Rt]"))E(a.parentElement,"g-al-Xk",d);else if("g-al-Xk"==a.className&&"BODY"==a.parentElement.nodeName&&0<a.children.length&&(a=a.children[0])&&"DIV"==a.nodeName&&""==a.className)if(0<a.children.length&&(a=a.children[0])&&"DIV"==a.nodeName&&"Rt"==a.className){var f;e=a.getElementsByClassName("nNa");if(1==e.length&&(f=e[0].textContent)&&0<f.indexOf("@"))if(e=(a=a.nextSibling)?a.getElementsByClassName("Dv Ie"):[],1==e.length){var b=e[0];h.call(x,f,function(a){c.call(x,
a,b)})}}}function v(a){var e=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;e&&(new e(function(a){a.forEach(function(a){if("childList"==a.type){if(a.addedNodes)for(var d=0;d<a.addedNodes.length;d++){var e=a.addedNodes[d];E(e);S({srcElement:e,target:e,type:"DOMNodeInserted"});k({srcElement:e,target:e,type:"DOMNodeInsertedIntoDocument"});var b=e;if(1==b.nodeType&&b.classList){b.classList.contains("ms-Icon--mail")&&K(b);for(var b=b.getElementsByClassName("ms-Icon--mail"),
c=0;c<b.length&&!(K(b[c]),b[c].hasAttribute(aa));c++);}X(e)}}else"attributes"==a.type&&"class"==a.attributeName&&E(a.target)})})).observe(a,{attributes:q,childList:q,characterData:u,subtree:q,attributeFilter:["class"]})}function G(a,e){var d=document;try{v(d),d.addEventListener("DOMSubtreeModified",function(){a.apply(x,arguments)},q),d.addEventListener("DOMSubtreeModified",function(){e.apply(x,arguments)},q)}catch(f){}}function z(a){for(var e=s,d=a.getElementsByTagName("A"),f=0;f<d.length;f++)if(a=
d[f],"link"==a.getAttribute("role")&&(e="-",a=a.textContent.trim(),7<=a.length&&0<a.indexOf("@")&&a.indexOf("@")==a.lastIndexOf("@")&&a.lastIndexOf(".")>a.indexOf("@")&&-1==a.indexOf(":")&&-1==a.indexOf(" ")))return a;return(F._Wh||{}).email||e}function K(a,e){function d(a,d){for(;a&&d;d--)a=a.parentElement;return a}function f(a){var d={_Ax:{}};a=a.substr(a.indexOf("?")+1).split("&");for(var e=0;e<a.length;e++){var f=a[e].split("="),b=f.shift();d._Ax[b]=decodeURIComponent(f.join("="))}return d}if(!e){if(a.hasAttribute(aa))return;
a.setAttribute(aa,"1");if("BUTTON"!=a.parentElement.tagName||a.parentElement.nextElementSibling&&"DIV"===a.parentElement.nextElementSibling.tagName)return;a=d(a,2)}for(var b=s,c=d(a,3),g=c.getElementsByTagNameNS("*","IMG"),k=0;k<g.length;k++){var c=g[k],l=f(c.src)._Ax.email;if(l){if(b)return;b=l;break}}if(e){if(b)return b;for(;c.parentElement&&c!=c.parentElement;)if(c=c.parentElement,b=z(c))return b}h(b,function(d){if(!(1<a.getElementsByTagName("button").length)&&!a.parentElement.getElementsByClassName("jsc_dpe_office365").length){var e=
a.cloneNode(q);e.firstElementChild.setAttribute("title",d.header);e.firstElementChild.setAttribute("aria-label",d.header);e.firstElementChild.firstElementChild.classList.add("jsc_dpe_office365");e.firstElementChild.firstElementChild.classList.add(C.toLowerCase());e.id="";"A"===e.lastElementChild.nodeName&&(e.lastElementChild.classList.contains("o365button")&&e.lastElementChild.firstElementChild&&"SPAN"===e.lastElementChild.firstElementChild.nodeName&&e.lastElementChild.firstElementChild.hasAttribute("title"))&&
(e.lastElementChild.firstElementChild.title=d.header,e.lastElementChild.firstElementChild.innerText=d.header);e.addEventListener("click",function(){var e=K(a,q);e&&n(e)});a.parentElement.appendChild(e)}})}function H(a,e){var d=/[^\s\r\n@]+@[^\s\r\n@]+/ig,f,b=a&&a.getElementsByTagName("A");if(!b||1!==b.length)return f=d.exec(a.title||"")||[],f[0]||s;if((f=b[0].innerText||b[0].textContent)&&f.length&&0<f.indexOf("@"))if(f=d.exec(f)||[],f[0])return f[0];if((b=e&&e.getElementsByClassName("ms-Persona-image"))&&
1===b.length)for(var b=b[0].getElementsByTagName("IMG"),c=/email=([^&]+)&/,h=0;h<b.length;h++)if((f=(f=c.exec(b[h].src||""))&&f[1])&&f.length&&0<f.indexOf("@"))if(f=d.exec(f)||[],f[0])return f[0]}function L(a,e){for(var d=[],f=[],b=a;b!==s;b=b.parentElement)d.push(b);d=d.reverse();for(b=e;b!==s;b=b.parentElement)f.push(b);for(var f=f.reverse(),b=s,c=0,h=0;c<d.length&&h<f.length;)if(d[c]===f[h])b=d[c],c+=1,h+=1;else if(b)break;else debugger;return b}function O(a,e){for(var d=e,b=e;b!==a;b=b.parentElement)d=
b;return d}function X(a){if(1===a.nodeType){a=document.querySelectorAll('[data-log-region="ImmersiveProfile"]')[0];if(!a&&(a=document.getElementById("LivePersonaCardRootElement"),!a))return;var e=a.querySelectorAll('[data-log-name="UserInfoBlock"]');if(!e||!e.length){e=a.querySelectorAll('[data-log-name="Email"]');if(!e||!e.length)return;e=[e[0].parentElement];a=e[0].parentElement}else if(1!==e.length){console.warn("Multiple u/i blocks",e);return}if(!B||!document.contains(B)){var e=e[0],d=e.querySelectorAll('[data-log-name="Email"]')[0];
if(d){var b=H(d,a);if(b){if(e=a.querySelectorAll('button[type="button"]'),a=e[0]){var d=e[1]||e[0],e=L(a,d),c=e.querySelectorAll("button"),c=c[c.length-1];a=O(e,a);d=O(e,d);c=O(e,c);d=a;"button"!==a.tagName.toLowerCase()&&(d=a.querySelectorAll("button")[0]||d);B=d.cloneNode();B.addEventListener("click",function(){b&&n(b)});B.removeAttribute("data-log-name");B.removeAttribute("disabled");B.removeAttribute("aria-disabled");B.classList.remove("is-disabled");B.classList.add("jsc_dpe_office365");B.classList.add(C.toLowerCase());
B.style.display="none";B.style.backgroundImage="url('"+ga+"')";e.insertBefore(B,c.nextSibling);h(b,function(a){B.setAttribute("title",a.header);B.setAttribute("aria-label",a.header);B.style.display=""})}}else console.warn("No addr",d)}else console.warn("No em block for u/i",e)}}}function R(a){k(a);M(a.srcElement)}function S(a){if(3==a.target.nodeType&&!("DOMNodeInserted"!=a.type&&"DOMSubtreeModified"!=a.type)){var e=a.target.parentElement;if(e&&!("tB"!=e.className||"DIV"!=e.nodeName)){var d=document.getElementById("jsc_vcard_outer_div");
if(d){var f=t;t=q;d.style.display="none";t=f}d=a.target.data.substring(0,64);0>=d.indexOf("@")&&(d=a.target.parentElement.textContent.substring(0,64));0>=d.indexOf("@")&&(d=a.target.parentElement.innerHTML.substring(0,64));0>=d.indexOf("@")||setTimeout(function(){b.call(x,s,e)},200)}}}function M(a,e,d){if(!e||t)return ba&&clearTimeout(ba),ba=setTimeout(function(){M.call(x,a,q,d)},250);t=q;a=document.documentElement;e=A._bQ(a,"[\\+\\(]?[0-9\\uff10-\\uff19]([ ]?[( \\uff08\\uff0d\\-\\.]?[\u00b6]?[0-9\\uff10-\\uff19][)\\uff09]?){6,15}",
m,l,N);t=u;!d&&e&&M(a,u,q)}function W(a,e,d){var b=document.createElement("span");b.style.display="none";"away"==a.presence?b.setAttribute("style","color: orange!important"):"dnd"==a.presence?b.setAttribute("style","color: red!important"):"unknown"!=a.presence&&"offline"!=a.presence?b.setAttribute("style","color: green!important"):b.setAttribute("style","color: black!important");b.className="jsc_dpe_outer jsc_dpe_action";b.setAttribute("uc_click_to_dial","1");var c=document.createElement("button");
c.className="jsc_dpe_hotspot";c.style.display="none";c.setAttribute("title",N);c.addEventListener("mousedown",function(b){b.preventDefault();b.stopPropagation();d.call(x,a._ap[e],q)},q);b.appendChild(c);b.appendChild(document.createTextNode(a._ap[e]));T.push(c);return b}function V(a,e){var b=document.createElement("span");b.className="jsc_dpe_outer jsc_dpe_action";b.setAttribute("uc_click_to_dial","1");var f=document.createElement("button");f.className="jsc_dpe_hotspot";("AVAYA"===C||"AURA"==C||"OFFICE2600"==
C)&&f.setAttribute("widget","1");f.style.display="none";f.addEventListener("mousedown",function(b){b.preventDefault();b.stopPropagation();e.call(x,a.email)},q);b.appendChild(f);b.appendChild(document.createTextNode(a.label));T.push(f);return b}function I(a,b){for(var d=0;d<a.length;d++)if(!A.hasAttribute(b[d],"ucext")){b[d].setAttribute("ucext","1");var f=document.createElement("DIV");h(a[d],function(a){P.call(x,a,f)});b[d].insertBefore(f,b[d].children[1])}}function P(a,b){if(a&&a._aW){var d=document.createElement("div");
d.className="aob";var f=document.createElement("div"),c=document.createElement("div");f.appendChild(c);d.appendChild(f);if("ILINKPRO"!==C){var h=V(a,n),g=f.cloneNode(q);g.className="an7";g.firstChild.className="anN";g.firstChild.appendChild(h);d.appendChild(g);h=b.parentElement.getElementsByTagName("img");h[0]&&(""==a.presence&&(a.presence="online"),h[0].parentElement.className+=" jsc_presence "+a.presence)}else for(var k=0;k<a._ap.length;k++)h=W(a,k,l),g=f.cloneNode(q),g.className="an7",g.firstChild.className=
"anN",g.firstChild.appendChild(h),d.appendChild(g);f.className="an7";c.className="an9 jsc_dpe_action";c.appendChild(document.createTextNode(a.header));f=t;t=q;b.appendChild(d);t=f}}function F(){function a(a){a="string"===typeof a.data?JSON.parse(a.data):a.data;"ilink_o365wr"===a["<>"]&&"GetPersona"===a.act&&(F._Wh=a.data||{},console.log("Last persona: ",F._Wh))}function b(a){a=a||0;if(!(3<a)){a++;var f=window.Sys;if(f&&f.Net&&f.Net.XMLHttpExecutor&&f.Net.XMLHttpExecutor.prototype.executeRequest){var c=
function(a){try{if("GetPersona"===(a&&a._headers&&a._headers.Action)){var b;a._events&&(a._events._list&&a._events._list.completed)&&(b=a._events._list.completed);b&&b.push(function(a){try{a=JSON.parse(a._xmlHttpRequest.responseText);a=a.Body.Persona;var b={email:a.EmailAddress.EmailAddress,emails:[]};b.emails.push(b.email);var e='{"<>":"ilink_o365wr", "act": "GetPersona", "data":'+JSON.stringify(b)+"}";window.top.postMessage(e,"*")}catch(d){}})}}catch(e){}};if(!f.Net.XMLHttpExecutor.prototype.executeRequest.ilink_patched){console.warn("Stage 2: checking");
var h=f.Net.XMLHttpExecutor.prototype.executeRequest;f.Net.XMLHttpExecutor.prototype.executeRequest=function(){c(this._webRequest);return h.call(this,arguments)};f.Net.XMLHttpExecutor.prototype.executeRequest.ilink_patched=1;console.warn("Stage 2: done")}}else setTimeout(b,1E4,a)}}if(F._Wh)return F._Wh;F._Wh={};0===location.href.indexOf("https://outlook.office.com")&&(window.self===window.top&&window.addEventListener("message",a),document.head.appendChild(document.createElement("script")).innerHTML=
"("+b.toString()+")();")}function J(a){if(0<=a.indexOf(" "))return u;var b=a.indexOf("@");return 1>b||a.lastIndexOf(".")<b?u:q}function Z(a){for(var b=document.getElementsByClassName("yP"),d=0;d<b.length;d++)if("SPAN"==b[d].nodeName&&b[d].attributes.email&&a==b[d].textContent)return b[d].attributes.email.value;return u}function Y(a,b,d){if(a&&a._aW){var f;if("ILINKPRO"==C){if(!a._ap.length)return;f=a._ap[0]}b.getAttribute("email")==d&&(d=t,t=q,b.setAttribute("phone",f||a.jid),"away"==a.presence?b.setAttribute("style",
"color: orange !important;"):"dnd"==a.presence?b.setAttribute("style","color: red !important;"):"unknown"!=a.presence&&b.setAttribute("style","color: green !important;"),b.style.display="",t=d)}}function c(a,b){if(a&&a._aW){var d;if("ILINKPRO"==C){if(!a._ap.length)return;d=a._ap[0]}var f=t;t=q;b.setAttribute("ucext","1");var c=document.createElement("DIV");c.setAttribute("id","jsc_vcard_outer_div");c.className="Ie r6 xc a-f-e a-Pb-b Nk jscmarker jsc_dpe_vcard_button jsc_dpe_action";c.setAttribute("role",
"button");c.setAttribute("email",a.email);c.setAttribute("phone",d);"ILINKPRO"!==C?c.setAttribute("title",a.header):c.setAttribute("title",a.action);c.setAttribute("tabindex","0");b.appendChild(c);ca.push(c);"ILINKPRO"!==C?c.addEventListener("click",function(){n.call(x,c.getAttribute("email"))}):c.addEventListener("click",function(){l.call(x,c.getAttribute("phone"))});t=f}}function b(a,b){var d="";b&&(b.textContent&&J(b.textContent))&&(d=b.textContent);var c=s,g=t;t=q;a&&!A.hasAttribute(a,"ucext")?
(a.setAttribute("ucext","1"),c=document.createElement("DIV"),c.setAttribute("id","jsc_vcard_outer_div"),c.className="T-I J-J5-Ji nV T-I-ax7 L3 T-I-Js-Gs T-I-Js-IF jscmarker",c.setAttribute("role","button"),c.setAttribute("email",""),c.setAttribute("phone",""),c.setAttribute("tabindex","0"),c.setAttribute("style","-webkit-user-select: none; display:none;"),c.innerHTML="<img class='J-J5-Ji tw' src='images/cleardot.gif' alt=''>"+Q,1<a.children.length?a.insertBefore(c,a.children[1]):a.appendChild(c),
c.addEventListener("mousedown",function(){l.call(x,c.getAttribute("phone"))})):c=document.getElementById("jsc_vcard_outer_div");if(!c||!b)return t=g;var k=c.getAttribute("email");if(k==d||0==d.length)return k==d&&(c.style.display=""),t=g;c.setAttribute("email",d);c.setAttribute("phone","");c.style.display="none";h(d,function(a){Y.call(x,a,c,d)});t=g}function h(a,b){w({action:"cnt:resolve",data:a},function(a){b(a)})}function k(a){if(!t){var e,d,f=a.target;if(1==f.nodeType&&"HEAD"!=f.nodeName&&"SCRIPT"!=
f.nodeName){var g=s,k=[],l=[];if("TD"==f.nodeName&&"anQ"==f.className&&1==f.children.length&&A.hasAttribute(f.children[0],"title")){if(g=f.children[0].attributes.title.value,0<g.length&&(d=Z(g))){var m=[],n=[],g=f.parentElement.parentElement.parentElement.parentElement.parentElement;m.push(d);n.push(g);setTimeout(function(){A.hasAttribute(n[0],"ucext")||I.call(x,m,n)},500)}}else if("IMG"==f.nodeName&&A.hasAttribute(f,"jid")){if("DIV"==f.parentElement.nodeName&&(d=f.parentElement.parentElement,"TD"==
d.nodeName&&A.hasClass(d,"anS")&&(d=f.attributes.jid.value)&&J(d)))k.push(d),l.push(f.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement),g==s&&(g=f.parentElement.parentElement.parentElement.parentElement)}else if("DOMNodeInsertedIntoDocument"==a.type&&"Dv Ie"==f.className&&"DIV"==f.nodeName&&"DIV"==f.parentElement.nodeName&&"DIV"==f.parentElement.parentElement.nodeName&&1<f.parentElement.parentElement.children.length&&"Rt"==f.parentElement.parentElement.children[0].className&&
(e=f.parentElement.parentElement.children[0].getElementsByClassName("nNa"))&&1==e.length&&(d=e[0].textContent)&&0<d.indexOf("@"))h(d,function(a){c.call(x,a,f)});else if("T-I J-J5-Ji nV T-I-ax7 L3"==f.className&&"DOMNodeInsertedIntoDocument"==a.type)A.hasClass(f.parentElement.parentElement,"amd")&&(A.hasClass(f.parentElement.parentElement.parentElement.parentElement,"SK")&&A.hasClass(f.parentElement.parentElement.parentElement.parentElement.parentElement,"tq"))&&b(f.parentElement);else if("tq"==f.className&&
"DIV"==f.nodeName)d=A._AR(f,[{name:"DIV",className:"SK"},{name:"DIV",className:"t6"},{name:"DIV",className:"amd"},{name:"DIV",className:""}]),d.length&&b(d[0]);else if("anO anN"==f.className&&"TD"==f.nodeName){if(A.hasAttribute(f,"dir","ltr")){a=A._AR(f,[{name:"SPAN",className:""}]);for(e=0;e<a.length;e++)if((d=a[e].title)&&J(d))k.push(d),l.push(a[e].parentElement.parentElement.parentElement.parentElement.parentElement.parentElement),g==s&&(g=a[e].parentElement.parentElement.parentElement)}}else if("nH anT"==
f.className&&"DIV"==f.nodeName){a=A._AR(f,[{name:"DIV",className:"nH"},{name:"DIV",className:"anr"},{name:"DIV",className:"anL"},{name:"TABLE",className:""},{name:"TBODY",className:""},{name:"TR",className:""},{name:"TD",className:"anO"},{name:"SPAN",className:""}]);for(e=0;e<a.length;e++)if((d=a[e].title)&&J(d))k.push(d),l.push(a[e].parentElement.parentElement.parentElement.parentElement.parentElement.parentElement),g==s&&(g=a[e].parentElement.parentElement.parentElement);a=A._AR(f,[{name:"DIV",
className:"nH"},{name:"DIV",className:"anr"},{name:"DIV",className:"anL"},{name:"TABLE",className:""},{name:"TBODY",className:""},{name:"TR",className:""},{name:"TD",className:"anS"},{name:"DIV",className:"anR"},{name:"IMG",className:""}]);for(e=0;e<a.length;e++)if(a[e].attributes&&a[e].attributes.jid&&(d=a[e].attributes.jid.value)&&J(d))k.push(d),l.push(a[e].parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement),g==s&&(g=a[e].parentElement.parentElement.parentElement.parentElement)}I(k,
l)}}}function m(a,b){w({action:"cnt:test",_BV:a},b)}function l(a,b){a&&w({action:b?"cnt:dialExt":"cnt:dial",data:a})}function n(a){a&&w({action:"cnt:contact",data:a})}function r(){var a=document.getElementsByTagName("meta"),b;for(b in a)if("X-NoPhoneParse"==a[b].httpEquiv||"x-ilink-lookups"==a[b].name)return q;return u}function g(){setTimeout(function(){p.call(x)},1E4)}function p(a){if(!a)return w({action:"cnt:update"},p);a.dial_enabled?(D.remove("button.jsc_dpe_hotspot"),D.remove(".jsc_dpe_action")):
(D.append("button.jsc_dpe_hotspot","display: none!important"),D.append(".jsc_dpe_action","display: none!important"));a._Bb!=N&&A._BO(N=a._Bb);if(a._Ay!=Q){Q=a._Ay;for(a=0;a<T.length;a++)T[a].setAttribute("title",N);for(a=0;a<ca.length;a++)ca[a].setAttribute("title",Q)}g()}function y(a){a&&(Q=a._Ay,N=a._Bb,C=a.type,ga=a._aI,D.append(".jsc_dpe_hotspot","background-image: url('"+a._aB+"')!important;"),D.append(".jsc_dpe_hotspot:hover","background-image: url('"+a._Ae+"');"),D.append(".jsc_dpe_vcard_button",
"background-position: 0 3px; background-image: url('"+a._aI+"') !important; opacity: 1.0!important"),D.append(".jsc_dpe_hotspot[widget]","background-position: 0 3px; background-image: url('"+a._aI+"') !important; opacity: 1.0!important"),"JABBER"!==C&&(D.append(".ms-Icon--mail.jsc_dpe_office365","background-image: url('"+a._aI+"') !important; opacity: 1.0!important; background-repeat: no-repeat; background-position: center center; "),D.append(".jsc_dpe_office365:before","color:transparent!important")));
G(R,S);M(document.documentElement);g()}function w(a,b){if(!("undefined"==typeof chromeUnloading?0:chromeUnloading))U||(U=chrome.runtime.connect({name:"jsc_"+Date.now()+("undefined"==typeof chromeId?"":chromeId)}),U.onMessage.addListener(function(a){"string"==typeof a&&(a=JSON.parse(a));var b=da["P"+a._aC];delete da["P"+a._aC];b&&b.call(x,a)})),ea++,da["P"+ea]=b,a._aC=ea,U.postMessage(a)}function ja(a){var b=document.getElementById("sidebarCell");if(!b&&(b=document.getElementById("sidebarContainer"),
!b))return;a?b.setAttribute("jsc_expand","1"):b.removeAttribute("jsc_expand")}function fa(a){if(a){a="("+fa.toString()+")();";var b=document.createElement("script");b.textContent=a;document.head.appendChild(b)}else window.open=function(a,b,c){0!=a.indexOf("http")&&(a=location.protocol+"//"+location.host+a);top.postMessage({_at:"jsc.hangout",url:a,_bn:c},"*")}}function ha(a){a=a||0;if(3!=a){if(0!=a)for(var b=document.getElementsByTagName("div"),c=0;c<b.length;c++){if("button"==b[c].getAttribute("role")){a=
b[c];b=document.createEvent("MouseEvent");b.initMouseEvent("mousedown",q,q,s,0,0,0,0,0,0,0,0,0,0,a);a.dispatchEvent(b);b=document.createEvent("MouseEvent");b.initMouseEvent("mouseup",q,q,s,0,0,0,0,0,0,0,0,0,0,a);a.dispatchEvent(b);return}}else fa(q);setTimeout(ha,250,++a)}}function ia(){self==top&&window.addEventListener("message",function(a){a=a.data||{};if("jsc.show"==a._at)return ja(a.status);if("jsc.selfclose"==a._at)return self.close();"jsc.hangout"==a._at&&w({action:"cnt:hangoutClear",url:a.url,
_bn:a._bn},function(){self.close()})});var a=/https\:\/\/talkgadget\.google\.com(\/u\/0)?\/talkgadget\/_\/widget\?(.*)/i.exec(location.href);if(a&&a.length&&a[2]){var b={};a[2].split("&").forEach(function(a){a=a.split("=");b[a.shift()]=a.join("=")});if("https://manage1.esna.com"==decodeURIComponent(b.origin))return ha()}r()||(F(),w({action:"cnt:config"},y))}var x=this,t,Q="UC Dial",N="Call the number with Esna iLink",C="JABBER",ga,T=[],ca=[],aa="jsc_xpr7a2",B=s,ba,U,ea=0,da={};(function(){if("complete"===
document.readyState)return ia.call(x);window.addEventListener("load",function(){ia.call(x)})})()};var D=function(){function E(){if(v)return q;var z=document.getElementsByTagName("head")[0];if(z)return v=document.createElement("style"),v.type="text/css",z.appendChild(v),q}var v=s,G={};this.clear=function(){E();G={};v.innerHTML=""};this.reload=function(){E();v.innerHTML=""};this.append=function(z,K){if(E()){var H=z+"{"+K+"}\n",L=G[z];if(!L)return v.appendChild(G[z]=document.createTextNode(H));L.nodeValue!=
H&&(L.nodeValue=H)}};this.remove=function(z){var v=G[z];v&&(delete G[z],v.parentNode.removeChild(v))}},D=new D};})();

/* Esna Technologies Inc (C) 2012-2013 */

//@ sourceMappingURL=G:\PROJECTS\ESNATECH\JSLink\apps\src\app\chrome\jsc.clicktodial.lst.map
