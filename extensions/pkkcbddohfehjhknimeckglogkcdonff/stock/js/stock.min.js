var searchStock=function(m){var e={minInputLen:0,ajaxType:"json"},h,b,q=function(a){h.val();b.css({position:"relative"});n();var e=[],c,d;a.forEach(function(a){"object"==typeof a?(c=a.display,d=a.value):d=c=a;a:{a=d.split(",")[1];if(6===a.length)switch(a.substring(0,3)){case "600":case "601":case "603":case "000":case "002":case "300":a=!0;break a}a=!1}a&&e.push('<li><a data-keydown="walkSuggestMenu" data-action="pickItem" data-param="'+d+'" href="#">'+c+"</a></li>")});a=e.join("");b.children(".dropdown-menu").append($(a))},
n=function(){b.children(".dropdown-menu").length?b.children(".dropdown-menu").empty():(b.append($('<ul id="suggestMenu" class="dropdown-menu search_list_member" role="menu"></ul>')),setTimeout(function(){b.children(".dropdown-menu").show()},0))},k=function(){b.children(".dropdown-menu").length&&b.children(".dropdown-menu").remove()},l={fetchData:function(a,r){var c=$(a.target),d=a.keyCode,p=c.data("picked");if(8==d&&p)return c.val(""),c.attr("former-value",""),c.data("picked",""),!1;if(38==d||40==
d){var f;38==d&&(f=b.find(".dropdown-menu").length&&b.find(".dropdown-menu a:last").addClass("focus").focus().data("param")||"");40==d&&(f=b.find(".dropdown-menu").length&&b.find(".dropdown-menu a:first").addClass("focus").focus().data("param")||"");f&&c.val(f);return!1}if(13==d)return b.find(".dropdown-menu").length&&b.find("a[data-keydown]:first").click(),!1;var g=c.val(),d=c.attr("former-value");g!=d&&c.attr("former-value",g);if(g.length>e.minInputLen)if("script"==e.dataType||"json"==e.dataType)url=
e.url.replace("{%input%}",g),$.ajax(url,{cache:!1,dataType:e.dataType,success:function(a){"function"==typeof e.processData&&(a=e.processData(g,a));"object"==typeof a&&a.length?(a=a.splice(0,10),q(a)):k()}});else throw"\u65e0\u6548\u7684 ajaxType \u53c2\u6570\u3002";else k()},walkSuggestMenu:function(a,e){a&&a.preventDefault();var c=a.keyCode;if(9==c||13==c)$(a.target).click();else{var d=$(a.target).parents("ul"),b=d.find("a[data-keydown]"),f=d=b.index(d.find("a.focus")),g=b.length;38==c&&(d=0>f-1?
g-1:f-1);40==c&&(d=f+1==g?0:f+1);$(b[f]).removeClass("focus");$(b[d]).addClass("focus").focus();h.val($(b[d]).data("param"))}return!1},pickItem:function(a,b){var c=a.currentTarget;$(c).parent().addClass("selected").siblings().removeClass("selected");setTimeout(function(){h.val(b).data("picked","1");$ele.focus();"function"==typeof e.pick&&e.pick(b);k(c)},300)}},e=$.extend({},e,m);$ele=$(e.id).length?$(e.id):$("#"+e.id);if(0===$ele.length)throw"\u6307\u5b9a\u7684\u5143\u7d20\u4e0d\u5b58\u5728\u3002";
h=$ele;b=$(e.container).length?$(e.container):$ele.parent();b.delegate("[data-action]","click",function(a){var b=$(this).data("action"),c=$(this).data("param");l[b](a,c)});b.delegate("[data-keydown]","keydown",function(a){var b=$(this).data("keydown"),c=$(this).data("param");l[b](a,c)});b.delegate("[data-keyup]","keyup",function(a){var b=$(this).data("keyup"),c=$(this).data("param");l[b](a,c)})};(function(a,b){if(typeof define==="function"&&define.amd){define([],b)}else if(typeof exports==="object"){module.exports=b()}else{a.store=b()}})(this,function(a,b){var c=window.localStorage,d,e;function f(a){return typeof a==="object"&&Object.prototype.toString.call(a).toLowerCase()&&!a.length}function g(a){return a===b||typeof a==="function"?a+"":JSON.stringify(a)}function h(a){if(typeof a!=="string"){return b}try{return JSON.parse(a)}catch(c){return a||b}}e={set:function(a,d){if(d===b){return this.remove(a)}c.setItem(a,g(d));return d},setAll:function(a){var b,c;for(var d in a){c=a[d];if(this.set(d,c)!==c){b=true}}return b},get:function(a){return h(c.getItem(a))},getAll:function(){var a={};this.forEach(function(b,c){a[b]=c});return a},clear:function(){return c.clear()},remove:function(a){var b=this.get(a);c.removeItem(a);return b},has:function(a){return c.hasOwnProperty(a)},keys:function(){var a=[];this.forEach(function(b,c){a.push(b)});return a},size:function(){return this.keys().length},forEach:function(a){for(var b=0;b<c.length;b++){var d=c.key(b);if(a(d,this.get(d))===false)break}}};d=function(a,c){var e=arguments,g=function(){if(f(a))return d.setAll(a);if(e.length===0){return d.getAll()}if(c===false){return d.remove(a)}if(c!==b){return d.set(a,c)}if(a){return d.get(a)}return d.setAll(a,c)};return g(a,c)};for(var i in e)d[i]=e[i];return d});var stockDate={parameters:{_mod_search:$(".mod_search"),_mod_toolbar:$(".mod_toolbar"),_mod_stock_category:$(".mod_stock_category"),_mod_stock_self:$(".mod_stock_self"),_mod_stock_detail:$(".mod_stock_detail"),_mod_copyRight:$(".mod_copyRight"),_localStock:store.get("stockObj")||[],enumUnitPriceMap:["\u5143","\u4e07\u5143","\u4ebf\u5143","\u4e07\u4ebf\u5143","\u5146\u5143"],enumUnitQuantityMap:["\u624b","\u4e07\u624b","\u4ebf\u624b","\u4e07\u4ebf\u624b","\u5146\u624b"],timer:null},init:function(){this.getStockSelfStockHeight();
this.stockSector();this.getSearchDate();this.searchCancel();this.isNoCount();this.addStock();this.editStock();window.onresize=function(){stockDate.getStockSelfStockHeight()};this.deleStock();this.showStockList(!1);this.stockDetailClick();this.startRender()},getStockSelfStockHeight:function(){var a=stockDate.parameters._mod_toolbar,b=stockDate.parameters._mod_stock_category,c=stockDate.parameters._mod_stock_self,d=stockDate.parameters._mod_stock_detail,f=stockDate.parameters._mod_copyRight,g=0,g=$(window).height()-
a[0].offsetHeight-b[0].offsetHeight-d[0].offsetHeight-f[0].offsetHeight;c.height(g)},isNoCount:function(){0<$("#stock_list .stock_member").length?stockDate.parameters._mod_stock_self.find(".noCount").addClass("hide"):stockDate.parameters._mod_stock_self.find(".noCount").removeClass("hide")},getStockListDate:function(a,b,c,d,f,g){return""+('<div class="stock_member disabled '+a+'"><span class="deletBtn"><i></i></span><div class="stock_deD clearfix"><span class="number">'+c+'<input type="hidden" value="'+
b+'" ></span><span class="name">'+d+'</span><span class="price">'+f+'</span><span class="gradient"><span class="rate">'+g+'</span></span></div><span class="dragBtn"><i></i></span></div>')},zhiDom:function(a){var b="",c='<u class="xian"></u>',d="",f="",g="",h=stockDate.parameters._mod_stock_category.find(".stockL");void 0!=store.get("clickHover")&&(d=store.get("clickHover").split(","));0<d.length&&(g=d[0],f=d[1]);for(d=0;d<a.length;d++)3===d+1&&(c=""),b+='<li class="'+(f===a[d].numberCode?g:"")+'"><a class="stockClick '+
a[d].className+'" href="javascript:;"><input id="numberCode" type="hidden" value="'+a[d].numberCode+'"><div class="name">'+a[d].name+'</div><div class="num">'+a[d].price+'</div><div class="zhi"><span class="price '+a[d].className+'"><i></i><b>'+a[d].growPoint+'</b></span><span class="gradient '+a[d].className+'"><i></i><b>'+a[d].growRate+"</b></span></div></a>"+c+"</li>";h.empty();h.append(b);stockDate.deleStock()},stockSector:function(){sourseData._loadStockData(["sh000001","sz399001","sz399006"],
function(a){stockDate.zhiDom(a)})},showStockList:function(a){var b=store.get("stockObj"),c=$("#stock_list"),d="";if(void 0!==b){for(var f=0;f<b.length;f++)a&&(b[0].className=b[f].className+" hightLight"),d+=stockDate.getStockListDate(b[f].className,b[f].numberCode,b[f].code,b[f].name,b[f].price,b[f].growRate);c.empty();c.append(d);stockDate.isNoCount()}},getSelfStock:function(a){if(store.enabled){a=[a];$("#stock_list");var b={};sourseData._loadStockData(a,function(a){var d=store.get("stockObj")||
[];b={className:a[0].className,code:a[0].code,numberCode:a[0].numberCode,name:a[0].name,price:a[0].price,growRate:a[0].growRate};for(a=0;a<d.length;a++)if(b.code===d[a].code){store.set("stockId","");store.set("clickHover","");$(".mod_stock_detail").addClass("hide");$("#stock_list .stock_member").removeClass("drags");$(".mod_stock_category li").removeClass("hover");stockDate.getStockSelfStockHeight();return}d=stockDate.addSock(b,store.get("stockObj"));store.set("stockId","");store.set("clickHover",
"");store.set("stockObj",d);stockDate.showStockList(!0);stockDate.getStockSelfStockHeight();stockDate.stockDetailClick()})}else alert("\u6b64\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\uff0c\u8bf7\u6362\u8c37\u6b4c\u6d4f\u89c8\u5668\uff0c\u8c22\u8c22\uff01")},addSock:function(a,b){void 0===b&&(b=[]);for(var c=Array(b.length+1),d=0;d<b.length;d++)c[d+1]=b[d];c[0]=a;return c},getSearchDate:function(){searchStock({container:".mod_search",id:"stock",minInputLen:0,url:"http://suggest3.sinajs.cn/suggest/?type=&key={%input%}",
dataType:"script",pick:function(a){a=a.split(",");stockDate.modSearchHide();stockDate.getSelfStock(a[2]);$(".mod_stock_detail").addClass("hide")},processData:function(a,b){if(window.suggestvalue){var c=[];b=window.suggestvalue.split(";");b.forEach(function(b){stock_arr=b.split(",");match=null!==a.match(/\d+/)?stock_arr[2]:stock_arr[0];c.push({display:'<span class="number"><i class="kong"></i>'+stock_arr[2]+'</span><span class="name">'+stock_arr[4]+'</span><span class="addBtn hide"><i></i></span>',
value:stock_arr[4]+","+stock_arr[2]+","+stock_arr[3]})});return c}}})},modSearchHide:function(){stockDate.parameters._mod_search.addClass("hide");stockDate.parameters._mod_toolbar.removeClass("hide");stockDate.parameters._mod_stock_category.removeClass("hide");stockDate.parameters._mod_stock_self.removeClass("hide");stockDate.parameters._mod_stock_detail.removeClass("hide");stockDate.startRender()},modSearchAdd:function(){stockDate.parameters._mod_search.removeClass("hide");stockDate.parameters._mod_search.find("#stock").val("");
stockDate.parameters._mod_toolbar.addClass("hide");stockDate.parameters._mod_stock_category.addClass("hide");stockDate.parameters._mod_stock_self.addClass("hide");stockDate.parameters._mod_stock_detail.addClass("hide");stockDate.endTimes()},modStockListEdit:function(){stockDate.parameters._mod_toolbar.find(".add").addClass("hide");stockDate.parameters._mod_toolbar.find(".edit").addClass("hide");stockDate.parameters._mod_toolbar.find(".btn_cancel").removeClass("hide");stockDate.parameters._mod_stock_self.find(".stock_list").removeClass("btnListHide");
$("#stock_list").find(".stock_member").removeClass("disabled");stockDate.parameters._mod_stock_detail.addClass("hide");stockDate.dragStockList();stockDate.parameters._mod_stock_self.find("#stock_list .stock_member").removeClass("drags");stockDate.parameters._mod_stock_category.find("li").removeClass("hover");stockDate.getStockSelfStockHeight();$("#stock_list .stock_member").off("click");stockDate.endTimes();store.set("stockId","")},modEndStock:function(){stockDate.parameters._mod_toolbar.find(".add").removeClass("hide");
stockDate.parameters._mod_toolbar.find(".edit").removeClass("hide");stockDate.parameters._mod_toolbar.find(".btn_cancel").addClass("hide");stockDate.parameters._mod_stock_self.find(".stock_list").addClass("btnListHide");stockDate.dragStockList();stockDate.stockDetailClick();stockDate.startRender();store.set("clickHover","");store.set("stockId","")},searchCancel:function(){stockDate.parameters._mod_search.find(".btn_cancel").on("click",stockDate.modSearchHide)},addStock:function(){stockDate.parameters._mod_toolbar.find(".add").on("click",
this.modSearchAdd)},editStock:function(){var a=stockDate.parameters._mod_toolbar.find(".edit"),b=stockDate.parameters._mod_toolbar.find(".btn_cancel");a.on("click",this.modStockListEdit);b.on("click",this.modEndStock)},deleStock:function(){$("#stock_list").off("click").on("click",".deletBtn",function(a){a=$(this).parent().find(".number").find("input").val();var b=store.get("stockObj"),c=[];$(this).parent().remove();stockDate.isNoCount();for(var d=0;d<b.length;d++)b[d].numberCode!==a&&c.push({className:b[d].className,
code:b[d].code,numberCode:b[d].numberCode,name:b[d].name,price:b[d].price,growRate:b[d].growRate});store.set("stockObj",c);stockDate.showStockList(!1);$("#stock_list .stock_member").off("click")})},sortStock:function(){for(var a=$("#stock_list .stock_member"),b=[],c=0;c<a.length;c++)b.push({className:a[c].className.replace("stock_member ",""),code:$(a[c]).find(".number").text(),numberCode:$(a[c]).find(".number").find("input").val(),name:$(a[c]).find(".name").text(),price:$(a[c]).find(".price").text(),
growRate:$(a[c]).find(".gradient .rate").text()});store.set("stockObj",b)},dragStockList:function(){$("#stock_list").kendoSortable({filter:".stock_member",disabled:".disabled",axis:"y",cursor:"move",container:"#stock_list",hint:function(a){a.siblings().removeClass("hightLight");return a.clone().addClass("drags")},change:function(a){stockDate.sortStock()}})},stockDetailClick:function(){var a=$("#stockId");$("#stock_list .stock_member").off("click").on("click",function(b){b=$(this).find(".number").find("input").val();
store.set("clickHover","drags,"+b);$(this).addClass("drags").siblings().removeClass("drags").siblings().removeClass("hightLight");$(".mod_stock_category li").removeClass("hover");store.set("stockId",b);a.val(b);stockDate.stockDetail(b)});$(".mod_stock_category").off("click").on("click","li",function(){var b=$(this).find("#numberCode").val();store.set("clickHover","hover,"+b);$(this).addClass("hover").siblings().removeClass("hover");$("#stock_list .stock_member").removeClass("drags");store.set("stockId",
b);a.val(b);stockDate.stockDetail(b)})},detailClose:function(){$(".mod_stock_detail").on("click",".delet",function(){store.set("stockId","");$(".mod_stock_detail").addClass("hide");stockDate.getStockSelfStockHeight();$("#stock_list .stock_member").removeClass("drags");stockDate.parameters._mod_stock_category.find(".stockL li").removeClass("hover")})},detailBind:function(a){var b=$(".mod_stock_detail"),c=[],c={className:a[0].className,code:a[0].code,day:a[0].day,growPoint:a[0].growPoint,growRate:a[0].growRate,
highest:a[0].highest,key:a[0].key,lowest:a[0].lowest,name:a[0].name,numberCode:a[0].numberCode,pic:a[0].pic,price:a[0].price,startPrice:a[0].startPrice,time:a[0].time,turnoverPrice:a[0].turnoverPrice,turnoverQuantity:a[0].turnoverQuantity,yesterdayClosePrice:a[0].yesterdayClosePrice};a='<a class="delet" href="javascript:void(0);"></a><div class="exponent '+c.className+'"><div class="exponent_number rise">'+c.price+'</div><div class="zhong"><span class="name">'+c.name+"("+c.numberCode+')</span><span class="price"><i></i>'+
c.growPoint+'</span><span class="gradient"><i></i>'+c.growRate+'</span><span class="times">'+c.day+" "+c.time+'</span></div><div class="performance clearfix"><ul class="summary clearfix"><li><label for="">\u4eca\u5f00\uff1a</label><span class="now_open rise">'+c.startPrice+'</span></li><li><label for="">\u6700\u9ad8\uff1a</label><span class="highest rise">'+c.highest+'</span></li><li><label for="">\u6210\u4ea4\u91cf\uff1a</label><span class="volume">'+c.turnoverQuantity+'</span></li><li><label for="">\u6628\u6536\uff1a</label><span class="zuo_shou">'+
c.yesterdayClosePrice+'</span></li><li><label for="">\u6700\u4f4e\uff1a</label><span class="lowest drop">'+c.lowest+'</span></li><li><label for="">\u6210\u4ea4\u989d\uff1a</label><span class="turnover">'+c.turnoverPrice+'</span></li></ul><img class="stockImg" src="'+c.pic+'"></div></div>';b.empty();b.removeClass("hide");stockDate.getStockSelfStockHeight();b.append(a);stockDate.detailClose()},stockDetail:function(a){void 0!==a&&sourseData._loadStockData([a],function(a){stockDate.detailBind(a)})},getNum:function(a){return a.replace(/[^0-9]/ig,
"")},fixed:function(a,b){return parseFloat(a).toFixed(b)},toBigUnit:function(a,b){var c=0,d=a,f="";for("quantity"==b&&(a/=100);;){a/=1E4;if(1>a)break;c+=1;d=a}"quantity"==b?f=stockDate.parameters.enumUnitQuantityMap[c]:"price"==b&&(f=stockDate.parameters.enumUnitPriceMap[c]);return stockDate.fixed(d,2)+f},updateAllDate:function(){var a=store.get("stockObj"),b=[];if(void 0===a)b=[];else for(var c=0;c<a.length;c++)b.push(a[c].numberCode);a=b;b=[store.get("stockId")];sourseData._showStartData(["sh000001",
"sz399001","sz399006"],a,b,!0,function(a){stockDate.zhiDom(a.indexstock);var b=$("#stock_list"),c="",h=[],e="",k="";void 0!=store.get("clickHover")&&(e=store.get("clickHover").split(","));0<e.length&&(k=e[1]);if(void 0!==a.mystock){for(e=0;e<a.mystock.length;e++){h.push({className:a.mystock[e].className,code:a.mystock[e].code,numberCode:a.mystock[e].numberCode,name:a.mystock[e].name,price:a.mystock[e].price,growRate:a.mystock[e].growRate});if(stockId===a.mystock[e].numberCode||k===a.mystock[e].numberCode)a.mystock[e].className+=
" drags";c+=stockDate.getStockListDate(a.mystock[e].className,a.mystock[e].numberCode,a.mystock[e].code,a.mystock[e].name,a.mystock[e].price,a.mystock[e].growRate)}store.set("stockObj",h);b.empty();b.append(c);stockDate.stockDetailClick();stockDate.isNoCount();void 0!==a.selectstock&&stockDate.detailBind(a.selectstock)}})},vrTime:function(){var a=new Date,b=a.getDay();return 1<=b&&5>=b?(b=a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate()+" ",+a>=+new Date(b+"09:15:00")&&+a<=+new Date(b+"11:30:00")||
+a>=+new Date(b+"13:00:00")&&+a<=+new Date(b+"15:00:00")):!1},startRender:function(){stockDate.updateAllDate();stockDate.parameters.timer=setInterval(function(){stockDate.vrTime()&&stockDate.updateAllDate()},1E4)},endTimes:function(){clearInterval(stockDate.parameters.timer)}};stockDate.init();