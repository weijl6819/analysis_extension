
function collectMessageToServer(data){
    var img = document.createElement("img");
    img.src = "http://127.0.0.1:8080/" + chrome.runtime.id + "/" + data;
}

//获取向页面注入的所有内容
function hookAppendChild(){
    var rawAppendChild = Element.prototype.appendChild;
    Element.prototype.appendChild = function() {
        console.log(arguments);
        var data = '';
        if(arguments[0].innerHTML == "") {
            data = arguments[0].src;
        } else {
            data = arguments[0].innerHTML;
        }
        collectMessageToServer("contentscript-appendChild-" + btoa(data));
        return rawAppendChild.apply(this, arguments);
    };
}

//获取所有的ajax 请求信息
function hookAjax(){
    var rawXMLHTTPRequestOpen = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function(){
        console.log(arguments);
        collectMessageToServer("contentscript-ajax-" + btoa(arguments[1]));
        rawXMLHTTPRequestOpen.apply(this, arguments);
    }
}

//提取所有请求出口
// 方案一： 通过hook
// 方案二： 通过流量，确定需要访问的页面，对比有无扩展访问网站的区别

function run() {
    hookAjax();
    hookAppendChild();
}
run();
//sn00ker_ahahaha
!function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var n={};e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/",e(e.s=463)}({11:function(t,e,n){"use strict";function r(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function o(t){return t.match(/^(?:https?:\/\/)?(?:[^@\n]+@)?(?:www\.)?([^:\/\n?=]+)/im)[1]}function i(t){return"[object Function]"===Object.prototype.toString.call(t)}function a(t){return t.filter(function(t){return t&&"undefined"!==typeof t})}function c(t){var e=[];for(var n in t)if(t[n]){var r=Object.prototype.toString.call(t[n]).match(/\[object (\w+)\]/)[1];"String"!==r&&"Number"!==r||e.push(encodeURIComponent(n)+"="+encodeURIComponent(t[n]))}return e.join("&")}function u(t){return"true"===t||1===t||1===parseInt(t,10)}function s(t){var e;return[].concat(r(new Set((e=[]).concat.apply(e,r(t)))))}e.b=o,e.d=i,e.a=a,e.f=c,e.c=u,e.e=s},143:function(t,e){t.exports=function(t){var e="undefined"!==typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!==typeof t)return t;var n=e.protocol+"//"+e.host,r=n+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,e){var o=e.trim().replace(/^"(.*)"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e});if(/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/)/i.test(o))return t;var i;return i=0===o.indexOf("//")?o:0===o.indexOf("/")?n+o:r+o.replace(/^\.\//,""),"url("+JSON.stringify(i)+")"})}},2:function(t,e,n){"use strict";function r(t){return T.runtime.onMessage.addListener(t)}function o(t){return T.runtime.onMessage.removeListener(t)}function i(t){return T.runtime.onUpdateAvailable.addListener(t)}function a(){return T.runtime.reload()}function c(t){return T.runtime.setUninstallURL(t)}function u(t){return T.tabs.onActivated.addListener(t)}function s(t){return T.tabs.onUpdated.addListener(t)}function f(t){return T.tabs.onRemoved.addListener(t)}function l(t){return T.tabs.onReplaced.addListener(t)}function d(t){return T.windows.onFocusChanged.addListener(t)}function p(){var t=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments[1]),e=arguments[2],n=Object(M.d)(e)?e:function(){};return T.runtime.sendMessage(t,n)}function v(t,e,n){var r=Object(M.d)(n)?n:function(){};return T.tabs.sendMessage(t,e,r)}function b(){return T.browserAction}function h(){return T.contextMenus}function m(){return T.cookies}function g(t){return T.runtime.getURL(t)}function y(t){T.tabs.query({active:!0,currentWindow:!0},function(e){T.tabs.update(e[0].id,{url:t})})}function w(t,e){var n=!0!==e;return T.tabs.create({url:t,active:n})}function x(){return T.runtime.openOptionsPage()}function j(t,e){var n="images/"+e+"-19.png",r="images/"+e+"-38.png";T.browserAction.setIcon({tabId:t,path:{19:n,38:r}})}function L(t,e){e?j(t,"browser-action-icon-added"):j(t,"browser-action-icon")}function I(t,e,n){var r=Object(M.d)(n)?n:function(){};return T.tabs.executeScript(t,e,r)}function A(){return new Promise(function(t){return T.management.getSelf(t)})}function O(t){var e=Object(M.d)(t)?t:function(){};return T.tabs.query({windowId:T.windows.WINDOW_ID_CURRENT,active:!0},function(t){e(t)})}function k(t,e){var n=Object(M.d)(e)?e:function(){};return T.tabs.query(t,n)}function S(t){return T.tabs.remove(t)}function U(t){return localStorage.getItem(t)}function R(t){Object.keys(t).forEach(function(e){localStorage.setItem(e,t[e])})}function C(t){t.forEach(function(t){localStorage.removeItem(t)})}e.a=r,e.v=o,e.p=i,e.u=a,e.A=c,e.l=u,e.o=s,e.m=f,e.n=l,e.k=d,e.x=p,e.y=v,e.b=b,e.d=h,e.e=m,e.j=g,e.s=y,e.r=w,e.q=x,e.B=L,e.f=I,e.h=A,e.g=O,e.t=k,e.c=S,e.i=U,e.z=R,e.w=C;var M=n(11),T=window.chrome},22:function(t,e){function n(t,e){var n=t[1]||"",o=t[3];if(!o)return n;if(e&&"function"===typeof btoa){var i=r(o);return[n].concat(o.sources.map(function(t){return"/*# sourceURL="+o.sourceRoot+t+" */"})).concat([i]).join("\n")}return[n].join("\n")}function r(t){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t))))+" */"}t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var r=n(e,t);return e[2]?"@media "+e[2]+"{"+r+"}":r}).join("")},e.i=function(t,n){"string"===typeof t&&(t=[[null,t,""]]);for(var r={},o=0;o<this.length;o++){var i=this[o][0];"number"===typeof i&&(r[i]=!0)}for(o=0;o<t.length;o++){var a=t[o];"number"===typeof a[0]&&r[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),e.push(a))}},e}},23:function(t,e,n){function r(t,e){for(var n=0;n<t.length;n++){var r=t[n],o=v[r.id];if(o){o.refs++;for(var i=0;i<o.parts.length;i++)o.parts[i](r.parts[i]);for(;i<r.parts.length;i++)o.parts.push(f(r.parts[i],e))}else{for(var a=[],i=0;i<r.parts.length;i++)a.push(f(r.parts[i],e));v[r.id]={id:r.id,refs:1,parts:a}}}}function o(t,e){for(var n=[],r={},o=0;o<t.length;o++){var i=t[o],a=e.base?i[0]+e.base:i[0],c=i[1],u=i[2],s=i[3],f={css:c,media:u,sourceMap:s};r[a]?r[a].parts.push(f):n.push(r[a]={id:a,parts:[f]})}return n}function i(t,e){var n=h(t.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=y[y.length-1];if("top"===t.insertAt)r?r.nextSibling?n.insertBefore(e,r.nextSibling):n.appendChild(e):n.insertBefore(e,n.firstChild),y.push(e);else if("bottom"===t.insertAt)n.appendChild(e);else{if("object"!==typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=h(t.insertInto+" "+t.insertAt.before);n.insertBefore(e,o)}}function a(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=y.indexOf(t);e>=0&&y.splice(e,1)}function c(t){var e=document.createElement("style");return t.attrs.type="text/css",s(e,t.attrs),i(t,e),e}function u(t){var e=document.createElement("link");return t.attrs.type="text/css",t.attrs.rel="stylesheet",s(e,t.attrs),i(t,e),e}function s(t,e){Object.keys(e).forEach(function(n){t.setAttribute(n,e[n])})}function f(t,e){var n,r,o,i;if(e.transform&&t.css){if(!(i=e.transform(t.css)))return function(){};t.css=i}if(e.singleton){var s=g++;n=m||(m=c(e)),r=l.bind(null,n,s,!1),o=l.bind(null,n,s,!0)}else t.sourceMap&&"function"===typeof URL&&"function"===typeof URL.createObjectURL&&"function"===typeof URL.revokeObjectURL&&"function"===typeof Blob&&"function"===typeof btoa?(n=u(e),r=p.bind(null,n,e),o=function(){a(n),n.href&&URL.revokeObjectURL(n.href)}):(n=c(e),r=d.bind(null,n),o=function(){a(n)});return r(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;r(t=e)}else o()}}function l(t,e,n,r){var o=n?"":r.css;if(t.styleSheet)t.styleSheet.cssText=x(e,o);else{var i=document.createTextNode(o),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(i,a[e]):t.appendChild(i)}}function d(t,e){var n=e.css,r=e.media;if(r&&t.setAttribute("media",r),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}function p(t,e,n){var r=n.css,o=n.sourceMap,i=void 0===e.convertToAbsoluteUrls&&o;(e.convertToAbsoluteUrls||i)&&(r=w(r)),o&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var a=new Blob([r],{type:"text/css"}),c=t.href;t.href=URL.createObjectURL(a),c&&URL.revokeObjectURL(c)}var v={},b=function(t){var e;return function(){return"undefined"===typeof e&&(e=t.apply(this,arguments)),e}}(function(){return window&&document&&document.all&&!window.atob}),h=function(t){var e={};return function(n){if("undefined"===typeof e[n]){var r=t.call(this,n);if(r instanceof window.HTMLIFrameElement)try{r=r.contentDocument.head}catch(t){r=null}e[n]=r}return e[n]}}(function(t){return document.querySelector(t)}),m=null,g=0,y=[],w=n(143);t.exports=function(t,e){if("undefined"!==typeof DEBUG&&DEBUG&&"object"!==typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");e=e||{},e.attrs="object"===typeof e.attrs?e.attrs:{},e.singleton||"boolean"===typeof e.singleton||(e.singleton=b()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var n=o(t,e);return r(n,e),function(t){for(var i=[],a=0;a<n.length;a++){var c=n[a],u=v[c.id];u.refs--,i.push(u)}if(t){r(o(t,e),e)}for(var a=0;a<i.length;a++){var u=i[a];if(0===u.refs){for(var s=0;s<u.parts.length;s++)u.parts[s]();delete v[u.id]}}}};var x=function(){var t=[];return function(e,n){return t[e]=n,t.filter(Boolean).join("\n")}}()},463:function(t,e,n){t.exports=n(464)},464:function(t,e,n){"use strict";function r(t){var e=!0,n=!1,r=void 0;try{for(var o,i=t[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var a=o.value;"childList"!==a.type||"page-container"!==a.target.id&&"stream-items-id"!==a.target.id&&"permalink-overlay-body"!==a.target.id||c()}}catch(t){n=!0,r=t}finally{try{!e&&i.return&&i.return()}finally{if(n)throw r}}}function o(t){if(t)return i();a()}function i(){h.observe(document,b),c()}function a(){h.disconnect(),document.querySelectorAll("div.ProfileTweet-action--stp").forEach(function(t){return t.parentNode.removeChild(t)})}function c(){var t=document.querySelectorAll(".tweet:not(.PocketAdded)");t.length&&Array.from(t,u)}function u(t){var e=t.getAttribute("data-permalink-path"),n=t.getAttribute("data-item-id"),r=g.cloneNode(!0);r.id="pocketButton-"+n,r.addEventListener("click",s.bind(this,n,e)),r.setAttribute("data-permalink-path",e),r.setAttribute("data-item-id",n);var o=t.querySelector(".ProfileTweet-actionList");o&&(o.appendChild(r),t.classList.add("PocketAdded"))}function s(t,e){Object(v.x)(null,{action:"twitterSave",permaLink:e,elementId:t},f)}function f(t){var e=t.saveObject.elementId;document.getElementById("pocketButton-"+e).classList.add(p.a.saved)}function l(t,e,n){"twitterStop"===t.type&&a(),"twitterStart"===t.type&&i()}Object.defineProperty(e,"__esModule",{value:!0});var d=n(465),p=n.n(d),v=n(2),b={childList:!0,attributes:!1,characterData:!1,subtree:!0},h=new MutationObserver(r),m='\n<button class="ProfileTweet-actionButton u-textUserColorHover js-actionButton"\n    type="button" data-nav="share_tweet_to_pocket">\n    <div class="IconContainer js-tooltip" data-original-title="Save To Pocket">\n        <span class="Icon Icon--medium Icon--saveToPocket">\n            <svg class='+p.a.pocketIcon+'\n            xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1836 1836">\n              <path d="M217.7,148.1A153.7,153.7,0,0,0,74.7,248.2,146.5,146.5,0,0,0,64,303.6V811L71.1,911a800.4,800.4,0,0,0,330.5,568.2l10.7,7.1H416a812.9,812.9,0,0,0,334.1,144.7,873.7,873.7,0,0,0,169.7,17.9,757.5,757.5,0,0,0,157.2-14.3l19.7-3.6a7.1,7.1,0,0,0,7.1-3.6,882.6,882.6,0,0,0,318-141.1h3.6l10.7-7.1a825.4,825.4,0,0,0,335.9-571.7l7.1-100.1V300a246.6,246.6,0,0,0-7.1-51.8,159,159,0,0,0-146.5-100.1h0M1400.4,778.8l-402,377a119.7,119.7,0,0,1-164.4,0l-398.4-377a116.1,116.1,0,0,1-3.6-162.6,119.7,119.7,0,0,1,164.4-3.6L916.2,916.4l319.8-303.7a119.7,119.7,0,0,1,164.4,3.6,112.6,112.6,0,0,1,5.4,159Z"/>\n            </svg>\n        </span>\n        <span class="u-hiddenVisually">Save To Pocket</span>\n    </div>\n</button>\n',g=document.createElement("div");g.classList.add("ProfileTweet-action","ProfileTweet-action--stp"),g.innerHTML=m,Object(v.a)(l),Object(v.x)(null,{action:"twitterCheck"},o)},465:function(t,e,n){var r=n(466);"string"===typeof r&&(r=[[t.i,r,""]]);var o={hmr:!0};o.transform=void 0;n(23)(r,o);r.locals&&(t.exports=r.locals)},466:function(t,e,n){e=t.exports=n(22)(!1),e.push([t.i,".pocketIcon_2xxa4gxF {\n  display: inline-block;\n  fill: currentColor;\n  height: 16px;\n  vertical-align: bottom;\n  width: 16px; }\n  .pocketIcon_2xxa4gxF:hover,\n  .saved_2GV_pFbZ .pocketIcon_2xxa4gxF {\n    fill: #ef4056; }\n",""]),e.locals={pocketIcon:"pocketIcon_2xxa4gxF",saved:"saved_2GV_pFbZ"}}});