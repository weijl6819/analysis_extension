let TRstaticjsmsg_type=function(e){return"object"==typeof e&&(e.exports={CODE_STANDARDS:"code_standards",FCP_HELPER_INIT:"fcp_helper_init",FCP_HELPER_DETECT:"fcp_helper_detect",GET_CSS:"get-css",GET_JS:"get-js",GET_HTML:"get-html",GET_COOKIE:"get-cookie",REMOVE_COOKIE:"remove-cookie",SET_COOKIE:"set-cookie",CSS_READY:"css-ready",JS_READY:"js-ready",HTML_READY:"html-ready",ALL_READY:"all-ready",GET_OPTIONS:"get_options",SET_OPTIONS:"set_options",MENU_SAVED:"menu_saved",START_OPTION:"start-option",OPT_START_FCP:"opt-item-fcp",CALC_PAGE_LOAD_TIME:"calc-page-load-time",GET_PAGE_WPO_INFO:"get_page_wpo_info",SHOW_PAGE_LOAD_TIME:"show-page-load-time",TAB_CREATED_OR_UPDATED:"tab_created_or_updated",REGEXP_TOOL:"regexp",EN_DECODE:"en-decode",JSON_FORMAT:"json-format",QR_CODE:"qr-code",CODE_BEAUTIFY:"code-beautify",JS_CSS_PAGE_BEAUTIFY:"JS_CSS_PAGE_BEAUTIFY",JS_CSS_PAGE_BEAUTIFY_REQUEST:"JS_CSS_PAGE_BEAUTIFY_REQUEST",CODE_COMPRESS:"code-compress",TIME_STAMP:"timestamp",IMAGE_BASE64:"image-base64",RANDOM_PASSWORD:"password",QR_DECODE:"qr-decode",JSON_COMPARE:"json-diff",JSON_PAGE_FORMAT:"JSON_PAGE_FORMAT",JSON_PAGE_FORMAT_REQUEST:"JSON_PAGE_FORMAT_REQUEST",COLOR_PICKER:"color-picker:newImage",SHOW_COLOR_PICKER:"show_color_picker",AJAX_DEBUGGER:"ajax-debugger",AJAX_DEBUGGER_CONSOLE:"ajax-debugger-console",AJAX_DEBUGGER_SWITCH:"ajax-debugger-switch",HTML_TO_MARKDOWN:"html2markdown",PAGE_CAPTURE:"page-capture",PAGE_CAPTURE_SCROLL:"page_capture_scroll",PAGE_CAPTURE_CAPTURE:"page_capture_capture",STICKY_NOTES:"sticky-notes",DEV_TOOLS:"dev-tools",OPEN_OPTIONS_PAGE:"open-options-page"}),e.exports}({exports:{}});new Vue({el:"#pageContainer",data:{sizeOri:"暂无数据",sizeBase:"暂无数据",previewSrc:"",resultContent:"",toolName:{image:"图片转Base64",base64:"Base64转图片"},curType:"image",nextType:"base64",txtBase64Input:""},mounted:function(){let e=TRstaticjsmsg_type;chrome.runtime.onMessage.addListener((t,a,i)=>{t.type===e.TAB_CREATED_OR_UPDATED&&t.event===e.IMAGE_BASE64&&t.content&&("image"!==this.curType&&this.trans(),this.convertOnline(t.content,e=>{e||chrome.extension.getBackgroundPage().BgPageInstance.notify({message:"抱歉，"+t.content+" 对应的图片未转码成功！"})}))}),document.addEventListener("paste",e=>{"image"===this.curType&&this.paste(e)},!1),document.addEventListener("drop",e=>{if(e.preventDefault(),e.stopPropagation(),"image"!==this.curType)return;let t=e.dataTransfer.files;t.length&&(/image\//.test(t[0].type)?this._getDataUri(t[0]):alert("请选择图片文件！"))},!1),document.addEventListener("dragover",e=>{"image"===this.curType&&(e.preventDefault(),e.stopPropagation())},!1)},methods:{_sizeFormat:function(e){return isNaN(e)?"暂无数据":(e=+e)<1024?e+" B":e<1048576?(e/1024).toFixed(2)+" KB":(e/1024/1024).toFixed(2)+" MB"},_getDataUri:function(e){let t=new FileReader;t.onload=(t=>{this.resultContent=t.target.result,this.previewSrc=t.target.result,this.$refs.panelBox.style.backgroundImage="none",this.sizeOri=this._sizeFormat(e.size),this.sizeBase=this._sizeFormat(t.target.result.length)}),t.readAsDataURL(e)},convertOnline:function(e,t){let a=this;a.previewSrc=e;let i=new Image;i.src=e,i.onload=function(){let e=this.naturalWidth,s=this.naturalHeight;!function(i,n,r,o,_){let E=document.createElement("canvas");E.setAttribute("id","qr-canvas"),E.height=_+100,E.width=o+100;let c=E.getContext("2d");c.fillStyle="rgb(255,255,255)",c.fillRect(0,0,E.width,E.height),c.drawImage(i,r,n,o,_,50,50,o,_),a.resultContent=E.toDataURL(),a.$refs.panelBox.style.backgroundImage="none",a.sizeOri=e+"x"+s,a.sizeBase=a._sizeFormat(a.resultContent.length),t&&t(!0)}(i,0,0,e,s)},i.onerror=function(){t&&t(!1)}},convert:function(){this.$refs.fileBox.files.length&&(this._getDataUri(this.$refs.fileBox.files[0]),this.$refs.fileBox.value="")},select:function(){this.$refs.resultBox.select()},upload:function(e){e.preventDefault(),this.$refs.fileBox.click()},paste:function(e){let t=e.clipboardData.items||{};for(let e in t){let a=t[e];if(/image\//.test(a.type)){let e=a.getAsFile();return this._getDataUri(e)}}try{(async()=>{for(let e in t){let a=t[e];if(/text\/plain/.test(a.type)){let e=await new Promise(e=>{a.getAsString(t=>e(t))});if(await new Promise(t=>{this.convertOnline(e,e=>t(e))}))break}}})()}catch(e){for(let e in t){let a=t[e];if(/text\/plain/.test(a.type))return a.getAsString(e=>{this.convertOnline(e)})}}},trans:function(){this.curType={image:"base64",base64:"image"}[this.curType],this.nextType={image:"base64",base64:"image"}[this.nextType]},loadError:function(e){"base64"===this.curType&&this.txtBase64Input.trim().length&&alert("无法识别的Base64编码，请确认是正确的图片Data URI？")}}});