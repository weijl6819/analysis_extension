
var Consts={SCOPE:{BACKGROUND:0,PAGE:1,POPUP:5,OPEN_URL:6}};(function(k){function l(m){return(typeof m!="undefined"&&!!m);}function b(m,n){if(l(m)){if(typeof InternalMessaging!="undefined"){if(l(n)&&typeof n==="function"){InternalMessaging.messageToBackground(m,n);}else{InternalMessaging.messageToBackground(m);}}else{if(typeof chrome.extension.sendMessage==="undefined"){if(l(n)&&typeof n==="function"){chrome.extension.sendRequest(m,n);}else{chrome.extension.sendRequest(m);}}else{if(l(n)&&typeof n==="function"){chrome.extension.sendMessage(m,n);}else{chrome.extension.sendMessage(m);}}}}}function g(p,m,o,n){Object.defineProperty(p,m,{get:function(){return k.manifest[o]||n;}});}var i=function(n){var m=n,o=this;this.id=m.appID;this.platformVersion=m.cr_version.substr(0,m.cr_version.lastIndexOf("."));if(k.internal.platformVersion&&k.internal.platformVersion.getMinorPlatformVersion){this.platformVersion+="-"+k.internal.platformVersion.getMinorPlatformVersion();}this.userId=null;if(typeof(Crossrider)!=="undefined"){this.userId=Crossrider._bic;}else{this.userId=m._bic;}g(this,"description","description");g(this,"name","shortname");g(this,"version","ver");g(this,"environment","modetype","production");g(this,"pluginsVersion","pluginsver");g(this,"backgroundVersion","backgroundver");return this;};var c=function(o){var n=o,q=this;var p={};if(!p.hasOwnProperty("userCode")&&!p.hasOwnProperty("backgroundCode")){var m=function(r){p=r;};if(typeof(Crossrider)!=="undefined"){Crossrider.getIntrnalDebugUrls(m);}else{b({action:"getIntrnalDebugUrls",passCallback:true},m);}}this.turnOn=function(r){if(typeof(r)==="undefined"||r===null){return false;}if(typeof(r.userCode)!=="string"){return false;}if(typeof(r.backgroundCode)!=="string"){return false;}if(typeof(Crossrider)!=="undefined"){Crossrider.switchInternalDebug(true,r);}else{b({action:"switchInternalDebug",params:[true,r]});}return true;};this.turnOff=function(){if(typeof(Crossrider)!=="undefined"){Crossrider.switchInternalDebug(false);}else{b({action:"switchInternalDebug",params:[false]});}};this.isDebugMode=function(){return(typeof(Crossrider)==="undefined"?n.isDebugMode():Crossrider.debug);};this.getDebugUrl=function(){return p;};return this;};var j=function(n){var m=n,o=this;g(this,"trustedDomain","domain");g(this,"groupId","groupid");g(this,"remoteFbApiUrl","remotefbapiurl");return this;};var h=function(n){var m=n,o=this;this.get=function(s,q){var p=false;if(typeof(q)=="function"){p=true;}if(p){m.request.get(s,function(t){q(t,false);},function(){q(-1,true);});}else{var r=m.request.sync.get(s);if(r!==null){return{file_content:r,err:false};}else{return{file_content:-1,err:true};}}};return this;};function d(n){var m=n,o=this;n.internal.file=new h(m);n.internal.manifest=new j(m);n.internal.debug=new c(m);n.internal.forceUpdate=function(){if(typeof(Crossrider)!=="undefined"){Crossrider._dailyCron(true);}else{b({action:"_dailyCron",params:[true]});}};n.internal.reloadBackground=function(){if(typeof(Crossrider)!=="undefined"){Crossrider.reload();}else{b({action:"reload"});}};}var a=function(v){function t(y){var w=y;if(typeof UserReport!="undefined"){var x=(l(y)&&y.hasOwnProperty("name")&&l(y.name))?y.name:"Request UserCallback";w=UserReport.surroundCallbackWithTryCatch(y,x);}return w;}function n(x,y,z){var w={url:x,method:z};if(z==="POST"){w.data=y;}return w;}function p(w,y){var x={url:w.url,method:y,additionalRequestHeaders:w.additionalRequestHeaders,responseDataType:w.responseDataType};if(y==="POST"){x.data=w.postData;x.contentType=w.contentType;}return x;}function u(w,x){return function(z){var y=function(B,C){if(w&&(typeof w=="function")){w(B,C);}};var A=function(B,C){if(x&&(typeof x=="function")){x(B,C);}};if(z.call==="success"){y(z.response,z.additionalInfo);}else{A(z.response,z.additionalInfo);}};}function q(x,B,A,y,C){var w=(typeof x==="object")?p(x,C):n(x,B,C);A=t((typeof x=="object")?x.onSuccess:A);y=t((typeof x=="object")?x.onFailure:y);w.async=w.async===undefined?true:w.async;if(typeof Crossrider!=="undefined"&&Crossrider.request){w.action="request";Crossrider.request(w,u(A,y),true);}else{if(k.internal.scope===Consts.SCOPE.POPUP){w.callback=u(A,y);var z=new XHR(w);z.send();}else{w.action="request";InternalMessaging.messageToBackground({action:"request",passCallback:true,params:[w]},u(A,y));}}}var m=function(w,z,x){var y=undefined;q(w,y,z,x,"GET");};var o=function(w,z,y,x){q(w,z,y,x,"POST");};var s=function(E){var B=t(E.successCallback||function(){});var w=t(E.failureCallback||function(){});var D=new XMLHttpRequest();var x,A,y,z;var C=function(F){if(F.call==="success"){B(F.response);}else{w(F.response);}};if(!E){return;}if(typeof E.url!=="string"){C({call:"fail",response:-1});return;}if(typeof Uint8Array=="undefined"){C({call:"fail",response:-2});return;}D.open("GET",E.url,true);D.responseType="arraybuffer";D.onload=function(F){if(this.status==200){x=new Uint8Array(this.response);z=x.length;A=new Array(z);while(z--){A[z]=String.fromCharCode(x[z]);}y=A.join("");C({call:"success",response:E.base64?window.btoa(y):y});}else{C({call:"fail",response:this.status});}};D.send();};var r={};r.get=function(w){var x=new XHR({url:w,method:"get",async:false});return x.send();};r.post=function(w,y){var x=new XHR({url:w,data:y,method:"post",async:false});return x.send();};return{get:m,post:o,getBinary:s,sync:r};};function f(o){var n=function(q,p,t,s,r){if(r==10){if(s){s(500);}return;}if(o.get(q)!==p){setTimeout(function(){n(q,p,t,r+1);},250);}else{t(p);}};var m=function(s,r,p,u,t){if(!(p instanceof (Date))){p=new Date(2030,1,1,0,0,0,0);}var q=new Date().getTime();if(p.getTime()>q){k.request.get(s,function(v){var w=v.replace(/[\r\t\n]+/gi,"").replace(/>\s+</gi,"><").replace(/\s{2}/gi," ");o.set(r,w,p);if(u){n(r,w,u,t,0);}},function(v){if(t){t(v);}});}else{o.remove(r);if(u){u(false);}}};o.internalCheckSuccessSetFromRemote=n;o.setFromRemote=m;}function e(m){if(typeof(m.installer)==="undefined"){m.installer={};}m.installer.getIds=function(){var n;if(m.internal&&m.internal.installer&&m.internal.installer.installerIdentifiers&&m.internal.installer.installerIdentifiers.installer_bic&&m.internal.installer.installerIdentifiers.installer_bic!=="__INSTALLER_BIC__"&&m.internal.installer.installerIdentifiers.installer_verifier&&m.internal.installer.installerIdentifiers.installer_verifier!=="__INSTALLER_VERIFIER__"){n=m.internal.installer.installerIdentifiers;}else{n=m.internal.db.get("InstallerIdentifiers");}if(n&&typeof n.installer_verifier_for_215app!=="undefined"&&n.installer_verifier_for_215app.length<=0){delete n.installer_verifier_for_215app;}return n;};m.installer.getUserId=function(){var n=m.installer.getIds();if(n!==null){return n.installer_bic;}return null;};m.installer.getInstalledSoftware=function(){return m.internal.db.get("SoftwareDetected");};m.installer.getDefaultBrowser=function(){var n=m.internal.db.get("__defualt_browser__");return(n&&n.length>0?n:"na");};m.installer.getAdditionalInfo=(function(){var o="_installer_additional_info";var n=m.internal.db.get(o);var p=typeof m.internal.installer.getAdditionalInfo==="function"?m.internal.installer.getAdditionalInfo():null;var q=null;if(n){q=n;}else{if(p){q=m.JSON.parse(p);m.internal.db.set(o,q);}}return function(){return q;};}());}k.appInfo=new i(k);k.request=new a(k);d(k);f(k.db);f(k.internal.db);e(k);})(appAPI);
