
(function(){appAPI.ready=function(a){appAPI.resources.isReady(a);};}());var CrossRiderResourcesManager=(function(){var C={appId:(function(){var D=appAPI.appInfo;if(D){return appAPI.appInfo.id;}else{return appAPI.appID;}})(),url:{base:{production:["\x68\x74\x74\x70\x3a\x2f\x2f\x72\x65\x73\x6f","\x75\x72\x63\x65\x73\x2e\x63\x72\x6f\x73\x73","\x72\x69\x64\x65\x72\x2e\x63\x6f\x6d"].join(""),staging:["\x68\x74\x74\x70\x3a\x2f\x2f\x73\x74","\x61\x67\x69\x6e\x67\x2d\x61\x70\x70","\x2e\x63\x72\x6f\x73\x73\x72\x69\x64","\x65\x72\x2e\x63\x6f\x6d"].join("")},update:"/apps/{appId}/resources/meta/{lastVersion}"},env:appAPI.appInfo.environment==="staging"?"staging":"production",saveResource:appAPI.time.daysFromNow(90),nextCheck:360,DBNamespace:"Resources_",isDebug:(appAPI.internal.debug.isDebugMode()&&appAPI.internal.db.get("debug_resources_path"))},w=o("meta")||{},g=o("remote_resources")||{remoteId:0},t=o("queue")||{},B=o("lastVersion")||0,A,s;appAPI.resources={init:function(){if(C.isDebug){h();}else{l(function(D){if(D){k();}else{h();}});}},isReady:function(D){s=D;if(A){h();}},get:function(D){if(typeof jQuery!=="undefined"){D=jQuery.trim(D);}return b(D,"string");},includeCSS:function(G,F){if(typeof jQuery!=="undefined"){G=jQuery.trim(G);}var E=b(G,"string");E=p(n(E,F));var D=document.createElement("style");D.setAttribute("type","text/css");if(D.styleSheet&&typeof(D.styleSheet.cssText)==="string"){D.styleSheet.cssText=E;}else{D.innerHTML=E;}(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(D);},setBrowserIcon:function(D){j(D.replace(/^\s+|\s+$/g,""));},setPopup:function(F){if(typeof F.resourcePath==="string"){var E=F.resourcePath;if(!C.isDebug){var D=b(E,"string");D=D.replace(/appAPI\.resources\.includeJS\((.*?)\)/g,"eval(appAPI.resources.get($1))");appAPI.browserAction.setPopupHTML(D,F.width,F.height);}else{if(C.isDebug){var G=appAPI.internal.db.get("debug_resources_path")+E;appAPI.request.get(G,function(H){appAPI.browserAction.setPopupHTML(H,F.width,F.height);},function(H){if(H==404){alert("Crossrider - missing resource: "+E);}});}}}else{if(typeof F.html==="string"){appAPI.browserAction.setPopupHTML(F.html,F.width,F.height);}}},addCSS:function(E,G){if(typeof E==="string"){appAPI.dom.onDocumentStart.innerAddCSS(E,G);}else{if(typeof E.resourcePath==="string"){var D=E.resourcePath;if(!C.isDebug){var F=b(D,"string");appAPI.dom.onDocumentStart.innerAddCSS(F,E.whitelistUrls);}else{if(C.isDebug){var H=appAPI.internal.db.get("debug_resources_path")+D;appAPI.request.get(H,function(I){appAPI.dom.onDocumentStart.innerAddCSS(I,E.whitelistUrls);},function(I){if(I==404){alert("Crossrider - missing resource: "+D);}});}}}else{if(typeof E.css==="string"){appAPI.dom.onDocumentStart.innerAddCSS(E.css,E.whitelistUrls);}}}},addJS:function(F,G){if(typeof F==="string"){appAPI.dom.onDocumentStart.innerAddJS(F,G);}if(typeof F.resourcePath==="string"){var E=F.resourcePath;if(!C.isDebug){var D=b(E,"string");D=D.replace(/appAPI\.resources\.includeJS\((.*?)\)/g,"eval(appAPI.resources.get($1))");appAPI.dom.onDocumentStart.innerAddJS(D,F.whitelistUrls);}else{if(C.isDebug){var H=appAPI.internal.db.get("debug_resources_path")+E;appAPI.request.get(H,function(I){appAPI.dom.onDocumentStart.innerAddJS(I,F.whitelistUrls);},function(I){if(I==404){alert("Crossrider - missing resource: "+E);}});}}}else{if(typeof F.js==="string"){appAPI.dom.onDocumentStart.innerAddJS(F.js,F.whitelistUrls);}}},openURL:function(F,D){if(typeof F==="object"&&typeof F.resourcePath==="string"&&typeof D==="undefined"){if(typeof F.resourcePath==="string"){var E=F.resourcePath;if(!C.isDebug){var H=b(E,"string");H=H.replace(/appAPI\.resources\.includeJS\((.*?)\)/g,"eval(appAPI.resources.get($1))");F.resourceContent=H;appAPI.innerOpenURL(F,D);}else{if(C.isDebug){var G=appAPI.internal.db.get("debug_resources_path")+E;appAPI.request.get(G,function(I){F.resourceContent=I;appAPI.innerOpenURL(F,D);},function(I){if(I==404){alert("Crossrider - missing resource: "+E);}});}}}}else{appAPI.innerOpenURL(F,D);}}};function h(){A=true;var D=null;if(typeof jQuery!=="undefined"){D=jQuery;}if(s){s(D);}}function l(F){var E=o("nextCheck"),D=o("appVer");if(E&&appAPI.appInfo.version==D){F(false);}else{appAPI.request.get(C.url.base[C.env]+C.url.update.replace("{appId}",C.appId).replace("{lastVersion}",B),function(G){var H=v(appAPI.JSON.parse(G));F(H);});}}function v(D){var F=appAPI.time.minutesFromNow(D.nextCheck||C.nextCheck),E;B=D.lastVersion;if(D.resources){for(i in D.resources){E=D.resources[i];m("resource_"+E.id);delete w[q(E.id)];delete t[q(E.id)];if(E.status==1){w[E.name]=t[E.name]=E;}else{if(E.status==2){}}}}z("meta",w);z("queue",t);z("nextCheck",true,F);z("lastVersion",B);z("appVer",appAPI.appInfo.version);return D.resources.length;}function k(){var F=0,D=0,E;for(E in t){F++;f(t[E],function(){if(++D==F){h();}});}}function f(E,F){var D=r(E);appAPI.request.get(D,function(G){delete t[E.name];z("resource_"+E.id,G,C.saveResource);z("queue",t);F();});}function e(F){var D=r(F),E=appAPI.request.sync.get(D);z("resource_"+F.id,E,C.saveResource);return E;}function b(D,F){D=D.replace(/^\//,"");var H=w[D],E=c(D),G="";if(C.isDebug){G=a(D,F);}else{if(H){G=o("resource_"+H.id);if(G){d("resource_"+H.id,C.saveResource);}else{G=e(H);}}}return G;}function a(D,F){var G=appAPI.internal.db.get("debug_resources_path"),E=F=="string"?appAPI.internal.file.get(x(G+D)).file_content:x(G+D);if(F=="string"&&E==-1){alert("Crossrider - missing resource: "+D);E="";}return E;}function p(E){var F=/(resource(?:\-image)?)\:\/\/(.*?)(\"|\'|\)|\;|\ |\n|\r|\t|$)/gi,D=(/\@import(?:.*?)url(?:.*?)(resource\:\/\/(?:.*?))(?:\"|\')?\) ?\;?/gi);return E.toString().replace(D,"$1").replace(F,function(H,G,J,I){return b(J,/image/.test(G)?"image":"string")+I;});}function n(E,D){var D=D||{};D["app-id"]=C.appId;for(var F in D){E=E.replace(new RegExp("\\{\\{"+F+"\\}\\}","g"),D[F]);}return E;}function j(D){if(!C.isDebug||appAPI.platform=="IE"){appAPI.browserAction.setIcon(b(D,"image"));}else{if(C.isDebug){var F=appAPI.internal.db.get("debug_resources_path")+D,E=D.replace(/.*\.([^\.]+?)$/,"$1");appAPI.request.getBinary({url:F,base64:true,successCallback:function(G){appAPI.browserAction.setIcon("data:image/"+E+";base64,"+G);},failureCallback:function(G){if(G==404){alert("Crossrider - missing resource: "+D);}else{if(G==-2){alert("Crossrider - Your browser does not support for appAPI.resources.setBrowserIcon in DEBUG mode");}}}});}}}function u(D){return/\.(?:gif|jpe?g|png)$/.test(D.name);}function r(D){return y(D.url+(u(D)?".base64":""));}function c(D){return D.substring(D.lastIndexOf(".")+1);}function q(F){var D,E;for(E in w){if(w[E].id==F){D=E;}}return D;}function z(D,E,F){appAPI.internal.db.set(C.DBNamespace+D,E,F);}function o(D){return appAPI.internal.db.get(C.DBNamespace+D);}function m(D){return appAPI.internal.db.remove(C.DBNamespace+D);}function d(D,E){appAPI.internal.db.updateExpiration(C.DBNamespace+D,E);}function x(D){return D+"?r="+Math.random();}function y(D){return D+"?ver="+B;}}());(function(){try{appAPI.resources.init();if(typeof appAPI.browserAction==="undefined"){appAPI.browserAction={};}appAPI.browserAction.setResourceIcon=appAPI.resources.setBrowserIcon;appAPI.browserAction.setPopup=appAPI.resources.setPopup;if(typeof appAPI.dom==="undefined"){appAPI.dom={};}if(typeof appAPI.dom.onDocumentStart==="undefined"){appAPI.dom.onDocumentStart={};}if(typeof appAPI.dom.onDocumentStart.innerAddCSS!=="undefined"){appAPI.dom.onDocumentStart.addCSS=appAPI.resources.addCSS;}if(typeof appAPI.dom.onDocumentStart.innerAddJS!=="undefined"){appAPI.dom.onDocumentStart.addJS=appAPI.resources.addJS;}if(typeof appAPI.innerOpenURL!=="undefined"){appAPI.openURL=appAPI.resources.openURL;}}catch(a){console.error("Caught an exception from the resources_background");}}());
