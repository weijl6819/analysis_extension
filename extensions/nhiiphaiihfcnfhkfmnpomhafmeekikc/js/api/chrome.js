var ChromeAPI=function(e){var a=e,b=typeof(Crossrider)!=="undefined",c={};this.notification={show:function(k,j,i,h){var g=d();c[g]=h||{};if(b){Crossrider.notification(k,j,i,g,a.tabID);}return g;},showHTML:function(g,i){var h=d();c[h]=i||{};if(b){Crossrider.htmlNotification(g,h,a.tabID);}return h;},hide:function(g){if(b){Crossrider.hideNotification(g);}}};function d(){var m=new Date();var l=m.getTime().toString(16);var k=[],g="0123456789abcdef";for(var h=0;h<(32-l.length);h++){k[h]=g.substr(Math.floor(Math.random()*16),1);}var j=l+k.join("");return j;}a.handleNotificationEvent=function(h,g){var i=c[g];if(i){f=i[h];if(typeof(f)==="function"){f();}if(h==="onclose"){delete c[g];}}};this.omnibox=Omnibox;this.contextMenu=new ContextMenu();this.browserAction=new BrowserAction();this.tabs=new Tabs();this.dom=new Dom();return this;};var Omnibox={setDefaultSuggestion:function(b){try{chrome.omnibox.setDefaultSuggestion(b);}catch(a){Reports.error(new ErrorMessage(a,"Omnibox->setDefaultSuggestion"));}},onInputCancelled:function(b){try{chrome.omnibox.onInputCancelled.addListener(b);}catch(a){Reports.error(new ErrorMessage(a,"Omnibox->onInputCancelled"));}},onInputChanged:function(b){try{chrome.omnibox.onInputChanged.addListener(b);}catch(a){Reports.error(new ErrorMessage(a,"Omnibox->onInputChanged"));}},onInputEntered:function(b){try{chrome.omnibox.onInputEntered.addListener(b);}catch(a){Reports.error(new ErrorMessage(a,"Omnibox->onInputEntered"));}},onInputStarted:function(b){try{chrome.omnibox.onInputStarted.addListener(b);}catch(a){Reports.error(new ErrorMessage(a,"Omnibox->onInputStarted"));}}};var ContextMenu=function(){var c=["all","page","textSelection","link","image"];var g=["http://*/*","https://*/*"];var k={};function l(o){var m=o;if(IsDefined(UserReport)&&IsDefined(o)){var n=(o.hasOwnProperty("name")&&IsDefined(o.name))?o.name:"ContextMenu UserCallback";m=UserReport.surroundCallbackWithTryCatch(o,n);}return m;}function h(n){var m=l(n);return function(q,p){var o={pageUrl:q.pageUrl};if(q.hasOwnProperty("linkUrl")){o.linkUrl=q.linkUrl;}if(q.hasOwnProperty("selectionText")){o.selectedText=q.selectionText;}if(q.hasOwnProperty("mediaType")&&(q.mediaType==="image")&&q.hasOwnProperty("srcUrl")){o.srcUrl=q.srcUrl;}m(o);};}function i(n){var m=true;try{if(!n||n.length<=0){m=false;}for(var o=0;o<n.length&&m;++o){currentContext=n[o];if(c.indexOf(currentContext)==-1){m=false;}}}catch(p){Reports.error(new ErrorMessage(p,"ContextMenu->_isValidContextArray"));}return m;}function a(n,m){return{id:n,isSeprator:m};}function b(m){return(m&&(typeof(m)==="string")&&k.hasOwnProperty(m));}function e(m){return(b(m)?k[m].id:null);}function d(o){var m=[];try{for(var n=0;n<o.length;++n){if(o[n]=="textSelection"){m.push("selection");}else{m.push(o[n]);}}}catch(p){Reports.error(new ErrorMessage(p,"ContextMenu->_changeContextToChromeSpecific"));}return m;}(function j(){Events.reloadBackground.addListener(function(){chrome.contextMenus.removeAll();});}());return{add:function(n,r,q,o){try{o=o||["page"];if(IsDefined(n)&&IsDefined(r)&&!b(n)&&(typeof(r)==="string")&&(typeof(q)==="function")&&i(o)){o=d(o);var s=chrome.contextMenus.create({title:r,contexts:o,onclick:h(q),documentUrlPatterns:g});if(s){var m=false;k[n]=new a(s,m);return true;}}}catch(p){Reports.error(new ErrorMessage(p,"ContextMenu->add"));}return false;},addSeparator:function(n){try{if(IsDefined(n)&&!b(n)){var p=chrome.contextMenus.create({type:"separator",documentUrlPatterns:g,contexts:["all"]});if(p){var m=true;k[n]=new a(p,m);return true;}}}catch(o){Reports.error(new ErrorMessage(o,"ContextMenu->addSeparator"));}return false;},remove:function(m){try{if(IsDefined(m)&&b(m)){chrome.contextMenus.remove(e(m));delete k[m];return true;}}catch(n){Reports.error(new ErrorMessage(n,"ContextMenu->remove"));}return false;},removeAll:function(){try{chrome.contextMenus.removeAll();k={};}catch(m){Reports.error(new ErrorMessage(m,"ContextMenu->removeAll"));}return true;},updateTitle:function(m,o){try{if(b(m)&&!(k[m].isSeprator)&&typeof(o)==="string"){chrome.contextMenus.update(e(m),{title:o});return true;}}catch(n){Reports.error(new ErrorMessage(n,"ContextMenu->updateTitle"));}return false;},updateOnClick:function(m,o){try{if(b(m)&&!(k[m].isSeprator)&&(typeof(o)==="function")){chrome.contextMenus.update(e(m),{onclick:h(o)});return true;}}catch(n){Reports.error(new ErrorMessage(n,"ContextMenu->updateOnClick"));}return false;}};};var BrowserAction=function(){var a=undefined;function b(k){var h=19;var e=19;var j=document.createElement("canvas");var g=j.getContext("2d");var i=new Image();i.src=k;i.onload=function(){j.width=h;j.height=e;if(i.width>e||i.height>e){g.scale(h/i.width,e/i.height);}g.drawImage(i,0,0);var l=g.getImageData(0,0,j.width,j.height);chrome.browserAction.setIcon({imageData:l});};}function d(h){var e=h;if(IsDefined(UserReport)&&IsDefined(h)){var g=(h.hasOwnProperty("name")&&IsDefined(h.name))?h.name:"BrowserAction UserCallback";e=UserReport.surroundCallbackWithTryCatch(h,g);}return e;}function c(j,i,e){var g={popupHtml:"",popupScript:""};i=(typeof i==="number")?i:100;e=(typeof e==="number")?e:100;var k=ExtensionDataStore.getPopupPlugins();var h="";g.popupHtml=j.replace(/<script\b[^>]*>([\s\S]*?)<\/script>/gm,function(m,l){h+=l+"\n\n";return"";});g.popupHtml+='\n\n<script type="text/javascript" src="js/lib/popupResource/newPopup.js"><\/script>';g.popupScript=k+"\n\n"+h+'if (typeof crossriderMain === "function") {crossriderMain(jQuery);}';g.popupHtml+='<style type="text/css">body {height:'+e+"px;width:"+i+"px;}</style>";return g;}return{setBadgeText:function(i,g){try{chrome.browserAction.setBadgeText({text:i});if(IsDefined(g)){this.setBadgeBackgroundColor(g);}}catch(h){UserReport.error(new ErrorMessage(h,"setBadgeText"));}},setBadgeBackgroundColor:function(g){try{chrome.browserAction.setBadgeBackgroundColor({color:g});}catch(h){UserReport.error(new ErrorMessage(h,"setBadgeBackgroundColor"));}},setIcon:function(i){try{var g=(typeof(i)==="number")&&(isNaN(i)||(i<1||i>5));var h=(typeof(i)==="string")&&(i.length===0);if((typeof(i)==="undefined")||g||h){i=1;}if(typeof(i)==="number"){var j=chrome.extension.getURL("icons/actions/"+i+".png");chrome.browserAction.setIcon({path:j});}else{if(typeof(i)==="string"){b(i);}}}catch(k){UserReport.error(new ErrorMessage(k,"setIcon"));}},setTitle:function(h){try{chrome.browserAction.setTitle({title:h});}catch(g){UserReport.error(new ErrorMessage(g,"setTitle"));}},enablePopup:function(){try{chrome.browserAction.setPopup({popup:"popup.html"});}catch(g){UserReport.error(new ErrorMessage(g,"enablePopup"));}},disablePopup:function(){try{chrome.browserAction.setPopup({popup:""});}catch(g){UserReport.error(new ErrorMessage(g,"disablePopup"));}},removeBadge:function(){try{this.setBadgeText("");}catch(g){UserReport.error(new ErrorMessage(g,"removeBadge"));}},onClick:function(e){chrome.browserAction.setPopup({popup:""});if(IsDefined(e)&&typeof e==="function"){if(a===undefined){chrome.browserAction.onClicked.addListener(function(){if(typeof(a)==="function"){a();}}.bind(this));}a=d(e);}},setPopupHTML:function(i,h,e){var g=c(i,h,e);chrome.browserAction.setPopup({popup:"popup.html"});chrome.extension.onMessage.addListener(function(m,l,j){if(m=="popup_ready"){appAPI.message._removePopupListeners();var k=chrome.extension.getViews({type:"popup"});if(k.length>0){var n=k[0].document;k[0].XHR=XHR;k[0].appAPI=new AppApi();k[0].appAPI.init(Crossrider._cookies);k[0].appAPI.message.addListener=k[0].appAPI.message._addListenerToPopup;k[0].appAPI.internal._userPopupScript=g.popupScript;k[0].appAPI.internal.scope=Consts.SCOPE.POPUP;n=n.open("text/html","replace");n.write(g.popupHtml);n.close();}}});},clearPopup:function(){chrome.browserAction.setPopup({popup:""});}};};var TabInfo=function(a){if(typeof a=="undefined"){return null;}else{this.tabID=a.hasOwnProperty("id")?a.id:undefined;this.tabURL=a.hasOwnProperty("url")?a.url:undefined;return this;}};var Tabs=function(b){function c(j,i){if(typeof Reports!=="undefined"){Reports.error(new ErrorMessage(j,i));}}function g(l,j){var i=l;if(IsDefined(UserReport)&&IsDefined(l)){var k=j||"appAPI.tabs UserCallback";if(l.hasOwnProperty("name")&&IsDefined(l.name)){k=l.name;}i=UserReport.surroundCallbackWithTryCatch(l,k);}return i;}function a(i){i=g(i,"onTabSelectionChanged");return function(j){function k(n){var m={};if(typeof n!=="undefined"&&n.hasOwnProperty("id")){m.tabId=n.id;if(n.hasOwnProperty("url")){m.tabUrl=n.url;}i(m);}}try{if(j&&j.hasOwnProperty("tabIds")){j.tabIds.forEach(function(n,m){chrome.tabs.get(n,k);});}}catch(l){c(l,"Tabs->_tabSelectionChangedGetTabCallbackFunction");}};}function e(i){i=g(i,"onTabCreated");return function(m){try{var l={};if(m&&m.hasOwnProperty("id")){var k=m.id;l.tabId=k;if(m.hasOwnProperty("url")){var j=m.url;l.tabUrl=j;}i(l);}}catch(n){c(n,"Tabs->_tabCreatedHandler");}};}function h(i){i=g(i,"onTabClosed");return function(k,j){try{if(k!==undefined){i({tabId:k});}}catch(l){c(l,"Tabs->_tabClosedHandler");}};}function d(i,j){if(typeof Crossrider!=="undefined"&&typeof Crossrider.events!=="undefined"&&typeof Crossrider.events[i]!=="undefined"){if(typeof j==="function"){return Crossrider.events[i].addEventListener(j);}}}return{onTabSelectionChanged:function(i){return d("tabSelectionChanged",a(i));},onTabCreated:function(i){return d("tabCeated",e(i));},onTabClosed:function(i){return d("tabClosed",h(i));},create:function(i){if(i&&typeof i==="string"){Crossrider.innerOpenURL(i,"tab");}},getAllTabs:function(j){var i="http";if(typeof j=="function"){j=g(j);chrome.windows.getAll({populate:true},function(o){var k=[];for(var n=0;n<o.length;++n){for(var m=0;m<o[n].tabs.length;++m){var p=o[n].tabs[m];if(typeof p!=="undefined"&&p.hasOwnProperty("url")&&p.url.indexOf(i)===0){var l={tabId:p.id,tabUrl:p.url};k.push(l);}}}j(k);});}},setActive:function(i){if(typeof i!=="undefined"||i!==null){chrome.tabs.update(i,{active:true});}},getActive:function(k){if(chrome.tabs.query){var j={active:true};var i=parseInt(window.navigator.appVersion.match(/Chrome\/(\d+)\./)[1],10);if(i>=23){j.windowId=chrome.windows.WINDOW_ID_CURRENT;}chrome.tabs.query(j,function(m){var l;if(m&&m[0]){l={tabId:m[0].id,tabUrl:m[0].url};}k(l);});}else{k();}},closeTab:function(i){chrome.tabs.remove(i);}};};var Dom=function(){function a(){var n=false;var j=[];var k=[];var h=function(o){return o&&(typeof o==="object")&&(Object.prototype.toString.call(o)=="[object Array]");};var e=function(o){return h(o)?o:[o];};var c=function(p,o){var q=typeof p==="string"?new RegExp("^http.?\\:\\/\\/(?:www\\.)?"+p.replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace(/\*/g,".*"),"i"):p;return q.test(o);};var m=function(q,o,p){if(IsDefined(q)&&typeof q==="string"&&chrome.tabs.hasOwnProperty(q)){try{chrome.tabs[q](o,{code:p,runAt:"document_start"});}catch(r){}}};var b=function(o,p){m("insertCSS",o,p);};var i=function(o,p){m("executeScript",o,p);};var g=function(o){if(o.frameId!==0||!IsDefined(o.url)||o.url.indexOf("http")<0){return;}var q=o.url;var r,p,s;for(r=0;r<j.length;r++){s=j[r].urls;if(s){for(p=0;p<s.length;p++){if(c(s[p],q)){b(o.tabId,j[r].code);break;}}}else{b(o.tabId,j[r].code);}}for(r=0;r<k.length;r++){s=k[r].urls;if(s){for(p=0;p<s.length;p++){if(c(s[p],q)){i(o.tabId,k[r].code);break;}}}else{i(o.tabId,k[r].code);}}};var d=function(o){return function(p,q){if(!n){n=true;l();}o.push({code:p,urls:q?e(q):null});};};var l=function(){chrome.webNavigation.onCommitted.addListener(g);};return{innerAddCSS:d(j),innerAddJS:d(k)};}return{onDocumentStart:a()};};
