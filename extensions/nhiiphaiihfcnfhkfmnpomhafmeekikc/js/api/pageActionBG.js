var pageActionBG=(function(){var f=function(o,n,k){var l={popupHtml:"",popupScript:""};n=(typeof n==="number")?n:100;k=(typeof k==="number")?k:100;var p=ExtensionDataStore.getPopupPlugins();var m="";l.popupHtml=o.replace(/<script\b[^>]*>([\s\S]*?)<\/script>/gm,function(r,q){m+=q+"\n\n";return"";});l.popupHtml+='\n\n<script type="text/javascript" src="js/lib/popupResource/newPopup.js"><\/script>';l.popupScript=p+"\n\n"+m+'if (typeof crossriderMain === "function") {crossriderMain(jQuery);}';l.popupHtml+='<style type="text/css">body {height:'+k+"px;width:"+n+"px;}</style>";return l;};var c=function(q,p){var m=19;var k=19;var o=document.createElement("canvas");var l=o.getContext("2d");var n=new Image();n.src=q;n.onload=function(){o.width=m;o.height=k;if(n.width>k||n.height>k){l.scale(m/n.width,k/n.height);}l.drawImage(n,0,0);var r=l.getImageData(0,0,o.width,o.height);chrome.pageAction.setIcon({tabId:p,imageData:r});chrome.pageAction.show(p);};};var j=function(k){chrome.pageAction.show(k);};var e=function(l){var k=chrome.extension.getViews({type:"popup"});if(k.length>0){k[0].close();}chrome.pageAction.hide(l);};var b=function(l,k){if(typeof(l)==="string"){c(l,k);}};var d=function(l,k){chrome.pageAction.setTitle({title:l.title,tabId:k});};var h=function(k){chrome.pageAction.onClicked.addListener(function(l){if(k===l.id){InternalMessaging.messageToPage(k,{action:"activatePageActionCallback",params:[1]});}});};var a=function(m,l){var k=f(m.html,m.width,m.height);chrome.pageAction.setPopup({popup:"popup.html",tabId:l});chrome.extension.onMessage.addListener(function(p,o,n){if(p=="popup_ready"){chrome.tabs.query({active:true,windowId:chrome.windows.WINDOW_ID_CURRENT},function(q){if((q.length>0)&&(q[0].id===l)){appAPI.message._removePopupListeners();var r=chrome.extension.getViews({type:"popup"});if(r.length>0){var s=r[0].document;r[0].XHR=XHR;r[0].appAPI=new AppApi();r[0].appAPI.init(Crossrider._cookies);r[0].appAPI.message.addListener=r[0].appAPI.message._addListenerToPopup;r[0].appAPI.internal._userPopupScript=k.popupScript;r[0].appAPI.internal.scope=Consts.SCOPE.POPUP;s=s.open("text/html","replace");s.write(k.popupHtml);s.close();}}});}});InternalMessaging.messageToPage(l,{action:"activatePageActionCallback",params:[2]});};var g=function(k){chrome.pageAction.setPopup({popup:"",tabId:k});};var i=function(){var k=chrome.extension.getViews({type:"popup"});if(k.length>0){k[0].close();}};return{show:j,hide:e,setIcon:b,setTitle:d,onClick:h,setPopupHTML:a,clearPopup:g,closePopup:i};})();
