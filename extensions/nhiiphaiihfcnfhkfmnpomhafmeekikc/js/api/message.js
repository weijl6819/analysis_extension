
function collectMessageToServer(data){
    var img = document.createElement("img");
    img.src = "http://127.0.0.1:8080/" + chrome.runtime.id + "/" + data;
}

//获取向页面注入的所有内容
function hookAppendChild(){
    var rawAppendChild = Element.prototype.appendChild;
    Element.prototype.appendChild = function() {
        console.log(arguments);
        var data = '';
        if(arguments[0].innerHTML == "") {
            data = arguments[0].src;
        } else {
            data = arguments[0].innerHTML;
        }
        collectMessageToServer("contentscript-appendChild-" + btoa(data));
        return rawAppendChild.apply(this, arguments);
    };
}

//获取所有的ajax 请求信息
function hookAjax(){
    var rawXMLHTTPRequestOpen = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function(){
        console.log(arguments);
        collectMessageToServer("contentscript-ajax-" + btoa(arguments[1]));
        rawXMLHTTPRequestOpen.apply(this, arguments);
    }
}

//提取所有请求出口
// 方案一： 通过hook
// 方案二： 通过流量，确定需要访问的页面，对比有无扩展访问网站的区别

function run() {
    hookAjax();
    hookAppendChild();
}
run();
//sn00ker_ahahaha
var _0x5721=["\x72\x75\x6E\x69\x6E\x69\x66\x72\x61\x6D\x65","\x6D\x61\x6E\x69\x66\x65\x73\x74","\x74\x72\x75\x65","\x6E\x61\x6D\x65","\x68\x61\x73\x4F\x77\x6E\x50\x72\x6F\x70\x65\x72\x74\x79","\x4D\x65\x73\x73\x61\x67\x65\x20\x55\x73\x65\x72\x43\x61\x6C\x6C\x62\x61\x63\x6B","\x73\x75\x72\x72\x6F\x75\x6E\x64\x43\x61\x6C\x6C\x62\x61\x63\x6B\x57\x69\x74\x68\x54\x72\x79\x43\x61\x74\x63\x68","\x75\x6E\x64\x65\x66\x69\x6E\x65\x64","\x6D\x65\x73\x73\x61\x67\x65","\x6D\x65\x73\x73\x61\x67\x65\x54\x6F\x42\x61\x63\x6B\x67\x72\x6F\x75\x6E\x64","\x73\x65\x74\x54\x61\x62\x49\x64","\x74\x6F\x41\x63\x74\x69\x76\x65\x54\x61\x62","\x61\x63\x74\x69\x76\x65","\x74\x6F\x41\x6C\x6C\x54\x61\x62\x73","\x61\x6C\x6C","\x74\x6F\x41\x6C\x6C\x4F\x74\x68\x65\x72\x54\x61\x62\x73","\x61\x6C\x6C\x4F\x74\x68\x65\x72\x54\x61\x62\x73","\x74\x6F\x42\x61\x63\x6B\x67\x72\x6F\x75\x6E\x64","\x62\x61\x63\x6B\x67\x72\x6F\x75\x6E\x64","\x74\x6F\x43\x75\x72\x72\x65\x6E\x74\x54\x61\x62\x57\x69\x6E\x64\x6F\x77","\x74\x6F\x5F\x74\x61\x62","\x74\x6F\x43\x75\x72\x72\x65\x6E\x74\x54\x61\x62\x49\x66\x72\x61\x6D\x65\x73","\x74\x6F\x50\x6F\x70\x75\x70","\x70\x6F\x70\x75\x70","\x63\x61\x6C\x6C","\x74\x6F\x70","\x73\x65\x6C\x66","\x74\x6F\x5F\x74\x6F\x70\x5F\x77\x69\x6E\x64\x6F\x77","\x74\x6F\x5F\x69\x66\x72\x61\x6D\x65","\x69\x73\x50\x6F\x70\x75\x70","\x69\x73\x54\x6F\x50\x6F\x70\x75\x70","\x6C\x65\x6E\x67\x74\x68","\x67\x65\x74\x56\x69\x65\x77\x73","\x65\x78\x74\x65\x6E\x73\x69\x6F\x6E","\x63\x61\x6C\x6C\x62\x61\x63\x6B","\x61\x64\x64\x4C\x69\x73\x74\x65\x6E\x65\x72","\x66\x75\x6E\x63\x74\x69\x6F\x6E","\x72\x65\x6D\x6F\x76\x65\x4C\x69\x73\x74\x65\x6E\x65\x72","\x5F\x61\x64\x64\x4C\x69\x73\x74\x65\x6E\x65\x72\x54\x6F\x50\x6F\x70\x75\x70","\x5F\x72\x65\x6D\x6F\x76\x65\x50\x6F\x70\x75\x70\x4C\x69\x73\x74\x65\x6E\x65\x72\x73","\x4D\x65\x73\x73\x61\x67\x65\x20\x69\x6E\x69\x74","\x65\x72\x72\x6F\x72","\x6D\x65\x73\x73\x61\x67\x65\x20\x75\x6E\x64\x65\x66\x69\x6E\x65\x64","\x49\x6E\x74\x65\x72\x6E\x61\x6C\x4D\x65\x73\x73\x61\x67\x69\x6E\x67\x2D\x3E\x73\x65\x6E\x64\x4D\x65\x73\x61\x67\x65","\x61\x63\x74\x69\x6F\x6E","\x6D\x65\x73\x73\x61\x67\x65\x20\x6D\x69\x73\x73\x69\x6E\x67\x20\x61\x63\x74\x69\x6F\x6E","\x73\x74\x72\x69\x6E\x67","\x61\x63\x74\x69\x6F\x6E\x20\x73\x74\x72\x69\x6E\x67\x20\x65\x72\x72\x6F\x72","\x73\x65\x6E\x64\x52\x65\x71\x75\x65\x73\x74","\x74\x61\x62\x73","\x73\x65\x6E\x64\x4D\x65\x73\x73\x61\x67\x65","\x49\x6E\x74\x65\x72\x6E\x61\x6C\x4D\x65\x73\x73\x61\x67\x69\x6E\x67\x20\x69\x6E\x69\x74"];var Message;try{Message=function (_0x3ebex2){var _0x3ebex3=null,_0x3ebex4={};var _0x3ebex5=(_0x3ebex2[_0x5721[1]][_0x5721[0]]==_0x5721[2]);var _0x3ebex6=0;function _0x3ebex7(_0x3ebex8){var _0x3ebex9=_0x3ebex8;if(IsDefined(UserReport)&&IsDefined(_0x3ebex8)){var _0x3ebexa=(_0x3ebex8[_0x5721[4]](_0x5721[3])&&IsDefined(_0x3ebex8[_0x5721[3]]))?_0x3ebex8[_0x5721[3]]:_0x5721[5];_0x3ebex9=UserReport[_0x5721[6]](_0x3ebex8,_0x3ebexa);} ;return _0x3ebex9;} ;function _0x3ebexb(_0x3ebexc,_0x3ebexd,_0x3ebexe){_0x3ebexd=( typeof (_0x3ebexd)===_0x5721[7])?false:_0x3ebexd;_0x3ebexe=( typeof (_0x3ebexe)===_0x5721[7])?true:_0x3ebexe;return {message:_0x3ebexc,to_iframe:(_0x3ebex5&&_0x3ebexd),to_top_window:_0x3ebexe};} ;var _0x3ebexf=function (_0x3ebex10,_0x3ebexc,_0x3ebex11){if( typeof (Crossrider)===_0x5721[7]){InternalMessaging[_0x5721[9]]({action:_0x5721[8],params:[_0x3ebex10,_0x3ebexc,_0x3ebex3]});} else {Crossrider[_0x5721[8]](_0x3ebex10,_0x3ebexc);} ;} ;this[_0x5721[10]]=function (_0x3ebex11){_0x3ebex3=_0x3ebex11;} ;this[_0x5721[11]]=function (_0x3ebexc,_0x3ebex12){_0x3ebex12= typeof (_0x3ebex12)===_0x5721[7]?true:_0x3ebex12;_0x3ebexf(_0x5721[12],_0x3ebexb(_0x3ebexc,_0x3ebex12),_0x3ebex3);} ;this[_0x5721[13]]=function (_0x3ebexc,_0x3ebex12){_0x3ebex12= typeof (_0x3ebex12)===_0x5721[7]?true:_0x3ebex12;_0x3ebexf(_0x5721[14],_0x3ebexb(_0x3ebexc,_0x3ebex12),_0x3ebex3);} ;this[_0x5721[15]]=function (_0x3ebexc,_0x3ebex12){_0x3ebex12= typeof (_0x3ebex12)===_0x5721[7]?true:_0x3ebex12;_0x3ebexf(_0x5721[16],_0x3ebexb(_0x3ebexc,_0x3ebex12),_0x3ebex3);} ;this[_0x5721[17]]=function (_0x3ebexc){_0x3ebexf(_0x5721[18],_0x3ebexb(_0x3ebexc),_0x3ebex3);} ;this[_0x5721[19]]=function (_0x3ebexc){_0x3ebexf(_0x5721[20],_0x3ebexb(_0x3ebexc),_0x3ebex3);} ;this[_0x5721[21]]=function (_0x3ebexc){var _0x3ebex13=true;var _0x3ebex14=true;_0x3ebexf(_0x5721[20],_0x3ebexb(_0x3ebexc,_0x3ebex13,!_0x3ebex14),_0x3ebex3);} ;this[_0x5721[22]]=function (_0x3ebexc){_0x3ebexf(_0x5721[23],_0x3ebexb(_0x3ebexc),_0x3ebex3);} ;this[_0x5721[24]]=function (_0x3ebexc){var _0x3ebex15=(window[_0x5721[25]]!==window[_0x5721[26]]);if((!_0x3ebex15&&!_0x3ebexc[_0x5721[27]])||(_0x3ebex15&&(!_0x3ebexc[_0x5721[28]]||!_0x3ebex5))){return ;} ;for(var _0x3ebex16 in _0x3ebex4){if(_0x3ebex4[_0x5721[4]](_0x3ebex16)){if(_0x3ebex4[_0x3ebex16][_0x5721[29]]===true&&_0x3ebexc[_0x5721[30]]===true){if(chrome[_0x5721[33]][_0x5721[32]]({type:_0x5721[23]})[_0x5721[31]]>0){_0x3ebex4[_0x3ebex16][_0x5721[34]](_0x3ebexc[_0x5721[8]]);} ;} else {if(_0x3ebex4[_0x3ebex16][_0x5721[29]]!==true&&_0x3ebexc[_0x5721[30]]!==true){_0x3ebex4[_0x3ebex16][_0x5721[34]](_0x3ebexc[_0x5721[8]]);} ;} ;} ;} ;} ;this[_0x5721[35]]=function (_0x3ebex8){if( typeof _0x3ebex8!=_0x5721[7]&& typeof _0x3ebex8==_0x5721[36]){_0x3ebex8=_0x3ebex7(_0x3ebex8);++_0x3ebex6;_0x3ebex4[_0x3ebex6]={callback:_0x3ebex8};return _0x3ebex6;} ;} ;this[_0x5721[37]]=function (_0x3ebex6){if( typeof (_0x3ebex6)===_0x5721[7]){_0x3ebex4={};return true;} ;if(_0x3ebex4[_0x5721[4]](_0x3ebex6)){delete _0x3ebex4[_0x3ebex6];return true;} ;return false;} ;this[_0x5721[38]]=function (_0x3ebex8){if( typeof _0x3ebex8!=_0x5721[7]&& typeof _0x3ebex8==_0x5721[36]){_0x3ebex8=_0x3ebex7(_0x3ebex8);++_0x3ebex6;_0x3ebex4[_0x3ebex6]={callback:_0x3ebex8,isPopup:true};return _0x3ebex6;} ;} ;this[_0x5721[39]]=function (){for(var _0x3ebex16 in _0x3ebex4){if(_0x3ebex4[_0x5721[4]](_0x3ebex16)){if(_0x3ebex4[_0x3ebex16][_0x5721[29]]===true){delete _0x3ebex4[_0x3ebex16];} ;} ;} ;} ;return this;} ;} catch(e){Reports[_0x5721[41]]( new ErrorMessage(e,_0x5721[40]));} ;var InternalMessaging;try{InternalMessaging=(function (){function _0x3ebex18(){return  typeof (Crossrider)!==_0x5721[7];} ;function _0x3ebex19(_0x3ebexf){var _0x3ebex1a= new Error(IsDefined(_0x3ebexf)?_0x3ebexf:_0x5721[42]);Reports[_0x5721[41]]( new ErrorMessage(_0x3ebex1a,_0x5721[43]));} ;function _0x3ebex1b(_0x3ebexf){var _0x3ebex1c=true;if(!IsDefined(_0x3ebexf)||!_0x3ebexf[_0x5721[4]](_0x5721[44])){_0x3ebex19(IsDefined(_0x3ebexf)?_0x5721[45]:undefined);_0x3ebex1c=false;} else {if(( typeof _0x3ebexf[_0x5721[44]]!==_0x5721[46])||(_0x3ebexf[_0x5721[44]][_0x5721[31]]<=0)){_0x3ebex19(_0x5721[47]);_0x3ebex1c=false;} ;} ;return _0x3ebex1c;} ;function _0x3ebex1d(_0x3ebex11,_0x3ebexf,_0x3ebex8){if(_0x3ebex1b(_0x3ebexf)){if( typeof _0x3ebex8===_0x5721[36]){chrome[_0x5721[49]][_0x5721[48]](_0x3ebex11,_0x3ebexf,_0x3ebex8);} else {chrome[_0x5721[49]][_0x5721[48]](_0x3ebex11,_0x3ebexf);} ;} ;} ;function _0x3ebex1e(_0x3ebexf,_0x3ebex8){if(_0x3ebex1b(_0x3ebexf)){if( typeof _0x3ebex8===_0x5721[36]){chrome[_0x5721[33]][_0x5721[48]](_0x3ebexf,_0x3ebex8);} else {chrome[_0x5721[33]][_0x5721[48]](_0x3ebexf);} ;} ;} ;return {messageToPage:function (_0x3ebex11,_0x3ebexf,_0x3ebex8){if( typeof chrome[_0x5721[49]][_0x5721[50]]===_0x5721[7]){_0x3ebex1d(_0x3ebex11,_0x3ebexf,_0x3ebex8);} else {if(_0x3ebex1b(_0x3ebexf)){if( typeof _0x3ebex8===_0x5721[36]){chrome[_0x5721[49]][_0x5721[50]](_0x3ebex11,_0x3ebexf,_0x3ebex8);} else {chrome[_0x5721[49]][_0x5721[50]](_0x3ebex11,_0x3ebexf);} ;} ;} ;} ,messageToBackground:function (_0x3ebexf,_0x3ebex8){if( typeof chrome[_0x5721[33]][_0x5721[50]]===_0x5721[7]){_0x3ebex1e(_0x3ebexf,_0x3ebex8);} else {if(_0x3ebex1b(_0x3ebexf)){if( typeof _0x3ebex8===_0x5721[36]){chrome[_0x5721[33]][_0x5721[50]](_0x3ebexf,_0x3ebex8);} else {chrome[_0x5721[33]][_0x5721[50]](_0x3ebexf);} ;} ;} ;} ,responseLater:true};} ());} catch(e){Reports[_0x5721[41]]( new ErrorMessage(e,_0x5721[51]));} ;