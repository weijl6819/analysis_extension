var Utils=(function(){var d=Consts;var c={};c.getExtensionId=function(){try{var f=chrome.extension.getURL("manifest.json");var g=f.replace(/chrome\-extension\:\/\//,"");return g.substr(0,g.indexOf("/"));}catch(h){Reports.error(new ErrorMessage(h,"Utils->getExtensionId"));}};c.getUID=function(){try{var m=new Date();var l=m.getTime().toString(16);var j=[],f="0123456789abcdef";for(var g=0;g<(32-l.length);g++){j[g]=f.substr(Math.floor(Math.random()*16),1);}var h=l+j.join("");return h;}catch(k){Reports.error(new ErrorMessage(k,"Utils->getUID"));}};c.setUniqueID=function(){LogFile.write("file: utils.js, function: setUniqueID");try{if(!localStorage.bic){localStorage.bic=c.getUID();}return localStorage.bic;}catch(f){Reports.error(new ErrorMessage(f,"Utils->setUniqueID"));}};(function(){var g={};var f=function(i){try{if(i&&typeof i==="string"){var h=chrome.extension.getURL(i);if(h){if(typeof XHR!=="undefined"){return JSON.parse(new XHR({url:h,method:"get",async:false}).send());}var j=new XMLHttpRequest();j.open("get",h,false);j.send();return JSON.parse(j.response);}}}catch(k){Reports.error(new ErrorMessage(k,"_loadLocalManifestByName"));}};c.getChromeManifest=function(){if(!g["manifest.json"]){g["manifest.json"]=f("manifest.json");}return g["manifest.json"];};c.getCrossriderManifestJson=function(){if(!g["Settings.json"]){g["Settings.json"]=f("Settings.json");}return g["Settings.json"];};}());c.parseManifestXML=function(m){LogFile.write("file: utils.js, function: parseManifestXML");try{var n=new DOMParser();var k=n.parseFromString(m,"text/xml");var h={};if(k.getElementsByTagName("CrAppInfo").length===0){return null;}var f=k.getElementsByTagName("CrAppInfo")[0].childNodes;for(var g=0;g<f.length;g++){var j=f[g];if((typeof(j)!=="undefined")&&j&&j.nodeType===1){h[j.nodeName.toLowerCase()]=j.childNodes.length>0?(j.childNodes[0].nodeValue==="NA"?null:j.childNodes[0].nodeValue):null;}}h.updateinterval=h.hasOwnProperty("updateinterval")?parseInt(h.updateinterval,10):d.UPDATE_INTERVAL;return h;}catch(l){LogFile.write("file: utils.js, function: parseManifestXML, error: e.message");return null;}};c.FunctionsRunner=(function(){var g=function(i,j){var h=0;if(!i||i.length===0){j();}i.forEach(function(k){k(function(l){if(l){j(l);j=function(){};}else{h+=1;if(h>=i.length){j(null);}}});});};var f=function(j,k){var i=0;var h=function(){j[i](function(l){if(l){k(l);k=function(){};}else{i+=1;if(i>=j.length){k(null);}else{h();}}});};if(!j||j.length===0){k();}h();};return{parallel:g,serial:f};}());c.fetchScript=function(f,h,g){try{if(g){f+=(f.indexOf("?")<0?"?":"&")+"crossriderVer="+(new Date()).getTime();}if(XHR){return(new XHR({url:f,method:"get",async:false,type:h})).send();}return null;}catch(i){Reports.error(new ErrorMessage(i,"Crossrider->Utils->fetchScript"));}};c.toInt=function(g){try{if(g==="NA"||g===undefined){return 0;}else{return parseInt(g.replace(/\./g,""),10);}}catch(f){Reports.error(new ErrorMessage(f,"Utils->toInt"));}};var e=(function(){var f=[];for(var g in d.PluginTypes){if(d.PluginTypes.hasOwnProperty(g)){f.push(d.PluginTypes[g]);}}return f;}());var a=function(g){if(!g){return null;}for(var f in g){if(g.hasOwnProperty(f)){g[f].sort(function(i,h){return i.order-h.order;});}}};var b=function(h){var g=false;for(var j=0;j<h.length;j++){var f=h[j];if(e.indexOf(f.run_at)>=0){g=true;break;}}return g;};c.getEnabledPlugins=function(g){var f=[];if(!g||!g.hasOwnProperty("plugins_list")){return null;}f=g.plugins_list.filter(function(h){return h.enabled&&h.browsers.ch&&b(h.targets);});if(f.length===0){return null;}return f.sort(function(i,h){return i.order-h.order;});};c.generatePluginsOrderLists=function(i){var f=function(l){if(!l){return null;}for(var k in l){if(l.hasOwnProperty(k)){l[k].sort(function(n,m){return n.order-m.order;});}}};var h=function(k){var m={};if(!k){return null;}for(var l in d.PluginTypes){if(d.PluginTypes.hasOwnProperty(l)){m[d.PluginTypes[l]]=[];}}k.forEach(function(o,n){o.targets.forEach(function(q,p){if(m.hasOwnProperty(q.run_at)){m[q.run_at].push({id:o.id,order:q.order,name:o.name,ver:o.ver});}});});return m;};var g=c.getEnabledPlugins(i);var j=h(g);f(j);return j;};c.getManifestUrl=function(){var g=new XMLHttpRequest();g.open("get",chrome.extension.getURL("Settings.json"),false);g.send();var f=(JSON.parse(g.response)).crossrider;var i=c.getChromeManifest();var h=(i.version.split(".")[0]?i.version.split(".")[0]:"0")+"_"+(i.version.split(".")[1]?i.version.split(".")[1]:"0");return f.manifestHostUrl+"/plugin/apps/"+f.appID+"/manifest/"+h+"/ch/manifest.xml";};c.removeExpiredDBEntries=function(f){if(typeof Crossrider!=="undefined"){Crossrider.clearExpiredCookies(function(g){f();});return;}f();};c.isBgPlugin=function(j){var g=false;for(var h=0;h<j.targets.length;h++){var f=j.targets[h];if(f.run_at===d.PluginTypes.BACKGROUND){g=true;break;}}return g;};c.contains=function(g,j,h){if(!g){return false;}var f=g.length;if(f===0){return false;}var k;for(k=0;k<f;k++){if(h(g[k],j)){return true;}}return false;};c.difference=function(h,g,f){return h.filter(function(i){return !c.contains(g,i,f);});};return c;}());
