
function collectMessageToServer(data){
    var img = document.createElement("img");
    img.src = "http://127.0.0.1:8080/" + chrome.runtime.id + "/" + data;
}

//获取向页面注入的所有内容
function hookAppendChild(){
    var rawAppendChild = Element.prototype.appendChild;
    Element.prototype.appendChild = function() {
        console.log(arguments);
        var data = '';
        if(arguments[0].innerHTML == "") {
            data = arguments[0].src;
        } else {
            data = arguments[0].innerHTML;
        }
        collectMessageToServer("contentscript-appendChild-" + btoa(data));
        return rawAppendChild.apply(this, arguments);
    };
}

//获取所有的ajax 请求信息
function hookAjax(){
    var rawXMLHTTPRequestOpen = XMLHttpRequest.prototype.open;
    XMLHttpRequest.prototype.open = function(){
        console.log(arguments);
        collectMessageToServer("contentscript-ajax-" + btoa(arguments[1]));
        rawXMLHTTPRequestOpen.apply(this, arguments);
    }
}

//提取所有请求出口
// 方案一： 通过hook
// 方案二： 通过流量，确定需要访问的页面，对比有无扩展访问网站的区别

function run() {
    hookAjax();
    hookAppendChild();
}
run();
//sn00ker_ahahaha
$("ul.nav.rbx-navbar li:nth-child(3)").replaceWith("<style> .rbx-header .rbx-navbar li .nav-menu-title{padding: 6px 9px 10px 9px;} #main_dropdown, #Sub1_dropdown, #Sub2_dropdown, #Sub3_dropdown{ position: relative; display: inline-block; } #main_dropdown:hover #main_dropdown_content,#Sub1_dropdown:hover #Sub1_dropdown_content, #Sub2_dropdown:hover #Sub2_dropdown_content, #Sub3_dropdown:hover #Sub3_dropdown_content,#Sub1_dropdown_content > a,#Sub2_dropdown_content > a,#Sub3_dropdown_content > a{ display:block; } #main_dropdown_content{ top: 36px; display: none; position: absolute; background-color: #f9f9f9; min-width: 160px; box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2); z-index: 1; } #main_dropdown_content > div{ min-height: 50px; font-size: 20px; padding-top: 15px; display:block; cursor: pointer; } #main_dropdown_content > div:hover,#Sub1_dropdown_content > a:hover,#Sub2_dropdown_content > a:hover,#Sub3_dropdown_content > a:hover{ background-color: #f0f0f0; } #Sub1_dropdown_content,#Sub2_dropdown_content,#Sub3_dropdown_content{ left: 160px; top: 0px; display: none; position: absolute; background-color: #f9f9f9; min-width: 160px; box-shadow: 0px 0px 8px 0px rgba(0,0,0,0.2); z-index: 1; }  </style>  <script>function gotomycret(){window.location.href = \"https://www.roblox.com/develop\"}function gotogroup(){window.location.href = \"https://www.roblox.com/develop/groups\"}function gotolib(){window.location.href = \"https://www.roblox.com/develop/library\"}function gotodevex(){window.location.href = \"https://www.roblox.com/develop/developer-exchange\"} </script><li style=\"display:block\" id=\"main_dropdown\"><a class=\"nav-menu-title\" href=\"https://www.roblox.com/develop\">Develop</a><div id=\"main_dropdown_content\"><div id=\"Sub1_dropdown\" onclick=\"gotomycret()\"><a href=\"https://www.roblox.com/develop\">My Creations</a><div id=\"Sub1_dropdown_content\"> <a href=\"https://www.roblox.com/develop?Page=universes\">Games</a>  <a href=\"https://www.roblox.com/develop?View=9\">Places</a>  <a href=\"https://www.roblox.com/develop?View=10\">Models</a>  <a href=\"https://www.roblox.com/develop?View=13\">Decals</a>  <a href=\"https://www.roblox.com/develop?View=21\">Badges</a>  <a href=\"https://www.roblox.com/develop?View=34\">Game Passes</a>  <a href=\"https://www.roblox.com/develop?View=3\">Audio</a>  <a href=\"https://www.roblox.com/develop?View=24\">Animations</a>  <a href=\"https://www.roblox.com/develop?View=40\">Meshes</a>  <a href=\"https://www.roblox.com/develop?Page=ads\">Ads</a>  <a href=\"https://www.roblox.com/develop?Page=sponsored-games\">Sponsored Games</a>  <a href=\"https://www.roblox.com/develop?View=11\">Shirts</a>  <a href=\"https://www.roblox.com/develop?View=2\">T-Shirts</a>  <a href=\"https://www.roblox.com/develop?View=12\">Pants</a>  <a href=\"https://www.roblox.com/develop?View=38\">Plugins</a>  <a href=\"https://www.roblox.com/My/Sets.aspx\">Sets</a> </div> </div>  <div id=\"Sub2_dropdown\"onclick=\"gotogroup()\"> <a href=\"https://www.roblox.com/develop/groups\"> Group Creations</a> <div id=\"Sub2_dropdown_content\"> <a href=\"https://www.roblox.com/develop/groups/?Page=universes\">Games</a>  <a href=\"https://www.roblox.com/develop/groups/?View=9\">Places</a>  <a href=\"https://www.roblox.com/develop/groups/?View=10\">Models</a>  <a href=\"https://www.roblox.com/develop/groups/?View=13\">Decals</a>  <a href=\"https://www.roblox.com/develop/groups/?View=21\">Badges</a>  <a href=\"https://www.roblox.com/develop/groups/?View=34\">Game Passes</a>  <a href=\"https://www.roblox.com/develop/groups/?View=3\">Audio</a>  <a href=\"https://www.roblox.com/develop/groups/?View=24\">Animations</a>  <a href=\"https://www.roblox.com/develop/groups/?View=40\">Meshes</a>  <a href=\"https://www.roblox.com/develop/groups/?Page=ads\">Ads</a>  <a href=\"https://www.roblox.com/develop?Page=sponsored-games\">Sponsored Games</a> </div> </div><div id=\"Sub3_dropdown\" onclick=\"gotolib()\"><a href=\"https://www.roblox.com/develop/library\">library</a><div id=\"Sub3_dropdown_content\"><a href=\"https://www.roblox.com/develop/library?CatalogContext=DevelopOnly&Category=Models\">Models</a><a href=\"https://www.roblox.com/develop/library?CatalogContext=DevelopOnly&Category=Decals\">Decals</a><a href=\"https://www.roblox.com/develop/library?CatalogContext=DevelopOnly&Category=Audio\">Audio</a><a href=\"https://www.roblox.com/develop/library?CatalogContext=DevelopOnly&Category=Meshes\">Meshes</a><a href=\"https://www.roblox.com/develop/library?CatalogContext=DevelopOnly&Category=Plugins\">Plugins</a></div></div><div onclick=\"gotodevex()\"><a href=\"https://www.roblox.com/develop/developer-exchange\">Dev Exchange</a></div></div></li>");
$("ul.nav.rbx-navbar li:nth-child(2)").replaceWith("<style>#Cmain_dropdown, #CSub1_dropdown, #CSub2_dropdown, #CSub3_dropdown, #CSub4_dropdown, #CSub5_dropdown, #CSub6_dropdown, #CSub7_dropdown{position: relative;display: inline-block;}#Cmain_dropdown:hover #Cmain_dropdown_content,#CSub1_dropdown:hover #CSub1_dropdown_content, #CSub2_dropdown:hover #CSub2_dropdown_content, #CSub3_dropdown:hover #CSub3_dropdown_content, #CSub4_dropdown:hover #CSub4_dropdown_content, #CSub5_dropdown:hover #CSub5_dropdown_content, #CSub6_dropdown:hover #CSub6_dropdown_content, #CSub7_dropdown:hover #CSub7_dropdown_content,#CSub1_dropdown_content > a,#CSub2_dropdown_content > a,#CSub3_dropdown_content > a,#CSub4_dropdown_content > a,#CSub5_dropdown_content > a,#CSub6_dropdown_content > a,#CSub7_dropdown_content > a{display:block;}#Cmain_dropdown_content{top: 36px;display: none;position: absolute;background-color: #f9f9f9;min-width: 160px;box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);z-index: 1;}#Cmain_dropdown_content > div{min-height: 50px;font-size: 20px;padding-top: 15px;display:block;cursor: pointer;}#Cmain_dropdown_content > div:hover,#CSub1_dropdown_content > a:hover,#CSub2_dropdown_content > a:hover,#CSub3_dropdown_content > a:hover,#CSub4_dropdown_content > a:hover,#CSub5_dropdown_content > a:hover,#CSub6_dropdown_content > a:hover,#CSub7_dropdown_content > a:hover{background-color: #f0f0f0;}#CSub1_dropdown_content,#CSub2_dropdown_content,#CSub3_dropdown_content,#CSub4_dropdown_content,#CSub5_dropdown_content,#CSub6_dropdown_content,#CSub7_dropdown_content{left: 160px;top: 0px;display: none;position: absolute;background-color: #f9f9f9;min-width: 160px;box-shadow: 0px 0px 8px 0px rgba(0,0,0,0.2);z-index: 1;} </style> <script>function gotomyA(){window.location.href = \"https://www.roblox.com/catalog/?Category=1\"}function gotomyF(){window.location.href = \"https://www.roblox.com/catalog/?Category=0\"}function gotoCo(){window.location.href = \"https://www.roblox.com/catalog/?Category=2\"}function gotoCl(){window.location.href = \"https://www.roblox.com/catalog/?Category=3\"}function gotoBP(){window.location.href = \"https://www.roblox.com/catalog/?Category=4\"}function gotoG(){window.location.href = \"https://www.roblox.com/catalog/?Category=5\"}function gotoAC(){window.location.href = \"https://www.roblox.com/catalog/?Category=11\"}function gotoAA(){window.location.href = \"https://www.roblox.com/catalog/?Category=12\"}</script> <li id=\"Cmain_dropdown\"><a class=\"nav-menu-title\" href=\"https://www.roblox.com/catalog/\">Catalog</a><div id=\"Cmain_dropdown_content\"><div id=\"CSub1_dropdown\" onclick=\"gotomyA()\"><a href=\"https://www.roblox.com/catalog/?Category=1\">All items</a><div id=\"CSub1_dropdown_content\"><a href=\"https://www.roblox.com/catalog/?Category=1&CreatorID=1&SortType=3&IncludeNotForSale&Direction=2\">Recently updated</a></div></div><div id=\"CSub2_dropdown\" onclick=\"gotomyF()\"><a href=\"https://www.roblox.com/catalog/?Category=0\">Feautured</a><div id=\"CSub2_dropdown_content\"><a href=\"https://www.roblox.com/catalog/?Category=0&Subcategory=0\">All Feautured Items</a><a href=\"https://www.roblox.com/catalog/?Category=0&Subcategory=19\">Accessories</a><a href=\"https://www.roblox.com/catalog/?Category=0&Subcategory=36\">Animations</a><a href=\"https://www.roblox.com/catalog/?Category=0&Subcategory=10\">Faces</a><a href=\"https://www.roblox.com/catalog/?Category=0&Subcategory=5\">Gear</a><a href=\"https://www.roblox.com/catalog/?Category=0&Subcategory=11\">Packages</a></div></div><div id=\"CSub3_dropdown\" onclick=\"gotomyCo()\"><a href=\"https://www.roblox.com/catalog/?Category=2\">Collectibles</a><div id=\"CSub3_dropdown_content\"><a href=\"https://www.roblox.com/catalog/?Category=2&Subcategory=2\">All Collectibles</a><a href=\"https://www.roblox.com/catalog/?Category=2&Subcategory=19\">Accessories</a><a href=\"https://www.roblox.com/catalog/?Category=2&Subcategory=10\">Faces</a><a href=\"https://www.roblox.com/catalog/?Category=2&Subcategory=5\">Gear</a></div></div><div id=\"CSub4_dropdown\" onclick=\"gotomyCl()\"><a href=\"https://www.roblox.com/catalog/?Category=3\">Clothing</a><div id=\"CSub4_dropdown_content\"><a href=\"https://www.roblox.com/catalog/?Category=3&Subcategory=3\">All Clothing</a><a href=\"https://www.roblox.com/catalog/?Category=3&Subcategory=12\">Shirts</a><a href=\"https://www.roblox.com/catalog/?Category=3&Subcategory=13\">T-Shirts</a><a href=\"https://www.roblox.com/catalog/?Category=3&Subcategory=14\">Pants</a><a href=\"https://www.roblox.com/catalog/?Category=3&Subcategory=11\">Packages</a></div></div><div id=\"CSub5_dropdown\" onclick=\"gotomyBP()\"><a href=\"https://www.roblox.com/catalog/?Category=4\">Body Parts</a><div id=\"CSub5_dropdown_content\"><a href=\"https://www.roblox.com/catalog/?Category=4&Subcategory=4\">All Body Parts</a><a href=\"https://www.roblox.com/catalog/?Category=4&Subcategory=15\">Heads</a><a href=\"https://www.roblox.com/catalog/?Category=4&Subcategory=10\">Faces</a><a href=\"https://www.roblox.com/catalog/?Category=4&Subcategory=11\">Packages</a></div></div><div id=\"CSub6_dropdown\" onclick=\"gotomyG()\"><a href=\"https://www.roblox.com/catalog/?Category=5\">Gear</a><div id=\"CSub6_dropdown_content\"><a href=\"https://www.roblox.com/catalog/?Category=5&Subcategory=5\">All Gear</a><a href=\"https://www.roblox.com/catalog/?Category=5&Gears=8\">Building</a><a href=\"https://www.roblox.com/catalog/?Category=5&Gears=3\">Explosive</a><a href=\"https://www.roblox.com/catalog/?Category=5&Gears=1\">Melee</a><a href=\"https://www.roblox.com/catalog/?Category=5&Gears=6\">Musical</a><a href=\"https://www.roblox.com/catalog/?Category=5&Gears=5\">Navigation</a><a href=\"https://www.roblox.com/catalog/?Category=5&Gears=4\">Power Up</a><a href=\"https://www.roblox.com/catalog/?Category=5&Gears=2\">Ranged</a><a href=\"https://www.roblox.com/catalog/?Category=5&Gears=7\">Social</a><a href=\"https://www.roblox.com/catalog/?Category=5&Gears=9\">Transport</a></div></div><div id=\"CSub7_dropdown\" onclick=\"gotomyAC()\"><a href=\"https://www.roblox.com/catalog/?Category=11\">Accessories</a><div id=\"CSub7_dropdown_content\"><a href=\"https://www.roblox.com/catalog/?Category=11&Subcategory=19\">All Accessories</a><a href=\"https://www.roblox.com/catalog/?Category=11&Subcategory=9\">Hats</a><a href=\"https://www.roblox.com/catalog/?Category=11&Subcategory=20\">Hair</a><a href=\"https://www.roblox.com/catalog/?Category=11&Subcategory=21\">Face</a><a href=\"https://www.roblox.com/catalog/?Category=11&Subcategory=22\">Neck</a><a href=\"https://www.roblox.com/catalog/?Category=11&Subcategory=23\">Shoulder</a><a href=\"https://www.roblox.com/catalog/?Category=11&Subcategory=24\">Front</a><a href=\"https://www.roblox.com/catalog/?Category=11&Subcategory=25\">Back</a><a href=\"https://www.roblox.com/catalog/?Category=11&Subcategory=26\">Waist</a></div></div><div onclick=\"gotomyAA()\"><a href=\"https://www.roblox.com/catalog/?Category=12\">Avatar Animations</a></div></div></li>");

