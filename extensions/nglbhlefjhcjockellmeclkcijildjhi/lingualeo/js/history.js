var LinguaLeoHistory=function(){function e(){try{a=JSON.parse(kango.storage.getItem("history")||{})}catch(c){a={items:[]}}}var a={items:[]},d,g=["popup/historyList","popup/historyItem"];return{addItem:function(c,d,h,b,g){e();for(var f=0,l=a.items.length;f<l;f++)if(a.items[f].word===c){a.items.splice(f,1);break}a.items.push({word:c,tword:d,context:h,context_url:b,context_title:g});100<a.items.length&&a.items.shift();kango.storage.setItem("history",JSON.stringify(a))},getItemsCount:function(){e();return a.items.length},
getHistoryHtml:function(){e();if(!a.items.length)return null;d||(d=lingualeo.getTemplates(g,!0));for(var c=[],k=a.items.length-1,h=0,b;(b=a.items[k])&&100>h++;k--)c.push(stringHelper.formatStrExt(d["popup/historyItem"],{originalText:100<b.word.length?b.word.substr(0,50)+"...":b.word,translatedText:b.tword?100<b.tword.length?b.tword.substr(0,100)+"...":b.tword:"...",link:lingualeoHelper.getWordArticleUrl(b.word)}));return stringHelper.formatStr(d["popup/historyList"],{items:c.join("")})},clearHistory:function(){kango.storage.removeItem("history");
e()}}};
