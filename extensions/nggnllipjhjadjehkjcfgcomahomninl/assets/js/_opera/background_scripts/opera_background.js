var navigationIntercepter=function(){var e={api:utils().getExtensionApi(),endpoint:{url:"https://ext.pcprotect.com/e1/gsb/url",method:"POST",cache:[]},settings:{urlFilters:["http://*/*","https://*/*"],method:"blocking",blockPageUrl:""},urlWhitelist:{},init:function(){var r=e.api;e.settings.blockPageUrl=r.extension.getURL("/assets/html/warning-page.html"),r.webRequest.onBeforeRequest.addListener(function(r){return e.onBeforeRequest(r)},{urls:e.settings.urlFilters},[e.settings.method])},replaceString:function(e,r){return e.replace(r,"")},addToCache:function(r,t,n){if(void 0===t[n]){if(void 0!==t[e.replaceString(n,"https://www.")])return r[n]=t[e.replaceString(n,"https://www.")],e.replaceString(n,"https://www.");if(void 0!==t[e.replaceString(n,"https://")])return r[n]=t[e.replaceString(n,"https://")],e.replaceString(n,"https://");if(void 0!==t[e.replaceString(n,"http://www.")])return r[n]=t[e.replaceString(n,"http://www.")],e.replaceString(n,"http://www.");if(void 0!==t[e.replaceString(n,"http://")])return r[n]=t[e.replaceString(n,"http://")],e.replaceString(n,"http://");if(void 0!==t[e.replaceString(n,"www.")])return r[n]=t[e.replaceString(n,"www.")],e.replaceString(n,"www.")}return n},onBeforeRequest:function(r){if(-1!=r.url.indexOf("SafeSearchIgnore"))return!0;if(void 0!==r&&0==r.frameId&&"main_frame"==r.type&&e.excludeUrls(r.url)){var t,n=e.regexUrl(r.url),a=e.endpoint.cache,i=e.cleanUrl(n),o=e.api;if(n[0]){if(r.cleanUrl=n[0],a.hasOwnProperty(i)){var l=!!a[i]&&a[i];if(l)return e.ifThreatBlockResponse(l,r,!1)}else if(t=e.ajax(n[0])){i=e.addToCache(a,t,i);var c=!!t[i]&&t[i];if(c)return e.ifThreatBlockResponse(c,r,!1)}}else{void 0;var s=encodeURIComponent(r.url),p="https://search.pcprotect.com/web?fcoid=417&fcop=topnav&fpid=27&q="+s;o.tabs.query({currentWindow:!0,active:!0},function(e){chrome.tabs.update(e[0].id,{url:p})})}}},onBeforeNavigate:function(r){if(-1!=r.url.indexOf("SafeSearchIgnore"))return!0;if(void 0!==r&&0==r.frameId&&e.excludeUrls(r.url)){var t,n=e.regexUrl(r.url),a=e.endpoint.cache,i=e.cleanUrl(n);if(n[0])if(r.cleanUrl=n[0],a.hasOwnProperty(i)){var o=!!a[i]&&a[i];if(o)return e.ifThreatBlockResponse(o,r,!1)}else if(t=e.ajax(n[0])){i=e.addToCache(a,t,i);var l=!!t[i]&&t[i];if(l)return e.ifThreatBlockResponse(l,r,!1)}}},onBeforeNavigateErrorOccurred:function(r){if(-1!=r.url.indexOf("SafeSearchIgnore"))return!0;if(void 0!==r&&0==r.frameId&&e.excludeUrls(r.url)){var t,n=e.regexUrl(r.url),a=e.endpoint.cache,i=e.cleanUrl(n);if(n[0])if(r.cleanUrl=n[0],a.hasOwnProperty(i)){var o=!!a[i]&&a[i];if(o)return e.ifThreatBlockResponse(o,r,!1)}else if(t=e.ajax(n[0])){i=e.addToCache(a,t,i);var l=!!t[i]&&t[i];if(l)return e.ifThreatBlockResponse(l,r,!1)}}},ajax:function(r){var t=$.ajax({url:e.endpoint.url,method:e.endpoint.method,data:JSON.stringify({urls:[r]}),dataType:"json",async:!1});return"object"==typeof t.responseJSON&&t.responseJSON.data},regexUrl:function(e){var r=new RegExp("^(http://|https://).*?(/|$)"),t=e.match(r);return null!==t&&void 0!==t&&void 0!==t[0]&&t},excludeUrls:function(r){var t=[e.endpoint.url,"about:blank"];return-1==$.inArray(r,t)},cleanUrl:function(e){if(void 0!==e[1])var r=e[0].replace(e[1],"");return r?r.replace("/",""):null},ifThreatBlockResponse:function(r,t,n){if(e.shouldBlock(r)){var a=e.api;t.cleanUrl=t.cleanUrl.replace("https://www.","").replace("http://www.","").replace("https://","").replace("http://","").replace(/^www\./g,"").replace("/","");var i="?url="+encodeURIComponent(t.url)+"&threat="+e.getThreat(r),o=e.settings.blockPageUrl+i;if(void 0!==n&&(a.tabs.query({currentWindow:!0,active:!0},function(r){void 0,e.api.storage.local.get("dont-block-whitelist",function(n){if(void 0,n&&void 0!==n["dont-block-whitelist"]&&(void 0,e.urlWhitelist=JSON.parse(n["dont-block-whitelist"])),-1==$.inArray(t.cleanUrl,e.urlWhitelist))void 0,a.tabs.update(r[0].id,{url:o});else{void 0;var i=-1!=t.url.indexOf("?")?"&":"?",l=t.url+i+"SafeSearchIgnore";a.tabs.update(r[0].id,{url:l})}})}),!n))return void 0,{redirectUrl:o}}},shouldBlock:function(e){var r=0,t=0,n=["malware","virusinfected","spyware","phishing"];switch(-1!=$.inArray(e.category,n)&&(r=1),e.threatType){case"":t=4;break;case"THREAT_TYPE_UNSPECIFIED":t=2;break;default:t=1}return 1==t||1==r},getThreat:function(e){var r;return""!=e.threatType&&(r=e.threatType),""!=e.category&&(r=e.category),r.toUpperCase()}};return e.init(),e}();