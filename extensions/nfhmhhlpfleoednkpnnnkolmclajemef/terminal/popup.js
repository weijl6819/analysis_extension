document.addEventListener("DOMContentLoaded",function(){function n(a){l=a;var k=localStorage.getItem("evalCurrents"),k=k?JSON.parse(k):{};k[h]={code:a,pos:b.selectionStart};localStorage.evalCurrents=JSON.stringify(k)}function q(){var a=localStorage.getItem("evalCurrents"),a=a?JSON.parse(a):{};if(a=a[h]?a[h]:null)l=a.code,b.focus(),b.value=l,b.setSelectionRange(a.pos,a.pos)}function r(a){var b=m();b[0]!=a&&(b.unshift(a),20<b.length&&b.pop());a=(a=localStorage.getItem("evalHistory"))?JSON.parse(a):
{};a[h]=b;localStorage.evalHistory=JSON.stringify(a);g=0}function m(){var b=localStorage.getItem("evalHistory"),b=b?JSON.parse(b):{};return b[h]?b[h]:[]}function t(){var b=m();if(20>g&&g+1<b.length)return g++,b[g]}function u(){var b=m();if(0<g)return g--,b[g]}var p=null,h=null,g=-1,l="",b=null,v=chrome.extension.getBackgroundPage().app;document.getElementById("logoutButton").onclick=function(){chrome.extension.sendMessage({_logout:!0});window.close()};v.getActiveTab(function(a,g){p=a;h=g;b=document.getElementById("code");
q();b.onclick=function(){n(b.value)};document.onkeyup=function(a){var c=a.keyCode||a.which;if(a.ctrlKey)if(10==c||13==c)b.value.trim()&&(r(b.value),b.className="send",chrome.extension.sendMessage({_evalCode:!0,code:b.value,tabId:p},function(){b.className=""}));else{if(38==c||40==c)if(a=38==c?t():u())b.value=a}else if(9==c){a.preventDefault();var f=a.shiftKey;a=b.value;var d=b.selectionStart,c=b.selectionEnd;if(d-c||f){for(var e=d;e&&"\n"!=a.charAt(e-1);e--);d+=f?/^\t/.exec(a.substring(e,c))?-1:0:
1;0>d&&(d=0);f=f?a.substring(e,c).replace(/^\t/,"").replace(/\n\t/g,"\n"):"\t"+a.substring(e,c).replace(/\n/g,"\n\t");b.value=a.substring(0,e)+f+a.substring(c);b.setSelectionRange(d,e+f.length);b.focus()}else b.value=a.substring(0,d)+"\t"+a.substring(c),b.setSelectionRange(d+1,d+1)}else if(10==c||13==c){a=b.value;d=b.selectionStart;c=b.selectionEnd;f="{"==a.charAt(d-2)?"\t":"";for(e=d-1;e;e--)if("\n"==a.charAt(e-1)){for(;"\t"==a.charAt(e);e++)f+="\t";break}f&&(b.value=a.substring(0,d)+f+a.substring(c),
b.setSelectionRange(d+f.length,d+f.length))}n(b.value)}})},!1);