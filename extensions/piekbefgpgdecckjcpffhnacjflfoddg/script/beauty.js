(function(){function A(w,g){return(new V(w,g)).beautify()}function V(w,g){function A(a,c){var b=0;a&&(b=a.indentation_level,b+=a.var_line&&a.var_line_reindented?1:0,!B()&&a.line_indent_level>b&&(b=a.line_indent_level));return{mode:c,parent:a,last_text:a?a.last_text:"",last_word:a?a.last_word:"",var_line:!1,var_line_tainted:!1,var_line_reindented:!1,in_html_comment:!1,multiline_frame:!1,if_block:!1,do_block:!1,do_while:!1,in_case_statement:!1,in_case:!1,case_body:!1,indentation_level:b,line_indent_level:a?
a.line_indent_level:b,start_line_index:n.length,ternary_depth:0}}function S(a){a=void 0===a?!1:a;if(n.length)for(W(n[n.length-1],a);a&&1<n.length&&0===n[n.length-1].text.length;)n.pop(),W(n[n.length-1],a)}function W(a){for(;a.text.length&&(" "===a.text[a.text.length-1]||a.text[a.text.length-1]===y||a.text[a.text.length-1]===E);)a.text.pop()}function T(a){return a.replace(/^\s+|\s+$/g,"")}function B(){return 0===n[n.length-1].text.length}function F(h){h=void 0===h?!1:h;if(e.wrap_line_length&&!h){var c=
n[n.length-1],b=0;0<c.text.length&&(b=c.text.join("").length+f.length+(d?1:0),b>=e.wrap_line_length&&(h=!0))}(e.preserve_newlines&&C||h)&&!B()&&(l(!1,!0),z(a.mode)||M(a.mode)||(G=!0))}function l(h,c){d=G=!1;if(!c&&";"!==a.last_text)for(;a.mode===q.Statement&&!a.if_block&&!a.do_block;)D();if(1!==n.length||!B())if(h||!B())a.multiline_frame=!0,n.push({text:[]})}function p(h){h=h||f;if(B()){var c=n[n.length-1];if(e.keep_array_indentation&&z(a.mode)&&C){c.text.push("");for(var b=0;b<H.length;b+=1)c.text.push(H[b])}else if(E&&
c.text.push(E),c=a.indentation_level+(a.var_line&&a.var_line_reindented?1:0)+(G?1:0),1<n.length){b=n[n.length-1];a.line_indent_level=c;for(var k=0;k<c;k+=1)b.text.push(y)}}G=!1;c=n[n.length-1];d&&c.text.length&&(b=c.text[c.text.length-1]," "!==b&&b!==y&&c.text.push(" "));d=!1;n[n.length-1].text.push(h)}function N(b){a?(P.push(a),v=a):v=A(null,b);a=A(v,b)}function z(a){return a===q.ArrayLiteral}function M(a){return s(a,[q.Expression,q.ForInitializer,q.Conditional])}function D(){0<P.length&&(v=a,a=
P.pop())}function Q(){return"do"===a.last_text||"else"===a.last_text&&"if"!==f||"TK_END_EXPR"===k&&(v.mode===q.ForInitializer||v.mode===q.Conditional)?(F(s(f,["do","for","if","while"])),N(q.Statement),B()&&(a.indentation_level+=1,G=!1),!0):!1}function O(a){return s(a,"case return do if throw else".split(" "))}function s(a,b){for(var e=0;e<b.length;e+=1)if(b[e]===a)return!0;return!1}function X(){var h;x=0;if(b>=t)return["","TK_EOF"];C=!1;H=[];var c=m.charAt(b);for(b+=1;s(c,U);){"\n"===c?(x+=1,H=[]):
x&&(c===y?H.push(y):"\r"!==c&&H.push(" "));if(b>=t)return["","TK_EOF"];c=m.charAt(b);b+=1}if(s(c,R)){if(b<t)for(;s(m.charAt(b),R)&&(c+=m.charAt(b),b+=1,b!==t););if(b!==t&&c.match(/^[0-9]+[Ee]$/)&&("-"===m.charAt(b)||"+"===m.charAt(b))){var r=m.charAt(b);b+=1;var d=X(),c=c+(r+d[0]);return[c,"TK_WORD"]}return"in"===c?[c,"TK_OPERATOR"]:[c,"TK_WORD"]}if("("===c||"["===c)return[c,"TK_START_EXPR"];if(")"===c||"]"===c)return[c,"TK_END_EXPR"];if("{"===c)return[c,"TK_START_BLOCK"];if("}"===c)return[c,"TK_END_BLOCK"];
if(";"===c)return[c,"TK_SEMICOLON"];if("/"===c){r="";d=!0;if("*"===m.charAt(b)){b+=1;if(b<t)for(;b<t&&("*"!==m.charAt(b)||!m.charAt(b+1)||"/"!==m.charAt(b+1));){c=m.charAt(b);r+=c;if("\n"===c||"\r"===c)d=!1;b+=1;if(b>=t)break}b+=2;return d&&0===x?["/*"+r+"*/","TK_INLINE_COMMENT"]:["/*"+r+"*/","TK_BLOCK_COMMENT"]}if("/"===m.charAt(b)){for(r=c;"\r"!==m.charAt(b)&&"\n"!==m.charAt(b)&&!(r+=m.charAt(b),b+=1,b>=t););return[r,"TK_COMMENT"]}}if("'"===c||'"'===c||("/"===c||e.e4x&&"<"===c&&m.slice(b-1).match(/^<([-a-zA-Z:0-9_.]+|{[^{}]*}|!\[CDATA\[[\s\S]*?\]\])\s*([-a-zA-Z:0-9_.]+=('[^']*'|"[^"]*"|{[^{}]*})\s*)*\/?\s*>/))&&
("TK_WORD"===k&&O(a.last_text)||"TK_END_EXPR"===k&&s(v.mode,[q.Conditional,q.ForInitializer])||s(k,"TK_COMMENT TK_START_EXPR TK_START_BLOCK TK_END_BLOCK TK_OPERATOR TK_EQUALS TK_EOF TK_SEMICOLON TK_COMMA".split(" ")))){var r=c,g=d=!1;h=c;if(b<t)if("/"===r)for(c=!1;d||c||m.charAt(b)!==r;){if(h+=m.charAt(b),d?d=!1:(d="\\"===m.charAt(b),"["===m.charAt(b)?c=!0:"]"===m.charAt(b)&&(c=!1)),b+=1,b>=t)return[h,"TK_STRING"]}else if(e.e4x&&"<"===r){var d=/<(\/?)([-a-zA-Z:0-9_.]+|{[^{}]*}|!\[CDATA\[[\s\S]*?\]\])\s*([-a-zA-Z:0-9_.]+=('[^']*'|"[^"]*"|{[^{}]*})\s*)*(\/?)\s*>/g,
c=m.slice(b-1),f=d.exec(c);if(f&&0===f.index){r=f[2];for(h=0;f;){var g=!!f[1],l=f[2],p=!!f[f.length-1]||"![CDATA["===l.slice(0,8);l!==r||p||(g?--h:++h);if(0>=h)break;f=d.exec(c)}r=f?f.index+f[0].length:c.length;b+=r-1;return[c.slice(0,r),"TK_STRING"]}}else for(;d||m.charAt(b)!==r;){h+=m.charAt(b);if(d){if("x"===m.charAt(b)||"u"===m.charAt(b))g=!0;d=!1}else d="\\"===m.charAt(b);b+=1;if(b>=t)return[h,"TK_STRING"]}b+=1;h+=r;if(g&&e.unescape_strings)a:{c=h;d=!1;f="";h=0;g="";for(l=0;d||h<c.length;)if(p=
c.charAt(h),h++,d){d=!1;if("x"===p)g=c.substr(h,2),h+=2;else if("u"===p)g=c.substr(h,4),h+=4;else{f+="\\"+p;continue}if(!g.match(/^[0123456789abcdefABCDEF]+$/)){h=c;break a}l=parseInt(g,16);if(0<=l&&32>l)f="x"===p?f+("\\x"+g):f+("\\u"+g);else if(34===l||39===l||92===l)f+="\\"+String.fromCharCode(l);else if("x"===p&&126<l&&255>=l){h=c;break a}else f+=String.fromCharCode(l)}else"\\"===p?d=!0:f+=p;h=f}if("/"===r)for(;b<t&&s(m.charAt(b),R);)h+=m.charAt(b),b+=1;return[h,"TK_STRING"]}if("#"===c){if(1===
n.length&&0===n[0].text.length&&"!"===m.charAt(b)){for(h=c;b<t&&"\n"!==c;)c=m.charAt(b),h+=c,b+=1;return[T(h)+"\n","TK_UNKNOWN"]}r="#";if(b<t&&s(m.charAt(b),Y)){do c=m.charAt(b),r+=c,b+=1;while(b<t&&"#"!==c&&"="!==c);"#"!==c&&("["===m.charAt(b)&&"]"===m.charAt(b+1)?(r+="[]",b+=2):"{"===m.charAt(b)&&"}"===m.charAt(b+1)&&(r+="{}",b+=2));return[r,"TK_WORD"]}}if("<"===c&&"\x3c!--"===m.substring(b-1,b+3)){b+=3;for(c="\x3c!--";"\n"!==m.charAt(b)&&b<t;)c+=m.charAt(b),b++;a.in_html_comment=!0;return[c,"TK_COMMENT"]}if("-"===
c&&a.in_html_comment&&"--\x3e"===m.substring(b-1,b+2))return a.in_html_comment=!1,b+=2,["--\x3e","TK_COMMENT"];if("."===c)return[c,"TK_DOT"];if(s(c,I)){for(;b<t&&s(c+m.charAt(b),I)&&!(c+=m.charAt(b),b+=1,b>=t););return","===c?[c,"TK_COMMA"]:"="===c?[c,"TK_EQUALS"]:[c,"TK_OPERATOR"]}return[c,"TK_UNKNOWN"]}var m,n,f,J,k,K,y,a,v,P,U,R,I,b,L,Y,u,C,G,d,t,x,H,Z,q,e,E="";U=["\n","\r","\t"," "];R="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$".split("");Y="0123456789".split("");I="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! !! , : ? ^ ^= |= ::";
I+=" <%= <% %> <?= <? ?>";I=I.split(" ");L="continue try throw return var if switch case default for while break function".split(" ");q={BlockStatement:"BlockStatement",Statement:"Statement",ObjectLiteral:"ObjectLiteral",ArrayLiteral:"ArrayLiteral",ForInitializer:"ForInitializer",Conditional:"Conditional",Expression:"Expression"};Z={TK_START_EXPR:function(){Q();var b=q.Expression;if("["===f){if("TK_WORD"===k||")"===a.last_text){s(a.last_text,L)&&(d=!0);N(b);p();a.indentation_level+=1;e.space_in_paren&&
(d=!0);return}b=q.ArrayLiteral;!z(a.mode)||"["!==a.last_text&&(","!==a.last_text||"]"!==K&&"}"!==K)||e.keep_array_indentation||l()}else"for"===a.last_text?b=q.ForInitializer:s(a.last_text,["if","while"])&&(b=q.Conditional);";"===a.last_text||"TK_START_BLOCK"===k?l():"TK_END_EXPR"===k||"TK_START_EXPR"===k||"TK_END_BLOCK"===k||"."===a.last_text?(F(C),G=!1):"TK_WORD"!==k&&"TK_OPERATOR"!==k?d=!0:"function"===a.last_word||"typeof"===a.last_word?e.jslint_happy&&(d=!0):(s(a.last_text,L)||"catch"===a.last_text)&&
e.space_before_conditional&&(d=!0);"("===f&&("TK_EQUALS"!==k&&"TK_OPERATOR"!==k||a.mode===q.ObjectLiteral||F());N(b);p();e.space_in_paren&&(d=!0);a.indentation_level+=1},TK_END_EXPR:function(){for(;a.mode===q.Statement;)D();"]"===f&&z(a.mode)&&a.multiline_frame&&!e.keep_array_indentation&&l();a.multiline_frame&&F();e.space_in_paren&&("TK_START_EXPR"===k?(S(),d=!1):d=!0);"]"===f&&e.keep_array_indentation?(p(),D()):(D(),p());if(!v.multiline_frame)for(var b=v.start_line_index,c=0,g;b<n.length;)g=n[b],
b++,0!==g.text.length&&(c=E&&g.text[0]===E?1:0,g.text[c]===y&&g.text.splice(c,1));a.do_while&&v.mode===q.Conditional&&(v.mode=q.Expression,a.do_block=!1,a.do_while=!1)},TK_START_BLOCK:function(){N(q.BlockStatement);var h;a:{h=b;for(var c=m.charAt(h);s(c,U)&&"}"!==c;){h++;if(h>=t){h=!1;break a}c=m.charAt(h)}h="}"===c}h=h&&"function"===a.last_word&&"TK_END_EXPR"===k;"expand"===e.brace_style?"TK_OPERATOR"!==k&&(h||"TK_EQUALS"===k||O(a.last_text)&&"else"!==a.last_text)?d=!0:l():"TK_OPERATOR"!==k&&"TK_START_EXPR"!==
k?"TK_START_BLOCK"===k?l():d=!0:z(v.mode)&&","===a.last_text&&("}"===K?d=!0:l());p();a.indentation_level+=1},TK_END_BLOCK:function(){for(;a.mode===q.Statement;)D();var b="TK_START_BLOCK"===k;"expand"===e.brace_style?b||l():b||(z(a.mode)&&e.keep_array_indentation?(e.keep_array_indentation=!1,l(),e.keep_array_indentation=!0):l());D();p()},TK_WORD:function(){Q()||!C||M(a.mode)||"TK_OPERATOR"===k&&"--"!==a.last_text&&"++"!==a.last_text||"TK_EQUALS"===k||!e.preserve_newlines&&"var"===a.last_text||l();
if(a.do_block&&!a.do_while){if("while"===f){d=!0;p();d=!0;a.do_while=!0;return}l();a.do_block=!1}if(a.if_block&&"else"!==f){for(;a.mode===q.Statement;)D();a.if_block=!1}if("case"===f||"default"===f&&a.in_case_statement){l();if(a.case_body||e.jslint_happy)0<a.indentation_level&&(!a.parent||a.indentation_level>a.parent.indentation_level)&&(a.indentation_level-=1),a.case_body=!1;p();a.in_case=!0;a.in_case_statement=!0}else if("function"===f&&(a.var_line&&"TK_EQUALS"!==k&&(a.var_line_reindented=!0),!B()&&
";"!==a.last_text&&"}"!==a.last_text||"{"===a.last_text||z(a.mode)||B()&&(1===n.length||0===n[n.length-2].text.length)||(l(),l(!0)),"TK_WORD"===k?"get"===a.last_text||"set"===a.last_text||"new"===a.last_text||"return"===a.last_text?d=!0:l():"TK_OPERATOR"===k||"="===a.last_text?d=!0:M(a.mode)||l()),"TK_COMMA"!==k&&"TK_START_EXPR"!==k&&"TK_EQUALS"!==k&&"TK_OPERATOR"!==k||a.mode===q.ObjectLiteral||F(),"function"===f)p(),a.last_word=f;else{u="NONE";"TK_END_BLOCK"===k?s(f,["else","catch","finally"])?"expand"===
e.brace_style||"end-expand"===e.brace_style?u="NEWLINE":(u="SPACE",d=!0):u="NEWLINE":"TK_SEMICOLON"===k&&a.mode===q.BlockStatement?u="NEWLINE":"TK_SEMICOLON"===k&&M(a.mode)?u="SPACE":"TK_STRING"===k?u="NEWLINE":"TK_WORD"===k?u="SPACE":"TK_START_BLOCK"===k?u="NEWLINE":"TK_END_EXPR"===k&&(d=!0,u="NEWLINE");s(f,L)&&")"!==a.last_text&&(u="else"===a.last_text?"SPACE":"NEWLINE");if(s(f,["else","catch","finally"]))if("TK_END_BLOCK"!==k||"expand"===e.brace_style||"end-expand"===e.brace_style)l();else{S(!0);
var b=n[n.length-1];"}"!==b.text[b.text.length-1]&&l();d=!0}else"NEWLINE"===u?O(a.last_text)?d=!0:"TK_END_EXPR"!==k?"TK_START_EXPR"===k&&"var"===f||":"===a.last_text||("if"===f&&"else"===a.last_word&&"{"!==a.last_text?d=!0:(a.var_line=!1,a.var_line_reindented=!1,l())):s(f,L)&&")"!==a.last_text&&(a.var_line=!1,a.var_line_reindented=!1,l()):z(a.mode)&&","===a.last_text&&"}"===K?l():"SPACE"===u&&(d=!0);p();a.last_word=f;"var"===f&&(a.var_line=!0,a.var_line_reindented=!1,a.var_line_tainted=!1);"do"===
f&&(a.do_block=!0);"if"===f&&(a.if_block=!0)}},TK_SEMICOLON:function(){for(Q()&&(d=!1);a.mode===q.Statement&&!a.if_block&&!a.do_block;)D();p();a.var_line=!1;a.var_line_reindented=!1;a.mode===q.ObjectLiteral&&(a.mode=q.BlockStatement)},TK_STRING:function(){Q()?d=!0:"TK_WORD"===k?d=!0:"TK_COMMA"===k||"TK_START_EXPR"===k||"TK_EQUALS"===k||"TK_OPERATOR"===k?a.mode!==q.ObjectLiteral&&F():l();p()},TK_EQUALS:function(){a.var_line&&(a.var_line_tainted=!0);d=!0;p();d=!0},TK_OPERATOR:function(){var b=!0,c=
!0;O(a.last_text)?(d=!0,p()):"*"!==f||"TK_DOT"!==k||K.match(/^\d+$/)?":"===f&&a.in_case?(a.case_body=!0,a.indentation_level+=1,p(),l(),a.in_case=!1):"::"===f?p():(!C||"--"!==f&&"++"!==f||l(),s(f,["--","++","!"])||s(f,["-","+"])&&(s(k,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||s(a.last_text,L)||","===a.last_text)?(c=b=!1,";"===a.last_text&&M(a.mode)&&(b=!0),"TK_WORD"===k&&s(a.last_text,L)&&(b=!0),a.mode!==q.BlockStatement&&a.mode!==q.Statement||"{"!==a.last_text&&";"!==a.last_text||
l()):":"===f?0===a.ternary_depth?(a.mode===q.BlockStatement&&(a.mode=q.ObjectLiteral),b=!1):a.ternary_depth-=1:"?"===f&&(a.ternary_depth+=1),d=d||b,p(),d=c):p()},TK_COMMA:function(){if(a.var_line){if(M(a.mode)||"TK_END_BLOCK"===k)a.var_line_tainted=!1;a.var_line&&(a.var_line_reindented=!0);p();a.var_line_tainted?(a.var_line_tainted=!1,l()):d=!0}else"TK_END_BLOCK"===k&&a.mode!==q.Expression?(p(),a.mode===q.ObjectLiteral&&"}"===a.last_text?l():d=!0):a.mode===q.ObjectLiteral?(p(),l()):(p(),d=!0)},TK_BLOCK_COMMENT:function(){for(var a=
f,a=a.replace(/\x0d/g,""),b=[],d=a.indexOf("\n");-1!==d;)b.push(a.substring(0,d)),a=a.substring(d+1),d=a.indexOf("\n");a.length&&b.push(a);a=!1;l(!1,!0);if(1<b.length){a:{for(var d=b.slice(1),e=0;e<d.length;e++)if("*"!==T(d[e]).charAt(0)){d=!1;break a}d=!0}d&&(a=!0)}p(b[0]);for(d=1;d<b.length;d++)l(!1,!0),a?p(" "+T(b[d])):n[n.length-1].text.push(b[d]);l(!1,!0)},TK_INLINE_COMMENT:function(){d=!0;p();d=!0},TK_COMMENT:function(){C?l(!1,!0):S(!0);d=!0;p();l(!1,!0)},TK_DOT:function(){O(a.last_text)?d=
!0:F(")"===a.last_text&&e.break_chained_methods);p()},TK_UNKNOWN:function(){p();"\n"===f[f.length-1]&&l()}};g=g?g:{};e={};void 0!==g.space_after_anon_function&&void 0===g.jslint_happy&&(g.jslint_happy=g.space_after_anon_function);void 0!==g.braces_on_own_line&&(e.brace_style=g.braces_on_own_line?"expand":"collapse");e.brace_style=g.brace_style?g.brace_style:e.brace_style?e.brace_style:"collapse";"expand-strict"===e.brace_style&&(e.brace_style="expand");e.indent_size=g.indent_size?parseInt(g.indent_size,
10):4;e.indent_char=g.indent_char?g.indent_char:" ";e.preserve_newlines=void 0===g.preserve_newlines?!0:g.preserve_newlines;e.break_chained_methods=void 0===g.break_chained_methods?!1:g.break_chained_methods;e.max_preserve_newlines=void 0===g.max_preserve_newlines?0:parseInt(g.max_preserve_newlines,10);e.space_in_paren=void 0===g.space_in_paren?!1:g.space_in_paren;e.jslint_happy=void 0===g.jslint_happy?!1:g.jslint_happy;e.keep_array_indentation=void 0===g.keep_array_indentation?!1:g.keep_array_indentation;
e.space_before_conditional=void 0===g.space_before_conditional?!0:g.space_before_conditional;e.unescape_strings=void 0===g.unescape_strings?!1:g.unescape_strings;e.wrap_line_length=void 0===g.wrap_line_length?0:parseInt(g.wrap_line_length,10);e.e4x=void 0===g.e4x?!1:g.e4x;g.indent_with_tabs&&(e.indent_char="\t",e.indent_size=1);for(y="";0<e.indent_size;)y+=e.indent_char,e.indent_size-=1;for(;w&&(" "===w.charAt(0)||"\t"===w.charAt(0));)E+=w.charAt(0),w=w.substring(1);m=w;t=w.length;k="TK_START_BLOCK";
K="";n=[{text:[]}];d=G=!1;H=[];P=[];N(q.BlockStatement);b=0;this.beautify=function(){for(var b;;){b=X();f=b[0];J=b[1];if("TK_EOF"===J)break;b=e.keep_array_indentation&&z(a.mode);C=0<x;if(b)for(b=0;b<x;b+=1)l(0<b);else if(e.max_preserve_newlines&&x>e.max_preserve_newlines&&(x=e.max_preserve_newlines),e.preserve_newlines&&1<x)for(l(),b=1;b<x;b+=1)l(!0);Z[J]();"TK_INLINE_COMMENT"!==J&&"TK_COMMENT"!==J&&"TK_UNKNOWN"!==J&&(K=a.last_text,k=J,a.last_text=f)}b=n[0].text.join("");for(var c=1;c<n.length;c++)b+=
"\n"+n[c].text.join("");return b=b.replace(/[\r\n ]+$/,"")}}"function"===typeof define?"undefined"===typeof define.amd?define(function(w,g,V){g.js_beautify=A}):define([],function(){return A}):"undefined"!==typeof exports?exports.js_beautify=A:"undefined"!==typeof window?window.js_beautify=A:"undefined"!==typeof global&&(global.js_beautify=A)})();