var __extends=(this&&this.__extends)||(function(){var extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}})();var ForecastDownloader=(function(_super){__extends(ForecastDownloader,_super);function ForecastDownloader(Url){var _this=_super.call(this,Url)||this;_this.Url=Url;return _this}ForecastDownloader.prototype.DownloadCallback=function(o){_super.prototype.DownloadCallback.call(this,o);var parsedObject=null;if(o){parsedObject=this.ParseForecast(o.objects.LondonAirForecast);dataDownloader.DownloadCompleted({hasChanged:o.hasChanged,hash:o.hash,objects:parsedObject,hasData:(parsedObject.Forecast.length>0),settings:settings},this)}else{dataDownloader.DownloadCompleted(null,this)}};ForecastDownloader.prototype.ParseForecast=function(json){var casts=[];if(Object.prototype.toString.call(json.CurrentForecast)==='[object Array]'){casts=json.CurrentForecast;delete json.CurrentForecast}for(var p in json){if(p["ForecastID"]){casts[casts.length]=p;delete json[p]}}json.DisclaimerText=$.trim(json.DisclaimerText).replace(/(\r\n|\n|\r)/gm,'<br/>');for(var i=0;i<casts.length;i++){var obj=casts[i];obj.ForecastBand=$.trim(obj.ForecastBand.toUpperCase());var start=moment(obj.ValidFrom,'DD/MM/YYYY HH:mm:ss Z');var end=moment(obj.ValidTo,'DD/MM/YYYY HH:mm:ss Z');var now=moment();if(obj.ForecastType&&$.trim(obj.ForecastType).length>0){obj.IsCurrent=(obj.ForecastType&&obj.ForecastType.toLowerCase()==='current'&&obj.ForecastType.toLowerCase()!=='future')}else{obj.IsCurrent=(now.isAfter(start)&&now.isBefore(end))}obj.IsCurrentStr=obj.IsCurrent.toString().toLowerCase();if(obj.IsCurrent){obj.HeaderText='Currently - '+obj.ForecastBand}else{obj.HeaderText='Forecast - '+obj.ForecastBand.replace('NONE','Not Issued')}obj.PublishedDateTime=moment(obj.PublishedDateTime,'DD/MM/YYYY HH:mm:ss Z').toDate();obj.ValidFrom=start.format('DD MMM @ HH:mm');obj.ValidTo=end.format('DD MMM @ HH:mm');obj.ImageUrl='images/forecast/'+$.trim(obj.ForecastBand).replace(' ','')+'.png';obj.ForecastText=$("<div/>").html($.trim(obj.ForecastText).replace(/(\r\n|\n|\r)/gm,'<br/>')).text();obj.More=(i<casts.length-1);obj.ShowDetails=obj.ForecastBand.toUpperCase()!='NONE';switch(obj.ForecastBand.toUpperCase()){case'LOW':obj.BandHexColor='#339900';break;case'MODERATE':obj.BandHexColor='#FF6600';break;case'HIGH':obj.BandHexColor='#990000';break;case'VERYHIGH':obj.BandHexColor='#000000';break;default:obj.BandHexColor='#999999';break}}casts.sort(this.CompareForecast);json.Forecast=casts;return json};ForecastDownloader.prototype.CompareForecast=function(a,b){if(a.IsCurrent==b.IsCurrent)return 0;else if(a.IsCurrent>b.IsCurrent)return-1;else if(a.IsCurrent<b.IsCurrent)return 1};return ForecastDownloader}(XmlDownloader))