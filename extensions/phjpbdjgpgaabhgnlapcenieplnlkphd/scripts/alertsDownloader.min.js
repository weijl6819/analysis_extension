var __extends=(this&&this.__extends)||(function(){var extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}})();var AlertsDownloader=(function(_super){__extends(AlertsDownloader,_super);function AlertsDownloader(Url){var _this=_super.call(this,Url)||this;_this.Url=Url;return _this}AlertsDownloader.prototype.DownloadCallback=function(o){_super.prototype.DownloadCallback.call(this,o);if(o){var parsedObjects=[];if(o.objects!=null&&o.objects.notifications!=null&&o.objects.notifications.region!=null&&o.objects.notifications.region.site!=null){parsedObjects=this.ParseAlerts(o.objects.notifications.region.site||[])}dataDownloader.DownloadCompleted({hasChanged:o.hasChanged,hash:o.hash,objects:parsedObjects,hasData:(parsedObjects.length>0),settings:settings},this)}else{dataDownloader.DownloadCompleted(null,this)}};AlertsDownloader.prototype.CompareSiteName=function(a,b){if(a.sitename==b.sitename)return 0;else if(a.sitename<b.sitename)return-1;else if(a.sitename>b.sitename)return 1};AlertsDownloader.prototype.ParseAlerts=function(json){if(Object.prototype.toString.call(json)!=='[object Array]'){json=[json]}for(var siteIdx=0;siteIdx<json.length;siteIdx++){var siteObj=json[siteIdx];var siteName=$.trim(siteObj.sitename.replace(' and ',' & '));if(siteName.indexOf('-')>0){siteName=$.trim(siteName.substring(siteName.indexOf('-')+1))}siteObj.sitename=siteName;if(!siteObj.species||siteObj.species==null)siteObj.species=[];if(Object.prototype.toString.call(siteObj.species)!='[object Array]'){siteObj.species=[siteObj.species]}var speciesNodes=siteObj.species;for(var speciesIdx=0;speciesIdx<speciesNodes.length;speciesIdx++){var speciesObj=speciesNodes[speciesIdx];speciesObj.dataend=moment(speciesObj.dataend).toDate();speciesObj.newaqindex=parseInt(speciesObj.newaqindex);speciesObj.prevaqindex=parseInt(speciesObj.prevaqindex);speciesObj.IndexSourceIsTrigger=(speciesObj.IndexSource=='Trigger');speciesObj.PrevIndexSourceIsTrigger=(speciesObj.prevIndexSource=='Trigger');speciesObj.AlertMessage=this.GetAlertMessage(speciesObj);speciesObj.HexColor=this.GetIndexHexColor(speciesObj.newaqindex);speciesObj.IndexPrefix='';if(speciesObj.IndexSourceIsTrigger){speciesObj.IndexPrefix='T'}speciesObj.PrevIndexPrefix='';if(speciesObj.PrevIndexSourceIsTrigger){speciesObj.PrevIndexPrefix='T'}}}if(json.length==1&&json[0].sitecode==''){json=[]}json.sort(this.CompareSiteName);return json};AlertsDownloader.prototype.GetIndexHexColor=function(idx){switch(parseInt(idx)){case 1:return'#A5CF7C';case 2:return'#6AA940';case 3:return'#2B8200';case 4:return'#DFB386';case 5:return'#E68A45';case 6:return'#EE5F00';case 7:return'#F30000';case 8:return'#C60000';case 9:return'#990000';case 10:return'#000000';default:return'#CCCCCC'}};AlertsDownloader.prototype.GetAlertMessage=function(speciesObj){var msg;if(speciesObj.IndexSource=='Trigger'){if(speciesObj.speciescode=='O3'){msg=speciesObj.speciesname+' predicted to be '+speciesObj.newband+' for the next few hours.'}else if(speciesObj.speciescode=='PM10'||speciesObj.speciescode=='PM25'){msg=speciesObj.speciesname+' predicted to be '+speciesObj.newband+' today.'}else{msg=speciesObj.speciesname+' predicted to be '+speciesObj.newband}}else{if(speciesObj.newaqindex>speciesObj.prevaqindex){msg=speciesObj.speciesname+' increased from '+speciesObj.prevband+' to '+speciesObj.newband}else{msg=speciesObj.speciesname+' decreased from '+speciesObj.prevband+' to '+speciesObj.newband}}return msg};return AlertsDownloader}(XmlDownloader))