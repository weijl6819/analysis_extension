var __extends=(this&&this.__extends)||(function(){var extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}})();var LayersDownloader=(function(_super){__extends(LayersDownloader,_super);function LayersDownloader(Url){var _this=_super.call(this,Url)||this;_this.Url=Url;return _this}LayersDownloader.prototype.DownloadCallback=function(o){_super.prototype.DownloadCallback.call(this,o);var parsedObjects=null;if(o&&o.objects&&o.objects.layers&&o.objects.layers.layer){parsedObjects=this.ParseLayers(o.objects.layers.layer||[]);dataDownloader.DownloadCompleted({hasChanged:o.hasChanged,hash:o.hash,objects:parsedObjects,hasData:(parsedObjects.length>0),settings:settings},this)}else{dataDownloader.DownloadCompleted(null,this)}};LayersDownloader.prototype.ParseLayers=function(json){if(Object.prototype.toString.call(json)!=='[object Array]'){json=[json]}for(var layerIdx=0;layerIdx<json.length;layerIdx++){var layerObj=json[layerIdx];layerObj.Index=layerIdx;layerObj.IsAnnual=(layerObj.LayerType.toLowerCase()=='annual');layerObj.IsHourly=(layerObj.LayerType.toLowerCase()=='hourly');var startMoment=moment(layerObj.datastart,'DD/MM/YYYY HH:mm:ss Z');var endMoment=moment(layerObj.dataend,'DD/MM/YYYY HH:mm:ss Z');layerObj.dataend=endMoment.toDate();layerObj.datastart=startMoment.toDate();layerObj.Year=startMoment.format('YYYY');layerObj.Is2010=(layerObj.Year.toString()==='2010');layerObj.layercode=layerObj.layercode.toUpperCase();if(layerObj.IsHourly){layerObj.MenuLabel=''}if(layerObj.IsAnnual){layerObj.MenuLabel='['+layerObj.Year+']'}layerObj.LayerUrl=layerObj.LayerUrl.replace('http://','https://');layerObj.SwitchableFeatureLayer=parseInt(layerObj.SwitchableFeatureLayer);layerObj.CurrentToAnnualRatio=parseFloat(layerObj.CurrentToAnnualRatio)}return json};return LayersDownloader}(XmlDownloader))