var __extends=(this&&this.__extends)||(function(){var extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b})||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}})();var NewsDownloader=(function(_super){__extends(NewsDownloader,_super);function NewsDownloader(Url){var _this=_super.call(this,Url)||this;_this.Url=Url;return _this}NewsDownloader.prototype.DownloadCallback=function(o){_super.prototype.DownloadCallback.call(this,o);var parsedObjects=null;if(o&&o.objects&&o.objects.rss&&o.objects.rss.channel&&o.objects.rss.channel.item){parsedObjects=this.ParseNews(o.objects.rss.channel.item||[]);dataDownloader.DownloadCompleted({hasChanged:o.hasChanged,hash:o.hash,objects:parsedObjects,hasData:(parsedObjects.length>0),settings:settings},this)}else{dataDownloader.DownloadCompleted(null,this)}};NewsDownloader.prototype.ParseNews=function(json){var news=[];if(Object.prototype.toString.call(json)!=='[object Array]'){json=[json]}var articleNumber=1;for(var itemIdx=0;itemIdx<json.length;itemIdx++){var story={articleNumber:0,Description:null,Title:null,PublishedDate:null,PublishedDateString:null,Link:null,ImageUrl:null,ImageTitle:null,ImageLink:null,ShowImage:false};var newsDescription=$.trim(json[itemIdx].description);newsDescription=newsDescription.replace('<![CDATA[','').replace(']]>','');if(newsDescription.indexOf('&gt;')>=0){newsDescription=$("<div/>").html(newsDescription).text()}newsDescription=newsDescription.replace('&gt;','>').replace('&lt;','<');newsDescription=newsDescription.replace(/\<br \/\>/gm,'<br/>');newsDescription=newsDescription.replace(/\<br\/\><br\/\><br\/\>/gm,'<br/><br/>');newsDescription=newsDescription.replace(/\<br\/\><br\/\><br\/\>/gm,'<br/><br/>');story.Description=newsDescription;story.Link=json[itemIdx].link;story.PublishedDate=moment(json[itemIdx].pubDate).toDate();if(story.PublishedDate.toString()==="Invalid Date"){story.PublishedDate=moment(json[itemIdx].pubDate,'dd/MM/YYYY').toDate()}story.PublishedDateString=moment(story.PublishedDate).format('ddd DD MMM YYYY');story.Title=$("<div/>").html($.trim(json[itemIdx].title)).text();var lowerUrl1='';if(json[itemIdx].enclosure&&json[itemIdx].enclosure.url){lowerUrl1=$.trim(json[itemIdx].enclosure.url)}if(lowerUrl1.lastIndexOf('.jpg')>=0||lowerUrl1.lastIndexOf('.jpeg')>=0||lowerUrl1.lastIndexOf('.png')>=0||lowerUrl1.lastIndexOf('.gif')>=0||lowerUrl1.lastIndexOf('.tiff')>=0){story.ImageUrl=lowerUrl1;story.ImageTitle=story.Title;story.ImageLink=story.Link;story.ShowImage=true}else{var lowerUrl2='';if(json[itemIdx].image&&json[itemIdx].image.url){lowerUrl2=$.trim(json[itemIdx].image.url)}if(lowerUrl2.lastIndexOf('.jpg')>=0||lowerUrl2.lastIndexOf('.jpeg')>=0||lowerUrl2.lastIndexOf('.png')>=0||lowerUrl2.lastIndexOf('.gif')>=0){story.ImageUrl=lowerUrl2;story.ImageTitle=json[itemIdx].image.title;story.ImageLink=json[itemIdx].image.link;story.ShowImage=true}}story.articleNumber=articleNumber;articleNumber++;news[itemIdx]=story}if(news!=null&&news.length>0){for(var i=0;i<news.length;i++){news[i].articleNumber=i+1}}news=news.slice(0,settings.maxNewsItemsToDisplay);return news};NewsDownloader.prototype.SortStories=function(a,b){try{if(a.PublishedDate==b.PublishedDate)return 0;else if(a.PublishedDate>b.PublishedDate)return-1;else if(a.PublishedDate<b.PublishedDate)return 1}catch(e){return 0}};return NewsDownloader}(XmlDownloader))