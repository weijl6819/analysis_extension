var settings;var dataDownloader;var popPage;var hostObj;$(document).ready(function(e){debug('Ready!');hostObj=getHostObj();settings=new Settings;if(chromeObjSupported()){UpdateAlertCount(0);SetBadgeText('busy')}dataDownloader=new DataDownloader(DataChangedBg,DataUnchangedBg);dataDownloader.Start()});function DataUnchangedBg(result){debug('DataUnchangedBg',result);if(chromeObjSupported()){SetBadgeIndex(result.authorityData.objects.overallMaxIndex);UpdateAlertCount(result.alertData)}}function DataChangedBg(result){debug('DataChangedBg',result);if(chromeObjSupported()){SetBadgeIndex(result.authorityData.objects.overallMaxIndex);UpdateAlertCount(result.alertData)}}function SetBadgeIndex(maxIndex){hostObj.browserAction.setIcon({path:'images/'+settings.logoPath+'/bandIcons/'+maxIndex+'.png'});var hex=getIndexHexColor(maxIndex);hostObj.browserAction.setBadgeBackgroundColor({color:hex})}function SetBadgeText(text){hostObj.browserAction.setBadgeText({text:text})}function SetBadgeTitle(text){hostObj.browserAction.setTitle({title:text})}function UpdateAlertCount(alertData){if(alertData!=null&&alertData.objects!=null&&alertData.hasChanged&&alertData.hasData&&alertData.objects.length>0){SetBadgeText(alertData.objects.length.toString());SetBadgeTitle(alertData.objects.length+' alerts')}else{SetBadgeText('');SetBadgeTitle(settings.appName)}}