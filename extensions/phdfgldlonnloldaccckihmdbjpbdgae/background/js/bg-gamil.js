"use strict";var bgGmail={idArryLen:0,noticationArray:[],isOpentGmailNotication:"",isOpentGmailRingNotication:"",init:function(){try{this.isOpentGmailNotication=infinity.get("infinity-settings").isOpentGmailNotication,this.isOpentGmailNotication?this.getGmailNotication():this.dellEmailIdArray(),this.Ring(),chrome.notifications.onClicked.addListener(this.replyBtnClick1),chrome.notifications.onClosed.addListener(this.replyClosed)}catch(i){}},replyClosed:function(i,t){try{t&&chrome.notifications.clear(i,function(i){})}catch(i){}},audioNotification:function(){try{new Audio("./data/ring.mp3").play()}catch(i){}},replyBtnClick1:function(i){try{bgGmail.replyClosed(i,!0),-1!=i.indexOf("://")&&window.open(i)}catch(i){}},Ring:function(){try{this.isOpentGmailRingNotication=infinity.get("infinity-settings").isOpentGmailRingNotication}catch(i){}},alertNoticationShow:function(){try{var i=this,t=this.noticationArray;if(0===this.noticationArray.length)return;var a=localStorage.getItem("emailIdArray"),e=!1;if(a){(a=JSON.parse(a)).length;e=a instanceof Array}for(var n={type:"basic",contextMessage:"",title:"",message:"",iconUrl:"img/gmail.png",isClickable:!0},r=0;r<t.length;r++)!function(r){var o=t[r].id;n.title=t[r].title,n.message=t[r].summary,n.contextMessage=t[r].name+"("+t[r].email+")",i.isOpentGmailRingNotication&&i.audioNotification(),e&&(a.length>i.idArryLen&&a.pop(),a.unshift(o)),chrome.notifications.create(t[r].href,n,function(){})}(r);0!=a.length&&e&&localStorage.setItem("emailIdArray",JSON.stringify(a)),i.noticationArray=[]}catch(i){}},dealId:function(i){try{var t=i.split(":");return t[t.length-1]}catch(i){return"a"}},dealEmailData:function(i,t){try{if(this.noticationArray=[],!this.isOpentGmailNotication)return;var a=t.length;if(i.feed&&i.feed.entry){var e=i.feed.entry;if(e instanceof Array){for(var n=0,r=e.length;n<r;n++)if(e[n].id){var o=this.dealId(e[n].id);if(0==a)t.push(o);else if(-1==t.indexOf(o)){var l={id:"",title:"",name:"",email:"",href:"",summary:""};if(e[n].title){var c=e[n].title;l.title=c}if(e[n].author&&e[n].author.name&&e[n].author.email){var m=e[n].author.name,s=e[n].author.email;l.name=m,l.email=s}if(e[n].link&&e[n].link._href){var f=e[n].link._href;l.href=f}e[n].summary&&(l.summary=e[n].summary),l.id=o,this.noticationArray.push(l)}}0==a&&0!==t.length&&localStorage.setItem("emailIdArray",JSON.stringify(t))}}}catch(i){}},dellEmailIdArray:function(){try{localStorage.getItem("emailIdArray")&&localStorage.removeItem("emailIdArray")}catch(i){}},getGmailNotication:function(){try{var i=this,t="https://mail.google.com/mail/u/0/feed/atom/?ibxr=0&timestamp="+(new Date).getTime();$.ajax({url:t,dataType:"xml"}).done(function(t,a,e){if(200===e.status)try{var n=(new X2JS).xml2json(t);i.idArryLen=2*n.feed.entry.length;var r=localStorage.getItem("emailIdArray");r?(r=JSON.parse(r),bgGmail.dealEmailData(n,r),bgGmail.alertNoticationShow()):(r=[],bgGmail.dealEmailData(n,r))}catch(i){}}).fail(function(i){bgGmail.dellEmailIdArray()}).always(function(){i.isOpentGmailNotication&&setTimeout(function(){bgGmail.getGmailNotication()},5e3)})}catch(i){}}};