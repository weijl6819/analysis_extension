"use strict";var usWeatherDict={19:{color:"#B9B18F",img:"blowingsand.png"},22:{color:"#B9B18F",img:"ash.png"},26:{color:"#27CDFF",img:"cloudy.png"},27:{color:"#27CDFF",img:"cloudy.png"},28:{color:"#27CDFF",img:"cloudy.png"},29:{color:"#27CDFF",img:"cloudy.png"},30:{color:"#27CDFF",img:"cloudy.png"},44:{color:"#27CDFF",img:"cloudy.png"},9:{color:"#A1BAC6",img:"drizzle.png"},20:{color:"#AEAEAE",img:"fog.png"},21:{color:"#808080",img:"fogandhaze.png"},17:{color:"#A1BAC6",img:"hail.png"},41:{color:"#6C828D",img:"heavysnow.png"},43:{color:"#6C828D",img:"heavysnow.png"},13:{color:"#A1BAC6",img:"lightsnow.png"},14:{color:"#A1BAC6",img:"lightsnow.png"},15:{color:"#A1BAC6",img:"lightsnow.png"},16:{color:"#A1BAC6",img:"lightsnow.png"},25:{color:"#A1BAC6",img:"lightsnow.png"},31:{color:"#211A3E",img:"moon.png"},33:{color:"#211A3E",img:"moon.png"},6:{color:"#A1BAC6",img:"rainandsnow.png"},7:{color:"#A1BAC6",img:"rainandsnow.png"},18:{color:"#A1BAC6",img:"rainandsnow.png"},11:{color:"#A1BAC6",img:"shower.png"},12:{color:"#A1BAC6",img:"shower.png"},40:{color:"#A1BAC6",img:"shower.png"},8:{color:"#95BAD9",img:"sleet.png"},10:{color:"#95BAD9",img:"sleet.png"},32:{color:"#27CDFF",img:"sunny.png"},34:{color:"#27CDFF",img:"sunny.png"},3:{color:"#A1BAC6",img:"thunder.png"},4:{color:"#A1BAC6",img:"thunder.png"},37:{color:"#A1BAC6",img:"thunderstorm.png"},38:{color:"#A1BAC6",img:"thunderstorm.png"},39:{color:"#A1BAC6",img:"thunderstorm.png"},45:{color:"#A1BAC6",img:"thunderstorm.png"},47:{color:"#A1BAC6",img:"thunderstorm.png"},35:{color:"#A1BAC6",img:"thunderstormandhail.png"},0:{color:"#808080",img:"typhoon.png"},1:{color:"#808080",img:"typhoon.png"},2:{color:"#808080",img:"typhoon.png"},23:{color:"#27CDFF",img:"wind.png"},24:{color:"#27CDFF",img:"wind.png"},5:{color:"#A1BAC6",img:"rainandsnow.png"},46:{color:"#A1BAC6",img:"snowshowers.png"}},bgWeather={init:function(){var e=this,t={citys:[],isFirst:!0,lastUpdateTime:null};infinity.init("infinity-weather",t),infinity.get("infinity-weather").isFirst?e.getPosition(function(t){var i={citys:t,isFirst:!0};infinity.set("infinity-weather",i),e.getWeather()}):e.getWeather(),infinity.onMessage("reInitWeather",function(){e.getPosition(function(t){var i={citys:t,isFirst:!0};infinity.set("infinity-weather",i),e.getWeather()})}),infinity.onMessage("removeCity",function(e){var t=e.index,i=infinity.get("infinity-weather");i.citys.splice(t,1),infinity.set("infinity-weather",i),infinity.sendMessage("getWeatherDone"),infinity.doSyncData()}),setInterval(function(){e.update()},12e5),infinity.onMessage("addWeatherCityDone",function(){infinity.sendMessage("onAddWeatherCityDone"),infinity.doSyncData()})},handleWeatherResult:function(e,t,i){var n={name:e,woeid:t};if(0==i.query.count)return!1;var o={};o.cityName=i.query.results.channel.location.city,o.time=i.query.results.channel.lastBuildDate,o.Rtemp=i.query.results.channel.item.condition.temp,o.weather=i.query.results.channel.item.condition.code,o.weatherName=i.query.results.channel.item.forecast[0].text,o.Htemp=i.query.results.channel.item.forecast[0].high,o.Ltemp=i.query.results.channel.item.forecast[0].low,o.wind=i.query.results.channel.wind.speed;var r=1.609344*o.wind;o.wind=r<1?0:1<=r&&r<5?1:5<=r&&r<11?2:11<=r&&r<19?3:19<=r&&r<28?4:28<=r&&r<38?5:38<=r&&r<49?6:49<=r&&r<61?7:61<=r&&r<74?8:74<=r&&r<88?9:88<=r&&r<102?10:102<=r&&r<117?11:r>=117?12:0,o.week=i.query.results.channel.item.forecast[0].day,o.humidity=i.query.results.channel.atmosphere.humidity,o.pressure=i.query.results.channel.atmosphere.pressure,o.weather in usWeatherDict?(o.weatherIcon=usWeatherDict[o.weather].img,o.weatherColor=usWeatherDict[o.weather].color):(o.weatherIcon="sunny.png",o.weatherColor="#27CDFF"),n.today=o,n.days=[];for(var a=1;a<=4;a++){var s={weather:i.query.results.channel.item.forecast[a].code,Ltemp:i.query.results.channel.item.forecast[a].low,Htemp:i.query.results.channel.item.forecast[a].high,weatherName:i.query.results.channel.item.forecast[a].text,week:i.query.results.channel.item.forecast[a].day,date:i.query.results.channel.item.forecast[a].date};s.weather in usWeatherDict?(s.weatherIcon=usWeatherDict[s.weather].img,s.weatherColor=usWeatherDict[s.weather].color):(s.weatherIcon="sunny.png",s.weatherColor="#27CDFF"),n.days.push(s)}return{status:200,desc:"OK",data:n}},queryWeather:function(e,t,i){var n=this,o="https://query.yahooapis.com/v1/public/yql?q=select * from weather.forecast where woeid="+t+"&format=json";$.getJSON(o,function(o){var r=n.handleWeatherResult(e,t,o);r?i(r):infinity.get("infinity-weather").isFirst&&infinity.sendMessage("weather-error")})},getWeather:function(e){function t(){var a=e[i].data.name,s=e[i].data.woeid;r.queryWeather(a,s,function(e){if(i+=1,o.push(e),i<n)t();else{r.citys=o;var a=infinity.get("infinity-weather");a.citys=o,a.isFirst=!1,a.lastUpdateTime=(new Date).toLocaleString(),infinity.set("infinity-weather",a),infinity.sendMessage("getWeatherDone")}})}var i,n,o,r,e=infinity.get("infinity-weather").citys;i=0,n=e.length,o=[],r=this,t()},isHasCity:function(e,t){var i=infinity.lang,n=infinity.url+"is-has-city?city="+encodeURIComponent(e)+"&lang="+i;$.getJSON(n,function(e){200==e.status?t(!0,e.data.data[0].woeid,e.data.data[0].city,e.data.data[0]):t(!1)})},getPosition:function(e){var t=this;$.getJSON("http://int.dpool.sina.com.cn/iplookup/iplookup.php?format=json",function(i){if(i&&""!=i.city){var n=i.city;i.country;t.isHasCity(n,function(t,i,n,o){chrome.i18n.getUILanguage();t?(infinity.setting("location",o),e([{data:{name:n,woeid:i}}])):e([{data:{name:infinity.i18n("new_delhi"),woeid:28743736}}])})}else e([{data:{name:infinity.i18n("new_delhi"),woeid:28743736}}])}).fail(function(){setTimeout(function(){infinity.sendMessage("weather-error")},1e3)})},update:function(){var e=this;infinity.get("infinity-weather").isFirst?e.getPosition(function(t){var i={citys:t,isFirst:!1};infinity.set("infinity-weather",i),e.getWeather()}):e.getWeather()}};