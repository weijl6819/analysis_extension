"use strict";!function(){var a=parseInt(window.devicePixelRatio*window.screen.width);a=a<=1280?1280:a<=1920?1920:2560,window.bgWallpaper={intervalId:null,ajaxGettingNewDayWallpaper:!1,wallaperWidth:a,init:function(){var a=this;a.checkEverydayWallpaper(),infinity.onMessage("setWallpaper",function(a){var e=a.type,i=a.src,n=a.blur,t=a.color||"transparent";i&&0==i.indexOf("blob:")&&infinity.setting("currentBg","local"),infinity.setWallpaper(e,i,t,n,function(a){a.error?infinity.sendMessage("setWallpaperFail"):(infinity.sendMessage("setWallpaperDone"),infinity.doSyncWallpaper())})}),infinity.onMessage("cancalSetWallpaper",function(){infinity.imageXhr.abort()}),infinity.onMessage("setRandWallPaper",function(){var e,i=infinity.url+"random-wallpaper?t="+(new Date).getTime(),n=a.wallaperWidth;$.get(i,function(a){if(200==a.status||304==a.status)try{e=a.data[0].src.rawSrc;var i=e=e+"?imageView2/2/w/"+n+"/format/webp";infinity.setWallpaper("image",i,null,0,function(e){e.error?infinity.sendMessage("setRandWallPaperFail"):(infinity.setting("currentBg",a.data[0].src.rawSrc),infinity.sendMessage("setRandWallPaperDone"),infinity.doSyncWallpaper())})}catch(a){void 0,infinity.sendMessage("setRandWallPaperFail")}else void 0,infinity.sendMessage("setRandWallPaperFail")})})},checkEverydayWallpaper:function(){var a=this;setInterval(function(){infinity.setting("everydayWallpaper")&&infinity.isNewDay("wallpaper",function(){a.getNewWallpaper()})},6e4)},getNewWallpaper:function(a){var e=this,i=(infinity.get("infinity-bg"),infinity.setting("lastWallpaperId")||""),n=infinity.setting("wallpaperSource").value||"infinity",t=infinity.url+"daily-wallpaper?source="+n+"&_id="+i+"&t="+(new Date).getTime();e.ajaxGettingNewDayWallpaper||(e.ajaxGettingNewDayWallpaper=$.get(t,function(a){try{if(200==a.status){var i=a.data[0].src.rawSrc;i=i+"?imageView2/2/w/"+e.wallaperWidth+"/format/webp",infinity.setWallpaper("image",i,null,blur,function(e){e.error||(infinity.setting("lastWallpaperId",a.data[0]._id),infinity.setting("currentBg",a.data[0].src.rawSrc),infinity.sendMessage("setWallpaperDone"))})}}catch(a){e.ajaxGettingNewDayWallpaper=!1}}).always(function(){e.ajaxGettingNewDayWallpaper=!1}))}}}();