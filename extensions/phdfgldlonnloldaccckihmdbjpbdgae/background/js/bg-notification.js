"use strict";var notiSocket=io.connect("https://ws.infinitynewtab.com/notification",{transports:["websocket"]}),bgNotification={init:function(){self=this,infinity.init("infinity-notifications",[]),infinity.onMessage("dellAnocation",function(i){var n=infinity.get("infinity-notifications"),t=n.filter(function(n,t){if(n.time==i.time)return t});0===t&&infinity.set("infinity-notifications-latelyid",i.time),n.splice(t,1),infinity.set("infinity-notifications",n),infinity.sendMessage("infinity-noticationsDone")}),infinity.onMessage("dellAllnocation",function(){var i=infinity.get("infinity-notifications");infinity.set("infinity-notifications-latelyid",i[0].time),infinity.set("infinity-notifications",[]),infinity.sendMessage("infinity-noticationsDone")}),notiSocket.on("connect",function(){var i={type:"getLatestUnexpireNotification"};notiSocket.emit("toServer",i)}),notiSocket.on("toClient",function(i){var n=i;void 0;try{if(200==n.status){var t=n.notifications;if(!t)return;var e=t.language,o=chrome.i18n.getUILanguage();if(-1==["zh-CN","en-US"].indexOf(o)&&(o="infinity-else"),-1!=e.indexOf(o)){var f=t.time,s=infinity.get("infinity-notifications-latelyid");if(s&&parseInt(s)>=f)return;var a=infinity.get("infinity-notifications");if(a instanceof Array){for(var c=!1,r=0;r<a.length;r++)a[r].time==f&&(c=!0);if(c)return;a.unshift(t),infinity.set("infinity-notifications-latelyid",f),infinity.set("infinity-notifications",a)}if(t.isAlert){var y,l=$("<div></div>");l.html(t.richText),y=l.text().trim(),void 0;t.title;t.link&&t.link+"?time="+f}}}}catch(i){void 0}})},checkIsHtml:function(i){return/<[^>]+>/g.test(i)}};