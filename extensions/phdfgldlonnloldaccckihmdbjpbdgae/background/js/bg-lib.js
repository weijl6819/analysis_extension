"use strict";function base64ArrayBuffer(n){for(var t,i,e,r,o="",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=new Uint8Array(n),f=s.byteLength,c=f%3,g=f-c,u=0;u<g;u+=3)t=(258048&(r=s[u]<<16|s[u+1]<<8|s[u+2]))>>12,i=(4032&r)>>6,e=63&r,o+=a[(16515072&r)>>18]+a[t]+a[i]+a[e];return 1==c?(t=(3&(r=s[g]))<<4,o+=a[(252&r)>>2]+a[t]+"=="):2==c&&(t=(1008&(r=s[g]<<8|s[g+1]))>>4,i=(15&r)<<2,o+=a[(64512&r)>>10]+a[t]+a[i]+"="),o}function getAddPosition(){var n=infinity.get("infinity-settings"),t=infinity.get("infinity-icons"),i=n.row*n.column,e=t.length;for(var r in t)if(t[r].length<i){e=r;break}return e}infinity.reset=function(){for(var n in localStorage)localStorage.removeItem(n);window.location.href=window.location.href},infinity.isDefaultBg=function(n){return n==chrome.extension.getURL("/background/data/india-default.jpg")?"https://infinitypro-img.infinitynewtab.com/findaphoto/bigLink/india-default.jpg?imageView2/2/w/2560/format/webp":n},infinity.init=function(n,t,i,e){try{i?chrome.storage.local.get(n,function(i){if(!i.hasOwnProperty(n)){var r={};r[n]=JSON.stringify(t),chrome.storage.local.set(r,function(){e&&e()})}}):localStorage[n]||(localStorage[n]=JSON.stringify(t))}catch(n){}},infinity.onBroadcast=function(n,t){chrome.runtime.onMessage.addListener(function(i,e,r){i.message;i.name=="infinity-broadcast-"+n&&t(i,e,r)})},infinity.imageXhr=null,infinity.image2base64=function(n,t){try{if("http"==n.substr(0,4)||"chrome-extension://"==n.substr(0,19)||"chrome://extension-icon/"==n.substr(0,24)||"blob:"==n.substr(0,5)||"filesystem:"==n.substr(0,11))infinity.imageXhr=new XMLHttpRequest,infinity.imageXhr.open("GET",n,!0),infinity.imageXhr.responseType="arraybuffer",infinity.imageXhr.timeout=15e3,infinity.imageXhr.onload=function(n){var i=base64ArrayBuffer(n.currentTarget.response);t&&t(i)},infinity.imageXhr.onerror=function(){t&&t(!1)},infinity.imageXhr.ontimeout=function(n){t&&t(!1)},infinity.imageXhr.send();else{var i=n.indexOf(";base64,");if(i>0)e=n.substr(i+8,n.length);else var e=n;t&&t(e)}}catch(n){t&&t(!1)}},infinity.base64toBlobUrl=function(n,t,i){try{t=t||"",i=i||512;for(var e=atob(n),r=[],o=0;o<e.length;o+=i){for(var a=e.slice(o,o+i),s=new Array(a.length),f=0;f<a.length;f++)s[f]=a.charCodeAt(f);var c=new Uint8Array(s);r.push(c)}var g=new Blob(r,{type:t});return window.URL.createObjectURL(g)}catch(n){return void void 0}},infinity.setWallpaper=function(n,t,i,e,r){function o(n,t,i){n.error=!0,n.desc=t,i&&i(n)}function a(n,t,i,e,r,o){infinity.set("infinity-wallpaper",{src:n,originalSrc:e},!0,function(){var e=infinity.base64toBlobUrl(n,"image/webp");t.color="transparent",t.src=e,infinity.set("infinity-bg",t),URL.revokeObjectURL(i.src),o&&o(r)})}var s={error:!1,desc:"success"};try{var f=infinity.get("infinity-bg")||{},c=infinity.get("infinity-bg")||{};c.type=n,"color"===n?(c.color=i,c.src=null,infinity.set("infinity-bg",c),infinity.setting("currentBg",!1),URL.revokeObjectURL(f.src),r&&r(s)):e>0?infinity.setBlurWallpaperBase64(t,e,function(n){n?a(n,c,f,t,s,r):o(s,"network error 0",r)}):infinity.image2base64(t,function(n){n?(t=infinity.isDefaultBg(t),a(n,c,f,t,s,r)):o(s,"network error 1",r)})}catch(n){o(s,"error",r)}};var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(n){var t,i,e,r,o,a,s,f="",c=0;for(n=Base64._utf8_encode(n);c<n.length;)r=(t=n.charCodeAt(c++))>>2,o=(3&t)<<4|(i=n.charCodeAt(c++))>>4,a=(15&i)<<2|(e=n.charCodeAt(c++))>>6,s=63&e,isNaN(i)?a=s=64:isNaN(e)&&(s=64),f=f+this._keyStr.charAt(r)+this._keyStr.charAt(o)+this._keyStr.charAt(a)+this._keyStr.charAt(s);return f},decode:function(n){var t,i,e,r,o,a,s="",f=0;for(n=n.replace(/[^A-Za-z0-9\+\/\=]/g,"");f<n.length;)t=this._keyStr.indexOf(n.charAt(f++))<<2|(r=this._keyStr.indexOf(n.charAt(f++)))>>4,i=(15&r)<<4|(o=this._keyStr.indexOf(n.charAt(f++)))>>2,e=(3&o)<<6|(a=this._keyStr.indexOf(n.charAt(f++))),s+=String.fromCharCode(t),64!=o&&(s+=String.fromCharCode(i)),64!=a&&(s+=String.fromCharCode(e));return s=Base64._utf8_decode(s)},_utf8_encode:function(n){n=n.replace(/\r\n/g,"\n");for(var t="",i=0;i<n.length;i++){var e=n.charCodeAt(i);e<128?t+=String.fromCharCode(e):e>127&&e<2048?(t+=String.fromCharCode(e>>6|192),t+=String.fromCharCode(63&e|128)):(t+=String.fromCharCode(e>>12|224),t+=String.fromCharCode(e>>6&63|128),t+=String.fromCharCode(63&e|128))}return t},_utf8_decode:function(n){for(var t="",i=0,e=0,r=0,o=0;i<n.length;)(e=n.charCodeAt(i))<128?(t+=String.fromCharCode(e),i++):e>191&&e<224?(r=n.charCodeAt(i+1),t+=String.fromCharCode((31&e)<<6|63&r),i+=2):(r=n.charCodeAt(i+1),o=n.charCodeAt(i+2),t+=String.fromCharCode((15&e)<<12|(63&r)<<6|63&o),i+=3);return t}};infinity.setLayout=function(n){var t=n.column,i=n.row,e=t*i,r=infinity.get("infinity-icons"),o=infinity.get("infinity-settings"),a=_.flatten(r,!0),s=_.chunk(a,e);o.row=i,o.column=t,infinity.set("infinity-icons",s),infinity.set("infinity-settings",o),infinity.sendMessage("reLayout")},infinity.setBlurWallpaperBase64=function(n,t,i){try{var e=t,r=document.getElementById("imgCanvas"),o=r.getContext("2d");o.clearRect(0,0,r.width,r.height);var a=new Image;a.src=n,a.onload=function(){var n=parseInt(window.devicePixelRatio*window.screen.width>=2560?2560:window.devicePixelRatio*window.screen.width);if(a.width>n)var t=n,s=Math.round(n/a.width*a.height);else var t=a.width,s=a.height;r.width=t,r.height=s,o.drawImage(a,0,0,r.width,r.height),stackBlurCanvasRGB("imgCanvas",0,0,t,s,e);var f=r.toDataURL("image/jpeg",.85),c=f.indexOf(";base64,");if(c>0)g=f.substr(c+8,f.length);else var g=f;i&&i(g)},a.onerror=function(){i&&i(!1)}}catch(n){i&&i(!1)}},infinity.onNetConnect=function(n){infinity.netStatus||(infinity.netStatus={});var t=(new Date).getTime();infinity.netStatus[t]=navigator.onLine,setInterval(function(){!infinity.netStatus[t]&&navigator.onLine&&n&&n(),infinity.netStatus[t]=navigator.onLine},1e3)},infinity.onDisconnect=function(n){infinity.netStatus||(infinity.netStatus={});var t=(new Date).getTime();infinity.netStatus[t]=navigator.onLine,setInterval(function(){infinity.netStatus[t]&&!navigator.onLine&&n&&n(),infinity.netStatus[t]=navigator.onLine},1e3)},infinity.isNewDay=function(n,t){if(localStorage["DayWith-"+n]){var i=parseInt(localStorage["DayWith-"+n]),e=new Date,r=parseInt(e.toJSON().substr(0,10).replace(/-/gi,""));r>i&&(localStorage["DayWith-"+n]=r,t&&t())}else{var o=(e=new Date).toJSON().substr(0,10).replace(/-/gi,"");localStorage["DayWith-"+n]=o,t&&t()}},infinity.socket=function(n){var t={url:"wss://"+infinity.domain+n.name,ws:null,init:function(){var t=this;t.ws=new WebSocket(t.url),t.ws.infinityId=0,t.ws.onopen=function(t){t.infinitySocketName=n.name,n.event.onopen&&n.event.onopen(t,t.target)},t.ws.onclose=function(i){n.isCheckHeart&&setTimeout(function(){t.checkHeart()},3e3)},t.ws.onmessage=function(t){t.infinitySocketName=n.name,n.event.onmessage&&n.event.onmessage(t,t.target)},t.ws.onerror=function(n){t.ws.close()}},checkHeart:function(){var t=this;t.ws=new WebSocket("wss://"+infinity.domain+n.name),t.ws.infinityId=(new Date).getTime(),t.ws.onopen=function(t){t.infinitySocketName=n.name,n.event.onopen&&n.event.onopen(t,t.target)},t.ws.onclose=function(n){setTimeout(function(){t.checkHeart()},3e3)},t.ws.onmessage=function(t){t.infinitySocketName=n.name,n.event.onmessage&&n.event.onmessage(t,t.target)},t.ws.onerror=function(n){t.ws.close()}}};return t.init(),t.ws};