!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";function i(t){return"number"==typeof t&&!isNaN(t)}function e(t){return void 0===t}function o(t,e){var o=[];return i(e)&&o.push(e),o.slice.apply(t,o)}function s(t,i){var e=o(arguments,2);return function(){return t.apply(i,e.concat(o(arguments)))}}function a(t){var i=t.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return i&&(i[1]!==b.protocol||i[2]!==b.hostname||i[3]!==b.port)}function r(t){var i="timestamp="+(new Date).getTime();return t+(-1===t.indexOf("?")?"?":"&")+i}function n(t){return t?' crossOrigin="'+t+'"':""}function h(t,i){var e;return t.naturalWidth&&!ht?i(t.naturalWidth,t.naturalHeight):(e=document.createElement("img"),e.onload=function(){i(this.width,this.height)},void(e.src=t.src))}function c(t){var e=[],o=t.rotate,s=t.scaleX,a=t.scaleY;return i(o)&&0!==o&&e.push("rotate("+o+"deg)"),i(s)&&1!==s&&e.push("scaleX("+s+")"),i(a)&&1!==a&&e.push("scaleY("+a+")"),e.length?e.join(" "):"none"}function p(t,i){var e,o,s=dt(t.degree)%180,a=(s>90?180-s:s)*Math.PI/180,r=gt(a),n=ut(a),h=t.width,c=t.height,p=t.aspectRatio;return i?(e=h/(n+r/p),o=e/p):(e=h*n+c*r,o=h*r+c*n),{width:e,height:o}}function l(e,o){var s,a,r,n=t("<canvas>")[0],h=n.getContext("2d"),c=0,l=0,d=o.naturalWidth,g=o.naturalHeight,u=o.rotate,f=o.scaleX,m=o.scaleY,v=i(f)&&i(m)&&(1!==f||1!==m),w=i(u)&&0!==u,x=w||v,b=d*dt(f||1),C=g*dt(m||1);return v&&(s=b/2,a=C/2),w&&(r=p({width:b,height:C,degree:u}),b=r.width,C=r.height,s=b/2,a=C/2),n.width=b,n.height=C,x&&(c=-d/2,l=-g/2,h.save(),h.translate(s,a)),w&&h.rotate(u*Math.PI/180),v&&h.scale(f,m),h.drawImage(e,vt(c),vt(l),vt(d),vt(g)),x&&h.restore(),n}function d(i){var e=i.length,o=0,s=0;return e&&(t.each(i,function(t,i){o+=i.pageX,s+=i.pageY}),o/=e,s/=e),{pageX:o,pageY:s}}function g(t,i,e){var o,s="";for(o=i,e+=i;o<e;o++)s+=wt(t.getUint8(o));return s}function u(t){var i,e,o,s,a,r,n,h,c,p,l=new k(t),d=l.byteLength;if(255===l.getUint8(0)&&216===l.getUint8(1))for(c=2;c<d;){if(255===l.getUint8(c)&&225===l.getUint8(c+1)){n=c;break}c++}if(n&&(e=n+4,o=n+10,"Exif"===g(l,e,4)&&(r=l.getUint16(o),((a=18761===r)||19789===r)&&42===l.getUint16(o+2,a)&&(s=l.getUint32(o+4,a))>=8&&(h=o+s))),h)for(d=l.getUint16(h,a),p=0;p<d;p++)if(c=h+12*p+2,274===l.getUint16(c,a)){c+=8,i=l.getUint16(c,a),ht&&l.setUint16(c,1,a);break}return i}function f(t){var i,e=t.replace(Z,""),o=atob(e),s=o.length,a=new $(s),r=new B(a);for(i=0;i<s;i++)r[i]=o.charCodeAt(i);return a}function m(t){var i,e=new B(t),o=e.length,s="";for(i=0;i<o;i++)s+=wt(e[i]);return"data:image/jpeg;base64,"+y(s)}function v(i,e){this.$element=t(i),this.options=t.extend({},v.DEFAULTS,t.isPlainObject(e)&&e),this.isLoaded=!1,this.isBuilt=!1,this.isCompleted=!1,this.isRotated=!1,this.isCropped=!1,this.isDisabled=!1,this.isReplaced=!1,this.isLimited=!1,this.wheeling=!1,this.isImg=!1,this.originalUrl="",this.canvas=null,this.cropBox=null,this.init()}var w=t(window),x=t(document),b=window.location,C=window.navigator,$=window.ArrayBuffer,B=window.Uint8Array,k=window.DataView,y=window.btoa,D="cropper",L="cropper-modal",T="cropper-hide",X="cropper-hidden",Y="cropper-move",M="cropper-crop",W="cropper-disabled",z="mousedown touchstart pointerdown MSPointerDown",R="mousemove touchmove pointermove MSPointerMove",O="mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",F="wheel mousewheel DOMMouseScroll",H="dblclick",P="load."+D,E="error."+D,I="resize."+D,U="build."+D,A="built."+D,S="cropstart."+D,j="cropmove."+D,N="cropend."+D,_="crop."+D,q="zoom."+D,V=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,K=/^data:/,Z=/^data:([^;]+);base64,/,Q=/^data:image\/jpeg.*;base64,/,G="preview",J="action",tt="se",it="sw",et="ne",ot="nw",st="crop",at="move",rt="zoom",nt=t.isFunction(t("<canvas>")[0].getContext),ht=C&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(C.userAgent),ct=Number,pt=Math.min,lt=Math.max,dt=Math.abs,gt=Math.sin,ut=Math.cos,ft=Math.sqrt,mt=Math.round,vt=Math.floor,wt=String.fromCharCode;v.prototype={constructor:v,init:function(){var t,i=this.$element;if(i.is("img")){if(this.isImg=!0,this.originalUrl=t=i.attr("src"),!t)return;t=i.prop("src")}else i.is("canvas")&&nt&&(t=i[0].toDataURL());this.load(t)},trigger:function(i,e){var o=t.Event(i,e);return this.$element.trigger(o),o},load:function(i){var e,o,s=this.options,n=this.$element;if(i&&(n.one(U,s.build),!this.trigger(U).isDefaultPrevented())){if(this.url=i,this.image={},!s.checkOrientation||!$)return this.clone();if(e=t.proxy(this.read,this),K.test(i))return Q.test(i)?e(f(i)):this.clone();(o=new XMLHttpRequest).onerror=o.onabort=t.proxy(function(){this.clone()},this),o.onload=function(){e(this.response)},s.checkCrossOrigin&&a(i)&&n.prop("crossOrigin")&&(i=r(i)),o.open("get",i),o.responseType="arraybuffer",o.send()}},read:function(t){var i=this.options,e=u(t),o=this.image,s=0,a=1,r=1;if(e>1)switch(this.url=m(t),e){case 2:a=-1;break;case 3:s=-180;break;case 4:r=-1;break;case 5:s=90,r=-1;break;case 6:s=90;break;case 7:s=90,a=-1;break;case 8:s=-90}i.rotatable&&(o.rotate=s),i.scalable&&(o.scaleX=a,o.scaleY=r),this.clone()},clone:function(){var i,e,o=this.options,s=this.$element,h=this.url,c="";o.checkCrossOrigin&&a(h)&&((c=s.prop("crossOrigin"))?i=h:(c="anonymous",i=r(h))),this.crossOrigin=c,this.crossOriginUrl=i,this.$clone=e=t("<img"+n(c)+' src="'+(i||h)+'">'),this.isImg?s[0].complete?this.start():s.one(P,t.proxy(this.start,this)):e.one(P,t.proxy(this.start,this)).one(E,t.proxy(this.stop,this)).addClass(T).insertAfter(s)},start:function(){var i=this.$element,e=this.$clone;this.isImg||(e.off(E,this.stop),i=e),h(i[0],t.proxy(function(i,e){t.extend(this.image,{naturalWidth:i,naturalHeight:e,aspectRatio:i/e}),this.isLoaded=!0,this.build()},this))},stop:function(){this.$clone.remove(),this.$clone=null},build:function(){var i,e,o,s=this.options,a=this.$element,r=this.$clone;this.isLoaded&&(this.isBuilt&&this.unbuild(),this.$container=a.parent(),this.$cropper=i=t(v.TEMPLATE),this.$canvas=i.find(".cropper-canvas").append(r),this.$dragBox=i.find(".cropper-drag-box"),this.$cropBox=e=i.find(".cropper-crop-box"),this.$viewBox=i.find(".cropper-view-box"),this.$face=o=e.find(".cropper-face"),a.addClass(X).after(i),this.isImg||r.removeClass(T),this.initPreview(),this.bind(),s.aspectRatio=lt(0,s.aspectRatio)||NaN,s.viewMode=lt(0,pt(3,mt(s.viewMode)))||0,s.autoCrop?(this.isCropped=!0,s.modal&&this.$dragBox.addClass(L)):e.addClass(X),s.guides||e.find(".cropper-dashed").addClass(X),s.center||e.find(".cropper-center").addClass(X),s.cropBoxMovable&&o.addClass(Y).data(J,"all"),s.highlight||o.addClass("cropper-invisible"),s.background&&i.addClass("cropper-bg"),s.cropBoxResizable||e.find(".cropper-line, .cropper-point").addClass(X),this.setDragMode(s.dragMode),this.render(),this.isBuilt=!0,this.setData(s.data),a.one(A,s.built),this.completing=setTimeout(t.proxy(function(){this.trigger(A),this.trigger(_,this.getData()),this.isCompleted=!0},this),0))},unbuild:function(){this.isBuilt&&(this.isCompleted||clearTimeout(this.completing),this.isBuilt=!1,this.isCompleted=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.unbind(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)},render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.isCropped&&this.renderCropBox()},initContainer:function(){var t=this.options,i=this.$element,e=this.$container,o=this.$cropper;o.addClass(X),i.removeClass(X),o.css(this.container={width:lt(e.width(),ct(t.minContainerWidth)||200),height:lt(e.height(),ct(t.minContainerHeight)||100)}),i.addClass(X),o.removeClass(X)},initCanvas:function(){var i,e=this.options.viewMode,o=this.container,s=o.width,a=o.height,r=this.image,n=r.naturalWidth,h=r.naturalHeight,c=90===dt(r.rotate),p=c?h:n,l=c?n:h,d=p/l,g=s,u=a;a*d>s?3===e?g=a*d:u=s/d:3===e?u=s/d:g=a*d,(i={naturalWidth:p,naturalHeight:l,aspectRatio:d,width:g,height:u}).oldLeft=i.left=(s-g)/2,i.oldTop=i.top=(a-u)/2,this.canvas=i,this.isLimited=1===e||2===e,this.limitCanvas(!0,!0),this.initialImage=t.extend({},r),this.initialCanvas=t.extend({},i)},limitCanvas:function(t,i){var e,o,s,a,r=this.options,n=r.viewMode,h=this.container,c=h.width,p=h.height,l=this.canvas,d=l.aspectRatio,g=this.cropBox,u=this.isCropped&&g;t&&(e=ct(r.minCanvasWidth)||0,o=ct(r.minCanvasHeight)||0,n&&(n>1?(e=lt(e,c),o=lt(o,p),3===n&&(o*d>e?e=o*d:o=e/d)):e?e=lt(e,u?g.width:0):o?o=lt(o,u?g.height:0):u&&(e=g.width,(o=g.height)*d>e?e=o*d:o=e/d)),e&&o?o*d>e?o=e/d:e=o*d:e?o=e/d:o&&(e=o*d),l.minWidth=e,l.minHeight=o,l.maxWidth=1/0,l.maxHeight=1/0),i&&(n?(s=c-l.width,a=p-l.height,l.minLeft=pt(0,s),l.minTop=pt(0,a),l.maxLeft=lt(0,s),l.maxTop=lt(0,a),u&&this.isLimited&&(l.minLeft=pt(g.left,g.left+g.width-l.width),l.minTop=pt(g.top,g.top+g.height-l.height),l.maxLeft=g.left,l.maxTop=g.top,2===n&&(l.width>=c&&(l.minLeft=pt(0,s),l.maxLeft=lt(0,s)),l.height>=p&&(l.minTop=pt(0,a),l.maxTop=lt(0,a))))):(l.minLeft=-l.width,l.minTop=-l.height,l.maxLeft=c,l.maxTop=p))},renderCanvas:function(t){var i,e,o=this.canvas,s=this.image,a=s.rotate,r=s.naturalWidth,n=s.naturalHeight;this.isRotated&&(this.isRotated=!1,e=p({width:s.width,height:s.height,degree:a}),(i=e.width/e.height)!==o.aspectRatio&&(o.left-=(e.width-o.width)/2,o.top-=(e.height-o.height)/2,o.width=e.width,o.height=e.height,o.aspectRatio=i,o.naturalWidth=r,o.naturalHeight=n,a%180&&(e=p({width:r,height:n,degree:a}),o.naturalWidth=e.width,o.naturalHeight=e.height),this.limitCanvas(!0,!1))),(o.width>o.maxWidth||o.width<o.minWidth)&&(o.left=o.oldLeft),(o.height>o.maxHeight||o.height<o.minHeight)&&(o.top=o.oldTop),o.width=pt(lt(o.width,o.minWidth),o.maxWidth),o.height=pt(lt(o.height,o.minHeight),o.maxHeight),this.limitCanvas(!1,!0),o.oldLeft=o.left=pt(lt(o.left,o.minLeft),o.maxLeft),o.oldTop=o.top=pt(lt(o.top,o.minTop),o.maxTop),this.$canvas.css({width:o.width,height:o.height,left:o.left,top:o.top}),this.renderImage(),this.isCropped&&this.isLimited&&this.limitCropBox(!0,!0),t&&this.output()},renderImage:function(i){var e,o=this.canvas,s=this.image;s.rotate&&(e=p({width:o.width,height:o.height,degree:s.rotate,aspectRatio:s.aspectRatio},!0)),t.extend(s,e?{width:e.width,height:e.height,left:(o.width-e.width)/2,top:(o.height-e.height)/2}:{width:o.width,height:o.height,left:0,top:0}),this.$clone.css({width:s.width,height:s.height,marginLeft:s.left,marginTop:s.top,transform:c(s)}),i&&this.output()},initCropBox:function(){var i=this.options,e=this.canvas,o=i.aspectRatio,s=ct(i.autoCropArea)||.8,a={width:e.width,height:e.height};o&&(e.height*o>e.width?a.height=a.width/o:a.width=a.height*o),this.cropBox=a,this.limitCropBox(!0,!0),a.width=pt(lt(a.width,a.minWidth),a.maxWidth),a.height=pt(lt(a.height,a.minHeight),a.maxHeight),a.width=lt(a.minWidth,a.width*s),a.height=lt(a.minHeight,a.height*s),a.oldLeft=a.left=e.left+(e.width-a.width)/2,a.oldTop=a.top=e.top+(e.height-a.height)/2,this.initialCropBox=t.extend({},a)},limitCropBox:function(t,i){var e,o,s,a,r=this.options,n=r.aspectRatio,h=this.container,c=h.width,p=h.height,l=this.canvas,d=this.cropBox,g=this.isLimited;t&&(e=ct(r.minCropBoxWidth)||0,o=ct(r.minCropBoxHeight)||0,e=pt(e,c),o=pt(o,p),s=pt(c,g?l.width:c),a=pt(p,g?l.height:p),n&&(e&&o?o*n>e?o=e/n:e=o*n:e?o=e/n:o&&(e=o*n),a*n>s?a=s/n:s=a*n),d.minWidth=pt(e,s),d.minHeight=pt(o,a),d.maxWidth=s,d.maxHeight=a),i&&(g?(d.minLeft=lt(0,l.left),d.minTop=lt(0,l.top),d.maxLeft=pt(c,l.left+l.width)-d.width,d.maxTop=pt(p,l.top+l.height)-d.height):(d.minLeft=0,d.minTop=0,d.maxLeft=c-d.width,d.maxTop=p-d.height))},renderCropBox:function(){var t=this.options,i=this.container,e=i.width,o=i.height,s=this.cropBox;(s.width>s.maxWidth||s.width<s.minWidth)&&(s.left=s.oldLeft),(s.height>s.maxHeight||s.height<s.minHeight)&&(s.top=s.oldTop),s.width=pt(lt(s.width,s.minWidth),s.maxWidth),s.height=pt(lt(s.height,s.minHeight),s.maxHeight),this.limitCropBox(!1,!0),s.oldLeft=s.left=pt(lt(s.left,s.minLeft),s.maxLeft),s.oldTop=s.top=pt(lt(s.top,s.minTop),s.maxTop),t.movable&&t.cropBoxMovable&&this.$face.data(J,s.width===e&&s.height===o?at:"all"),this.$cropBox.css({width:s.width,height:s.height,left:s.left,top:s.top}),this.isCropped&&this.isLimited&&this.limitCanvas(!0,!0),this.isDisabled||this.output()},output:function(){this.preview(),this.isCompleted&&this.trigger(_,this.getData())},initPreview:function(){var i,e=n(this.crossOrigin),o=e?this.crossOriginUrl:this.url;this.$preview=t(this.options.preview),this.$clone2=i=t("<img"+e+' src="'+o+'">'),this.$viewBox.html(i),this.$preview.each(function(){var i=t(this);i.data(G,{width:i.width(),height:i.height(),html:i.html()}),i.html("<img"+e+' src="'+o+'" style="display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;">')})},resetPreview:function(){this.$preview.each(function(){var i=t(this),e=i.data(G);i.css({width:e.width,height:e.height}).html(e.html).removeData(G)})},preview:function(){var i=this.image,e=this.canvas,o=this.cropBox,s=o.width,a=o.height,r=i.width,n=i.height,h=o.left-e.left-i.left,p=o.top-e.top-i.top;this.isCropped&&!this.isDisabled&&(this.$clone2.css({width:r,height:n,marginLeft:-h,marginTop:-p,transform:c(i)}),this.$preview.each(function(){var e=t(this),o=e.data(G),l=o.width,d=o.height,g=l,u=d,f=1;s&&(f=l/s,u=a*f),a&&u>d&&(f=d/a,g=s*f,u=d),e.css({width:g,height:u}).find("img").css({width:r*f,height:n*f,marginLeft:-h*f,marginTop:-p*f,transform:c(i)})}))},bind:function(){var i=this.options,e=this.$element,o=this.$cropper;t.isFunction(i.cropstart)&&e.on(S,i.cropstart),t.isFunction(i.cropmove)&&e.on(j,i.cropmove),t.isFunction(i.cropend)&&e.on(N,i.cropend),t.isFunction(i.crop)&&e.on(_,i.crop),t.isFunction(i.zoom)&&e.on(q,i.zoom),o.on(z,t.proxy(this.cropStart,this)),i.zoomable&&i.zoomOnWheel&&o.on(F,t.proxy(this.wheel,this)),i.toggleDragModeOnDblclick&&o.on(H,t.proxy(this.dblclick,this)),x.on(R,this._cropMove=s(this.cropMove,this)).on(O,this._cropEnd=s(this.cropEnd,this)),i.responsive&&w.on(I,this._resize=s(this.resize,this))},unbind:function(){var i=this.options,e=this.$element,o=this.$cropper;t.isFunction(i.cropstart)&&e.off(S,i.cropstart),t.isFunction(i.cropmove)&&e.off(j,i.cropmove),t.isFunction(i.cropend)&&e.off(N,i.cropend),t.isFunction(i.crop)&&e.off(_,i.crop),t.isFunction(i.zoom)&&e.off(q,i.zoom),o.off(z,this.cropStart),i.zoomable&&i.zoomOnWheel&&o.off(F,this.wheel),i.toggleDragModeOnDblclick&&o.off(H,this.dblclick),x.off(R,this._cropMove).off(O,this._cropEnd),i.responsive&&w.off(I,this._resize)},resize:function(){var i,e,o,s=this.options.restore,a=this.$container,r=this.container;!this.isDisabled&&r&&(1==(o=a.width()/r.width)&&a.height()===r.height||(s&&(i=this.getCanvasData(),e=this.getCropBoxData()),this.render(),s&&(this.setCanvasData(t.each(i,function(t,e){i[t]=e*o})),this.setCropBoxData(t.each(e,function(t,i){e[t]=i*o})))))},dblclick:function(){this.isDisabled||(this.$dragBox.hasClass(M)?this.setDragMode(at):this.setDragMode(st))},wheel:function(i){var e=i.originalEvent||i,o=ct(this.options.wheelZoomRatio)||.1,s=1;this.isDisabled||(i.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout(t.proxy(function(){this.wheeling=!1},this),50),e.deltaY?s=e.deltaY>0?1:-1:e.wheelDelta?s=-e.wheelDelta/120:e.detail&&(s=e.detail>0?1:-1),this.zoom(-s*o,i)))},cropStart:function(i){var e,o,s=this.options,a=i.originalEvent,r=a&&a.touches,n=i;if(!this.isDisabled){if(r){if((e=r.length)>1){if(!s.zoomable||!s.zoomOnTouch||2!==e)return;n=r[1],this.startX2=n.pageX,this.startY2=n.pageY,o=rt}n=r[0]}if(o=o||t(n.target).data(J),V.test(o)){if(this.trigger(S,{originalEvent:a,action:o}).isDefaultPrevented())return;i.preventDefault(),this.action=o,this.cropping=!1,this.startX=n.pageX||a&&a.pageX,this.startY=n.pageY||a&&a.pageY,o===st&&(this.cropping=!0,this.$dragBox.addClass(L))}}},cropMove:function(t){var i,e=this.options,o=t.originalEvent,s=o&&o.touches,a=t,r=this.action;if(!this.isDisabled){if(s){if((i=s.length)>1){if(!e.zoomable||!e.zoomOnTouch||2!==i)return;a=s[1],this.endX2=a.pageX,this.endY2=a.pageY}a=s[0]}if(r){if(this.trigger(j,{originalEvent:o,action:r}).isDefaultPrevented())return;t.preventDefault(),this.endX=a.pageX||o&&o.pageX,this.endY=a.pageY||o&&o.pageY,this.change(a.shiftKey,r===rt?t:null)}}},cropEnd:function(t){var i=t.originalEvent,e=this.action;this.isDisabled||e&&(t.preventDefault(),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass(L,this.isCropped&&this.options.modal)),this.action="",this.trigger(N,{originalEvent:i,action:e}))},change:function(t,i){var e,o,s=this.options.aspectRatio,a=this.action,r=this.container,n=this.canvas,h=this.cropBox,c=h.width,p=h.height,l=h.left,d=h.top,g=l+c,u=d+p,f=0,m=0,v=r.width,w=r.height,x=!0;switch(!s&&t&&(s=c&&p?c/p:1),this.isLimited&&(f=h.minLeft,m=h.minTop,v=f+pt(r.width,n.width,n.left+n.width),w=m+pt(r.height,n.height,n.top+n.height)),o={x:this.endX-this.startX,y:this.endY-this.startY},s&&(o.X=o.y*s,o.Y=o.x/s),a){case"all":l+=o.x,d+=o.y;break;case"e":if(o.x>=0&&(g>=v||s&&(d<=m||u>=w))){x=!1;break}c+=o.x,s&&(p=c/s,d-=o.Y/2),c<0&&(a="w",c=0);break;case"n":if(o.y<=0&&(d<=m||s&&(l<=f||g>=v))){x=!1;break}p-=o.y,d+=o.y,s&&(c=p*s,l+=o.X/2),p<0&&(a="s",p=0);break;case"w":if(o.x<=0&&(l<=f||s&&(d<=m||u>=w))){x=!1;break}c-=o.x,l+=o.x,s&&(p=c/s,d+=o.Y/2),c<0&&(a="e",c=0);break;case"s":if(o.y>=0&&(u>=w||s&&(l<=f||g>=v))){x=!1;break}p+=o.y,s&&(c=p*s,l-=o.X/2),p<0&&(a="n",p=0);break;case et:if(s){if(o.y<=0&&(d<=m||g>=v)){x=!1;break}p-=o.y,d+=o.y,c=p*s}else o.x>=0?g<v?c+=o.x:o.y<=0&&d<=m&&(x=!1):c+=o.x,o.y<=0?d>m&&(p-=o.y,d+=o.y):(p-=o.y,d+=o.y);c<0&&p<0?(a=it,p=0,c=0):c<0?(a=ot,c=0):p<0&&(a=tt,p=0);break;case ot:if(s){if(o.y<=0&&(d<=m||l<=f)){x=!1;break}p-=o.y,d+=o.y,c=p*s,l+=o.X}else o.x<=0?l>f?(c-=o.x,l+=o.x):o.y<=0&&d<=m&&(x=!1):(c-=o.x,l+=o.x),o.y<=0?d>m&&(p-=o.y,d+=o.y):(p-=o.y,d+=o.y);c<0&&p<0?(a=tt,p=0,c=0):c<0?(a=et,c=0):p<0&&(a=it,p=0);break;case it:if(s){if(o.x<=0&&(l<=f||u>=w)){x=!1;break}c-=o.x,l+=o.x,p=c/s}else o.x<=0?l>f?(c-=o.x,l+=o.x):o.y>=0&&u>=w&&(x=!1):(c-=o.x,l+=o.x),o.y>=0?u<w&&(p+=o.y):p+=o.y;c<0&&p<0?(a=et,p=0,c=0):c<0?(a=tt,c=0):p<0&&(a=ot,p=0);break;case tt:if(s){if(o.x>=0&&(g>=v||u>=w)){x=!1;break}p=(c+=o.x)/s}else o.x>=0?g<v?c+=o.x:o.y>=0&&u>=w&&(x=!1):c+=o.x,o.y>=0?u<w&&(p+=o.y):p+=o.y;c<0&&p<0?(a=ot,p=0,c=0):c<0?(a=it,c=0):p<0&&(a=et,p=0);break;case at:this.move(o.x,o.y),x=!1;break;case rt:this.zoom(function(t,i,e,o){var s=ft(t*t+i*i);return(ft(e*e+o*o)-s)/s}(dt(this.startX-this.startX2),dt(this.startY-this.startY2),dt(this.endX-this.endX2),dt(this.endY-this.endY2)),i),this.startX2=this.endX2,this.startY2=this.endY2,x=!1;break;case st:if(!o.x||!o.y){x=!1;break}e=this.$cropper.offset(),l=this.startX-e.left,d=this.startY-e.top,c=h.minWidth,p=h.minHeight,o.x>0?a=o.y>0?tt:et:o.x<0&&(l-=c,a=o.y>0?it:ot),o.y<0&&(d-=p),this.isCropped||(this.$cropBox.removeClass(X),this.isCropped=!0,this.isLimited&&this.limitCropBox(!0,!0))}x&&(h.width=c,h.height=p,h.left=l,h.top=d,this.action=a,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY},crop:function(){this.isBuilt&&!this.isDisabled&&(this.isCropped||(this.isCropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass(L),this.$cropBox.removeClass(X)),this.setCropBoxData(this.initialCropBox))},reset:function(){this.isBuilt&&!this.isDisabled&&(this.image=t.extend({},this.initialImage),this.canvas=t.extend({},this.initialCanvas),this.cropBox=t.extend({},this.initialCropBox),this.renderCanvas(),this.isCropped&&this.renderCropBox())},clear:function(){this.isCropped&&!this.isDisabled&&(t.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.isCropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),this.$dragBox.removeClass(L),this.$cropBox.addClass(X))},replace:function(t,i){!this.isDisabled&&t&&(this.isImg&&this.$element.attr("src",t),i?(this.url=t,this.$clone.attr("src",t),this.isBuilt&&this.$preview.find("img").add(this.$clone2).attr("src",t)):(this.isImg&&(this.isReplaced=!0),this.options.data=null,this.load(t)))},enable:function(){this.isBuilt&&(this.isDisabled=!1,this.$cropper.removeClass(W))},disable:function(){this.isBuilt&&(this.isDisabled=!0,this.$cropper.addClass(W))},destroy:function(){var t=this.$element;this.isLoaded?(this.isImg&&this.isReplaced&&t.attr("src",this.originalUrl),this.unbuild(),t.removeClass(X)):this.isImg?t.off(P,this.start):this.$clone&&this.$clone.remove(),t.removeData(D)},move:function(t,i){var o=this.canvas;this.moveTo(e(t)?t:o.left+ct(t),e(i)?i:o.top+ct(i))},moveTo:function(t,o){var s=this.canvas,a=!1;e(o)&&(o=t),t=ct(t),o=ct(o),this.isBuilt&&!this.isDisabled&&this.options.movable&&(i(t)&&(s.left=t,a=!0),i(o)&&(s.top=o,a=!0),a&&this.renderCanvas(!0))},zoom:function(t,i){var e=this.canvas;t=(t=ct(t))<0?1/(1-t):1+t,this.zoomTo(e.width*t/e.naturalWidth,i)},zoomTo:function(t,i){var e,o,s,a,r,n=this.options,h=this.canvas,c=h.width,p=h.height,l=h.naturalWidth,g=h.naturalHeight;if((t=ct(t))>=0&&this.isBuilt&&!this.isDisabled&&n.zoomable){if(o=l*t,s=g*t,i&&(e=i.originalEvent),this.trigger(q,{originalEvent:e,oldRatio:c/l,ratio:o/l}).isDefaultPrevented())return;e?(a=this.$cropper.offset(),r=e.touches?d(e.touches):{pageX:i.pageX||e.pageX||0,pageY:i.pageY||e.pageY||0},h.left-=(o-c)*((r.pageX-a.left-h.left)/c),h.top-=(s-p)*((r.pageY-a.top-h.top)/p)):(h.left-=(o-c)/2,h.top-=(s-p)/2),h.width=o,h.height=s,this.renderCanvas(!0)}},rotate:function(t){this.rotateTo((this.image.rotate||0)+ct(t))},rotateTo:function(t){i(t=ct(t))&&this.isBuilt&&!this.isDisabled&&this.options.rotatable&&(this.image.rotate=t%360,this.isRotated=!0,this.renderCanvas(!0))},scale:function(t,o){var s=this.image,a=!1;e(o)&&(o=t),t=ct(t),o=ct(o),this.isBuilt&&!this.isDisabled&&this.options.scalable&&(i(t)&&(s.scaleX=t,a=!0),i(o)&&(s.scaleY=o,a=!0),a&&this.renderImage(!0))},scaleX:function(t){var e=this.image.scaleY;this.scale(t,i(e)?e:1)},scaleY:function(t){var e=this.image.scaleX;this.scale(i(e)?e:1,t)},getData:function(i){var e,o,s=this.options,a=this.image,r=this.canvas,n=this.cropBox;return this.isBuilt&&this.isCropped?(o={x:n.left-r.left,y:n.top-r.top,width:n.width,height:n.height},e=a.width/a.naturalWidth,t.each(o,function(t,s){s/=e,o[t]=i?mt(s):s})):o={x:0,y:0,width:0,height:0},s.rotatable&&(o.rotate=a.rotate||0),s.scalable&&(o.scaleX=a.scaleX||1,o.scaleY=a.scaleY||1),o},setData:function(e){var o,s,a,r=this.options,n=this.image,h=this.canvas,c={};t.isFunction(e)&&(e=e.call(this.element)),this.isBuilt&&!this.isDisabled&&t.isPlainObject(e)&&(r.rotatable&&i(e.rotate)&&e.rotate!==n.rotate&&(n.rotate=e.rotate,this.isRotated=o=!0),r.scalable&&(i(e.scaleX)&&e.scaleX!==n.scaleX&&(n.scaleX=e.scaleX,s=!0),i(e.scaleY)&&e.scaleY!==n.scaleY&&(n.scaleY=e.scaleY,s=!0)),o?this.renderCanvas():s&&this.renderImage(),a=n.width/n.naturalWidth,i(e.x)&&(c.left=e.x*a+h.left),i(e.y)&&(c.top=e.y*a+h.top),i(e.width)&&(c.width=e.width*a),i(e.height)&&(c.height=e.height*a),this.setCropBoxData(c))},getContainerData:function(){return this.isBuilt?this.container:{}},getImageData:function(){return this.isLoaded?this.image:{}},getCanvasData:function(){var i=this.canvas,e={};return this.isBuilt&&t.each(["left","top","width","height","naturalWidth","naturalHeight"],function(t,o){e[o]=i[o]}),e},setCanvasData:function(e){var o=this.canvas,s=o.aspectRatio;t.isFunction(e)&&(e=e.call(this.$element)),this.isBuilt&&!this.isDisabled&&t.isPlainObject(e)&&(i(e.left)&&(o.left=e.left),i(e.top)&&(o.top=e.top),i(e.width)?(o.width=e.width,o.height=e.width/s):i(e.height)&&(o.height=e.height,o.width=e.height*s),this.renderCanvas(!0))},getCropBoxData:function(){var t,i=this.cropBox;return this.isBuilt&&this.isCropped&&(t={left:i.left,top:i.top,width:i.width,height:i.height}),t||{}},setCropBoxData:function(e){var o,s,a=this.cropBox,r=this.options.aspectRatio;t.isFunction(e)&&(e=e.call(this.$element)),this.isBuilt&&this.isCropped&&!this.isDisabled&&t.isPlainObject(e)&&(i(e.left)&&(a.left=e.left),i(e.top)&&(a.top=e.top),i(e.width)&&(o=!0,a.width=e.width),i(e.height)&&(s=!0,a.height=e.height),r&&(o?a.height=a.width/r:s&&(a.width=a.height*r)),this.renderCropBox())},getCroppedCanvas:function(i){var e,o,s,a,r,n,h,c,p,d,g;if(this.isBuilt&&nt)return this.isCropped?(t.isPlainObject(i)||(i={}),g=this.getData(),e=g.width,o=g.height,c=e/o,t.isPlainObject(i)&&(r=i.width,n=i.height,r?(n=r/c,h=r/e):n&&(r=n*c,h=n/o)),s=vt(r||e),a=vt(n||o),p=t("<canvas>")[0],p.width=s,p.height=a,d=p.getContext("2d"),i.fillColor&&(d.fillStyle=i.fillColor,d.fillRect(0,0,s,a)),d.drawImage.apply(d,function(){var t,i,s,a,r,n,c=l(this.$clone[0],this.image),p=c.width,d=c.height,u=this.canvas,f=[c],m=g.x+u.naturalWidth*(dt(g.scaleX||1)-1)/2,v=g.y+u.naturalHeight*(dt(g.scaleY||1)-1)/2;return m<=-e||m>p?m=t=s=r=0:m<=0?(s=-m,m=0,t=r=pt(p,e+m)):m<=p&&(s=0,t=r=pt(e,p-m)),t<=0||v<=-o||v>d?v=i=a=n=0:v<=0?(a=-v,v=0,i=n=pt(d,o+v)):v<=d&&(a=0,i=n=pt(o,d-v)),f.push(vt(m),vt(v),vt(t),vt(i)),h&&(s*=h,a*=h,r*=h,n*=h),r>0&&n>0&&f.push(vt(s),vt(a),vt(r),vt(n)),f}.call(this)),p):l(this.$clone[0],this.image)},setAspectRatio:function(t){var i=this.options;this.isDisabled||e(t)||(i.aspectRatio=lt(0,t)||NaN,this.isBuilt&&(this.initCropBox(),this.isCropped&&this.renderCropBox()))},setDragMode:function(t){var i,e,o=this.options;this.isLoaded&&!this.isDisabled&&(i=t===st,e=o.movable&&t===at,t=i||e?t:"none",this.$dragBox.data(J,t).toggleClass(M,i).toggleClass(Y,e),o.cropBoxMovable||this.$face.data(J,t).toggleClass(M,i).toggleClass(Y,e))}},v.DEFAULTS={viewMode:0,dragMode:"crop",aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},v.setDefaults=function(i){t.extend(v.DEFAULTS,i)},v.TEMPLATE='<div class="cropper-container"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',v.other=t.fn.cropper,t.fn.cropper=function(i){var s,a=o(arguments,1);return this.each(function(){var e,o,r=t(this),n=r.data(D);if(!n){if(/destroy/.test(i))return;e=t.extend({},r.data(),t.isPlainObject(i)&&i),r.data(D,n=new v(this,e))}"string"==typeof i&&t.isFunction(o=n[i])&&(s=o.apply(n,a))}),e(s)?this:s},t.fn.cropper.Constructor=v,t.fn.cropper.setDefaults=v.setDefaults,t.fn.cropper.noConflict=function(){return t.fn.cropper=v.other,this}});var cropperVue=new Vue({el:".cropper-cover",methods:{initPickColor:function(t){var i={callbackFn:this.callbackSetFontColor,callbackBgFn:this.callbackOkBtn,calllbackCancel:this.callbackCancelColor};infinity.modules.main.pickColor(t,i)},callbackSetFontColor:function(t){$(".cropper-preview,.cropper-preview2,.cropper-bg").css({"background-color":t,"background-image":"none"})},callbackOkBtn:function(t){$(".cropper-ok").attr("data-color",t)},callbackCancelColor:function(){var t=$(".cropper-ok").attr("data-color");$(".cropper-bg-color").each(function(){if($(this).attr("data-color")==t){var i=t;"transparent"==t&&(i="#cccccc"),"#FFFFFF"==t&&(i="#cccccc"),$(this).css("border","solid 1px "+i)}}),"transparent"==t?$(".cropper-preview,.cropper-preview2,.cropper-bg").css({"background-color":"transaprent","background-image":"url(/modules/cropper/img/transparent.png)"}):$(".cropper-preview,.cropper-preview2,.cropper-bg").css({"background-color":t,"background-image":"none"})}}});infinity.modules.cropper={onEditImage:function(t,i,e){var o="transparent";$(".cropper-ok").attr("data-color",o),$(".cropper-bg-color").css("border","solid 1px transparent"),$(".cropper-preview,.cropper-preview2,.cropper-bg").css({"background-color":"transaprent","background-image":"url(/modules/cropper/img/transparent.png)"}),$(".cropper-bg-transparent").css("border","solid 1px #ccc"),$("#cropper-image").attr("src",t),e?$(".cropper-bg-color-box").show():$(".cropper-bg-color-box").hide(),$("#cropper-image").cropper({aspectRatio:1,viewMode:0,dragMode:"crop",preview:".cropper-preview,.cropper-preview2",autoCropArea:1,modal:!1,toggleDragModeOnDblclick:!1,crop:function(t){},built:function(){function t(){$(".cropper-cover").css("display","none"),$(e).cropper("destroy"),$(".cropper-rotate-right").off("click"),$(".cropper-rotate-left").off("click"),$(".cropper-zoomIn").off("click"),$(".cropper-zoomOut").off("click"),$(".cropper-reset").off("click"),$(".cropper-ok").off("click"),$(".cropper-cancel").off("click")}var e=this;$(".cropper-cover").css("display","flex"),$(".cropper-rotate-left").on("click",function(){$(e).cropper("rotate",-90)}),$(".cropper-rotate-right").on("click",function(){$(e).cropper("rotate",90)}),$(".cropper-zoomIn").on("click",function(t){$(e).cropper("zoom",.1)}),$(".cropper-zoomOut").on("click",function(t){$(e).cropper("zoom",-.1)}),$(".cropper-reset").on("click",function(t){$(e).cropper("reset")}),$(".cropper-ok").on("click",function(o){var s=$(e).cropper("getCroppedCanvas",{width:360,height:360}).toDataURL("image/png",1);t();try{var a=$(this).attr("data-color");i(s,a)}catch(t){}}),$(".cropper-bg-color").on("click",function(t){t.preventDefault();var i=$(this).attr("data-color"),e=i;"transparent"==i&&(i="#cccccc"),"#FFFFFF"==i&&(i="#cccccc"),$(".cropper-bg-color").css("border","solid 1px transparent"),"transparent"==e?$(".cropper-preview,.cropper-preview2,.cropper-bg").css({"background-color":"transaprent","background-image":"url(/modules/cropper/img/transparent.png)"}):$(".cropper-preview,.cropper-preview2,.cropper-bg").css({"background-color":e,"background-image":"none"}),o=e,$(".cropper-ok").attr("data-color",o),$(this).css("border","solid 1px "+i)}),$(".cropper-cancel").on("click",function(i){t()})}})}};