!function(){function i(i,e){var n,s,t=-1;for(void 0,n=0,s=e.length;n<s;n++)if(e[n].seId===i){t=n;break}return t}var e=infinity.modules["search-add-custom"]=new Vue({el:"#search-add-custom",data:{isEditing:!1,engines:infinity.get("infinity-searchs").customEngines||[],visibleAreas:[]},created:function(){var i=this;infinity.onBroadcast("searchAddUpdate",!0,function(){i.refresh()}),infinity.onMessage("updateSearchView",function(){i.refresh()})},methods:{refresh:function(){var i=this;i.engines=infinity.get("infinity-searchs").customEngines||[],i.visibleAreas=[]},showOperateArea:function(i){var e=this;i.seId;e.visibleAreas=[i.seId]},isOperateAreaVisible:function(i){var e=this,n=i.seId;return-1!==e.visibleAreas.indexOf(n)},hasAdded:function(i){var e=i.seId,n=infinity.get("infinity-searchs").all;for(var s in n)if(n[s].seId&&n[s].seId==e)return!0;return!1},createEngine:function(){this.isEditing=!0,infinity.modules["search-add-custom-detail"].edit({seId:null,name:null,logo:null,desc:null,isCustom:!0,types:[{name:infinity.i18n("web"),url:null}]})},useEngine:function(i){infinity.sendMessage("sendGa",{category:"searchEngine",event:"customAdd",label:infinity.getHost(i.types[0].url)}),i=JSON.parse(JSON.stringify(i)),infinity.require("/modules/search/search",function(e){e.items.push(i);var n=infinity.get("infinity-searchs");n.all=e.items,infinity.set("infinity-searchs",n),infinity.broadcast("searchUpdate"),infinity.broadcast("searchAddUpdate")})},editEngine:function(i){this.isEditing=!0,infinity.modules["search-add-custom-detail"].edit(JSON.parse(JSON.stringify(i)))},delEngine:function(i){var e=this,n=infinity.modules.search;if(n.current.seId!==i.seId){var s=infinity.get("infinity-searchs"),t=e.engines,a=t.indexOf(i);t.splice(a,1),s.customEngines=t;var r,d,c=n.items;for(r=0,d=c.length;r<d;r++)if(c[r].seId===i.seId){c.splice(r,1),s.all=c;break}infinity.set("infinity-searchs",s),infinity.broadcast("searchUpdate"),infinity.broadcast("searchAddUpdate")}else infinity.with("info",function(i){i.show(infinity.i18n("cannot_delete_current_search"),!0)})},cancelEdit:function(){this.isEditing=!1},saveEdit:function(e){var n,s=this,t=infinity.get("infinity-searchs"),a=s.engines,r=e.seId,d=!1;if(r){if(-1===(n=i(r,a)))a.push(e),d=!0;else if(a.splice(n,1,e),s.hasAdded(e)){var c,f,o,u=infinity.modules.search,l=u.items;for(c=0,f=l.length;c<f;c++)if((o=l[c]).seId===e.seId){$.extend(o,JSON.parse(JSON.stringify(e))),t.all=l;break}var h=u.current;h.seId===e.seId&&($.extend(h,JSON.parse(JSON.stringify(e))),t.current=h,u.select=h.types[0])}}else e.seId=infinity.id("800"),a.push(e),d=!0;t.customEngines=a,infinity.set("infinity-searchs",t),d?(infinity.sendMessage("sendGa",{category:"searchEngine",event:"create",label:infinity.getHost(e.types[0].url)}),s.useEngine(e)):(infinity.broadcast("searchUpdate"),infinity.broadcast("searchAddUpdate")),s.isEditing=!1}}});$("#search-add").click(function(){e.visibleAreas=[]}),infinity.with("search-add-custom-detail","#search-add-custom-detail-container")}();