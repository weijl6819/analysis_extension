!function(){"use strict";infinity.modules.edit=new Vue({el:"#edit-box",data:{cusName:"",oldUrl:"",cusUrl:"",customType:"color",iconImageOriginal:"",iconCropped:"",iconImageBgColor:"transparent",icocolors:["#2989fd","#ff9800","#ffeb3b","#4caf50","#00bcd4","#2196f3","#673ab7","transparent",""],selectColor:"#2989fd",fontColors:["#ffffff","#2989fd","#ff9800","#ffeb3b","#4caf50","#00bcd4","#2196f3","#673ab7","transparent"],selectFontColor:"#ffffff",infinityType:"",showText:"",fontSize:44,showBgColor:!1,page:"",iconIndex:"",bgColor:"",disabledEditUrl:!1,colorNum:0,lastIconColor:"#2989fd",shareChecked:!1,isLoading:!1},created:function(){var o=this;infinity.onMessage("editDone",function(i){chrome.tabs.getCurrent(function(e){if(i.tabId==e.id){o.isLoading=!1,o.hide(),_edit.end(),loadIcons();var n=$($(".home-page")[o.page]).children()[o.iconIndex];$(n).addClass("home-icon-animate")}})}),$(document).on("click","#edit-cover",function(i){i.preventDefault(),o.hide()}),$("#edit-box").on("transitionend",function(i){i.stopPropagation(),i.target.className.indexOf("sildeBox")>=0&&i.target.className.indexOf("slide-show")>=0&&("web"!=o.infinityType&&"custom-web"!=o.infinityType?$(".edit-name")[0].focus():$(".edit-url")[0].focus())})},methods:{choiceCusetomColor:function(){this.colorNum=0,this.selectColor=this.icocolors[0]},transColor2Hex:function(o){try{if(o.indexOf("rgb")>=0){var i=o.substr(o.indexOf("(")+1,o.indexOf(")")).replace(")","").split(",");return function(o,i,e){return"#"+((1<<24)+(o<<16)+(i<<8)+e).toString(16).slice(1)}(parseInt(i[0]),parseInt(i[1]),parseInt(i[2])).trim()}return o.trim()}catch(i){return o}},initEdit:function(o){var i=this,e=o.icon;i.disabledEditUrl=!(0!=e.url.indexOf("infinity://")&&!e.disableEditUrl),i.showText=e.showText||e.name.substr(0,2),i.cusUrl=i.oldUrl=e.url,i.cusName=e.name,i.iconCropped="image"==e.imageType?e.src:"",i.iconImageOriginal="image"==e.imageType?e.src:"",i.customType=e.imageType,i.uid=e.uid,i.page=o.page,i.iconIndex=o.iconIndex,i.infinityType=e.infinityType,i.colorNum=i.icocolors.indexOf(i.transColor2Hex(e.bgColor)),-1==i.colorNum&&(i.colorNum=i.icocolors.length-1,i.icocolors.$set([i.icocolors.length-1],i.transColor2Hex(e.bgColor)),i.lastIconColor=i.transColor2Hex(e.bgColor)),i.selectColor=i.transColor2Hex(e.bgColor)||"#2989fd",i.fontSize=e.fontSize||44},show:function(o){var i=this;i.initEdit(o),"image"==o.icon.imageType&&i.choiceCusetomColor(),$("#edit-cover,#edit-box").show(),$("#edit-box").addClass("slide-show slide-box-shadow")},hide:function(){$("#edit-box").removeClass("slide-show slide-box-shadow"),$("#edit-cover").hide(),this.colorNum=0},inputUrl:function(){var o=this;$.debounce(1500,!1,function(){var i=infinity.isUrl(o.cusUrl);i.isValid&&$.get(i.str,function(i){try{e=$(i).filter(function(o,i){return"TITLE"==i.tagName})[0].text}catch(o){var e=""}"Redirect"!=e&&(o.cusName=e,o.showText=o.cusName.substr(0,2).toUpperCase(),o.showBgColor=!0)})})()},inputName:function(){var o=this;""==o.showText&&(o.showText=o.cusName.substr(0,2).toUpperCase(),o.showBgColor=!0),""==o.cusName&&(o.showText="",o.showBgColor=!1)},keyupName:function(){var o=this;""==o.showText&&(o.showText=o.cusName.substr(0,2).toUpperCase(),o.showBgColor=!0),""==o.cusName&&(o.showText="",o.showBgColor=!1)},setIconColor:function(o,i,e){var n=this;i&&(n.showBgColor=!0,n.selectColor=i,n.colorNum=e,this.lastIconColor=i)},callbackSeticoColor:function(o){this.selectColor=o},sendicoColorMessage:function(o){this.lastIconColor=o},callbackCancelColor:function(){var o=this.icocolors.indexOf(this.lastIconColor);o!=this.icocolors.length-1&&(this.selectColor=this.lastIconColor,-1==o||o==this.icocolors.length-1?(this.colorNum=this.icocolors.length-1,this.icocolors.$set(this.icocolors.length-1,this.lastIconColor)):this.colorNum=o)},initPickColor:function(o,i){var e={callbackFn:this.callbackSeticoColor,callbackBgFn:this.sendicoColorMessage,calllbackCancel:this.callbackCancelColor,color:this.icocolors[this.icocolors.length-1]};this.colorNum=i;$("#infinityColorPicker");infinity.require("/lib/js/jquery.minicolors.min",function(){infinity.with("pickColor",function(i){o&&infinity.modules.pickColor.callbackPickerFn(o,e)})})},clearFileValue:function(o){o.target.value=""},imgload:function(o){var i=this,e=o.srcElement.files[0],n=new FileReader;n.readAsDataURL(e),n.onload=function(o){i.iconImageOriginal=o.target.result,infinity.with("cropper",function(e){e.onEditImage(o.target.result,function(o,e){i.iconCropped=o,i.iconImageBgColor=e},!0)})}},editThisImage:function(o){if("edit-selected-image"==o.target.id){var i=this;infinity.with("cropper",function(o){o.onEditImage(i.iconImageOriginal,function(o,e){i.iconCropped=o,i.iconImageBgColor=e},!0)})}},reupload:function(o){this.iconCropped=""},updateEditedIcon:function(){var o=this;o.cusName?o.iconCropped||"image"!=o.customType?(o.oldUrl!=o.cusUrl&&infinity.sendMessage("sendGa",{category:"icon",event:"update",label:infinity.getHost(infinity.isUrl(o.cusUrl).str)}),o.isLoading=!0,chrome.tabs.getCurrent(function(i){if("image"==o.customType){e={src:o.iconCropped,imageType:"image",iconImageBgColor:o.iconImageBgColor,name:o.cusName,url:o.cusUrl,uid:o.uid,isShare:o.shareChecked};infinity.sendMessage("updateIcon",{icon:e,tabId:i.id,iconIndex:o.iconIndex,page:o.page},function(i){i.error&&(infinity.with("info",function(o){o.show(infinity.i18n("upload_img_failed"),!0)}),o.isLoading=!1)})}else{var e={imageType:"color",name:o.cusName,url:o.cusUrl,uid:o.uid,showText:o.showText,bgColor:o.selectColor,fontSize:o.fontSize,isShare:!1};infinity.sendMessage("updateIcon",{icon:e,tabId:i.id,iconIndex:o.iconIndex,page:o.page},function(i){i.error&&(infinity.with("info",function(o){o.show(infinity.i18n("upload_img_failed"),!0)}),o.isLoading=!1)})}})):infinity.with("alert",function(o){o.show(infinity.i18n("please_select_image"))}):infinity.with("alert",function(o){o.show(infinity.i18n("please_input_name"))})}}})}();