"use strict";infinity.modules["add-custom"]=new Vue({el:"#add-custom",data:{cusName:"",cusUrl:"",customType:"color",iconImageOriginal:"",iconCropped:"",iconImageBgColor:"transparent",icoColors:["#2989fd","#ff9800","#ffeb3b","#4caf50","#00bcd4","#2196f3","#673ab7","transparent",""],selectColor:"#2989fd",fontColors:["#ffffff","#2989fd","#ff9800","#ffeb3b","#4caf50","#00bcd4","#2196f3","#673ab7","transparent"],selectFontColor:"#ffffff",showText:"",fontSize:34,showBgColor:!1,addSuccess:!1,shareChecked:!1,colorNum:0,isLoading:!1},methods:{show:function(){var i=this;i.addSuccess=!1,i.cusName="",i.cusUrl="",i.customType="color",i.iconImageOriginal="",i.iconCropped="",i.selectColor="#2989fd",i.showText="",i.fontSize=34,i.showBgColor=!1,i.colorNum=0,$("#add-custom").css("display","flex"),$(".add-cus-url")[0].focus(),infinity.with("cropper",function(i){})},hide:function(){this.addSuccess=!1,$(".add-custom-cover").hide()},goOnAdd:function(){var i=this;i.addSuccess=!1,i.cusName="",i.cusUrl="",i.customType="color",i.iconImageOriginal="",i.iconCropped="",i.selectColor="#2989fd",i.showText="",i.fontSize=34,i.showBgColor=!1},onAddSuccess:function(){this.addSuccess=!0},inputUrl:function(){var i=this;$.debounce(1500,!1,function(){var o=infinity.isUrl(i.cusUrl);o.isValid&&$.get(o.str,function(o){try{e=$(o).filter(function(i,o){return"TITLE"==o.tagName})[0].text}catch(i){var e=""}"Redirect"!=e&&(i.cusName=e,i.showText=i.cusName.substr(0,2).toUpperCase(),i.showBgColor=!0)})})()},inputName:function(){var i=this;""==i.showText&&(i.showText=i.cusName.substr(0,2).toUpperCase(),i.showBgColor=!0),""==i.cusName&&(i.showText="",i.showBgColor=!1)},keyupName:function(){var i=this;""==i.showText&&(i.showText=i.cusName.substr(0,2).toUpperCase(),i.showBgColor=!0),""==i.cusName&&(i.showText="",i.showBgColor=!1)},setIconColor:function(i,o,e){var n=this;o&&(n.showBgColor=!0,n.selectColor=o,n.colorNum=e)},callbackSeticoColor:function(i){this.selectColor=i},sendicoColorMessage:function(i){},initPickColor:function(i,o){var e={callbackFn:this.callbackSeticoColor,callbackBgFn:this.sendicoColorMessage};this.colorNum=o,infinity.modules.main.pickColor(i,e)},clearFileValue:function(i){i.target.value=""},imgload:function(i){var o=this,e=i.srcElement.files[0],n=new FileReader;n.readAsDataURL(e),n.onload=function(i){o.iconImageOriginal=i.target.result,infinity.with("cropper",function(e){e.onEditImage(i.target.result,function(i,e){o.iconCropped=i,o.iconImageBgColor=e},!0)})}},editThisImage:function(i){if("add-cus-selected-image"==i.target.id){var o=this;infinity.with("cropper",function(i){i.onEditImage(o.iconImageOriginal,function(i,e){o.iconCropped=i,o.iconImageBgColor=e},!0)})}},reupload:function(i){this.iconCropped=""},customAdd:function(){var i=this;if(i.cusName)if(i.iconCropped||"image"!=i.customType){infinity.sendMessage("sendGa",{category:"icon",event:"customAdd",label:infinity.getHost(infinity.isUrl(i.cusUrl).str)});var o=null;if("image"==i.customType){var e=i.shareChecked,n=i.iconImageBgColor;o={src:i.iconCropped,imageType:"image",name:i.cusName,url:infinity.isUrl(i.cusUrl).str,uid:infinity.id("800")},void 0,infinity.setIconImageBgColorSrc(n,!1,o.src,function(n){i.isLoading=!0,infinity.uploadBase64Img({src:n,scope:"custom-icon/"},function(n,s){if(i.isLoading=!1,n)infinity.with("info",function(i){i.show(infinity.i18n("upload_img_failed"),!0)});else{o.src=s;try{infinity.modules["add-library"].onAddIcon(!1,o),i.onAddSuccess(),e&&infinity.sendMessage("shareIcon",{name:i.cusName,url:o.url,src:o.src})}catch(i){void 0}}})})}else{o={imageType:"color",name:i.cusName,url:infinity.isUrl(i.cusUrl).str,showText:i.showText,bgColor:i.selectColor,fontSize:i.fontSize,uid:infinity.id("800")};try{infinity.modules["add-library"].onAddIcon(!1,o),i.onAddSuccess()}catch(i){void 0}}}else infinity.with("alert",function(i){i.show(infinity.i18n("please_select_image"))});else infinity.with("alert",function(i){i.show(infinity.i18n("please_input_name"))})},isLoginToShare:function(){var i=this;infinity.getUserInfo().isLogin||1==i.shareChecked&&(infinity.with("info",function(i){i.show(infinity.i18n("please_login_before_share"),!0)}),infinity.with("login",function(o){o.show(),i.shareChecked=!1}))}}});