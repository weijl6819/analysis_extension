"use strict";var usWeatherDict;usWeatherDict={19:{color:"#B9B18F",img:"blowingsand.png"},22:{color:"#B9B18F",img:"ash.png"},26:{color:"#27CDFF",img:"cloudy.png"},27:{color:"#27CDFF",img:"cloudy.png"},28:{color:"#27CDFF",img:"cloudy.png"},29:{color:"#27CDFF",img:"cloudy.png"},30:{color:"#27CDFF",img:"cloudy.png"},44:{color:"#27CDFF",img:"cloudy.png"},9:{color:"#A1BAC6",img:"drizzle.png"},20:{color:"#AEAEAE",img:"fog.png"},21:{color:"#808080",img:"fogandhaze.png"},17:{color:"#A1BAC6",img:"hail.png"},41:{color:"#6C828D",img:"heavysnow.png"},43:{color:"#6C828D",img:"heavysnow.png"},13:{color:"#A1BAC6",img:"lightsnow.png"},14:{color:"#A1BAC6",img:"lightsnow.png"},15:{color:"#A1BAC6",img:"lightsnow.png"},16:{color:"#A1BAC6",img:"lightsnow.png"},25:{color:"#A1BAC6",img:"lightsnow.png"},31:{color:"#211A3E",img:"moon.png"},33:{color:"#211A3E",img:"moon.png"},6:{color:"#A1BAC6",img:"rainandsnow.png"},7:{color:"#A1BAC6",img:"rainandsnow.png"},18:{color:"#A1BAC6",img:"rainandsnow.png"},11:{color:"#A1BAC6",img:"shower.png"},12:{color:"#A1BAC6",img:"shower.png"},40:{color:"#A1BAC6",img:"shower.png"},8:{color:"#95BAD9",img:"sleet.png"},10:{color:"#95BAD9",img:"sleet.png"},32:{color:"#27CDFF",img:"sunny.png"},34:{color:"#27CDFF",img:"sunny.png"},3:{color:"#A1BAC6",img:"thunder.png"},4:{color:"#A1BAC6",img:"thunder.png"},37:{color:"#A1BAC6",img:"thunderstorm.png"},38:{color:"#A1BAC6",img:"thunderstorm.png"},39:{color:"#A1BAC6",img:"thunderstorm.png"},45:{color:"#A1BAC6",img:"thunderstorm.png"},47:{color:"#A1BAC6",img:"thunderstorm.png"},35:{color:"#A1BAC6",img:"thunderstormandhail.png"},0:{color:"#808080",img:"typhoon.png"},1:{color:"#808080",img:"typhoon.png"},2:{color:"#808080",img:"typhoon.png"},23:{color:"#27CDFF",img:"wind.png"},24:{color:"#27CDFF",img:"wind.png"},5:{color:"#A1BAC6",img:"rainandsnow.png"},46:{color:"#A1BAC6",img:"snowshowers.png"}},$(document).on("click",".w-section",function(e){e.target.className.indexOf("w-section-close")>=0||($(this).hasClass("w-section-less")?($(this).removeClass("w-section-less"),$(this).addClass("w-section-more")):($(this).removeClass("w-section-more"),$(this).addClass("w-section-less")))}),$(".weather-city-close").on("click",function(e){e.preventDefault(),$("#weather-city").hide()}),infinity.modules.weather=new Vue({el:"#weather-box",data:{time:(new Date).toLocaleString([infinity.lang],{hour:"2-digit",minute:"2-digit",hour12:!0}),lang:infinity.lang,tempUnitC:infinity.setting("tempUnitC"),citys:[],lastUpdateTime:"",isFirst:!0,leftzoom:infinity.get("infinity-settings").settingLeftSlideZoom/100},created:function(){var e=this;e.onMessage(),$(document).on("click","#weather-cover",function(i){i.preventDefault(),e.hide()}),$("#weather-box").on("transitionend",function(i){i.stopPropagation(),i.target.className.indexOf("sildeBox")>=0&&(i.target.className.indexOf("slide-show")>=0?(e.isInit||(e.init(),e.isInit=!0),$(".weather-splash").hide(),$(".weather-main").show()):($("#weather-box").hide(),$(".weather-main").removeClass("infinity-fadeIn-8")))})},methods:{init:function(){var e=this;e.setTime();var i=infinity.get("infinity-weather");e.citys=i.citys,e.lastUpdateTime=i.lastUpdateTime,e.isFirst=i.isFirst},topPosition:function(e){var i=this.citys[e];this.citys.$remove(i),this.citys.unshift(i);var t=infinity.get("infinity-weather");t.citys=this.citys,infinity.set("infinity-weather",t),infinity.sendMessage("autoBackup",{type:"data"})},show:function(){$("#weather-cover,#weather-box").show(),$("#weather-box").addClass("slide-show slide-box-shadow")},hide:function(){$("#weather-box").removeClass("slide-show slide-box-shadow"),$("#weather-cover").hide()},onMessage:function(){var e=this;infinity.onMessage("getWeatherDone",function(){var i=infinity.get("infinity-weather");e.citys=i.citys,e.lastUpdateTime=i.lastUpdateTime,e.isFirst=i.isFirst,e.showLoading=!1}),infinity.onMessage("weather-error",function(){e.showLoading=!1}),infinity.onMessage("onAddWeatherCityDone",function(){var i=infinity.get("infinity-weather");e.citys=i.citys,$(".w-all").stop().animate({scrollTop:0},300,"swing",function(){})})},onAddCity:function(){infinity.with("weather-add",function(e){e.show()})},showLoad:function(){this.showLoading=!0,infinity.sendMessage("reInitWeather")},transWeek:function(e){return new Date(e).toLocaleString([infinity.lang],{weekday:"short"})},setTime:function(){var e=this;setInterval(function(){e.time=(new Date).toLocaleString([infinity.lang],{hour:"2-digit",minute:"2-digit",hour12:!0})},6e4)},pmToDesc:function(e){return""==e?"":e<=50?infinity.i18n("air_a"):e>=51&&e<=100?infinity.i18n("air_b"):e>=101&&e<=150?infinity.i18n("air_c"):e>=151&&e<=200?infinity.i18n("air_d"):e>=201&&e<=300?infinity.i18n("air_e"):e>=301?infinity.i18n("air_f"):void 0},searchCity:function(e){var i=this,t=i.weatherInput,n=infinity.url+"search-city?city="+encodeURIComponent(t)+"&lang="+i.lang;i.isSearchingCity&&i.isSearchingCity.abort(),""!==t?i.isSearchingCity=$.getJSON(n,function(e){200==e.status&&(i.queryCitys=e.citys),i.isSearchingCity=!1}):i.queryCitys=""},queryWeather:function(e,i,t){var n=this,o="https://query.yahooapis.com/v1/public/yql?q=select * from weather.forecast where woeid="+i+"&format=json";$.getJSON(o,function(o){var r=n.handleWeatherResult(e,i,o);t(r)})},isHasCity:function(e,i){var t=chrome.i18n.getUILanguage(),n=infinity.url+"is-has-city?city="+encodeURIComponent(e)+"&lang="+t;$.getJSON(n,function(e){i(200==e.status?!0:!1)})},transUnit:function(e){try{var i=parseInt(e);return this.tempUnitC?Math.round((i-32)/1.8):i}catch(i){return e}},changeUnit:function(){this.tempUnitC=!this.tempUnitC,infinity.setting("tempUnitC",this.tempUnitC)},removeCity:function(e){var i=this.citys.indexOf(e);infinity.sendMessage("removeCity",{index:i})},handleWeatherResult:function(e,i,t){var n={name:e,woeid:i};if(0==t.query.count)return!1;var o={};o.cityName=t.query.results.channel.location.city,o.time=t.query.results.channel.lastBuildDate,o.Rtemp=t.query.results.channel.item.condition.temp,o.weather=t.query.results.channel.item.condition.code,o.weatherName=t.query.results.channel.item.forecast[0].text,o.Htemp=t.query.results.channel.item.forecast[0].high,o.Ltemp=t.query.results.channel.item.forecast[0].low,o.wind=t.query.results.channel.wind.speed;var r=1.609344*o.wind;o.wind=r<1?0:1<=r&&r<5?1:5<=r&&r<11?2:11<=r&&r<19?3:19<=r&&r<28?4:28<=r&&r<38?5:38<=r&&r<49?6:49<=r&&r<61?7:61<=r&&r<74?8:74<=r&&r<88?9:88<=r&&r<102?10:102<=r&&r<117?11:r>=117?12:0,o.week=t.query.results.channel.item.forecast[0].day,o.humidity=t.query.results.channel.atmosphere.humidity,o.pressure=t.query.results.channel.atmosphere.pressure,o.weather in usWeatherDict?(o.weatherIcon=usWeatherDict[o.weather].img,o.weatherColor=usWeatherDict[o.weather].color):(o.weatherIcon="sunny.png",o.weatherColor="#27CDFF"),n.today=o,n.days=[];for(var s=1;s<=4;s++){var a={weather:t.query.results.channel.item.forecast[s].code,Ltemp:t.query.results.channel.item.forecast[s].low,Htemp:t.query.results.channel.item.forecast[s].high,weatherName:t.query.results.channel.item.forecast[s].text,week:t.query.results.channel.item.forecast[s].day,date:t.query.results.channel.item.forecast[s].date};a.weather in usWeatherDict?(a.weatherIcon=usWeatherDict[a.weather].img,a.weatherColor=usWeatherDict[a.weather].color):(a.weatherIcon="sunny.png",a.weatherColor="#27CDFF"),n.days.push(a)}return{status:200,desc:"OK",data:n}}}});