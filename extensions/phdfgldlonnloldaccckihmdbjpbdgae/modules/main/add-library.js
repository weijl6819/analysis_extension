"use strict";infinity.modules["add-library"]=new Vue({el:"#add",data:{items:[],lists:[{id:"games",icon:"/modules/main/img/gamebox.png"},{id:"app"},{id:"news"},{id:"music"},{id:"photos"},{id:"shopping"},{id:"social"},{id:"sports"},{id:"life"},{id:"education"},{id:"tech"},{id:"finance"},{id:"read"},{id:"others"}],chromeApps:[],type:"popular",page:0,showInitLoading:!0,netError:!1,showLoading:!1,init:!1,showNoMore:!1,lockScroll:!1,leftClickShowloading:!1,keyword:"",iconSize:infinity.iconSize,lockAdd:!1,queryAjax:!1},created:function(){var i=this;setTimeout(function(){i.initLoading()},10),i.onsearch=$.debounce(200,!1,i.searched),$(document).on("mouseenter",".add-item-added",function(i){$(this).find(".add-btn-added").text(infinity.i18n("add_again"))}),$(document).on("mouseleave",".add-item-added",function(i){$(this).find(".add-btn-added").text(infinity.i18n("added"))}),infinity.onBroadcast("deleteDone",!0,function(){i.items=JSON.parse(JSON.stringify(i.items))})},methods:{show:function(){},reload:function(){var i=this;i.netError=!1,i.showInitLoading=!0,setTimeout(function(){i.getLists(function(){i.initLoading()})},10)},enterSearch:function(){var i=this;i.showNoMore=!1,i.page=0,i.type="search",i.items=[],i.showLoading=!0,i.onsearch()},keyupSearch:function(i){var n=this;32==i.which&&n.search()},search:function(){var i=this;i.showInitLoading||(i.showNoMore=!1,i.page=0,i.type="search",i.items=[],i.showLoading=!0,i.searched())},getAddPosition:function(){var i=infinity.get("infinity-settings"),n=infinity.get("infinity-icons"),e=i.row*i.column,t=n.length;for(var o in n)if(n[o].length<e){t=o;break}return parseInt(t)},searched:function(){var i=this;i.keyword?i.type="search":i.type="popular",i.query(function(){i.showLoading=!1,i.lockScroll=!1},function(){i.showLoading=!1,i.lockScroll=!1,i.init=!1,i.netError=!0,i.showInitLoading=!1})},scroll:function(i){var n,e,t,o=this;if(t=i.target.clientHeight,e=i.target.scrollHeight,n=i.target.scrollTop,t+n==e){if(o.lockScroll)return!1;o.showLoading=!0,o.query(function(){o.showLoading=!1},function(){o.showLoading=!1})}},getChromeAppIcon:function(i){return i.icons&&i.icons.length?i.icons[i.icons.length-1].url:"/lib/img/infinite.png"},getType:function(i,n){infinity.sendMessage("sendGa",{category:"addSideTabNav",event:"switch",label:n});var e=this;i.preventDefault(),e.showNoMore=!1,e.type=n,e.page=0,e.items=[],e.showLoading=!0,e.lockScroll=!1,e.leftClickShowloading=!0,setTimeout(function(){e.query(function(){e.showLoading=!1,e.lockScroll=!1,e.leftClickShowloading=!1,"app"==n&&(e.items=e.chromeApps.concat(e.items))},function(){e.showLoading=!1,e.lockScroll=!1,e.init=!1,e.netError=!0,e.showInitLoading=!1,e.leftClickShowloading=!1})},0)},getLists:function(i){i()},getUILanguage:function(){return chrome.i18n.getUILanguage()},query:function(i,n){var e=this;e.showNoMore=!1;var t="",o=chrome.i18n.getUILanguage();t="shareByUser"==e.type?infinity.url+"russia-get-icons?source="+e.type+"&lang="+o+"&page="+e.page:infinity.url+"russia-get-icons?type="+e.type+"&lang="+o+"&page="+e.page+"&keyword="+e.keyword,e.queryAjax&&e.queryAjax.abort(),e.queryAjax=$.getJSON(t,function(n,t,o){0==n.icons.length&&(e.showNoMore=!0);for(var a in n.icons)e.items.push(n.icons[a]);e.page=n.nextPage,i&&i()},function(){n&&n()}).fail(function(i,e,t){n&&"error"==e&&n()})},initLoading:function(){var i=this;i.query(function(){i.init=!0,i.showInitLoading=!1},function(){i.showLoading=!1,i.lockScroll=!1,i.init=!1,i.netError=!0,i.showInitLoading=!1,i.leftClickShowloading=!1})},launch:function(i){var n=this;chrome.management.get(i,function(e){e?e.enabled?chrome.management.launchApp(e.id,function(){}):infinity.with("confirm",function(i){i.show(infinity.i18n("app_disabled_enable_first"),function(i){i&&chrome.management.setEnabled(e.id,!0,function(){chrome.management.getAll(function(i){n.chromeApps=i.filter(function(i,n){return i.uid=i.id,i.isApp})}),chrome.management.launchApp(e.id,function(){})})})}):infinity.with("confirm",function(n){n.show(infinity.i18n("no_this_app_go_chrome_store_download"),function(n){n&&window.open("https://chrome.google.com/webstore/detail/"+i)})})})},openUrl:function(i,n){var e=this,t=i.url;if(t.indexOf("chrome://")>=0)chrome.tabs.create({url:t});else if(t.indexOf("infinity://")>=0)switch(t){case"infinity://weather":infinity.with("weather",function(i){i.show()});break;case"infinity://todos":infinity.with("todos",function(i){i.show()});break;case"infinity://chrome-apps":infinity.with("chrome-apps",function(i){i.show()});break;case"infinity://notes":infinity.with("notes",function(i){i.show()});break;case"infinity://history":infinity.requestPermission(["history"]).then(function(){infinity.with("history",function(i){i.show()})});break;case"infinity://bookmarks":infinity.with("bookmarks",function(i){i.show()});break;case"infinity://extension":infinity.with("extension",function(i){i.show()});break;case"infinity://settings":infinity.with("main",function(i){i.show("setting")});break;case"infinity://wallpaper":infinity.with("wallpaper",function(i){i.showLibrary()});break;default:infinity.with("alert",function(i){i.show(infinity.i18n("not_support"))})}else 0==t.indexOf("chrome-app://")?e.launch(t.replace("chrome-app://",""),i.uid):window.open(t,"_blank")},addIcon:function(i){var n=this;if(!n.lockAdd){infinity.sendMessage("sendGa",{category:"icon",event:"add",label:infinity.getHost(i.url)}),i.isApp&&(i.src=n.getChromeAppIcon(i),i.infinityType="chromeApp",i.url=i.id,i.uid=i.id);var e={src:i.src+"?imageMogr2/thumbnail/"+infinity.iconSize+"x/format/webp/blur/1x0/quality/100|imageslim",imageType:"image",name:i.name,url:i.url,uid:i.uid};0==e.src.indexOf("chrome://extension-icon")?infinity.setIconImageBgColorSrc("#ffffff",!0,e.src,function(t){e.src=t,n.onAddIcon(i,e)}):n.onAddIcon(i,e)}},onAddIcon:function(i,n){var e=this,t=infinity.get("infinity-icons"),o=e.getAddPosition();n.name=infinity.i18n(n.name);var a=!1;t[o]?t[o].push(n):(t.push([]),t[o].push(n),a=!0),infinity.set("infinity-icons",t),infinity.broadcast("addDone"),i&&Vue.set(i,"isLoading",!0),void 0,1==t.length&&1==t[0].length?(loadIcons(),infinityView.setIconAddingStatus()):(void 0,e.addDone(o,n,a)),i&&setTimeout(function(){Vue.set(i,"isLoading",!1)},300)},setAddUnloading:function(i){var n=this;for(var e in n.items)n.items[e].uid==i&&(n.items[e].isLoading=!1)},addDone:function(i,n,e){var t=this;try{_edit.end()}catch(i){}e&&($(".home-icon-first").before('<div class="home-icon-box home-page"></div>'),infinityView.setIconAddingStatus()),infinityView.setPoint();var o=encodeURIComponent(JSON.stringify(n)),a=n.src?"url("+n.src+")":"none",s=document.createElement("div");s.className="home-icon home-icon-setting home-icon-scale0",s.setAttribute("draggable",!0),s.innerHTML='<div class="home-icon-img" data-url="'+n.url+'" icon-data="'+o+'" style="background-image:'+a+";background-color: "+(n.bgColor||"transparent")+';"><div class="home-icon-text" style="font-size:'+(n.fontSize||"44px")+'px;">'+(n.showText||"")+'</div><div class="home-icon-delete-bu"></div><div class="home-icon-edit"></div></div><div class="home-icon-name">'+n.name+"</div>",$(".home-page:nth-child("+(i+2)+")").append(s),infinity.setPoint(null,i),t.lockAdd=!0,infinityView.slideToPage(i+1,!0,function(){$(s).addClass("home-icon-animate"),t.lockAdd=!1,void 0}),infinity.sendMessage("setIconFlat"),infinity.sendMessage("autoBackup",{type:"icon"}),n.uid.indexOf("800")>=0||infinity.sendMessage("rateIcon",{uid:n.uid})},isAdded:function(i){var n=infinity.get("infinity-iconsFlat");for(var e in n)if(n[e].uid&&n[e].uid==i)return!0;return!1},refresh:function(){var i=this,n=JSON.parse(JSON.stringify(this.items));i.items=[],i.items=n},addCustomShow:function(){infinity.with("add-custom","#main-box",function(i){i.show()})}}});