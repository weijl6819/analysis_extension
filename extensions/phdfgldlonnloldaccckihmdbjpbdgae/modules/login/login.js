"use strict";infinity.modules.login=new Vue({el:"#login",data:{social:null,showLoading:!1,user:infinity.get("infinity-user"),userEmail:"",userPassWord:"",isLegalEmail:!1,windowObject:""},created:function(){var i=this;$(document).on("animationend",".login-right",function(i){}),$(document).on("animationend webkitAnimationEnd",".login-box",function(i){i.target.className.indexOf("login-fade-out")>=0&&($("#login").hide(),$(".login-box").removeClass("login-fade-out"),$(".login-cover").removeClass("infinity-fadeOut-3"))}),infinity.onMessage("loginStatusChange",function(){var n=infinity.get("infinity-user");i.user=n,n.isLogin&&$("#login").is(":visible")?($(".login-box").addClass("login-fade-out"),$(".login-cover").addClass("infinity-fadeOut-3")):i.showLoading=!1})},methods:{cancelLoginBtn:function(){this.showLoading=!1;try{this.windowObject.close()}catch(i){}},show:function(i){var n=this;$("#login").css("display","flex"),i&&(n.userEmail=i)},hide:function(){$("#login").hide(),this.userEmail="",this.userPassWord=""},closeLogin:function(){this.hide()},loginBy:function(i){var n=this,o={facebook:"Facebook",google:"Google",qq:"QQ",weibo:infinity.i18n("weibo"),wechat:"wechat"},e=encodeURIComponent(infinity.url+"on-login/"),t={facebook:infinity.url+"login/"+i+"/",google:"https://accounts.google.com/o/oauth2/v2/auth?scope=profile&response_type=code&client_id=10687398329-ars3upmvj4b6rc2surhre8g8go8jbclj.apps.googleusercontent.com&redirect_uri="+e+"google",qq:"https://graph.qq.com/oauth2.0/show?which=Login&display=pc&response_type=code&client_id=101410947&redirect_uri="+e+"qq",weibo:"https://api.weibo.com/oauth2/authorize?client_id=1463590312&redirect_uri="+e+"weibo",wechat:"https://open.weixin.qq.com/connect/qrconnect?state=123&appid=wx5af98300f5d18d16&response_type=code&scope=snsapi_login&redirect_uri="+e+"wechat"};this.showLoading=!0,this.social=o[i];var s=t[i];setTimeout(function(){n.windowObject=window.open(s,"_blank")},300)},userLogin:function(){if(this.isLegalEmail){var i=this;infinity.require("/lib/js/md5.min",function(){var n=md5(i.userPassWord);i.loginGet(n)})}},loginGet:function(i){var n=this,o=infinity.url+"login/infinity";$.ajax({url:o,type:"post",beforeSend:function(){n.showLoading=!0},data:{email:n.userEmail,password:i},success:function(i){200==i.status?infinity.sendMessage("loginsuccess",i.msg):infinity.with("info",function(i){i.show(infinity.i18n("username_or_password_error"),!0)})},complete:function(){setTimeout(function(){n.showLoading=!1},300)},error:function(i){0===i.status?infinity.with("info",function(i){i.show(infinity.i18n("network_error_please_try_later"),!0)}):infinity.with("info",function(i){i.show(infinity.i18n("login_failed_please_try_later"),!0)})}})},validateEmail:function(){var i=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;this.userEmail=this.userEmail.trim();var n=i.test(this.userEmail),o=this.userPassWord.trim().length;if(n){if(0!=o)return void(this.isLegalEmail=!0);this.isLegalEmail=!1}else this.isLegalEmail=!1}},computed:{isLegalEmail:function(){var i=this.userEmail.trim().length,n=this.userPassWord.trim().length;return!!i&&0!=n}}});