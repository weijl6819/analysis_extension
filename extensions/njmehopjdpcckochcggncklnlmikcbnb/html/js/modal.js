"use strict";function getCurrentLocale(){let e=window.location.origin.split(".").reverse()[0],t={};return t.com={locale:"en-US",currency:"USD"},t.ca={locale:"en-CA",currency:"CAD"},t.mx={locale:"es-MX",currency:"MXN"},t.de={locale:"de-DE",currency:"EUR"},t.es={locale:"es-ES",currency:"EUR"},t.fr={locale:"fr-FR",currency:"EUR"},t.it={locale:"it-IT",currency:"EUR"},t.uk={locale:"en-GB",currency:"GBP"},t.jp={locale:"ja-JP",currency:"JPY"},t[e]}function getStockStats(){isSsFirstRun=!1,makeTabActive("#stock-stats"),showModal(".inventory-level-modal");const e=extractAsin();showPreview(e),getDataTable().clear(),chrome.runtime.sendMessage({type:"get-sellers",asin:e})}function getBlackBox(){makeTabActive("#black-box-tab"),showModal(".xray-modal"),addBlackboxRecords(!1),isBbFirstRun=!1}function getCalculator(e){makeTabActive("#profitabily-calculator-tab"),showModal(".profitabily-calculator-modal"),e&&(calculatorApp.predefinedAsin=e),$("#profitabily-calculator-tab .container"),calculatorApp.$mount("#profitabily-calculator-tab .container")}function makeTabActive(e){$(".tab.active").removeClass("active"),$('[href="'+e+'"]').addClass("active"),$(".container6 .content-div").each(function(e,t){$(t).hasClass("hide")||$(t).addClass("hide")}),$(e).removeClass("hide"),$(e).find(".content-div").removeClass("hide"),$(".h10-bb-settings-popup").addClass("hide")}function getDataTable(){return!1===dt&&(dt=$("#sellers-table").DataTable({paging:!1,searching:!1,autoWidth:!1,bInfo:!1,createdRow:function(e,t,a){$(e).addClass("seller-row "+t.key).data("seller",t.key).data("offer",t.offer)},columns:[{name:"Seller",data:"Seller",title:"Seller",className:"h10-sellers-table-seller"},{name:"Stock",data:"Stock",title:"Stock",orderDataType:"dom-text-numeric",className:"h10-sellers-table-stock stock"},{name:"Price",data:"Price",title:"Price",className:"h10-sellers-table-price",render:function(e){return e.toLocaleString(getCurrentLocale().locale,{style:"currency",currency:getCurrentLocale().currency,maximumFractionDigits:2})}},{name:"Fulfillment",data:"Fulfillment",title:"Fulfillment",className:"h10-sellers-table-fulfillment"},{name:"Rating",data:"Rating",title:"Rating",className:"h10-sellers-table-rating "}]}),$("#sellers-table-body").html('<td colspan="5" style="text-align: center;"><i class="fa fa-spinner fa-spin fa-fw"></i></td>'),$(".container6").trigger("resize")),dt}function updateRowData(e,t){let a=getBlackBoxDataTable().row(e).data();1===a.Fulfillment?a.Seller="Amazon":a.Seller=t.sellerName,a.Brand=t.brand,a.Title=t.title,t.bsr>0&&(a.BSR=t.bsr,$(e).find("td.h10-bb-bsr").text(t.bsr.toLocaleString(getCurrentLocale().locale))),$(e).data("isSponsored")?$(e).find("td.h10-bb-title").html("<div>"+sponsoredImageHtml+t.title+"</div>").find("div").attr("title",t.title):$(e).find("td.h10-bb-title").html("<div>"+t.title+"</div>").find("div").attr("title",t.title),a.Category||(a.Category=t.category,$(e).find("td.h10-bb-category").html("<div>"+t.category+"</div>").find("div").attr("title",t.category).tooltipster()),t.reviewsRating>0?a.Rating=t.reviewsRating:a.Rating=0,a.Reviews=t.reviewsNumber,getBlackBoxDataTable().row(e).invalidate(),a.SellersNumber<0&&$(e).find("td.h10-bb-sellers-number").html('<span style="color:#999">n/a</span>'),$(e).find("td.h10-bb-brand").html("<div>"+t.brand+"</div>").find("div").attr("title",t.brand),$(e).find("td.h10-bb-seller").html("<div>"+a.Seller+"</div>").find("div").attr("title",a.Seller).tooltipster(),$(e).find("td.h10-bb-reviews").text(t.reviewsNumber.toLocaleString(getCurrentLocale().locale)),$(e).find("td.h10-bb-rating").text(a.Rating)}function showGraph(e,t){const a=$(t).find("td.h10-bb-salesGraph");a.is(":visible")?a.sparkline(e.chartPoints,{type:"line",lineColor:"#a3bff6",fillColor:"#ebf1fe",lineWidth:1,spotColor:"#a3bff6",minSpotColor:"#a3bff6",maxSpotColor:"#a3bff6",highlightSpotColor:"#a3bff6",highlightLineColor:"#a3bff6",spotRadius:0,disableTooltips:!0,disableInteraction:!0,height:19}):setTimeout(function(){showGraph(e,t)},1e3)}function getBlackBoxDataTable(){const e=chrome.extension.getURL("html/images/svg/setting.svg");if(!1===bbDt){const t=$("#black-box-table");bbDt=t.DataTable({bInfo:!1,paging:!1,searching:!1,autoWidth:!0,order:[[1,"desc"]],scrollY:300,scrollCollapse:!0,scrollX:!0,fixedColumns:{leftColumns:4,rightColumns:1},createdRow:function(e,t,a){if($(e).addClass("asin-row-"+t.key).data("asin",t.key).data("imageUrl",t.imageUrl).data("isSponsored",t.isSponsored).data("isLimit",t.isLimit).data("error",t.error).data("position",t["Include in analysis"]),t.imageUrl){(new Image).src=t.imageUrl}t.chartPoints&&showGraph(t,e);const n=asinCachePrefix+t.key;chrome.storage.local.get(n,function(t){Object.keys(t).length?updateRowData(e,t[n]):console.log("cache error for "+n)})},rowCallback:function(e,t,a,n,r){if(t.SellersNumber<0&&$(e).find("td.h10-bb-sellers-number").html('<span style="color:#999">n/a</span>'),!t.Revenue){const a=$(e).find("td.h10-bb-monthly-revenue");a.html('<span style="color:#999">n/a</span>'),a.hasClass("tooltipstered")||a.tooltipster({content:t.error})}if(!t.BSR){const a=$(e).find("td.h10-bb-bsr");a.html('<span style="color:#999">n/a</span>'),a.hasClass("tooltipstered")||a.tooltipster({content:t.error})}if(!t.Sales){const a=$(e).find("td.h10-bb-sales");a.html('<span style="color:#999">n/a</span>'),a.hasClass("tooltipstered")||a.tooltipster({content:t.error})}},columns:[{name:"#",data:"Include in analysis",title:"#",className:"h10-bb-inc-in-analysis-wrapper"},{name:"ASIN",data:"ASIN",title:"ASIN",className:"h10-bb-asin",render:function(e){return'<a href="/dp/'+e+'" target="_blank" > '+e+"</a>"}},{name:"Brand",data:"Brand",title:"Brand",className:"h10-bb-brand",render:function(e,t,a,n){return'<div  title="'+e+'"> '+e+"</div>"}},{name:"Title",data:"Title",title:"Title",className:"h10-bb-title",render:function(e,t,a,n){return a.isSponsored?"<div title='"+e+"'> "+sponsoredImageHtml+e+"</div>":"<div title='"+e+"'> "+e+"</div>"}},{name:"Category",data:"Category",title:"Category",className:"h10-bb-category",render:function(e,t,a,n){return'<div title="'+e+'"> '+e+"</div>"}},{name:"Seller",data:"Seller",title:"BuyBox",className:"h10-bb-seller"},{name:"SellersNumber",data:"SellersNumber",title:"#",className:"h10-bb-sellers-number",orderable:!0},{name:"Fulfillment",data:"Fulfillment",title:'<i class="fa fa-truck" aria-hidden="true"></i>',className:"h10-bb-fulfillment",render:function(e){switch(e){case 1:return"AMZ";case 2:return"FBA";case 3:return"MFN";case 4:return'<span class="h10-bb-blur">FLF</span>';default:return"N/A"}}},{name:"Price",data:"Price",title:"Price",className:"h10-bb-price",orderSequence:["desc","asc"],render:function(e){return e=e>1e3?e.toLocaleString(getCurrentLocale().locale,{style:"currency",currency:getCurrentLocale().currency,minimumFractionDigits:0,maximumFractionDigits:0}):e.toLocaleString(getCurrentLocale().locale,{style:"currency",currency:getCurrentLocale().currency})}},{name:"Margin",data:"Margin",title:"FBA fee",className:"h10-bb-unit-margin",orderSequence:["desc","asc"],render:function(e){return e.toLocaleString(getCurrentLocale().locale,{style:"currency",currency:getCurrentLocale().currency})}},{name:"Sales",data:"Sales",title:"Sales",className:"h10-bb-sales",orderSequence:["desc","asc"],render:function(e){return e.toLocaleString(getCurrentLocale().locale)}},{name:"Sales 30",data:"Sales 30",title:'Sales <i class="fa fa-line-chart"></i>',className:"h10-bb-salesGraph",orderable:!1},{name:"Revenue",data:"Revenue",title:"Revenue",className:"h10-bb-monthly-revenue",orderSequence:["desc","asc"],render:function(e){return e.toLocaleString(getCurrentLocale().locale,{minimumFractionDigits:2})}},{name:"BSR",data:"BSR",title:'BSR <i class="fa fa-line-chart"></i>',className:"h10-bb-bsr",render:function(e){return e.toLocaleString(getCurrentLocale().locale)}},{name:"Rating",data:"Rating",title:"Rating",className:"h10-bb-rating"},{name:"Reviews",data:"Reviews",title:'Review Count <i class="fa fa-line-chart"></i>',className:"h10-bb-reviews",render:function(e){return e.toLocaleString(getCurrentLocale().locale)}},{name:"Review Velocity",data:"Review Velocity",title:"Review Velocity",className:"h10-bb-reviews-velocity",render:function(e){if(!Number.isInteger(e))return'<span style="color:#999">n/a</span>';let t="#999";return e>0&&(t="#62cb31"),e<0&&(t="#e74c3c"),'<span style="color:'+t+'">'+e+"</span>"}},{name:"Dimensions",data:"Dimensions",title:"Dimensions",className:"h10-bb-dimensions",render:function(e){return e.toString()}},{name:"Weight",data:"Weight",title:"Weight",className:"h10-bb-weight",render:function(e){return e.toString()}},{name:"Size Tier",data:"Size Tier",title:"Size Tier",className:"h10-bb-size-tier",render:function(e){return e.toString()}},{name:"Images",data:"Images",title:"Images",className:"h10-bb-images",render:function(e){return e.toString()}},{name:"Pin",data:"Pin",title:'<img class="h10-bb-settings" src="'+e+'" height="20px" alt=""/>',className:"h10-bb-pin",orderable:!1,render:function(e,t,a,n){return'<i class="fa fa-thumb-tack"></i>'}}]});let a="";t.on("preDraw.dt",function(){a=$("#h10-bb-load-second-page").clone()}).on("draw.dt",function(){a.length&&!$("#h10-bb-load-second-page").length&&($("#black-box-table-body").append(a),$(".DTFC_LeftBodyLiner table").append('<tr><td colspan="4">&nbsp;</td></tr>'),$(".DTFC_RightBodyLiner table").append("<tr><td>&nbsp;</td></tr>")),$(".DTFC_LeftBodyLiner td.h10-bb-brand div").tooltipster(),$(".DTFC_LeftBodyLiner td.h10-bb-title div").tooltipster(),$(".DTFC_RightBodyLiner td.h10-bb-pin").tooltipster({content:"Save to my list"})}),setTimeout(function(){$("th.h10-bb-seller").tooltipster({content:"BuyBox owner"}),$("th.h10-bb-sellers-number").tooltipster({content:"Number of active sellers"}),$("th.h10-bb-fulfillment").tooltipster({content:"Fulfillment: Amz (Amazon), FBA (Fulfilled by Amazon) or MFN (Fulfilled by seller/manufacturer)"}),$("th.h10-bb-unit-margin").tooltipster({content:"Estimated FBA fee"}),$("th.h10-bb-bsr").tooltipster({content:"Recent BSR (Click for trend chart)"}),$("th.h10-bb-sales").tooltipster({content:"Estimated number of sales over the last 30 days"}),$("th.h10-bb-monthly-revenue").tooltipster({content:"Estimated revenue over the last 30 days"}),$("th.h10-bb-rating").tooltipster({content:"Amazon star rating"}),$("th.h10-bb-reviews").tooltipster({content:"Total number of reviews"}),$("th.h10-bb-reviews-velocity").tooltipster({content:"Change in review count over the last 30 days"})},500),$(document).on("click",".h10-bb-settings",function(){$(".h10-bb-settings-popup").toggleClass("hide")}),$(document).on("click","td.h10-bb-bsr ",function(){const e=$(this).parent(),t="https://systems.helium10.com/chart/index?asin="+e.data("asin")+"&range=30&marketplace="+getCurrentMarketplaceId();$("#h10-bb-graph-popup-spinner").show(),$(".h10-bb-graph-popup-header-title").html("<strong>BSR Chart</strong> "),$(".h10-bb-graph-popup-header-title").append(e.find(".h10-bb-title").text()),$(".h10-bb-graph-popup").removeClass("hide"),$("#black-box-tab").css("opacity",.2),setTimeout(function(){$("#h10-bb-graph-popup-spinner").hide(),$("#h10-bb-10-chart-iframe").show(),$("#h10-bb-10-chart-iframe").attr("src",t)},1e3)}),$(document).on("click","td.h10-bb-reviews ",function(){const e=$(this).parent(),t="https://members.helium10.com/black-box/review-chart?asin="+e.data("asin")+"&range=30&marketplace="+getCurrentMarketplaceId();$("#h10-bb-graph-popup-spinner").show(),$(".h10-bb-graph-popup-header-title").html("<strong>Reviews Chart</strong> ").append(e.find(".h10-bb-title").text()),$(".h10-bb-graph-popup").removeClass("hide"),$("#black-box-tab").css("opacity",.2),setTimeout(function(){$("#h10-bb-graph-popup-spinner").hide(),$("#h10-bb-10-chart-iframe").show().attr("src",t)},1e3)}),$(document).on("click"," td.h10-bb-salesGraph",function(){if(!$(this).find("canvas").get(0))return!1;const e=$(this).parent(),t="https://members.helium10.com/black-box/sales-chart?days=30&asin="+e.data("asin")+"&marketplace="+getCurrentMarketplaceId();$("#h10-bb-10-chart-iframe").attr("src",t),$("#h10-bb-graph-popup-spinner").show(),setTimeout(function(){$("#h10-bb-graph-popup-spinner").hide(),$("#h10-bb-10-chart-iframe").show()},2e3),$(".h10-bb-graph-popup-header-title").html("<strong> Sales Chart </strong>"),$(".h10-bb-graph-popup-header-title").append(e.find(".h10-bb-title").text()),$(".h10-bb-graph-popup").removeClass("hide"),$("#black-box-tab").css("opacity",.2)}),$(document).on("click",".h10-bb-graph-popup-header-close",function(){$("#h10-bb-10-chart-iframe").attr("src",null).hide(),$("#h10-bb-graph-popup-spinner").show(),$(".h10-bb-graph-popup").addClass("hide"),$("#black-box-tab").css("opacity",1)}),$(document).on("click",".container6",function(e){const t=$(e.target);try{if(t.parent().find("canvas").get(0)||t.attr("class")&&t.attr("class").includes("h10-bb-graph-popup")||t.attr("class")&&t.attr("class").includes("h10-bb-bsr"))return!1}catch(e){console.log(e)}$("#h10-bb-10-chart-iframe").attr("src",null).hide(),$(".h10-bb-graph-popup").addClass("hide"),$("#h10-bb-graph-popup-spinner").show(),$("#black-box-tab").css("opacity",1)}),$(document).on("click",".h10-bb-screenshot-action",function(){let e=[],t=[];$("#black-box-table thead th").each(function(){if($(this).is(".h10-bb-pin"))return!0;$(this).hasClass("h10-bb-fulfillment")?t.push("Fulfillment"):t.push($(this).text().trim())}),e.push(t),$("#black-box-table tbody tr").each(function(){if("bb-graph-wrapper"==$(this).attr("id"))return!0;if("h10-bb-load-second-page"==$(this).attr("id"))return!0;t=[];let a=$(this).data("isLimit");$(this).find("td").each(function(){if($(this).is(".h10-bb-pin"))return!0;if($(this).hasClass("h10-bb-salesGraph"))return $(this).find("canvas").get(0)?t.push($(this).find("canvas").get(0).toDataURL()):t.push(""),!0;let e=$(this).text().trim();$(this).is(".h10-bb-price , .h10-bb-sales , .h10-bb-bsr , .h10-bb-monthly-revenue , .h10-bb-unit-margin , .h10-bb-fulfillment")&&a&&(e="Xray limit reached"),$(this).is(".h10-bb-asin , .h10-bb-brand , .h10-bb-title , .h10-bb-seller , .h10-bb-category ")&&(e="[blur]"),t.push(e)}),e.push({isSponsored:$(this).data("isSponsored"),rowData:t})});const a={"screenshot-data":e,"search-volume":$("#h10-bb-search-volume").text()};chrome.storage.local.set(a,function(){chrome.runtime.sendMessage({type:"get-screenshot-page"})})}),$(document).on("click",".h10-bb-csv-action",function(){let e="";$("#black-box-table th").each(function(){const t=$(this).text().trim();$(this).hasClass("h10-bb-salesGraph")||$(this).hasClass("h10-bb-inc-in-analysis-wrapper")||($(this).hasClass("h10-bb-fulfillment")?e+="Fulfillment ,":e+=t+",")}),e+="\r\n",$("#black-box-table tbody tr").each(function(){const t=$(this).data("isSponsored"),a=$(this).data("isLimit");$(this).find("td").each(function(){if($(this).attr("colspan"))return;let n=$(this).text().trim();$(this).hasClass("h10-bb-salesGraph")||$(this).hasClass("h10-bb-inc-in-analysis-wrapper")||($(this).is(".h10-bb-title , .h10-bb-seller , .h10-bb-brand , .h10-bb-category")&&(n=n.replace(/"/g,'""'),t&&(n="($) "+n),n='"'+n+'"'),$(this).is(".h10-bb-price , .h10-bb-reviews , .h10-bb-sales , .h10-bb-bsr , .h10-bb-monthly-revenue , .h10-bb-unit-margin")&&(n=n.replace(/[^0-9.-]+/g,"")),$(this).is(".h10-bb-price , .h10-bb-sales , .h10-bb-bsr , .h10-bb-monthly-revenue , .h10-bb-unit-margin , .h10-bb-fulfillment")&&a&&(n="Xray limit reached"),e+=n+",")}),e+="\r\n"});const t=new Blob([e],{type:"text/csv;charset=utf-8;\ufeff"}),a=document.createElement("a"),n=URL.createObjectURL(t);a.setAttribute("href",n),a.setAttribute("download","Helium_10_Xray_export.csv"),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)}),$(document).on("click","td.h10-bb-pin",function(){const e=$(this).find("i"),t=$("#black-box-table ."+$(this).parent("tr").attr("class").replace(/^(\S*).*/,"$1")).first().data("asin");e.toggleClass("clicked"),e.hasClass("clicked")?$.ajax({method:"POST",url:App.config.memberAccountUrl+"/black-box/add-to-list",dataType:"json",data:{asin:t,marketplace:getCurrentMarketplaceId()}}).done(function(e){}):$.ajax({method:"POST",url:App.config.memberAccountUrl+"/black-box/remove-from-list",dataType:"json",data:{asin:t,marketplace:getCurrentMarketplaceId()}}).done(function(e){})}),$(document).on("mouseover",".DTFC_LeftBodyWrapper td.h10-bb-asin",function(){const e=$("#black-box-table ."+$(this).parent("tr").attr("class").replace(/^(\S*).*/,"$1")).first(),t=e.find(".h10-bb-title").text(),a=e.find(".h10-bb-rating").text(),n=e.find(".h10-bb-reviews").text(),r=e.find(".h10-bb-price").text(),s=e.data("imageUrl");$(".h10-bb-asin-preview img.h10-bb-asin-preview-img").attr("src",s),$(".h10-bb-asin-preview-rating").raty({score:a,readOnly:!0,hints:null}),$(".h10-bb-asin-preview-title").text(t),$(".h10-bb-asin-preview-rating-count").text(n),$(".h10-bb-asin-preview-price").text(r),$(".h10-bb-asin-preview").removeClass("hide")}),$(document).on("mouseout",".DTFC_LeftBodyWrapper td.h10-bb-asin",function(){$(".h10-bb-asin-preview").addClass("hide")})}return bbDt}function extractAsinsFromPage(e,t){let a=[],n=[],r=[];const s=["B007RP7JU0","B00SG78GB4","B077BPG968","B00T6TNUH6","B079KFGXML","ACSVBGNA01","B079HRLQ87","B07BDRBQGB"];return $(e).find("#zg_centerListWrapper").length>0&&$(e).find("#zg_centerListWrapper .zg_itemImmersion").each(function(e,r){const i=$(r).find(".p13n-asin").data("p13n-asin-metadata").asin;i&&-1===$.inArray(i,a)&&-1===$.inArray(i,s)&&(a.push(i),t++,n.push({asin:i,position:t,isSponsored:!1}))}),$(e).find(".zg-item-immersion .a-list-item").length>0&&$(e).find(".zg-item-immersion .a-list-item").each(function(e,r){let i=$(this).find("a.a-link-normal").first().attr("href").match(/\/(dp|product|asin)\/([0-9A-Za-z]{10,})/);if(!i||0===i.length)return!1;let o=i[2];o&&-1===$.inArray(o,a)&&-1===$.inArray(o,s)&&(a.push(o),t++,n.push({asin:o,position:t,isSponsored:!1}))}),($(e).find("#s-results-list-atf").length>0||$(e).find(".s-results-list").length>0)&&$(e).find(".s-result-item.celwidget").each(function(e,i){const o=$(i).data("asin"),l=$(i).hasClass("AdHolder")||$(i).find(".s-sponsored-header").length,c={asin:o,isSponsored:l};o&&(-1===$.inArray(o,a)||!l&&-1!==$.inArray(o,r))&&-1===$.inArray(o,s)&&(a.push(o),t++,c.position=t,n.push(c),l&&r.push(o))}),$(e).find(".s-result-list .s-result-item").length>0&&$(e).find(".s-result-list .s-result-item").each(function(e,n){const i=$(n).data("asin"),o=$(n).hasClass("AdHolder")||$(n).find(".s-sponsored-header").length,l={asin:i,isSponsored:o};let c=[];i&&(-1===$.inArray(i,a)||!o&&-1!==$.inArray(i,r))&&-1===$.inArray(i,s)&&(a.push(i),t++,l.position=t,c.push(l),o&&r.push(i))}),n}function loadSecondPage(e,t){const a=new URLSearchParams(e);let n=a.get("page");n||(n=1),a.set("page",n+1),console.log("second page"),$.ajax({method:"GET",url:a.toString(),timeout:15e3,xhr:function(){const e=jQuery.ajaxSettings.xhr(),t=e.setRequestHeader;return e.setRequestHeader=function(e,a){"X-Requested-With"!==e&&"Referer"!==e&&t.call(this,e,a)},e}}).done(function(e){addBlackboxRecords(!0,extractAsinsFromPage(e,t))})}function addBlackboxRecords(e,t){$("#h10-bb-load-second-page").remove(),$("#h10-bb-activity-indicator").show();let a;if(!e){let e=!1;if(($("li.s-result-item").length>0||$("div.s-result-item.sg-col").length>0)&&(e=$('input[name="field-keywords"]').val()),e){$(".h10-bb-viability-score-column").show();let t=e;e.length>40&&(t=e.substr(0,40)+"..."),$("#h10-bb-search-term").attr("title",e).text(" - "+t).tooltipster(),$.ajax({method:"post",url:"https://members.helium10.com/black-box/search-volume",dataType:"json",data:{keyword:e,marketplace:getCurrentMarketplaceId()}}).done(function(e){const t=$("#h10-bb-search-volume");let a;switch(e.status){case"error":case"no-data":case"limit":t.text(" (search volume: n/a)");break;case"success":a=e.data.exact.toLocaleString(getCurrentLocale().locale),t.text(" (search volume: "+a+")")}})}else $("#zg_centerListWrapper").length>0||$("#zg-center-div").length>0||$(".h10-bb-viability-score-column").hide();$("#black-box-table-summary td.h10-bb-summary-numbers").addClass("h10-bb-preloader-grey").not("#h10-bb-viability-score").text("00.00"),$("#h10-bb-viability-score").html('<i class="fa fa-star-o"></i> <i class="fa fa-star-o"></i> <i class="fa fa-star-o"></i> <i class="fa fa-star-o"></i> <i class="fa fa-star-o"></i>'),getBlackBoxDataTable().clear();const n=chrome.runtime.getURL("html/images/svg/rolling.svg");$("#black-box-table-summary").after('<div id="bb-preloader" style="text-align: center;"><img class="fa-spin" src="'+n+'"><div class="bb-line-1">Wait, not so fast </div>\n<div class="bb-line-2">For the extension to work correctly, try loading it on a page with tons of products!</div></div>'),$("#black-box-table_wrapper").hide();let r=[];t=[];let s=[],i=[];a=0;const o=["B007RP7JU0","B00SG78GB4","B077BPG968","B00T6TNUH6","B079KFGXML","ACSVBGNA01","B079HRLQ87","B07BDRBQGB","B06XY7K1DZ"];if(extractAsin()){const e=$("body").attr("data-h10-detail-state");if(e&&e.length>10){const n=JSON.parse(e),s=Object.keys(n.asin_variation_values);r=r.concat(s),$.each(s,function(e,n){t.push({asin:n,position:a++,isSponsored:!1})})}else r.push(extractAsin()),a++,t.push({asin:extractAsin(),position:a,isSponsored:!1}),s=$(".swatchSelect ,.swatchAvailable").map(function(){const e=$(this).data("defaultasin");if(e!=extractAsin())return a++,t.push({asin:e,position:a,isSponsored:!1}),e}).get(),r=r.concat(s),s=$(".twisterShelf_swatch").map(function(){const e=$(this).data("dp-url").match("/([A-Z0-9]{10})(?:[#/?]|$)");if(e&&0!==e.length&&t.push({asin:e[1],position:++a,isSponsored:!1}),e&&e[1]&&e[1]!=extractAsin())return e[1]}).get(),r=r.concat(s)}else{$("#zg_centerListWrapper").length>0&&$("#zg_centerListWrapper .zg_itemImmersion").each(function(e,n){const s=$(n).find(".p13n-asin").data("p13n-asin-metadata").asin;s&&-1===$.inArray(s,r)&&-1===$.inArray(s,o)&&(r.push(s),a++,t.push({asin:s,position:a,isSponsored:!1}))}),$(".zg-item-immersion .a-list-item").length>0&&$(".zg-item-immersion .a-list-item").each(function(e,n){let s=$(this).find("a.a-link-normal").first().attr("href").match(/\/(dp|product|asin)\/([0-9A-Za-z]{10,})/);if(!s||0===s.length)return;let i=s[2];i&&-1===$.inArray(i,r)&&-1===$.inArray(i,o)&&(r.push(i),a++,t.push({asin:i,position:a,isSponsored:!1}))});let e=!1;try{const n=window.SearchPageAccess;if(n){n.asinResults().each(function(e,n){const s=$(n).data("asin");isSearchPage=!0;const l=$(n).hasClass("AdHolder")||$(n).find(".s-sponsored-header").length,c={asin:s,isSponsored:l};s&&(-1===$.inArray(s,r)||!l&&-1!==$.inArray(s,i))&&-1===$.inArray(s,o)&&(r.push(s),a++,c.position=a,t.push(c),l&&i.push(s))}),e=!0}}catch(e){console.log("error",e)}($("#s-results-list-atf").length>0||$(".s-results-list").length>0||e)&&(isSearchPage=!0,$(".s-result-item.celwidget").each(function(e,n){const s=$(n).data("asin"),l=$(n).hasClass("AdHolder")||$(n).find(".s-sponsored-header").length,c={asin:s,isSponsored:l};s&&(-1===$.inArray(s,r)||!l&&-1!==$.inArray(s,i))&&-1===$.inArray(s,o)&&(r.push(s),a++,c.position=a,t.push(c),l&&i.push(s))})),($(".s-result-list .s-result-item").length>0||e)&&(-1==window.location.href.indexOf("?node=")&&(isSearchPage=!0),$(".s-result-list .s-result-item").each(function(e,n){const s=$(n).data("asin"),l=$(n).hasClass("AdHolder")||$(n).find(".s-sponsored-header").length,c={asin:s,isSponsored:l};s&&(-1===$.inArray(s,r)||!l&&-1!==$.inArray(s,i))&&-1===$.inArray(s,o)&&(r.push(s),a++,c.position=a,t.push(c),l&&i.push(s))}))}}let n=[];$.each(t,function(e,t){n.push(asinCachePrefix+"bb-row-"+t.asin+"-isSponsored-"+t.isSponsored)}),chrome.storage.local.get(n,function(e){$.each(e,function(e,a){if(!a||a.time<Date.now()/1e3-21600)return!0;const n=a.rowData.ASIN;let r=a.rowData,s=-1;const i=$.grep(t,function(e,t){if(e&&e.asin==n&&e.isSponsored==r.isSponsored)return s=t,!0});t.splice(s,1),i[0]&&(r.isSponsored=i[0].isSponsored,r["Include in analysis"]=i[0].position);getBlackBoxDataTable().row.add(a.rowData).draw(!1);getBlackBoxDataTable().order([0,"asc"]).draw(),$("#bb-preloader").remove(),$("#black-box-table_wrapper").show()}),asinsRemainsToProcessCount=t.length,$.each(t,function(e,t){const a=asinCachePrefix+t.asin;chrome.storage.local.get(a,function(e){let n=!1;if(Object.keys(e).length&&(n=e[a]),!n||n.time<Date.now()/1e3-21600){let e=new AmazonProductScraper;let a=window.location.origin+"/dp/"+t.asin;e.start(a),$(e).on(e.externalEvents.productNotScraped,function(e){asinsRemainsToProcessCount--}),$(e).on(e.externalEvents.productScraped,function(e){asinsRemainsToProcessCount--;let a=e.productScrapedData;a.sellersNumber||(a.sellersNumber="1");let n,r={};n=$(a.detailsHtml).text().trim().length>25?a.detailsHtml:a.bulletsHtml,r[asinCachePrefix+a.asin]={bsr:a.bsr,bsrList:a.bsrList,category:a.category,bbSeller:a.bbSeller,sellersNumber:a.sellersNumber,detailsHtml:n,asin:a.asin,price:a.price,brand:a.brand,sellerName:a.sellerName,reviewsNumber:a.reviewsNumber,reviewsRating:a.reviewsRating,title:a.title,time:Date.now()},chrome.storage.local.set(r),addBbRequestToList(a,t)})}else asinsRemainsToProcessCount--,addBbRequestToList(n,t)})});let n=0;const r=setInterval(function(){console.log("Asins remains to process: "+asinsRemainsToProcessCount),n++,console.log("Interval counter: "+n),(!asinsRemainsToProcessCount||n>60)&&(clearInterval(r),setTimeout(function(){$.when.apply($,requestList).then(function(){}).fail(function(){}).always(function(){setTimeout(function(){console.log("finished non sponsored asins"),alwaysRequestHandler(a,!1),$(".container6").trigger("resize"),requestList=[],$.when.apply($,sponsoredRequestList).then(function(){}).fail(function(){}).always(function(){setTimeout(function(){console.log("finished sponsored asins"),getBlackBoxDataTable().order([0,"asc"]).draw(),alwaysRequestHandler(a,!0),$(".container6").trigger("resize"),sponsoredRequestList=[]},2e3)})},1e3)})},100))},1e3)})}function alwaysRequestHandler(e,t){setTimeout(function(){$(document).off("click",".DTFC_LeftBodyLiner .h10-bb-action-delete"),$(document).off("mouseenter mouseleave",".DTFC_LeftBodyLiner td.h10-bb-inc-in-analysis-wrapper"),$(document).off("click","#h10-bb-load-second-page"),$(document).on("mouseenter",".DTFC_LeftBodyLiner td.h10-bb-inc-in-analysis-wrapper",function(){$(this).html('<i class="fa fa-trash-o h10-bb-action-delete"></i>')}),$(document).on("click",".DTFC_LeftBodyLiner .h10-bb-action-delete",function(){getBlackBoxDataTable().row($(this).parents("tr")).remove().draw(),$("#h10-bb-activity-indicator").show(),calculateScore(),calculateTotals()}),$(document).on("mouseleave",".DTFC_LeftBodyLiner td.h10-bb-inc-in-analysis-wrapper",function(){const e=$("#black-box-table ."+$(this).parents("tr").attr("class").replace(/^(\S*).*/,"$1")).first();$(this).html(e.data("position"))}),$(document).on("click","#h10-bb-load-second-page",function(){const e=$(this).data("position"),t=window.location.href;$(this).remove(),loadSecondPage(t,e)}),isSearchPage&&!$("#h10-bb-load-second-page").length&&(console.log("append second page"),$("#black-box-table-body").append('<tr id="h10-bb-load-second-page"  data-position="'+e+'"><td colspan="15">Load more results</td></tr>'),$(".DTFC_LeftBodyLiner table, .DTFC_RightBodyLiner table").append("<tr><td>&nbsp;</td></tr>")),t||calculateScore(),$(".container6").trigger("resize")},500),$("#h10-bb-uses-summary-total").text(limitData.total);const a=Math.min.apply(null,limitData.left)-requestList.length+1;chrome.storage.local.set({limitdata:limitData});limitData.total;a>0?$("#h10-bb-uses-summary-used").text(limitData.total-a):$("#h10-bb-uses-summary-used").text(limitData.total),Number.isInteger(a)||$("#h10-bb-uses-summary-used").text("error");const n=a<.1*limitData.total;n&&$("#h10-bb-uses-summary").css("color","red"),(n||limitData.total<=1e3)&&$("#h10-bb-uses-summary").removeClass("hide"),$("#black-box-table-summary td.h10-bb-summary-numbers").removeClass("h10-bb-preloader-grey"),calculateTotals(),t||$.ajax({method:"GET",url:App.config.memberAccountUrl+"/black-box/get-products-from-ideas?marketplace="+getCurrentMarketplaceId(),dataType:"json"}).done(function(e){if("error"===e.status)return void console.log(e.message);e.data.forEach(function(e){$(".asin-row-"+e.asin+" i").addClass("clicked")})})}function addBbRequestToList(e,t){const a=$.ajax({method:"post",url:"https://members.helium10.com/black-box/sales",dataType:"json",data:{asins:JSON.stringify([e.asin]),marketplace:getCurrentMarketplaceId()}});t.isSponsored?sponsoredRequestList.push(a):requestList.push(a),a.done(function(e){const a=t.asin;let n=e.data,r={};r.Pin="",r["Review Velocity"]="N/A",r.SellersNumber=-1,r.isSponsored=t.isSponsored,r.isLimit=!1,r.ASIN=a,r.Seller="",r.Reviews=0,r.Rating=0,r.key=a,r.error=!1,r["Include in analysis"]=t.position,r.Brand="",r.Fulfillment="",r.Dimensions="",r.Weight="",r["Size Tier"]="",r.Images="";let s={};"limit"===e.status?(r.isLimit=!0,s=!1,(n={})[a]={status:"error"}):s=n[t.asin].data;try{limitData.total=e.total,limitData.left.push(e.left)}catch(e){console.log(e)}let i,o,l;if("error"===n[a].status){if(r.error=!s||s.error,r.Revenue=0,r.Price="",r.chartPoints=!1,r.Margin="",r.Sales=0,r.Title="",r.Category="",s&&s.productData&&s.productData.dimensions&&(o=s.productData.dimensions,r.Dimensions=o.width.toFixed(1)+"x"+o.length.toFixed(1)+"x"+o.height.toFixed(1),r.Weight=o.weight.toFixed(2),r["Size Tier"]=s.productData.sizeTier||"",r.Images=s.productData.numberOfImages||""),s&&s.category&&s.productData&&(r.imageUrl=s.productData.imageUrl||"",r.Title=s.productData.title||"",r.Category=s.category.name||"",r.Fulfillment=s.productData.sellerType||0,r.SellersNumber=s.productData.sellersNumber||-1,(!(l=s.productData.price)||l<=0)&&(l=" "),s.productData.fbaFee>0?r.Margin=s.productData.fbaFee/100:r.Margin=" "),s.reviewHistory){i=s.reviewHistory;try{if(!Array.isArray(i)){const e=Object.keys(i);r["Review Velocity"]=i[e[e.length-1]].count-i[e[0]].count}}catch(e){console.log("e",e)}}r.BSR="",r["Sales 30"]=""}else{if(s&&s.productData&&s.productData.dimensions&&(o=s.productData.dimensions,r.Dimensions=o.width.toFixed(1)+"x"+o.length.toFixed(1)+"x"+o.height.toFixed(1),r.Weight=o.weight.toFixed(2),r["Size Tier"]=s.productData.sizeTier||"",r.Images=s.productData.numberOfImages||""),s.reviewHistory){i=s.reviewHistory;const e=Object.keys(i);r["Review Velocity"]=i[e[e.length-1]].count-i[e[0]].count}const e=s.bsrHistory.history,t=s.salesHistory.history;let a=[];t&&Object.keys(t).filter(function(e){const t=new Date(e),a=new Date;return a.setDate((new Date).getDate()-30),t.getTime()>a.getTime()}).forEach(function(e){a.push(t[e])}),r.chartPoints=a,r.imageUrl=s.productData.imageUrl||"",r.Title=s.productData.title||"",r.Fulfillment=s.productData.sellerType||0,r.Category=s.category.name||"",r.SellersNumber=s.productData.sellersNumber||-1;let n=" ";e&&(n=e[Object.keys(e)[Object.keys(e).length-1]]||" "),r.BSR=n,r["Sales 30"]=" ",(!(l=s.productData.price)||l<=0)&&(l=" "),s.productData.fbaFee>0?r.Margin=s.productData.fbaFee/100:r.Margin=" ";let c=s.productData.price*s.salesHistory.last30DaysSales;(isNaN(c)||!c||c<0)&&(c=0),r.Revenue=c,r.Price=l,r.Sales=s.salesHistory.last30DaysSales||0}if("limit"===e.status)r.SellersNumber='<span class="h10-bb-blur">'+Math.floor(10*Math.random()+5)+"</<span>",r.Revenue='<span class="h10-bb-blur">'+Math.floor(1e4*Math.random()+1).toLocaleString(getCurrentLocale().locale,{style:"currency",currency:getCurrentLocale().currency})+"</<span>",r.Price='<span class="h10-bb-blur">'+Math.floor(100*Math.random()+1).toLocaleString(getCurrentLocale().locale,{style:"currency",currency:getCurrentLocale().currency})+"</<span>",r.Margin='<span class="h10-bb-blur">'+Math.floor(100*Math.random()+1).toLocaleString(getCurrentLocale().locale,{style:"currency",currency:getCurrentLocale().currency})+"</<span>",r.Sales='<span class="h10-bb-blur">'+Math.floor(1e4*Math.random()+1).toLocaleString(getCurrentLocale().locale)+"</<span>",r.BSR='<span class="h10-bb-blur">'+Math.floor(1e4*Math.random()+1).toLocaleString(getCurrentLocale().locale)+"</<span>",r.Fulfillment=4;else{let e={};e[asinCachePrefix+"bb-row-"+a+"-isSponsored-"+t.isSponsored]={rowData:r,time:Math.floor(Date.now()/1e3)},chrome.storage.local.set(e)}getBlackBoxDataTable().row.add(r).draw(!1);getBlackBoxDataTable().order([0,"asc"]).draw();const c=$("#h10-bb-load-second-page").clone();c.length&&(calculateScore(),calculateTotals(),$("#black-box-table-body").append(c)),$("#bb-preloader").remove(),$("#black-box-table_wrapper").show()})}function showModal(e){$(".h10-overlay").hide(),$(e).parents(".h10-overlay").show(),in_progress=!0,$(e).css("top","50px"),$(e).show()}function closeModal(){in_progress=!1,$("#h10-bb-10-chart-iframe").attr("src",null).hide(),$("#h10-bb-graph-popup-spinner").show(),$(".h10-bb-graph-popup").addClass("hide"),$("#black-box-tab").css("opacity",1),$(".h10-overlay ").hide(),$(".container6").hide()}function extractAsin(){let e=window.location.href.match(/\/(dp|product|asin)\/([0-9A-Za-z]{10,})/);return e||(e=window.location.href.match(/\/(d)\/[\s\S]+([0-9A-Za-z]{10,})/)),!(!e||0===e.length)&&e[2]}function showPreview(e){const t="https://www.amazon.com/dp/"+e;$.ajax({method:"GET",url:t,timeout:15e3,xhr:function(){const e=jQuery.ajaxSettings.xhr(),t=e.setRequestHeader;return e.setRequestHeader=function(e,a){"X-Requested-With"!==e&&"Referer"!==e&&t.call(this,e,a)},e}}).done(function(a){const n=$(a),r=(n.find("#productTitle").text()||self.data.find("#btAsinTitle").text()||self.data.find("#aiv-content-title").text()||self.data.find("#title_feature_div").text()||self.data.find("#ebooksProductTitle").text()||self.data.find(".AAG_ProductTitle a").attr("title")||"N/A").trim();let s=n.find("#landingImage, #imgBlkFront, #ebooksImgBlkFront").attr("data-a-dynamic-image");s?(s=JSON.parse(s),s=Object.keys(s)[0]?Object.keys(s)[0].trim():null):(s=n.find("#main-image").attr("src"))||(s=n.find("#js-masrw-main-image").attr("afr-data-src"));let i=n.find("#SalesRank").clone().find("ul,style,li").remove().end().text().match(/((#)|(Nr.\s))?[0-9,.]+/i);if(i)i=i[0].replace(/(#)|(Nr.)|(,)|(\.)/gi,"");else{let e,t=0;n.find('th:contains("Best Sellers Rank")').next().find(':contains("#")').each(function(){const a=$(this).text().split(">").length;(0===t||a<t)&&(t=a,e=$(this))}),e&&(i=e.text().replace(/#([,\d]+)\sin\s[\s\S]*/,"$1").replace(/[^\d]/g,""))}$("#product-title").text(r).attr("href",t),$(".media-object").attr("src",s),$("#product-asin").text(e),$("#product-bsr").text(i),$("#product-preview").show()})}function calculateTotals(){let e=0,t=0,a=0,n=0,r=0,s=0,i=0,o=0,l=0;getBlackBoxDataTable().rows().data().each(function(c){if(c.isSponsored)return!0;const d=c.Price;d&&"number"==typeof d&&(e+=d,t++);const b=c.Revenue,h=c.Sales;b&&"number"==typeof b&&h&&"number"==typeof h&&(n++,r+=b,a+=h);const u=c.BSR;u&&"number"==typeof u&&(s+=u,i++);const p=c.Reviews;p&&"number"==typeof p&&(o+=p,l++)});const c=parseInt(o/l);$("#h10-bb-avg-reviews-number").text(c.toLocaleString(getCurrentLocale().locale));const d=parseInt(a/n)||"N/A";$("#h10-bb-avg-monthly-sales").text(d.toLocaleString(getCurrentLocale().locale));let b=parseInt(s/i)||"N/A";b<1e6&&(b=b.toLocaleString(getCurrentLocale().locale)),$("#h10-bb-avg-sales-rank").text(b);let h=e/t||"N/A";h=isNaN(h)?"N/A":h<1e3?h.toLocaleString(getCurrentLocale().locale,{style:"currency",currency:getCurrentLocale().currency,minimumFractionDigits:2,maximumFractionDigits:2}):h.toLocaleString(getCurrentLocale().locale,{style:"currency",currency:getCurrentLocale().currency,minimumFractionDigits:0,maximumFractionDigits:0}),$("#h10-bb-avg-price").text(h);const u=parseFloat(r/n)||"N/A";$("#h10-bb-sales-number").text(r.toLocaleString(getCurrentLocale().locale,{style:"currency",currency:getCurrentLocale().currency,minimumFractionDigits:0,maximumFractionDigits:0})),$("#h10-bb-avg-monthly-sales").text(u.toLocaleString(getCurrentLocale().locale,{style:"currency",currency:getCurrentLocale().currency,minimumFractionDigits:0,maximumFractionDigits:0}))}function calculateScore(){let e=$('input[name="field-keywords"]').val();const t=$("#zg_centerListWrapper").length||$("#zg-center-div").length;if(!e&&!t)return $("#h10-bb-activity-indicator").hide(),!1;if(extractAsin())return $("#h10-bb-activity-indicator").hide(),!1;let a,n="search";e&&(a=(a=(a=$("#s-result-count").text()).includes("over")?a.replace(/^.+of over (.+) results.+$/,"$1"):a.replace(/^.+of (.+) results.+$/,"$1")).replace(/,/g,""),a=parseInt(a,10)||-1),t&&(e=-1,a=100,n="bestseller");let r=[],s=0;getBlackBoxDataTable().rows().data().each(function(e){r.push({asin:e.ASIN,price:e.Price,fees:e.Margin,fulfillment:e.Fulfillment,salesCount:e.Sales,rating:e.Rating,reviews:e.Reviews,isSponsored:e.isSponsored?1:0,revenue:e.Revenue}),e.isLimit&&s++});const i=$("#h10-bb-viability-score");if(s>r.length/2){$("#h10-bb-activity-indicator").hide(),i.html(" ");for(let e=0;e<5;e++)i.append('<i class="fa fa-ban" ></i>');i.append(" (n/a)")}else{const t={keyword:e,products:r,resultsNumber:a,source:n,marketplace:getCurrentMarketplaceId()};$.ajax({method:"post",url:App.config.memberAccountUrl+"/black-box/viability-score",dataType:"json",data:JSON.stringify(t)}).fail(function(){$("#h10-bb-activity-indicator").hide(),i.html(" ");for(let e=0;e<5;e++)$("#h10-bb-viability-score").append('<i class="fa fa-question-circle-o " ></i>');i.append(" (n/a)")}).done(function(e){if($("#h10-bb-activity-indicator").hide(),i.html(" "),"error"===e.status){for(let e=0;e<5;e++)$("#h10-bb-viability-score").append('<i class="fa fa-question-circle-o " ></i>');return i.append(" (n/a)"),void console.log(e.errMsg)}const t=Math.round(e.score/10);i.html("<span></span>");let a=0;for(;a<t;)(a+=2)<=t?$("#h10-bb-viability-score span").append('<i class="fa fa-star" ></i>'):$("#h10-bb-viability-score span").append('<i class="fa fa-star-half-o" ></i>');if(a<10){const e=(10-a)/2;for(let t=0;t<e;t++)$("#h10-bb-viability-score span").append('<i class="fa fa-star-o" ></i>')}i.append(" ("+e.score+")"),e.message&&$("#h10-bb-viability-score span").tooltipster({content:e.message,contentAsHTML:!0,trackOrigin:!0,maxWidth:400,interactive:!0})})}}let asins=[],in_progress=!1,dt=!1;extensionId=chrome.runtime.id;const asinCachePrefix="asin-"+amazonWebsite+"-";$(function(){function e(){if(!1==!!u){u=$("#asin-grabber-table").DataTable({bInfo:!1,paging:!1,order:[[1,"asc"]],searching:!1,autoWidth:!1,createdRow:function(e,t,a){$(e).addClass("ag-row "+t.asin).data("isSponsored",t.isSponsored).data("position",t.position),$(".container6").trigger("resize")},rowCallback:function(e,t,a,n,r){t.rating<0&&$(e).find("td.h10-ag-rating").html('<span style="color:#999">n/a</span>')},columns:[{name:"Position",data:"position",title:"#",className:"h10-ag-position"},{name:"ASIN",data:"asin",title:"ASIN",className:"h10-ag-asin",render:function(e){return'<a href="/dp/'+e+'" target="_blank" > '+e+"</a>"}},{name:"Brand",data:"brand",title:"Brand",className:"h10-ag-brand",render:function(e){return"<div title='"+e+"'> "+e+"</div>"}},{name:"Title",data:"title",title:"Title",className:"h10-ag-title",render:function(e,t,a,n){return a.isSponsored?"<div title='"+e+"'> "+sponsoredImageHtml+e+"</div>":"<div title='"+e+"'> "+e+"</div>"}},{name:"Price",data:"price",title:"Price",className:"h10-ag-price",render:function(e){return e.toLocaleString(getCurrentLocale().locale,{style:"currency",currency:getCurrentLocale().currency})}},{name:"BSR",data:"bsr",title:"BSR",className:"h10-ag-bsr",render:function(e){return e.toLocaleString(getCurrentLocale().locale)}},{name:"Rating",data:"rating",title:"Rating",className:"h10-ag-rating",render:function(e){return e<1?'<span style="color:#999">n/a</span>':e}},{name:"Reviews",data:"reviews",title:"Reviews",className:"h10-ag-reviews",render:function(e){return e.toLocaleString(getCurrentLocale().locale)}}]});const e=chrome.runtime.getURL("html/images/svg/rolling.svg");$("#asin-grabber-table-summary").after('<div id="ag-preloader" style="text-align: center;"><img class="fa-spin" alt="" src="'+e+'"><div class="bb-line-1">Wait, not so fast </div>\n<div class="bb-line-2">For the extension to work correctly, try loading it on a page with tons of products!</div></div>'),$("#asin-grabber-table_wrapper").hide()}return u}function t(e){let t="";return(0!==(t=void 0===e?i:$(e)).find("#pagn").length||0!==t.find(".zg_pagination").length)&&(0!==t.find(".pagnCur").next().find("a").length||0!==t.find(".zg_page.zg_selected").next().find("a").length)&&(t.find(".pagnCur").next().find("a").length>0?t.find(".pagnCur").next().find("a").attr("href"):t.find(".zg_page.zg_selected").next().find("a").length>0?t.find(".zg_page.zg_selected").next().find("a").attr("href"):void 0)}function a(e,t){$.ajax({url:e,type:"GET",success:t})}function n(e){for(let t=0;t!==asins.length;t++){if(void 0===asins[t])return!1;if(asins[t].asin===e)return!0}return!1}function r(s){if($(s).find("#s-results-list-atf").length>0||$(s).find(".s-results-list").length>0){console.log("page counter"),console.log(m),function(t){$(t).find(".s-result-item.celwidget").each(function(t,a){if($(a).data("asin")&&asins.length<100&&!n($(a).data("asin"))){const t=$(a).data("asin");let n=++g;const r=asinCachePrefix+t;chrome.storage.local.get(r,function(s){$("#ag-preloader").remove(),$("#asin-grabber-table_wrapper").show(),$("#h10-ag-export-wrapper").show();let i=!1;if(Object.keys(s).length&&(i=s[r]),!i||i.time<Date.now()/1e3-21600){let r=new AmazonProductScraper,s=window.location.origin+"/dp/"+t;r.start(s),$(r).on(r.externalEvents.productNotScraped,function(){f++,console.log("not scrapped "+t)}),$(r).on(r.externalEvents.productScraped,function(r){let s=r.productScrapedData;s.sellersNumber||(s.sellersNumber="1");let o,l={};o=$(s.detailsHtml).text().trim().length>25?s.detailsHtml:s.bulletsHtml,l[asinCachePrefix+s.asin]={bsr:s.bsr,bsrList:s.bsrList,category:s.category,bbSeller:s.bbSeller,sellersNumber:s.sellersNumber,detailsHtml:o,asin:s.asin,price:s.price,brand:s.brand,sellerName:s.sellerName,reviewsNumber:s.reviewsNumber,reviewsRating:s.reviewsRating,title:s.title,time:Date.now()},chrome.storage.local.set(l);const c={asin:t,title:(i=s).title,price:i.price,position:n,bsr:i.bsr,brand:i.brand,reviews:i.reviewsNumber,rating:i.reviewsRating,isSponsored:$(a).hasClass("AdHolder")||$(a).find(".s-sponsored-header").length};asins.push({asin:$(a).data("asin"),title:i.title,position:g,bsr:i.bsr}),e().row.add(c).draw(!1),e().order([0,"asc"]).draw()})}else{let r={asin:t,title:i.title,price:i.price,position:n,bsr:i.bsr,brand:i.brand,reviews:i.reviewsNumber,rating:i.reviewsRating,isSponsored:$(a).hasClass("AdHolder")||$(a).find(".s-sponsored-header").length};e().row.add(r).draw(!1),e().order([0,"asc"]).draw(),asins.push({asin:$(a).data("asin"),title:i.title,position:g,bsr:i.bsr})}})}})}(s),m++;let i=t(s);i&&g<100&&in_progress&&a(i,r)}if($(s).find("#zg_centerListWrapper").length>0||$(s).find(".zg-item-immersion .a-list-item").length>0){!function(t){$(t).find("#zg_centerListWrapper .zg_itemImmersion").each(function(t,a){let r="";if((r=void 0!==$(a).find(".p13n-asin").first().data("p13nAsinMetadata")?$(a).find(".p13n-asin").first().data("p13nAsinMetadata").asin:$(a).find(".p13n-asin").data("p13n-asin-meatdata").asin)&&asins.length<100&&!n(r)){let t=++g;const n=asinCachePrefix+r;chrome.storage.local.get(n,function(s){$("#ag-preloader").remove(),$("#asin-grabber-table_wrapper").show(),$("#h10-ag-export-wrapper").show();let i=!1;if(Object.keys(s).length&&(i=s[n]),!i||i.time<Date.now()/1e3-21600){let n=new AmazonProductScraper,s=amazonWebsite+"/dp/"+r;n.start(s),$(n).on(n.externalEvents.productNotScraped,function(){f++,console.log("not scrapped "+r)}),$(n).on(n.externalEvents.productScraped,function(n){let s=n.productScrapedData;s.sellersNumber||(s.sellersNumber="1");let o,l={};o=$(s.detailsHtml).text().trim().length>25?s.detailsHtml:s.bulletsHtml,l[asinCachePrefix+s.asin]={bsr:s.bsr,bsrList:s.bsrList,category:s.category,bbSeller:s.bbSeller,sellersNumber:s.sellersNumber,detailsHtml:o,asin:s.asin,price:s.price,brand:s.brand,sellerName:s.sellerName,reviewsNumber:s.reviewsNumber,reviewsRating:s.reviewsRating,title:s.title,time:Date.now()},chrome.storage.local.set(l);let c={asin:r,title:(i=s).title,price:i.price,position:t,bsr:i.bsr,brand:i.brand,reviews:i.reviewsNumber,rating:i.reviewsRating,isSponsored:$(a).hasClass("AdHolder")||$(a).find(".s-sponsored-header").length};asins.push({asin:$(a).data("asin"),title:i.title,position:g,bsr:i.bsr}),e().row.add(c).draw(!1),e().order([0,"asc"]).draw()})}else{let n={asin:r,title:i.title,price:i.price,position:t,bsr:i.bsr,brand:i.brand,reviews:i.reviewsNumber,rating:i.reviewsRating,isSponsored:$(a).hasClass("AdHolder")||$(a).find(".s-sponsored-header").length};e().row.add(n).draw(!1),e().order([0,"asc"]).draw(),asins.push({asin:$(a).data("asin"),title:i.title,position:g,bsr:i.bsr})}})}}),$(t).find(".zg-item-immersion .a-list-item").each(function(t,a){let r=$(this).find("a.a-link-normal").first().attr("href").match(/\/(dp|product|asin)\/([0-9A-Za-z]{10,})/);if(!r||0===r.length)return!1;let s=r[2];if(!n(s)){let t=++g;const n=asinCachePrefix+s;chrome.storage.local.get(n,function(r){$("#ag-preloader").remove(),$("#asin-grabber-table_wrapper").show(),$("#h10-ag-export-wrapper").show();let i=!1;if(Object.keys(r).length&&(i=r[n]),!i||i.time<Date.now()/1e3-21600){let n=new AmazonProductScraper,r=window.location.origin+"/dp/"+s;n.start(r),$(n).on(n.externalEvents.productNotScraped,function(){f++,console.log("not scrapped "+s)}),$(n).on(n.externalEvents.productScraped,function(n){let r=n.productScrapedData;r.sellersNumber||(r.sellersNumber="1");let o,l={};o=$(r.detailsHtml).text().trim().length>25?r.detailsHtml:r.bulletsHtml,l[asinCachePrefix+r.asin]={bsr:r.bsr,bsrList:r.bsrList,category:r.category,bbSeller:r.bbSeller,sellersNumber:r.sellersNumber,detailsHtml:o,asin:r.asin,price:r.price,brand:r.brand,sellerName:r.sellerName,reviewsNumber:r.reviewsNumber,reviewsRating:r.reviewsRating,title:r.title,time:Date.now()},chrome.storage.local.set(l);let c={asin:s,title:(i=r).title,price:i.price,position:t,bsr:i.bsr,brand:i.brand,reviews:i.reviewsNumber,rating:i.reviewsRating,isSponsored:$(a).hasClass("AdHolder")||$(a).find(".s-sponsored-header").length};asins.push({asin:$(a).data("asin"),title:i.title,position:g,bsr:i.bsr}),e().row.add(c).draw(!1),e().order([0,"asc"]).draw()})}else{let n={asin:s,title:i.title,price:i.price,position:t,bsr:i.bsr,brand:i.brand,reviews:i.reviewsNumber,rating:i.reviewsRating,isSponsored:$(a).hasClass("AdHolder")||$(a).find(".s-sponsored-header").length};e().row.add(n).draw(!1),e().order([0,"asc"]).draw(),asins.push({asin:$(a).data("asin"),title:i.title,position:g,bsr:i.bsr})}})}})}(s);let i=t(s);i&&g<100&&in_progress&&a(i,r)}}function s(e,t){getDataTable(),e.forEach(function(e){let t=p.length;p.push(e);let a="seller-"+t;t++;let n=e.sellerName,r=e.totalPrice||0,s="Yes"===e.fufilmentByAmazon?"Amazon":"Seller",i=e.rating,o=e.recentRatingDetails,l=e.offering;if(y.includes(l))return;y.push(l);let c=e;c.key=a,c.Seller=n,c.Stock="",c.Price=r,c.Fulfillment=s,c.Rating="",c.Description=o,c.offer=l;getDataTable().row.add(c).draw(!1);$("tr."+a+" td").last().raty({score:i,readOnly:!0,hints:null}).append(e.ratingText)}),function(e){$("#sellers-table-body .seller-row").each(function(){let t=$(this).find(".stock");if(t.text().trim())return;t.html('<i class="fa fa-spinner fa-spin fa-fw"></i>');const a={seller:$(this).data("seller"),offer:$(this).data("offer"),asin:extractAsin()};$.ajax({url:e+"/extension/get-stock",type:"POST",data:a}).done(function(e){console.log("get stock"),e.stock?("999"===e.stock&&(e.stock="1000+"),e.hasLimit&&!t.prev().has(".limited-box").length&&t.prev().append('<br><span class="limited-box">Seller has set max quantity</span>'),t.html(e.stock)):t.html("n/a")}).fail(function(){t.html("n/a")})})}(t)}const i=$("body");$.fn.raty.defaults.path=chrome.extension.getURL("html/images");const o=chrome.extension.getURL("html/images/svg/close.svg"),l=chrome.runtime.getURL("html/images/svg/rolling.svg");let c=chrome.extension.getURL("html/templates/modal.ejs"),d=new EJS({url:c}).render({close:o,spinner:l});i.append(d);const b=chrome.extension.getURL("html/images/logo1.png");$("#bb-helium-logo").attr("src",b),c=chrome.extension.getURL("html/templates/asin-grabber.ejs"),d=new EJS({url:c}).render({close:o}),i.append(d),$("#ag-helium-logo").attr("src",b),c=chrome.extension.getURL("html/templates/stock-stats.ejs"),d=new EJS({url:c}).render({close:o}),i.append(d),c=chrome.extension.getURL("html/templates/calculator.ejs"),d=new EJS({url:c}).render({close:o}),i.append(d),extractAsin()&&$("#h10-inventory-levels").parent().removeClass("hide"),$(".h10-bb-summary-labels").tooltipster();const h="h10-bb-columns-options";chrome.storage.local.get(h,function(e){let t;if(Object.keys(e).length)t=e[h];else{let e={};e[h]=t={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0,10:!0,11:!0,12:!0,13:!0,14:!0,15:!0},chrome.storage.local.set(e)}$.each(t,function(e,t){if(!t){getBlackBoxDataTable().column(e).visible(t),$("#h10-bb-column-"+e).prop("checked",!1)}}),$(".h10-bb-columns-options").iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green"})}),$(".h10-bb-csv-action").tooltipster({content:"Download CSV report"}),$(".h10-bb-screenshot-action").tooltipster({content:"Export as image"}),$(".h10-bb-list-action").tooltipster({content:"Open My List"}),$(".container6").draggable({handle:".top-tabs",containment:"window",drag:function(){const e=$(".container6");e.hasClass("h10-bb-dragged")||($(".content-div").hide(),e.addClass("h10-bb-dragged").draggable("enable"))},stop:function(){const e=$(".container6");$(".content-div").show(),e.position().top<0&&e.css("top",0)}}),$(".top-tabs").mousedown(function(e){const t=$(".container6");"DIV"===e.target.tagName?($(".content-div").hide(),t.addClass("h10-bb-dragged").draggable("enable")):t.removeClass("h10-bb-dragged").draggable("disable")}).mouseup(function(){$(".content-div").show(),$(".container6").removeClass("h10-bb-dragged")}).mouseleave(function(){$(".content-div").show(),$(".container6").removeClass("h10-bb-dragged").draggable("disable")}),$(".container6:not(.profitabily-calculator-modal)").resizable(),$(".container6").on("resize",function(){const e=$("th.h10-bb-title"),t=(e.width()-50)/2;$("td.h10-bb-title div").css("margin-right",-t).width(e.width()-10);const a=$(".container6:visible"),n=a.height()-240,r=n+40,s=$(".asin-grabber-modal").height()-50;$("#asin-grabber").height(s);const i=a.height()-55,o=$("#black-box");o.height(i+"px"),$("#black-box .dataTables_scrollBody").css("max-height",n+"px"),$("#sellers-table tbody").height(r),$("#asin-grabber-table tbody").height(s-180),$(".bb-footer").css("width",o.width()+"px").css("top",n+180);const l=o.width()-340;$("div.h10-bb-settings-popup ").css("left",l),getBlackBoxDataTable().draw()}),i.append('<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&amp;lang=en">'),i.append('<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">'),$(document).on("click",".h10-ag-csv-action",function(){let t="Position,ASIN,Brand,Title,Price,BSR,Rating,Reviews\r\n";e().rows().data().each(function(e){let a=e.title.replace(/"/g,'""');e.isSponsored&&(a="($) "+a),t+=e.position+","+e.asin+',"'+e.brand.replace(/"/g,'""')+'","'+a+'",'+e.price+","+e.bsr+","+e.rating+","+e.reviews+"\r\n"});const a=new Blob([t],{type:"text/csv;charset=utf-8;\ufeff"}),n=document.createElement("a"),r=URL.createObjectURL(a);n.setAttribute("href",r),n.setAttribute("download","ASIN_Grabber_export.csv"),n.style.visibility="hidden",document.body.appendChild(n),n.click(),document.body.removeChild(n)}),$(document).on("click",".helium10-overlay",function(){closeModal()}),$(document).on("click",".close-btn",function(){return $(".h10-bb-settings-popup").addClass("hide"),closeModal(),!1}),$(document).on("ifToggled",".h10-bb-columns-options",function(){const e=getBlackBoxDataTable(),t=$(this).attr("data-column"),a=e.column(t),n=!a.visible();a.visible(n),chrome.storage.local.get(h,function(e){if(Object.keys(e).length){let a=e[h];a[t]=n;let r={};r[h]=a,chrome.storage.local.set(r),$(".container6").trigger("resize")}})}),$(document).on("click","#black-box",function(e){if($(e.target).hasClass("h10-bb-settings"))return!1;$(".h10-bb-settings-popup").addClass("hide")}),chrome.runtime.onMessage.addListener(function(t,n,o){if(t.hasOwnProperty("type"))switch(t.type){case"open-stock-stats":getStockStats();break;case"open-asin-grabber":!function(){g=0,asins=[],m=0,e().clear(),makeTabActive("#asin-grabber"),showModal(".asin-grabber-modal"),$(".container6").trigger("resize");const t=window.location.href;in_progress&&a(t,r),setTimeout(function(){let t=0;const a=setInterval(function(){if(++t>50&&$("#h10-ag-export-wrapper").show(),t>100||g-f-e().rows().data().length<=1){clearInterval(a),$(document).off("click",".h10-ag-action-delete"),$(document).off("mouseenter mouseleave","td.h10-ag-position"),$(document).on("mouseenter","td.h10-ag-position",function(){$(this).html('<i class="fa fa-trash-o h10-ag-action-delete"></i>')}),$(document).on("click",".h10-ag-action-delete",function(){e().row($(this).parents("tr")).remove().draw()}),$(document).on("mouseleave","td.h10-ag-position",function(){$(this).html($(this).parents("tr").data("position"))});let t=0,n=0,r=0,s=0,i=0,o=0;e().rows().data().each(function(e){const a=parseFloat(e.price);a>0&&(t+=a,n++);const l=parseInt(e.bsr);l&&(r+=l,s++);const c=parseInt(e.reviews);c&&(i+=c,o++)});const l=parseInt(i/o);$("#h10-ag-avg-reviews-number").text(l.toLocaleString(getCurrentLocale().locale));let c=parseInt(r/s)||"N/A";c=c.toLocaleString(getCurrentLocale().locale),$("#h10-ag-avg-sales-rank").text(c);let d=t/n||"N/A";d=isNaN(d)?"N/A":d.toLocaleString(getCurrentLocale().locale,{style:"currency",currency:getCurrentLocale().currency,minimumFractionDigits:2,maximumFractionDigits:2}),$("#h10-ag-avg-price").text(d),$("#h10-ag-export-wrapper").show()}},2e3)},6e3)}();break;case"sellers-found":s(t.data,t.backend);break;case"on-product-page":!function(e){const t={status:!1,marketplace:getCurrentMarketplaceId()};extractAsin()?t.status="product":(i.find("#s-results-list-atf").length>0||i.find("#zg_centerListWrapper").length>0||i.find(".zg-item-immersion .a-list-item").length>0||i.find(".s-result-list .s-result-item ").length>0)&&(t.status="listing"),e(t)}(o);break;case"open-black-box":getBlackBox();break;case"open-calculator":getCalculator()}return!0}),$.fn.dataTable.ext.order["dom-text-numeric"]=function(e,t){return this.api().column(t,{order:"index"}).nodes().map(function(e,t){return 1*$(e).text()})},$.fn.dataTable.ext.order["dom-text-currency"]=function(e,t){return this.api().column(t,{order:"index"}).nodes().map(function(e){return Number($(e).text().replace(/[^0-9.-]+/g,""))})};let u=!1,p=[],m=0,g=0,f=0,y=[]});let isSsFirstRun=!0,isBbFirstRun=!0,bbDt=!1;const sponsoredImage=chrome.extension.getURL("html/images/svg/sp.png"),sponsoredImageHtml='<img alt="" src="'+sponsoredImage+'">';let asinsRemainsToProcessCount=0,isSearchPage=!1,limitData={total:0,left:[]};chrome.storage.local.get("limitdata",function(e){Object.keys(e).length&&(limitData=e.limitdata)});let requestList=[],sponsoredRequestList=[];