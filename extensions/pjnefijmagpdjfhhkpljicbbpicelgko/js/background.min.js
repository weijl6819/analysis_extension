function f(e){s?m():(t=e.id,l())}function g(){try{v.lang=u,v.start()}catch(e){}}function h(){try{v.stop()}catch(e){}}function i(e){chrome.tabs.query({active:!0,currentWindow:!0},function(n){if(!j(n))return void m()
chrome.tabs.sendMessage(n[0].id,{action:"on_results",txtToAdd:e},function(e){})})}function j(e){return void 0!=e&&null!=e&&!(e.length<1)&&e[0].id==t}function k(e){chrome.tabs.query({active:!0,currentWindow:!0},function(n){if(!j(n))return void m()
chrome.tabs.sendMessage(n[0].id,{action:"on_interim_results",txtToAdd:e},function(e){})})}function l(){s=!0,p(),g(),n(!0),chrome.runtime.sendMessage({message_id:"recognition_started_in_bg"})}function m(){s=!1,h(),p(),n(!1),chrome.runtime.sendMessage({message_id:"recognition_stopped_in_bg"})}function n(e){e?chrome.browserAction.setIcon({path:"images/ic_mic_red_36dp.png"}):chrome.browserAction.setIcon({path:"images/ic_mic_black_36dp.png"})}function update_language(e){u=e,chrome.storage.local.set({stored_lang:e},function(){})}function o(){}function p(){var e
e=s?"Stop recording":"Start recording",chrome.contextMenus.update(w,{title:e})}function q(e,n){s?m():(t=n.id,l())}function b(){var e=""
chrome.storage.local.get("stored_lang",function(n){"string"==typeof(e=n.stored_lang)&&e.length>1&&update_language(e)})}function r(e){for(var n=(new Date).getTime(),t=n;t<n+e;)t=(new Date).getTime()}function getMasterId(){return t}function getIsRecording(){return s}var s=!1,t=-1,u="en-US"
b()
var v=new webkitSpeechRecognition
v.continuous=!0,v.interimResults=!0,v.maxAlternatives=1,v.lang=u
var w=chrome.contextMenus.create({title:"Start recording",contexts:["editable"],id:ga},o)
chrome.browserAction.onClicked.addListener(f),chrome.runtime.onMessage.addListener(function(e,n){switch(e.message_id){case"start_recording":t=e.tab_id,l()
break
case"stop_recording":m()
break
case"update_language":update_language(e.language)}}),v.onstart=function(){xa=!1,ya="",za=""},v.onend=function(){if(xa){for(var e=0;e<ra.length;e++)ya=ya.replace(new RegExp(ra[e]+"$"),sa[e])
i(ya),ya="",xa=!1}return i(za),za="",!s||(v.start(),!1)},v.onspeechstart=function(){},v.onspeechend=function(){},v.onnomatch=function(e){},v.onerror=function(e){"not-allowed"===e.error&&chrome.runtime.openOptionsPage(function(){}),v.stop()},v.onresult=function(e){if(void 0===e.results)return v.onend=null,ua.intentionalPause=!0,v.stop(),void upgrade()
ya=""
for(var n="",t=e.resultIndex;t<e.results.length;++t)if(n=X(e.results[t][0].transcript),e.results[t].isFinal){switch(xa=!1,ya="",pa.indexOf(n)){case 0:return}for(var r=0;r<ra.length;r++)n.endsWith(ra[r])&&(n=n.replace(new RegExp(ra[r]+"$"),sa[r]))
ya="",i(n)}else{xa=!0,ya+=e.results[t][0].transcript,k(ya),n=" "+n
for(var r=0;r<qa.length;r++)if(n.endsWith(qa[r]))return g(),void(va=!0)}},chrome.tabs.onRemoved.addListener(function(e,n){e==t&&m()}),chrome.tabs.onActivated.addListener(function(e){e.tabId!=t&&m()}),chrome.contextMenus.onClicked.addListener(q)
